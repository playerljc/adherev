"use strict";require("core-js/modules/es.object.define-property.js"),require("core-js/modules/es.array.index-of.js"),require("core-js/modules/es.regexp.exec.js"),require("core-js/modules/es.string.split.js"),require("core-js/modules/es.function.name.js"),require("core-js/modules/es.array.find-index.js"),require("core-js/modules/es.array.find.js"),require("core-js/modules/es.object.to-string.js"),require("core-js/modules/es.array.map.js");var __importDefault=function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});var classnames_1=__importDefault(require("classnames")),adherev_util_1=__importDefault(require("@baifendian/adherev-util")),selectorPrefix="adherev-ui-surnames",DURATION=100;exports.default={name:"adv-surnames",props:{className:{type:String,default:""},position:{type:String,default:"right",validator:function(e){return-1!==["top","right","bottom","left"].indexOf(e)}},indexes:{type:Array,default:function(){return[]}},dataSource:{type:Array,default:function(){return[]}}},data:function(){return{$key:!1,$isMouseClicked:!1,$isMouseMoved:!1,$startY:null,$startX:null,$curIndexName:null,$indexPositionMap:null,$maskEl:null}},computed:{getClassName:function(){var e=this.position,t=this.className;return classnames_1.default(selectorPrefix,selectorPrefix+"-config-position-"+e,t.split(" "))}},mounted:function(){this.initEvent(),this.createMask(),this.adapterDimension(),this.createIndexPosition()},updated:function(){this.adapterDimension(),this.createIndexPosition()},beforeDestroy:function(){var e=this.$data.$maskEl;e&&e.parentElement.removeChild(e)},methods:{onClick:function(e){e.preventDefault(),e.stopPropagation(),this.clickDetail(e)},onTouchmove:function(e){e.preventDefault();var t=e.changedTouches[0].pageY,i=e.changedTouches[0].pageX,e=e.target,e=adherev_util_1.default.getTopDom(e,selectorPrefix+"-index-item");this.$data.$curIndexName=e.dataset.name,this.moveDetail(i,t)},onTouchend:function(){var e=this.$refs.highlightedEl;e.style.display="none",e.innerText="",e.style.transform="translate3d(0,0,0)"},onMousedown:function(e){e.preventDefault(),this.$data.$startY=e.pageY,this.$data.$startX=e.pageX;e=e.target,e=adherev_util_1.default.getTopDom(e,selectorPrefix+"-index-item");this.$data.$curIndexName=e.dataset.name,this.$data.$isMouseClicked=!0},onMousemove:function(e){if(!this.$data.$isMouseClicked)return!1;this.$data.$isMouseMoved=!0,e.preventDefault();var t=e.pageY,e=e.pageX;this.moveDetail(e,t)},onMouseleave:function(){var e=this.$refs.highlightedEl;this.$data.$isMouseClicked=!1,this.$data.$isMouseMoved=!1,e.style.display="none",e.innerText="",e.style.transform="translate3d(0,0,0)"},onMouseup:function(e){var t=this.$refs.highlightedEl,i=this.$data;if(i.$isMouseMoved)return i.$isMouseClicked=!1,i.$isMouseMoved=!1,t.style.display="none",t.innerText="",!(t.style.transform="translate3d(0,0,0)");e.preventDefault(),this.clickDetail(e)},onResize:function(){this.update()},clickDetail:function(e){var t=e.target;e.preventDefault();e=this.$data;if(e.$key)return!1;e.$key=!0,e.$maskEl.style.display="block";var t=adherev_util_1.default.getTopDom(t,selectorPrefix+"-index-item");this.scrollToAnimation(null===(t=null==t?void 0:t.dataset)||void 0===t?void 0:t.name)},moveDetail:function(e,t){var i,e=this.findIndex(e,t);e&&((t=this.$refs.highlightedEl).innerText=e.name,t.style.display="block","vertical"===this.getDirection()?(i=e.offsetTop+Math.floor(e.height/2),t.style.transform="translate3d(0,"+i+"px,0)"):(i=e.offsetLeft+e.width,t.style.transform="translate3d("+i+"px,0,0)"),this.scrollTo(e.name))},initEvent:function(){var e=this.$refs.indexInnerEl;adherev_util_1.default.isTouch()?(e.addEventListener("click",this.onClick),e.addEventListener("touchmove",this.onTouchmove),e.addEventListener("touchend",this.onTouchend)):(e.addEventListener("mousedown",this.onMousedown),e.addEventListener("mousemove",this.onMousemove),e.addEventListener("mouseleave",this.onMouseleave),e.addEventListener("mouseup",this.onMouseup),window.addEventListener("resize",this.onResize))},adapterDimension:function(){var e=this.$refs,t=e.el,e=e.indexInnerEl;"vertical"===this.getDirection()?(null!=t&&(t.style.height=(null==e?void 0:e.offsetHeight)+50+"px"),null!=t&&(t.style.width="100%")):null!=t&&(t.style.height="100%")},createIndexPosition:function(){var e=this.$refs.indexInnerEl,t=this.$data,i=e.querySelectorAll("."+selectorPrefix+"-index-item");t.$indexPositionMap=[];for(var n=0;n<i.length;n++){var s=i[n],r=s.dataset.name,o=s.getBoundingClientRect();t.$indexPositionMap.push({name:r,top:o.top,bottom:o.bottom,left:o.left,right:o.right,offsetTop:s.offsetTop,offsetLeft:s.offsetLeft,width:s.offsetWidth,height:s.offsetHeight})}},createMask:function(){var e=document.createElement("div");e.innerHTML="<div class='"+selectorPrefix+"-mask'></div>",this.$data.$maskEl=e.firstElementChild,document.body.appendChild(this.$data.$maskEl)},scrollToAnimation:function(i,e){void 0===e&&(e=100);var n=this,t=this.$refs,s=t.contentEl,r=t.el,o=this.$data,t=s.querySelector("."+selectorPrefix+"-group-title[data-name='"+i+"']"),a=s.scrollTop,l=t.offsetTop,t=screen.updateInterval,d=r.scrollHeight/((DURATION|e)/(t||16.7)+((DURATION|e)%(t||16.7)!=0?1:0));this.$emit("before-scroll",i),window.requestAnimationFrame(function e(){function t(){o.$key=!1,o.$isMouseClicked=!1,o.$maskEl.style.display="none",n.$emit("scroll",i)}s.scrollTop<l?l<a+d?a=l:a+=d:a-d<l?a=l:a-=d,s.scrollTop=a,s.scrollTop<l?l<=a?t():window.requestAnimationFrame(e):a<=l?t():window.requestAnimationFrame(e)})},scrollTo:function(e){var t=this.$refs.contentEl;t.scrollTop=t.querySelector("."+selectorPrefix+"-group-title[data-name='"+e+"']").offsetTop,this.$emit("scroll",e)},getDirection:function(){var e=this.position;return"left"===e||"right"===e?"vertical":"horizontal"},findIndex:function(e,t){for(var i,n=this.getDirection(),s=this.$data,r=s.$startX,o=s.$startY,a=s.$curIndexName,l=s.$indexPositionMap,d="vertical"===n?t-o:e-r,u=l.find(function(e){return e.name===a}),c=0,f=l.length-1;c<=f&&c<=l.length-1&&f<=l.length-1;){var h,m=l[h=f+c>>1],v=void 0,p=void 0,x=void 0,x="vertical"===n?(v=u.top+d,u.bottom,p=m.top,m.bottom):(v=u.left+d,u.right,p=m.left,m.right);if(p<=v&&v<=x){i=m;break}v<p?f=h-1:c=1+h}return i||null},update:function(){this.adapterDimension(),this.createIndexPosition()},renderIndex:function(t){var i=this.$scopedSlots;return this.indexes.map(function(e){return t("a",{key:e.index,class:selectorPrefix+"-index-item",attrs:{"data-name":e.index}},[i.index(e)])})},renderContent:function(t){var i=this.$scopedSlots;return this.dataSource.map(function(e){return t("div",{key:e.index,class:selectorPrefix+"-group"},[t("a",{class:selectorPrefix+"-group-title",attrs:{"data-name":e.index}},[i.title(e)]),t("div",{class:selectorPrefix+"-group-inner"},[i.content(e)])])})}},render:function(e){return e("div",{class:this.getClassName,ref:"el"},[e("div",{class:selectorPrefix+"-highlighted",ref:"highlightedEl"}),e("div",{class:selectorPrefix+"-content",ref:"contentEl"},[this.renderContent(e)]),e("div",{class:selectorPrefix+"-index",ref:"indexEl"},[e("div",{class:selectorPrefix+"-index-inner",ref:"indexInnerEl"},[this.renderIndex(e)])])])}};
//# sourceMappingURL=surnames.js.map
