{"version":3,"file":"EditableTableCellEdit.js","sources":["Extension/EditableCell/Edit/EditableTableCellEdit.js"],"sourcesContent":["import \"core-js/modules/es.number.constructor.js\";\nimport \"core-js/modules/es.array.concat.js\";\nimport { __assign } from \"tslib\";\nimport { Form, Icon } from 'ant-design-vue';\nimport { selectorPrefix } from '../../../SearchTable';\nimport FormItemGenerator from './FormItemGenerator';\n/**\n * EditableTableCellEdit\n * @description 可编辑单元格的编辑状态\n */\nexport default {\n  props: {\n    rowIndex: {\n      type: Number\n    },\n    record: {\n      type: Object\n    },\n    column: {\n      type: Object\n    },\n    columns: {\n      type: Array\n    },\n    editableConfig: {\n      type: Object\n    }\n  },\n  emits: ['triggerChange'],\n  inject: ['getFormIns', 'getContext'],\n  methods: {\n    /**\n     * renderFormItem\n     */\n    renderFormItem: function renderFormItem(h) {\n      var _a, _b, _c, _d;\n      var _e = this.editableConfig,\n        useKeepEdit = _e.useKeepEdit,\n        dataIndex = _e.dataIndex,\n        type = _e.type,\n        render = _e.render,\n        dictName = _e.dictName,\n        renderChildren = _e.renderChildren;\n      var _f = this,\n        rowIndex = _f.rowIndex,\n        record = _f.record;\n      var form = this.getFormIns();\n      var formItemNodeProps = __assign({\n        autoFocus: !useKeepEdit\n      }, this.editableConfig.props);\n      var formItemNode = FormItemGenerator.render(h, {\n        type: type,\n        props: formItemNodeProps,\n        dictName: dictName,\n        renderChildren: renderChildren,\n        form: form,\n        dataIndex: dataIndex,\n        rowIndex: rowIndex\n      });\n      var $scopedSlots = (_c = (_b = (_a = this.getContext) === null || _a === void 0 ? void 0 : _a.call(this)) === null || _b === void 0 ? void 0 : _b.context) === null || _c === void 0 ? void 0 : _c.$scopedSlots;\n      var renderArgs = {\n        value: record === null || record === void 0 ? void 0 : record[dataIndex],\n        record: record,\n        dataIndex: dataIndex,\n        rowIndex: rowIndex,\n        form: form,\n        children: formItemNode\n      };\n      return ((_d = $scopedSlots === null || $scopedSlots === void 0 ? void 0 : $scopedSlots[render]) === null || _d === void 0 ? void 0 : _d.call($scopedSlots, renderArgs)) || (render === null || render === void 0 ? void 0 : render(renderArgs)) || formItemNode;\n    },\n    /**\n     * renderDefaultSaveTrigger\n     * @description 渲染缺省的保存句柄\n     */\n    renderDefaultSaveTrigger: function renderDefaultSaveTrigger(h) {\n      return h(Icon, {\n        \"attrs\": {\n          \"type\": \"check\"\n        }\n      });\n    },\n    /**\n     * renderDefaultCancelTrigger\n     * @description 渲染缺省的取消句柄\n     */\n    renderDefaultCancelTrigger: function renderDefaultCancelTrigger(h) {\n      return h(Icon, {\n        \"attrs\": {\n          \"type\": \"close\"\n        }\n      });\n    },\n    /**\n     * onSaveTrigger\n     * @description 点击了保存句柄\n     */\n    onSaveTrigger: function onSaveTrigger() {\n      var _this = this;\n      var _a = this.editableConfig,\n        dataIndex = _a.dataIndex,\n        onSave = _a.onSave;\n      var _b = this,\n        rowIndex = _b.rowIndex,\n        record = _b.record;\n      var form = this.getFormIns();\n      var value = this.getValue();\n      if (onSave) {\n        form === null || form === void 0 ? void 0 : form.validateFields().then(function (values) {\n          var _a;\n          (_a = onSave({\n            value: value,\n            values: values,\n            record: record,\n            dataIndex: dataIndex,\n            rowIndex: rowIndex\n          })) === null || _a === void 0 ? void 0 : _a.then(function () {\n            _this.$emit('triggerChange');\n          });\n        });\n        return;\n      }\n      this.$emit('triggerChange');\n    },\n    /**\n     * onCancelTrigger\n     * @description 点击了cancel句柄\n     */\n    onCancelTrigger: function onCancelTrigger() {\n      var _this = this;\n      var _a;\n      var _b = this.editableConfig,\n        dataIndex = _b.dataIndex,\n        onBeforeCancel = _b.onBeforeCancel;\n      var _c = this,\n        rowIndex = _c.rowIndex,\n        record = _c.record;\n      var value = this.getValue();\n      if (onBeforeCancel) {\n        (_a = onBeforeCancel({\n          value: value,\n          record: record,\n          dataIndex: dataIndex,\n          rowIndex: rowIndex\n        })) === null || _a === void 0 ? void 0 : _a.then(function () {\n          return _this.$emit('triggerChange');\n        });\n        return;\n      }\n      this.$emit('triggerChange');\n    },\n    /**\n     * getValue\n     */\n    getValue: function getValue() {\n      var _a, _b;\n      return (_b = (_a = this.getFormIns) === null || _a === void 0 ? void 0 : _a.call(this)) === null || _b === void 0 ? void 0 : _b.getFieldValue(\"\".concat(this.editableConfig.dataIndex, \"_\").concat(this.rowIndex));\n    }\n  },\n  render: function render(h) {\n    var _a, _b, _c, _d, _e;\n    var _f = this.editableConfig,\n      useTrigger = _f.useTrigger,\n      useKeepEdit = _f.useKeepEdit,\n      renderSaveTrigger = _f.renderSaveTrigger,\n      renderCancelTrigger = _f.renderCancelTrigger,\n      dataIndex = _f.dataIndex,\n      type = _f.type,\n      render = _f.render,\n      rules = _f.rules,\n      formItemProps = _f.formItemProps;\n    var _g = this,\n      record = _g.record,\n      rowIndex = _g.rowIndex;\n    var context = (_b = (_a = this.getContext) === null || _a === void 0 ? void 0 : _a.call(this)) === null || _b === void 0 ? void 0 : _b.context;\n    var $scopedSlots = context === null || context === void 0 ? void 0 : context.$scopedSlots;\n    var form = this.getFormIns();\n    var getFieldDecorator = form.getFieldDecorator;\n    var renderArgs = {\n      value: record === null || record === void 0 ? void 0 : record[dataIndex],\n      record: record,\n      dataIndex: dataIndex,\n      rowIndex: rowIndex,\n      form: form\n    };\n    var renderSaveTriggerArgs = {\n      value: record === null || record === void 0 ? void 0 : record[dataIndex],\n      record: record,\n      dataIndex: dataIndex,\n      rowIndex: rowIndex\n    };\n    var renderCancelTriggerArgs = {\n      value: record === null || record === void 0 ? void 0 : record[dataIndex],\n      record: record,\n      dataIndex: dataIndex,\n      rowIndex: rowIndex\n    };\n    return h(\"div\", {\n      \"class\": \"\".concat(selectorPrefix, \"-editablecell-edit\")\n    }, [h(\"div\", {\n      \"class\": \"\".concat(selectorPrefix, \"-editablecell-edit-inner\")\n    }, [h(Form.Item, [getFieldDecorator(\"\".concat(dataIndex, \"_\").concat(rowIndex), __assign({\n      rules: rules,\n      initialValue: context === null || context === void 0 ? void 0 : context.valueToFormItemValue({\n        type: type,\n        record: record,\n        dataIndex: dataIndex\n      })\n    }, formItemProps || {}))(type !== 'custom' ? this.renderFormItem(h) : ((_c = $scopedSlots === null || $scopedSlots === void 0 ? void 0 : $scopedSlots[render]) === null || _c === void 0 ? void 0 : _c.call($scopedSlots, renderArgs)) || (render === null || render === void 0 ? void 0 : render(renderArgs)))])]), !!useTrigger && !useKeepEdit && h(\"div\", {\n      \"class\": \"\".concat(selectorPrefix, \"-editablecell-edit-trigger\")\n    }, [h(\"div\", {\n      \"class\": \"\".concat(selectorPrefix, \"-editablecell-edit-trigger-inner\")\n    }, [h(\"div\", {\n      \"class\": \"\".concat(selectorPrefix, \"-editablecell-edit-trigger-save\"),\n      \"on\": {\n        \"click\": this.onSaveTrigger\n      }\n    }, [((_d = $scopedSlots === null || $scopedSlots === void 0 ? void 0 : $scopedSlots[renderSaveTrigger]) === null || _d === void 0 ? void 0 : _d.call($scopedSlots, renderSaveTriggerArgs)) || (renderSaveTrigger === null || renderSaveTrigger === void 0 ? void 0 : renderSaveTrigger(renderSaveTriggerArgs)) || this.renderDefaultSaveTrigger(h)]), h(\"div\", {\n      \"class\": \"\".concat(selectorPrefix, \"-editablecell-edit-trigger-cancel\"),\n      \"on\": {\n        \"click\": this.onCancelTrigger\n      }\n    }, [((_e = $scopedSlots === null || $scopedSlots === void 0 ? void 0 : $scopedSlots[renderCancelTrigger]) === null || _e === void 0 ? void 0 : _e.call($scopedSlots, renderCancelTriggerArgs)) || (renderCancelTrigger === null || renderCancelTrigger === void 0 ? void 0 : renderCancelTrigger(renderCancelTriggerArgs)) || this.renderDefaultCancelTrigger(h)])])])]);\n  }\n};"],"names":["__assign","Form","Icon","selectorPrefix","FormItemGenerator","props","rowIndex","type","Number","record","Object","column","columns","Array","editableConfig","emits","inject","methods","renderFormItem","h","_e","this","useKeepEdit","dataIndex","render","dictName","renderChildren","form","getFormIns","formItemNodeProps","autoFocus","formItemNode","$scopedSlots","_c","_b","_a","getContext","call","context","renderArgs","value","children","_d","renderDefaultSaveTrigger","attrs","renderDefaultCancelTrigger","onSaveTrigger","_this","onSave","getValue","validateFields","then","values","$emit","onCancelTrigger","onBeforeCancel","getFieldValue","concat","_f","useTrigger","renderSaveTrigger","renderCancelTrigger","rules","formItemProps","getFieldDecorator","renderSaveTriggerArgs","renderCancelTriggerArgs","class","Item","initialValue","valueToFormItemValue","on","click"],"mappings":"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"}