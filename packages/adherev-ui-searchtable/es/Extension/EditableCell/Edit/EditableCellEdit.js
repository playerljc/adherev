import"core-js/modules/es.number.constructor.js";import"core-js/modules/es.array.reduce.js";import"core-js/modules/es.object.to-string.js";import{__assign}from"tslib";import{Form,Icon}from"ant-design-vue";import moment from"moment";import{selectorPrefix}from"../../../SearchTable";import EventTypes from"../EventTypes";import FormItemGenerator from"./FormItemGenerator";export default{props:{rowIndex:{type:Number},record:{type:Object},column:{type:Object},columns:{type:Array},editableConfig:{type:Object}},emits:["triggerChange"],inject:["getFormIns","getContext"],methods:{updateEditorCellData:function(){var e,t=this.editableConfig.dataIndex,r=this.record,n=this.getValue();return n instanceof moment?null==(e=null==(e=null==(e=this.getContext)?void 0:e.call(this))?void 0:e.context)?void 0:e.updateEditorCellDateData({record:r,dataIndex:t,value:n}):null==(e=null==(e=null==(e=this.getContext)?void 0:e.call(this))?void 0:e.context)?void 0:e.updateEditorCellDate({record:r,dataIndex:t,value:n})},renderFormItem:function(e){var r=this,t=this.editableConfig,n=t.useKeepEdit,i=t.dataIndex,o=t.type,l=t.render,d=t.dictName,t=t.renderChildren,a=this.rowIndex,s=this.record,c=this.getFormIns(),n=__assign(__assign({autoFocus:!n},this.editableConfig.props),EventTypes.reduce(function(e,t){return e[t]=function(e){r.editableConfig.props[t]&&r.editableConfig.props[t](e,{form:c,dataIndex:i,rowIndex:a,updateEditorCellData:function(){return r.updateEditorCellData()}})},e},{})),e=FormItemGenerator.render(e,{type:o,props:n,dictName:d,renderChildren:t,form:c,dataIndex:i,rowIndex:a}),t=null==(d=null==(n=null==(o=this.getContext)?void 0:o.call(this))?void 0:n.context)?void 0:d.$scopedSlots,o={value:null==s?void 0:s[i],record:s,dataIndex:i,rowIndex:a,form:c,updateEditorCellData:function(){return r.updateEditorCellData()},children:e};return(null==(n=null==t?void 0:t[l])?void 0:n.call(t,o))||(null==l?void 0:l(o))||e},renderDefaultSaveTrigger:function(){return h(Icon,{attrs:{type:"check"}})},onSaveTrigger:function(){var t=this,e=this.editableConfig,r=e.dataIndex,n=e.onSave,i=this.rowIndex,o=this.record,e=this.getFormIns(),l=this.getValue();n?null!=e&&e.validateFields().then(function(e){null!=(e=n({value:l,values:e,record:o,dataIndex:r,rowIndex:i}))&&e.then(function(){t.$emit("triggerChange")})}):this.$emit("triggerChange")},onCancelTrigger:function(){var e=this,t=this.editableConfig,r=t.dataIndex,t=t.onBeforeCancel,n=this.rowIndex,i=this.record,o=this.getValue();t?null!=(t=t({value:o,record:i,dataIndex:r,rowIndex:n}))&&t.then(function(){return e.$emit("triggerChange")}):this.$emit("triggerChange")},renderDefaultCancelTrigger:function(){return h(Icon,{attrs:{type:"close"}})},getValue:function(){var e;return null==(e=null==(e=this.getFormIns)?void 0:e.call(this))?void 0:e.getFieldValue(this.editableConfig.dataIndex)}},render:function(e){var t=this,r=this.editableConfig,n=r.useTrigger,i=r.useKeepEdit,o=r.renderSaveTrigger,l=r.renderCancelTrigger,d=r.dataIndex,a=r.type,s=r.render,c=r.rules,r=r.formItemProps,u=this.record,g=this.rowIndex,v=null==(v=null==(v=this.getContext)?void 0:v.call(this))?void 0:v.context,m=null==v?void 0:v.$scopedSlots,h=this.getFormIns(),f=h.getFieldDecorator,h={value:null==u?void 0:u[d],record:u,dataIndex:d,rowIndex:g,form:h,updateEditorCellData:function(){return t.updateEditorCellData()}},p={value:null==u?void 0:u[d],record:u,dataIndex:d,rowIndex:g},g={value:null==u?void 0:u[d],record:u,dataIndex:d,rowIndex:g};return e("div",{class:"".concat(selectorPrefix,"-editablecell-edit")},[e("div",{class:"".concat(selectorPrefix,"-editablecell-edit-inner")},[e(Form.Item,[f(d,__assign({rules:c,initialValue:null==v?void 0:v.valueToFormItemValue({type:a,record:u,dataIndex:d})},r||{}))("custom"!==a?this.renderFormItem(e):(null==(f=null==m?void 0:m[s])?void 0:f.call(m,h))||(null==s?void 0:s(h)))])]),!!n&&!i&&e("div",{class:"".concat(selectorPrefix,"-editablecell-edit-trigger")},[e("div",{class:"".concat(selectorPrefix,"-editablecell-edit-trigger-inner")},[e("div",{class:"".concat(selectorPrefix,"-editablecell-edit-trigger-save"),on:{click:this.onSaveTrigger}},[(null==(c=null==m?void 0:m[o])?void 0:c.call(m,p))||(null==o?void 0:o(p))||this.renderDefaultSaveTrigger()]),e("div",{class:"".concat(selectorPrefix,"-editablecell-edit-trigger-cancel"),on:{click:this.onCancelTrigger}},[(null==(v=null==m?void 0:m[l])?void 0:v.call(m,g))||(null==l?void 0:l(g))||this.renderDefaultCancelTrigger()])])])])}};
//# sourceMappingURL=EditableCellEdit.js.map
