import _Form from"ant-design-vue/es/form";import _CloseOutlined from"@ant-design/icons-vue/es/icons/CloseOutlined";import _CheckOutlined from"@ant-design/icons-vue/es/icons/CheckOutlined";import{mergeProps as _mergeProps,createVNode as _createVNode}from"vue";import"core-js/modules/es.array.reduce.js";import"core-js/modules/es.object.to-string.js";import"core-js/modules/es.object.keys.js";import"core-js/modules/es.array.concat.js";import{__assign}from"tslib";import dayjs from"dayjs";import{defineComponent,inject}from"vue";import{array,number,object}from"vue-types";import{selectorPrefix}from"../../../SearchTable";import FormItemGenerator from"./FormItemGenerator";export default defineComponent({props:{rowIndex:number(),record:object().def({}),column:object().def({}),columns:array().def([]),editableConfig:object()},emits:["triggerChange"],setup:function(d,e){function i(){var e,l=__assign({autoFocus:!(null!=(l=null==d?void 0:d.editableConfig)&&l.useKeepEdit)},(null==(l=null==d?void 0:d.editableConfig)?void 0:l.props)||{}),n=Object.keys((null==(n=null==d?void 0:d.editableConfig)?void 0:n.listeners)||{}).reduce(function(e,o){return e[o]=function(e){var l,n;null!=(n=null==(n=d.editableConfig)?void 0:(l=n.listeners)[o])&&n.call(l,e,{form:c,dataIndex:null==(n=null==d?void 0:d.editableConfig)?void 0:n.dataIndex,rowIndex:null==d?void 0:d.rowIndex,updateEditorCellData:function(){return m()}})},e},{}),o=FormItemGenerator.render({type:null==(o=null==d?void 0:d.editableConfig)?void 0:o.type,props:l,listeners:n,dictName:null==(o=null==d?void 0:d.editableConfig)?void 0:o.dictName,renderChildren:null==(l=null==d?void 0:d.editableConfig)?void 0:l.renderChildren,dataIndex:null==(n=null==d?void 0:d.editableConfig)?void 0:n.dataIndex,rowIndex:null==d?void 0:d.rowIndex,initialValue:g,name:b,form:c,context:v}),n={value:null==(l=null==d?void 0:d.record)?void 0:l[null==(n=null==d?void 0:d.editableConfig)?void 0:n.dataIndex],record:null==d?void 0:d.record,dataIndex:null==(l=null==d?void 0:d.editableConfig)?void 0:l.dataIndex,rowIndex:null==d?void 0:d.rowIndex,updateEditorCellData:function(){return m()},children:o,form:c};return(null==(l=null==u?void 0:u[null==(l=null==d?void 0:d.editableConfig)?void 0:l.render])?void 0:l.call(u,n))||(null==(e=null==(l=null==d?void 0:d.editableConfig)?void 0:l.render)?void 0:e.call(l,n))||o}function r(){var e,o=n();null!=(e=null==d?void 0:d.editableConfig)&&e.onSave?null!=c&&c.validateFields().then(function(e){var l,n;null!=(n=null==(l=null==(n=null==d?void 0:d.editableConfig)?void 0:n.onSave)?void 0:l.call(n,{value:o,values:e,record:null==d?void 0:d.record,dataIndex:null==(l=null==d?void 0:d.editableConfig)?void 0:l.dataIndex,rowIndex:null==d?void 0:d.rowIndex}))&&n.then(function(){a("triggerChange")})}):a("triggerChange")}function t(){var e,l=null==(l=null==d?void 0:d.record)?void 0:l[null==(l=null==d?void 0:d.editableConfig)?void 0:l.dataIndex];v.formData[b]=l,null!=(e=null==d?void 0:d.editableConfig)&&e.onBeforeCancel?null!=(l=null==(e=null==d?void 0:d.editableConfig)?void 0:e.onBeforeCancel({value:l,record:null==d?void 0:d.record,dataIndex:null==(e=null==d?void 0:d.editableConfig)?void 0:e.dataIndex,rowIndex:null==d?void 0:d.rowIndex}))&&l.then(function(){return a("triggerChange")}):a("triggerChange")}var a=e.emit,u=e.slots,e=inject("getContext"),v=null==(e=null==e?void 0:e())?void 0:e.context,c=null==(e=inject("getFormIns"))?void 0:e(),f={value:null==(e=null==d?void 0:d.record)?void 0:e[null==(e=null==d?void 0:d.editableConfig)?void 0:e.dataIndex],record:d.record,dataIndex:null==(e=null==d?void 0:d.editableConfig)?void 0:e.dataIndex,rowIndex:null==d?void 0:d.rowIndex},s={value:null==(e=null==d?void 0:d.record)?void 0:e[null==(e=null==d?void 0:d.editableConfig)?void 0:e.dataIndex],record:null==d?void 0:d.record,dataIndex:null==(e=null==d?void 0:d.editableConfig)?void 0:e.dataIndex,rowIndex:null==d?void 0:d.rowIndex},g=null==v?void 0:v.valueToFormItemValue({type:null==(e=null==d?void 0:d.editableConfig)?void 0:e.type,record:d.record,dataIndex:null==(e=null==d?void 0:d.editableConfig)?void 0:e.dataIndex}),C={initialValue:g,value:null==(e=null==d?void 0:d.record)?void 0:e[null==(e=null==d?void 0:d.editableConfig)?void 0:e.dataIndex],record:null==d?void 0:d.record,dataIndex:null==(e=null==d?void 0:d.editableConfig)?void 0:e.dataIndex,rowIndex:null==d?void 0:d.rowIndex,form:c,updateEditorCellData:function(){return m()}},m=function(){var e=n(),l={record:null==d?void 0:d.record,dataIndex:null==(l=null==d?void 0:d.editableConfig)?void 0:l.dataIndex,value:e,rowIndex:null==d?void 0:d.rowIndex};return e instanceof dayjs?null==v?void 0:v.updateEditorCellDateData(l):null==v?void 0:v.updateEditorCellDate(l)},n=function(){return v.formData[b]},b="".concat(null==(e=null==d?void 0:d.editableConfig)?void 0:e.dataIndex,"_").concat(null==d?void 0:d.rowIndex);return function(){var e,l,n,o;return _createVNode("div",{class:"".concat(selectorPrefix,"-editablecell-edit")},[_createVNode("div",{class:"".concat(selectorPrefix,"-editablecell-edit-inner")},[_createVNode(_Form.Item,_mergeProps({name:b,rules:null==(o=null==d?void 0:d.editableConfig)?void 0:o.rules},(null==(o=null==d?void 0:d.editableConfig)?void 0:o.formItemProps)||{}),{default:function(){return["custom"!==(null==(e=null==d?void 0:d.editableConfig)?void 0:e.type)?null===i?void 0:i():(null==(e=null==u?void 0:u[null==(e=null==d?void 0:d.editableConfig)?void 0:e.render])?void 0:e.call(u,C))||(null==(l=null==(e=null==d?void 0:d.editableConfig)?void 0:e.render)?void 0:l.call(e,C))]}})]),!(null==(o=null==d?void 0:d.editableConfig)||!o.useTrigger)&&!(null!=(o=null==d?void 0:d.editableConfig)&&o.useKeepEdit)&&_createVNode("div",{class:"".concat(selectorPrefix,"-editablecell-edit-trigger")},[_createVNode("div",{class:"".concat(selectorPrefix,"-editablecell-edit-trigger-inner")},[_createVNode("div",{class:"".concat(selectorPrefix,"-editablecell-edit-trigger-save"),onClick:r},[(null==(o=null==u?void 0:u[null==(o=null==d?void 0:d.editableConfig)?void 0:o.renderSaveTrigger])?void 0:o.call(u,f))||(null==(n=null==(o=null==d?void 0:d.editableConfig)?void 0:o.renderSaveTrigger)?void 0:n.call(o,f))||_createVNode(_CheckOutlined,null,null)]),_createVNode("div",{class:"".concat(selectorPrefix,"-editablecell-edit-trigger-cancel"),onClick:t},[(null==(o=null==u?void 0:u[null==(n=null==d?void 0:d.editableConfig)?void 0:n.renderCancelTrigger])?void 0:o.call(u,s))||(null==(o=null==(n=null==d?void 0:d.editableConfig)?void 0:n.renderCancelTrigger)?void 0:o.call(n,s))||_createVNode(_CloseOutlined,null,null)])])])])}}});
//# sourceMappingURL=EditableCellEdit.js.map
