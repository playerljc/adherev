{"version":3,"file":"index.js","sources":["Extension/EditableCell/EditableRowControl/index.js"],"sourcesContent":["import { createVNode as _createVNode } from \"vue\";\nimport { defineComponent, inject } from 'vue';\nimport { func, number, object, oneOfType, string } from 'vue-types';\nimport Intl from '@baifendian/adherev-util-intl';\nimport { selectorPrefix } from '../../../SearchTable';\nexport default defineComponent({\n  name: 'adv-searchtable-editable-row-control',\n  props: {\n    rowKey: string().def(''),\n    rowIndex: number(),\n    editorRowId: string().def(''),\n    record: object().def({}),\n    renderEditorRow: oneOfType([string(), func()]),\n    renderSave: oneOfType([string(), func()]),\n    renderCancel: oneOfType([string(), func()]),\n    onSave: func(),\n    onEditor: func()\n  },\n  emits: ['renderEditorRow', 'renderSave', 'renderCancel'],\n  setup: function setup(props, _a) {\n    var _b, _c, _d;\n    var slots = _a.slots;\n    var context = (_c = (_b = inject('getContext')) === null || _b === void 0 ? void 0 : _b()) === null || _c === void 0 ? void 0 : _c.context;\n    var form = (_d = inject('getFormIns')) === null || _d === void 0 ? void 0 : _d();\n    var setRowFieldValue = inject('setRowFieldValue');\n    var renderDefaultEditorRow = function renderDefaultEditorRow() {\n      return _createVNode(\"a\", null, [Intl.tv('编辑行')]);\n    };\n    var renderDefaultCancel = function renderDefaultCancel() {\n      return _createVNode(\"a\", null, [Intl.tv('取消')]);\n    };\n    var renderDefaultSave = function renderDefaultSave() {\n      return _createVNode(\"a\", null, [Intl.tv('保存')]);\n    };\n    var validateFieldsSuccess = function validateFieldsSuccess(values) {\n      if (props.onSave) {\n        props.onSave(values).then(function () {\n          return updateEditorCellRowData(values);\n        });\n        return;\n      }\n      updateEditorCellRowData(values);\n    };\n    var updateEditorCellRowData = function updateEditorCellRowData(values) {\n      var _a;\n      (_a = context === null || context === void 0 ? void 0 : context.updateEditorCellRowData({\n        values: values,\n        record: props.record,\n        rowIndex: props.rowIndex\n      })) === null || _a === void 0 ? void 0 : _a.then(function () {\n        return onReset();\n      });\n    };\n    var updateRowEdit = function updateRowEdit() {\n      if (context) {\n        context.editorRowId = props.record[props.rowKey];\n      }\n    };\n    var onReset = function onReset() {\n      if (context) {\n        context.editorRowId = '';\n        setRowFieldValue === null || setRowFieldValue === void 0 ? void 0 : setRowFieldValue(props.record, props === null || props === void 0 ? void 0 : props.rowIndex);\n        // const formData = {};\n        //\n        // Object.keys(props.record).forEach((dataIndex) => {\n        //   const column = context?.getColumnByDataIndex(dataIndex);\n        //   if (!column) return;\n        //\n        //   const type = column?.$editable?.type as string;\n        //\n        //   const name = `${dataIndex}_${props?.rowIndex}`;\n        //\n        //   if (['datePicker', 'timePicker'].includes(type)) {\n        //     formData[name] = dayjs(props.record[dataIndex]);\n        //   } else {\n        //     formData[name] = props.record[dataIndex];\n        //   }\n        // });\n        //\n        // context.formData = formData;\n      }\n    };\n\n    var onEditor = function onEditor() {\n      var _a, _b;\n      if (props.onEditor) {\n        (_b = (_a = props.onEditor) === null || _a === void 0 ? void 0 : _a.call(props, props.record[props.rowKey])) === null || _b === void 0 ? void 0 : _b.then(function () {\n          return updateRowEdit();\n        });\n        return;\n      }\n      updateRowEdit();\n    };\n    return function () {\n      var _a, _b, _c, _d, _e, _f;\n      return _createVNode(\"div\", {\n        \"class\": \"\".concat(selectorPrefix, \"-editor-row-control\")\n      }, [props.editorRowId !== props.record[props.rowKey] && _createVNode(\"div\", {\n        \"class\": \"\".concat(selectorPrefix, \"-editor-row-control-edit\"),\n        \"onClick\": onEditor\n      }, [((_a = slots === null || slots === void 0 ? void 0 : slots[props === null || props === void 0 ? void 0 : props.renderEditorRow]) === null || _a === void 0 ? void 0 : _a.call(slots)) || ((_b = props === null || props === void 0 ? void 0 : props.renderEditorRow) === null || _b === void 0 ? void 0 : _b.call(props)) || renderDefaultEditorRow()]), props.editorRowId === props.record[props.rowKey] && _createVNode(\"div\", {\n        \"class\": \"\".concat(selectorPrefix, \"-editor-row-control-save-cancel\")\n      }, [_createVNode(\"div\", {\n        \"class\": \"\".concat(selectorPrefix, \"-editor-row-control-save-cancel-item\"),\n        \"onClick\": function onClick() {\n          return form === null || form === void 0 ? void 0 : form.validateFields().then(function (values) {\n            return validateFieldsSuccess(values);\n          });\n        }\n      }, [((_c = slots === null || slots === void 0 ? void 0 : slots[props === null || props === void 0 ? void 0 : props.renderSave]) === null || _c === void 0 ? void 0 : _c.call(slots)) || ((_d = props === null || props === void 0 ? void 0 : props.renderSave) === null || _d === void 0 ? void 0 : _d.call(props)) || renderDefaultSave()]), _createVNode(\"div\", {\n        \"class\": \"\".concat(selectorPrefix, \"-editor-row-control-save-cancel-item\"),\n        \"onClick\": onReset\n      }, [((_e = slots === null || slots === void 0 ? void 0 : slots[props === null || props === void 0 ? void 0 : props.renderCancel]) === null || _e === void 0 ? void 0 : _e.call(slots)) || ((_f = props === null || props === void 0 ? void 0 : props.renderCancel) === null || _f === void 0 ? void 0 : _f.call(props)) || renderDefaultCancel()])])]);\n    };\n  }\n});"],"names":["_createVNode","defineComponent","inject","func","number","object","oneOfType","string","Intl","selectorPrefix","name","props","rowKey","def","rowIndex","editorRowId","record","renderEditorRow","renderSave","renderCancel","onSave","onEditor","emits","setup","_a","updateEditorCellRowData","values","context","then","onReset","updateRowEdit","_b","call","slots","_c","form","_d","setRowFieldValue","_f","class","concat","onClick","tv","validateFields","_e"],"mappings":"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"}