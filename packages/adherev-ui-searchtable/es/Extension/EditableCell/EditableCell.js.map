{"version":3,"file":"EditableCell.js","sources":["Extension/EditableCell/EditableCell.js"],"sourcesContent":["import { createVNode as _createVNode, mergeProps as _mergeProps } from \"vue\";\nimport { __assign } from \"tslib\";\nimport { computed, h, inject, onBeforeUnmount, ref, toRaw, watch } from 'vue';\nimport EditableCellEdit from './Edit/EditableCellEdit';\nimport EditableCellView from './View';\n/**\n * EditableCell\n * @description 可编辑的单元格\n */\nexport var useEditableCell = function useEditableCell(props, _a) {\n  var _b, _c, _d, _e;\n  var getContext = inject('getContext');\n  var context = (_b = getContext === null || getContext === void 0 ? void 0 : getContext()) === null || _b === void 0 ? void 0 : _b.context;\n  var setActiveValue = inject('setActiveValue');\n  var $editableCell = {\n    defaultConfig: {\n      editable: false,\n      defaultStatus: 'view',\n      type: 'input',\n      props: {},\n      formItemProps: {},\n      useTrigger: true,\n      require: true,\n      dataIndex: (_c = props.column) === null || _c === void 0 ? void 0 : _c.dataIndex,\n      useKeepEdit: false\n    }\n  };\n  var status = ref(((_e = (_d = props.column) === null || _d === void 0 ? void 0 : _d.$editable) === null || _e === void 0 ? void 0 : _e.defaultStatus) || 'view');\n  var editableCellEditableConfig = computed(function () {\n    var _a;\n    return __assign(__assign({}, $editableCell.defaultConfig), ((_a = props.column) === null || _a === void 0 ? void 0 : _a.$editable) || {});\n  });\n  var watchHandler1 = watch(function () {\n    return context === null || context === void 0 ? void 0 : context.getData();\n  }, function () {\n    status.value = editableCellEditableConfig.value.defaultStatus;\n  });\n  var watchHandler2 = watch(function () {\n    var _a, _b;\n    return (_b = (_a = props.column) === null || _a === void 0 ? void 0 : _a.$editable) === null || _b === void 0 ? void 0 : _b.defaultStatus;\n  }, function () {\n    status.value = editableCellEditableConfig.value.defaultStatus;\n  });\n  onBeforeUnmount(function () {\n    watchHandler1();\n    watchHandler2();\n  });\n  return function (tdVNode) {\n    var res = tdVNode;\n    // 单元格不是可编辑的单元格\n    if (!editableCellEditableConfig.value.editable) {\n      res = tdVNode;\n    }\n    // 始终保持编辑状态\n    else if (editableCellEditableConfig.value.useKeepEdit) {\n      res = h(tdVNode, {}, [_createVNode(EditableCellEdit, _mergeProps(toRaw(props), {\n        \"editableConfig\": editableCellEditableConfig.value,\n        \"onTriggerChange\": function onTriggerChange() {\n          setActiveValue === null || setActiveValue === void 0 ? void 0 : setActiveValue('');\n          status.value = 'view';\n        }\n      }), {\n        default: function _default() {\n          return [tdVNode.children];\n        }\n      })]);\n    }\n    // 查看状态\n    else if (status.value === 'view') {\n      res = h(tdVNode, {}, [_createVNode(EditableCellView, _mergeProps(toRaw(props), {\n        \"editableConfig\": editableCellEditableConfig.value,\n        \"onTriggerChange\": function onTriggerChange() {\n          setActiveValue === null || setActiveValue === void 0 ? void 0 : setActiveValue(props.record[props.column.dataIndex]);\n          status.value = 'edit';\n        }\n      }), {\n        default: function _default() {\n          return [tdVNode.children];\n        }\n      })]);\n    }\n    // 编辑状态\n    else if (status.value === 'edit') {\n      res = h(tdVNode, {}, [_createVNode(EditableCellEdit, _mergeProps(toRaw(props), {\n        \"editableConfig\": editableCellEditableConfig.value,\n        \"onTriggerChange\": function onTriggerChange() {\n          setActiveValue === null || setActiveValue === void 0 ? void 0 : setActiveValue('');\n          status.value = 'view';\n        }\n      }), {\n        default: function _default() {\n          return [tdVNode.children];\n        }\n      })]);\n    }\n    return res;\n  };\n};"],"names":["_createVNode","_mergeProps","__assign","computed","h","inject","onBeforeUnmount","ref","toRaw","watch","EditableCellEdit","EditableCellView","useEditableCell","props","_a","getContext","context","_b","setActiveValue","$editableCell","defaultConfig","editable","defaultStatus","type","formItemProps","useTrigger","require","dataIndex","_c","column","useKeepEdit","status","_e","_d","$editable","editableCellEditableConfig","watchHandler1","getData","value","watchHandler2","tdVNode","res","editableConfig","onTriggerChange","default","children","record"],"mappings":"OAAwBA,4BAA4BC,yBAAwB,KAAL,aAC9DC,QAAuB,KAAP,eAChBC,SAAUC,EAAGC,OAAQC,gBAAiBC,IAAKC,MAAOC,KAAkB,KAAL,aACjEC,qBAAsB,iCACtBC,qBAAsB,SAKtB,IAAIC,gBAAkB,SAAyBC,EAAOC,GAC3D,IACIC,EAAaV,OAAO,YAAY,EAChCW,EAAU,OAACC,EAAKF,MAAAA,EAA+C,KAAA,EAASA,EAAW,GAA+B,KAAA,EAASE,EAAGD,QAC9HE,EAAiBb,OAAO,gBAAgB,EACxCc,EAAgB,CAClBC,cAAe,CACbC,SAAU,CAAA,EACVC,cAAe,OACfC,KAAM,QACNV,MAAO,GACPW,cAAe,GACfC,WAAY,CAAA,EACZC,QAAS,CAAA,EACTC,UAAW,OAACC,EAAKf,EAAMgB,QAAoC,KAAA,EAASD,EAAGD,UACvEG,YAAa,CAAA,CACf,CACF,EACIC,EAASxB,KAAK,OAACyB,EAAK,OAACC,EAAKpB,EAAMgB,QAAoC,KAAA,EAASI,EAAGC,WAAuC,KAAA,EAASF,EAAGV,gBAAkB,MAAM,EAC3Ja,EAA6BhC,SAAS,WACxC,IAAIW,EACJ,OAAOZ,SAASA,SAAS,GAAIiB,EAAcC,aAAa,GAAI,OAACN,EAAKD,EAAMgB,QAAoC,KAAA,EAASf,EAAGoB,YAAc,EAAE,CAC1I,CAAC,EACGE,EAAgB3B,MAAM,WACxB,OAAOO,MAAAA,EAAyC,KAAA,EAASA,EAAQqB,QAAQ,CAC3E,EAAG,WACDN,EAAOO,MAAQH,EAA2BG,MAAMhB,aAClD,CAAC,EACGiB,EAAgB9B,MAAM,WACxB,IAAQQ,EACR,OAAO,OAACA,EAAK,OAACH,EAAKD,EAAMgB,QAAoC,KAAA,EAASf,EAAGoB,WAAuC,KAAA,EAASjB,EAAGK,aAC9H,EAAG,WACDS,EAAOO,MAAQH,EAA2BG,MAAMhB,aAClD,CAAC,EAKD,OAJAhB,gBAAgB,WACd8B,EAAc,EACdG,EAAc,CAChB,CAAC,EACM,SAAUC,GACf,IAAIC,EAAMD,EA+CV,OA7CKL,EAA2BG,MAAMjB,SAI7Bc,EAA2BG,MAAMR,YACxCW,EAAMrC,EAAEoC,EAAS,GAAI,CAACxC,aAAaU,iBAAkBT,YAAYO,MAAMK,CAAK,EAAG,CAC7E6B,eAAkBP,EAA2BG,MAC7CK,gBAAmB,WACjBzB,MAAAA,GAAgEA,EAAe,EAAE,EACjFa,EAAOO,MAAQ,MACjB,CACF,CAAC,EAAG,CACFM,QAAS,WACP,MAAO,CAACJ,EAAQK,SAClB,CACF,CAAC,EAAE,EAGqB,SAAjBd,EAAOO,MACdG,EAAMrC,EAAEoC,EAAS,GAAI,CAACxC,aAAaW,iBAAkBV,YAAYO,MAAMK,CAAK,EAAG,CAC7E6B,eAAkBP,EAA2BG,MAC7CK,gBAAmB,WACjBzB,MAAAA,GAAgEA,EAAeL,EAAMiC,OAAOjC,EAAMgB,OAAOF,UAAU,EACnHI,EAAOO,MAAQ,MACjB,CACF,CAAC,EAAG,CACFM,QAAS,WACP,MAAO,CAACJ,EAAQK,SAClB,CACF,CAAC,EAAE,EAGqB,SAAjBd,EAAOO,QACdG,EAAMrC,EAAEoC,EAAS,GAAI,CAACxC,aAAaU,iBAAkBT,YAAYO,MAAMK,CAAK,EAAG,CAC7E6B,eAAkBP,EAA2BG,MAC7CK,gBAAmB,WACjBzB,MAAAA,GAAgEA,EAAe,EAAE,EACjFa,EAAOO,MAAQ,MACjB,CACF,CAAC,EAAG,CACFM,QAAS,WACP,MAAO,CAACJ,EAAQK,SAClB,CACF,CAAC,EAAE,GA1CHJ,EAAMD,EA4CDC,CACT,CACF,SAxFW7B,eAwFV"}