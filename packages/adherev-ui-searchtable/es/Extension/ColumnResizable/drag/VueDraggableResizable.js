import{createVNode as _createVNode}from"vue";import"core-js/modules/es.number.constructor.js";import"core-js/modules/es.array.iterator.js";import"core-js/modules/es.object.to-string.js";import"core-js/modules/es.set.js";import"core-js/modules/es.string.iterator.js";import"core-js/modules/esnext.set.add-all.js";import"core-js/modules/esnext.set.delete-all.js";import"core-js/modules/esnext.set.difference.js";import"core-js/modules/esnext.set.every.js";import"core-js/modules/esnext.set.filter.js";import"core-js/modules/esnext.set.find.js";import"core-js/modules/esnext.set.intersection.js";import"core-js/modules/esnext.set.is-disjoint-from.js";import"core-js/modules/esnext.set.is-subset-of.js";import"core-js/modules/esnext.set.is-superset-of.js";import"core-js/modules/esnext.set.join.js";import"core-js/modules/esnext.set.map.js";import"core-js/modules/esnext.set.reduce.js";import"core-js/modules/esnext.set.some.js";import"core-js/modules/esnext.set.symmetric-difference.js";import"core-js/modules/esnext.set.union.js";import"core-js/modules/web.dom-collections.iterator.js";import"core-js/modules/es.array.filter.js";import"core-js/modules/es.array.includes.js";import"core-js/modules/es.parse-int.js";import"core-js/modules/es.regexp.constructor.js";import"core-js/modules/es.regexp.exec.js";import"core-js/modules/es.regexp.to-string.js";import"core-js/modules/es.string.includes.js";import"core-js/modules/es.array.map.js";import{__assign}from"tslib";import{defineComponent}from"vue";import{addEvent,getComputedSize,matchesSelectorToParentElements,removeEvent}from"./utils/dom";import{computeHeight,computeWidth,restrictToBounds,snapToGrid}from"./utils/fns";var events={mouse:{start:"mousedown",move:"mousemove",stop:"mouseup"},touch:{start:"touchstart",move:"touchmove",stop:"touchend"}},userSelectNone={userSelect:"none",MozUserSelect:"none",WebkitUserSelect:"none",MsUserSelect:"none"},userSelectAuto={userSelect:"auto",MozUserSelect:"auto",WebkitUserSelect:"auto",MsUserSelect:"auto"},eventsFor=events.mouse;export default defineComponent({replace:!0,name:"vue-draggable-resizable",props:{className:{type:String,default:"vdr"},classNameDraggable:{type:String,default:"draggable"},classNameResizable:{type:String,default:"resizable"},classNameDragging:{type:String,default:"dragging"},classNameResizing:{type:String,default:"resizing"},classNameActive:{type:String,default:"active"},classNameHandle:{type:String,default:"handle"},disableUserSelect:{type:Boolean,default:!0},enableNativeDrag:{type:Boolean,default:!1},preventDeactivation:{type:Boolean,default:!1},active:{type:Boolean,default:!1},draggable:{type:Boolean,default:!0},resizable:{type:Boolean,default:!0},lockAspectRatio:{type:Boolean,default:!1},w:{type:[Number,String],default:200,validator:function(t){return"number"==typeof t?0<t:"auto"===t}},h:{type:[Number,String],default:200,validator:function(t){return"number"==typeof t?0<t:"auto"===t}},minWidth:{type:Number,default:0,validator:function(t){return 0<=t}},minHeight:{type:Number,default:0,validator:function(t){return 0<=t}},maxWidth:{type:Number,default:null,validator:function(t){return 0<=t}},maxHeight:{type:Number,default:null,validator:function(t){return 0<=t}},x:{type:Number,default:0},y:{type:Number,default:0},z:{type:[String,Number],default:"auto",validator:function(t){return"string"==typeof t?"auto"===t:0<=t}},handles:{type:Array,default:function(){return["tl","tm","tr","mr","br","bm","bl","ml"]},validator:function(t){var e=new Set(["tl","tm","tr","mr","br","bm","bl","ml"]);return new Set(t.filter(function(t){return e.has(t)})).size===t.length}},dragHandle:{type:String,default:null},dragCancel:{type:String,default:null},axis:{type:String,default:"both",validator:function(t){return["x","y","both"].includes(t)}},grid:{type:Array,default:function(){return[1,1]}},parent:{type:Boolean,default:!1},scale:{type:[Number,Array],default:1,validator:function(t){return"number"==typeof t?0<t:2===t.length&&0<t[0]&&0<t[1]}},onDragStart:{type:Function,default:function(){return!0}},onDrag:{type:Function,default:function(){return!0}},onResizeStart:{type:Function,default:function(){return!0}},onResize:{type:Function,default:function(){return!0}}},data:function(){return{left:this.x,top:this.y,right:null,bottom:null,width:null,height:null,widthTouched:!1,heightTouched:!1,aspectFactor:null,parentWidth:null,parentHeight:null,minW:this.minWidth,minH:this.minHeight,maxW:this.maxWidth,maxH:this.maxHeight,handle:null,enabled:this.active,resizing:!1,dragging:!1,dragEnable:!1,resizeEnable:!1,zIndex:this.z}},created:function(){this.maxWidth&&this.minWidth>this.maxWidth&&console.warn("[Vdr warn]: Invalid prop: minWidth cannot be greater than maxWidth"),this.maxWidth&&this.minHeight>this.maxHeight&&console.warn("[Vdr warn]: Invalid prop: minHeight cannot be greater than maxHeight"),this.resetBoundsAndMouseState()},mounted:function(){this.enableNativeDrag||(this.$el.ondragstart=function(){return!1});var t=this.getParentSize(),e=t[0],t=t[1],e=(this.parentWidth=e,this.parentHeight=t,getComputedSize(this.$el)),t=e[0],e=e[1];this.aspectFactor=("auto"!==this.w?this.w:t)/("auto"!==this.h?this.h:e),this.width="auto"!==this.w?this.w:t,this.height="auto"!==this.h?this.h:e,this.right=this.parentWidth-this.width-this.left,this.bottom=this.parentHeight-this.height-this.top,this.active&&this.$emit("activated"),addEvent(document.documentElement,"mousedown",this.deselect),addEvent(document.documentElement,"touchend touchcancel",this.deselect),addEvent(window,"resize",this.checkParentSize)},beforeDestroy:function(){removeEvent(document.documentElement,"mousedown",this.deselect),removeEvent(document.documentElement,"touchstart",this.handleUp),removeEvent(document.documentElement,"mousemove",this.move),removeEvent(document.documentElement,"touchmove",this.move),removeEvent(document.documentElement,"mouseup",this.handleUp),removeEvent(document.documentElement,"touchend touchcancel",this.deselect),removeEvent(window,"resize",this.checkParentSize)},methods:{resetBoundsAndMouseState:function(){this.mouseClickPosition={mouseX:0,mouseY:0,x:0,y:0,w:0,h:0},this.bounds={minLeft:null,maxLeft:null,minRight:null,maxRight:null,minTop:null,maxTop:null,minBottom:null,maxBottom:null}},checkParentSize:function(){var t,e;this.parent&&(t=(e=this.getParentSize())[0],e=e[1],this.parentWidth=t,this.parentHeight=e,this.right=this.parentWidth-this.width-this.left,this.bottom=this.parentHeight-this.height-this.top)},getParentSize:function(){var t;return this.parent?(t=window.getComputedStyle(this.$el.parentNode,null),[parseInt(t.getPropertyValue("width"),10),parseInt(t.getPropertyValue("height"),10)]):[null,null]},elementTouchDown:function(t){eventsFor=events.touch,this.elementDown(t)},elementMouseDown:function(t){eventsFor=events.mouse,this.elementDown(t)},elementDown:function(t){var e;t instanceof MouseEvent&&1!==t.which||(e=t.target||t.srcElement,this.$el.contains(e)&&!1!==this.onDragStart(t)&&(this.dragHandle&&!matchesSelectorToParentElements(e,this.dragHandle,this.$el)||this.dragCancel&&matchesSelectorToParentElements(e,this.dragCancel,this.$el)?this.dragging=!1:(this.enabled||(this.enabled=!0,this.$emit("activated"),this.$emit("update:active",!0)),this.draggable&&(this.dragEnable=!0),this.mouseClickPosition.mouseX=(t.touches?t.touches[0]:t).pageX,this.mouseClickPosition.mouseY=(t.touches?t.touches[0]:t).pageY,this.mouseClickPosition.left=this.left,this.mouseClickPosition.right=this.right,this.mouseClickPosition.top=this.top,this.mouseClickPosition.bottom=this.bottom,this.parent&&(this.bounds=this.calcDragLimits()),addEvent(document.documentElement,eventsFor.move,this.move),addEvent(document.documentElement,eventsFor.stop,this.handleUp))))},calcDragLimits:function(){return{minLeft:this.left%this.grid[0],maxLeft:Math.floor((this.parentWidth-this.width-this.left)/this.grid[0])*this.grid[0]+this.left,minRight:this.right%this.grid[0],maxRight:Math.floor((this.parentWidth-this.width-this.right)/this.grid[0])*this.grid[0]+this.right,minTop:this.top%this.grid[1],maxTop:Math.floor((this.parentHeight-this.height-this.top)/this.grid[1])*this.grid[1]+this.top,minBottom:this.bottom%this.grid[1],maxBottom:Math.floor((this.parentHeight-this.height-this.bottom)/this.grid[1])*this.grid[1]+this.bottom}},deselect:function(t){var t=t.target||t.srcElement,e=new RegExp(this.className+"-([trmbl]{2})","");this.$el.contains(t)||e.test(t.className)||(this.enabled&&!this.preventDeactivation&&(this.enabled=!1,this.$emit("deactivated"),this.$emit("update:active",!1)),removeEvent(document.documentElement,eventsFor.move,this.handleResize)),this.resetBoundsAndMouseState()},handleTouchDown:function(t,e){eventsFor=events.touch,this.handleDown(t,e)},handleDown:function(t,e){e instanceof MouseEvent&&1!==e.which||!1!==this.onResizeStart(t,e)&&(e.stopPropagation&&e.stopPropagation(),this.lockAspectRatio&&!t.includes("m")?this.handle="m"+t.substring(1):this.handle=t,this.resizeEnable=!0,this.mouseClickPosition.mouseX=(e.touches?e.touches[0]:e).pageX,this.mouseClickPosition.mouseY=(e.touches?e.touches[0]:e).pageY,this.mouseClickPosition.left=this.left,this.mouseClickPosition.right=this.right,this.mouseClickPosition.top=this.top,this.mouseClickPosition.bottom=this.bottom,this.bounds=this.calcResizeLimits(),addEvent(document.documentElement,eventsFor.move,this.handleResize),addEvent(document.documentElement,eventsFor.stop,this.handleUp))},calcResizeLimits:function(){var t=this.minW,e=this.minH,i=this.maxW,s=this.maxH,o=this.aspectFactor,n=this.grid,h=n[0],n=n[1],a=this.width,r=this.height,m=this.left,l=this.top,u=this.right,d=this.bottom,c=(this.lockAspectRatio&&(o<t/e?e=t/o:t=o*e,i&&s?(i=Math.min(i,o*s),s=Math.min(s,i/o)):i?s=i/o:s&&(i=o*s)),i-=i%h,s-=s%n,{minLeft:null,maxLeft:null,minTop:null,maxTop:null,minRight:null,maxRight:null,minBottom:null,maxBottom:null});return this.parent?(c.minLeft=m%h,c.maxLeft=m+Math.floor((a-t)/h)*h,c.minTop=l%n,c.maxTop=l+Math.floor((r-e)/n)*n,c.minRight=u%h,c.maxRight=u+Math.floor((a-t)/h)*h,c.minBottom=d%n,c.maxBottom=d+Math.floor((r-e)/n)*n,i&&(c.minLeft=Math.max(c.minLeft,this.parentWidth-u-i),c.minRight=Math.max(c.minRight,this.parentWidth-m-i)),s&&(c.minTop=Math.max(c.minTop,this.parentHeight-d-s),c.minBottom=Math.max(c.minBottom,this.parentHeight-l-s)),this.lockAspectRatio&&(c.minLeft=Math.max(c.minLeft,m-l*o),c.minTop=Math.max(c.minTop,l-m/o),c.minRight=Math.max(c.minRight,u-d*o),c.minBottom=Math.max(c.minBottom,d-u/o))):(c.minLeft=null,c.maxLeft=m+Math.floor((a-t)/h)*h,c.minTop=null,c.maxTop=l+Math.floor((r-e)/n)*n,c.minRight=null,c.maxRight=u+Math.floor((a-t)/h)*h,c.minBottom=null,c.maxBottom=d+Math.floor((r-e)/n)*n,i&&(c.minLeft=-(u+i),c.minRight=-(m+i)),s&&(c.minTop=-(d+s),c.minBottom=-(l+s)),this.lockAspectRatio&&i&&s&&("number"==typeof c.minLeft&&(c.minLeft=Math.min(c.minLeft,-(u+i))),"number"==typeof c.minTop&&(c.minTop=Math.min(c.minTop,-(s+d))),"number"==typeof c.minRight&&(c.minRight=Math.min(c.minRight,-m-i)),"number"==typeof c.minBottom&&(c.minBottom=Math.min(c.minBottom,-l-s)))),c},move:function(t){this.resizing?this.handleResize(t):this.dragEnable&&this.handleDrag(t)},handleDrag:function(t){var e=this.axis,i=this.grid,s=this.bounds,o=this.mouseClickPosition,n=e&&"y"!==e?o.mouseX-(t.touches?t.touches[0]:t).pageX:0,e=e&&"x"!==e?o.mouseY-(t.touches?t.touches[0]:t).pageY:0,t=snapToGrid(i,n,e,this.scale),i=t[0],n=t[1],e=restrictToBounds(o.left-i,s.minLeft,s.maxLeft),t=restrictToBounds(o.top-n,s.minTop,s.maxTop);!1!==this.onDrag(e,t)&&(i=restrictToBounds(o.right+i,s.minRight,s.maxRight),o=restrictToBounds(o.bottom+n,s.minBottom,s.maxBottom),this.left=e,this.top=t,this.right=i,this.bottom=o,console.log("draggingInner",this.left),this.$emit("dragging",this.left,this.top),this.dragging=!0)},moveHorizontally:function(t){var t=snapToGrid(this.grid,t,this.top,1),e=t[0],t=(t[1],restrictToBounds(e,this.bounds.minLeft,this.bounds.maxLeft));this.left=t,this.right=this.parentWidth-this.width-t},moveVertically:function(t){t=snapToGrid(this.grid,this.left,t,1),t[0],t=t[1],t=restrictToBounds(t,this.bounds.minTop,this.bounds.maxTop);this.top=t,this.bottom=this.parentHeight-this.height-t},handleResize:function(t){var e=this.left,i=this.top,s=this.right,o=this.bottom,n=this.mouseClickPosition,h=(this.lockAspectRatio,this.aspectFactor),a=n.mouseX-(t.touches?t.touches[0]:t).pageX,t=n.mouseY-(t.touches?t.touches[0]:t).pageY,a=(!this.widthTouched&&a&&(this.widthTouched=!0),!this.heightTouched&&t&&(this.heightTouched=!0),snapToGrid(this.grid,a,t,this.scale)),t=a[0],a=a[1],a=(this.handle.includes("b")?(o=restrictToBounds(n.bottom+a,this.bounds.minBottom,this.bounds.maxBottom),this.lockAspectRatio&&this.resizingOnY&&(s=this.right-(this.bottom-o)*h)):this.handle.includes("t")&&(i=restrictToBounds(n.top-a,this.bounds.minTop,this.bounds.maxTop),this.lockAspectRatio&&this.resizingOnY&&(e=this.left-(this.top-i)*h)),this.handle.includes("r")?(s=restrictToBounds(n.right+t,this.bounds.minRight,this.bounds.maxRight),this.lockAspectRatio&&this.resizingOnX&&(o=this.bottom-(this.right-s)/h)):this.handle.includes("l")&&(e=restrictToBounds(n.left-t,this.bounds.minLeft,this.bounds.maxLeft),this.lockAspectRatio&&this.resizingOnX&&(i=this.top-(this.left-e)/h)),computeWidth(this.parentWidth,e,s)),n=computeHeight(this.parentHeight,i,o);!1!==this.onResize(this.handle,e,i,a,n)&&(this.left=e,this.top=i,this.right=s,this.bottom=o,this.width=a,this.height=n,this.$emit("resizing",this.left,this.top,this.width,this.height),this.resizing=!0)},changeWidth:function(t){var t=snapToGrid(this.grid,t,0,1),e=t[0],t=(t[1],restrictToBounds(this.parentWidth-e-this.left,this.bounds.minRight,this.bounds.maxRight)),e=this.bottom,i=(this.lockAspectRatio&&(e=this.bottom-(this.right-t)/this.aspectFactor),computeWidth(this.parentWidth,this.left,t)),s=computeHeight(this.parentHeight,this.top,e);this.right=t,this.bottom=e,this.width=i,this.height=s},changeHeight:function(t){var t=snapToGrid(this.grid,0,t,1),t=(t[0],t[1]),t=restrictToBounds(this.parentHeight-t-this.top,this.bounds.minBottom,this.bounds.maxBottom),e=this.right,i=(this.lockAspectRatio&&(e=this.right-(this.bottom-t)*this.aspectFactor),computeWidth(this.parentWidth,this.left,e)),s=computeHeight(this.parentHeight,this.top,t);this.right=e,this.bottom=t,this.width=i,this.height=s},handleUp:function(t){this.handle=null,this.resetBoundsAndMouseState(),this.dragEnable=!1,this.resizeEnable=!1,this.resizing&&(this.resizing=!1,this.$emit("resizestop",this.left,this.top,this.width,this.height)),this.dragging&&(this.dragging=!1,this.$emit("dragstop",this.left,this.top)),removeEvent(document.documentElement,eventsFor.move,this.handleResize)}},computed:{style:function(){return __assign({width:this.computedWidth,height:this.computedHeight,zIndex:this.zIndex},this.dragging&&this.disableUserSelect?userSelectNone:userSelectAuto)},actualHandles:function(){return this.resizable?this.handles:[]},computedWidth:function(){return"auto"!==this.w||this.widthTouched?this.width+"px":"auto"},computedHeight:function(){return"auto"!==this.h||this.heightTouched?this.height+"px":"auto"},resizingOnX:function(){return Boolean(this.handle)&&(this.handle.includes("l")||this.handle.includes("r"))},resizingOnY:function(){return Boolean(this.handle)&&(this.handle.includes("t")||this.handle.includes("b"))},isCornerHandle:function(){return Boolean(this.handle)&&["tl","tr","br","bl"].includes(this.handle)}},watch:{active:function(t){(this.enabled=t)?this.$emit("activated"):this.$emit("deactivated")},z:function(t){(0<=t||"auto"===t)&&(this.zIndex=t)},x:function(t){this.resizing||this.dragging||(this.parent&&(this.bounds=this.calcDragLimits()),this.moveHorizontally(t))},y:function(t){this.resizing||this.dragging||(this.parent&&(this.bounds=this.calcDragLimits()),this.moveVertically(t))},lockAspectRatio:function(t){this.aspectFactor=t?this.width/this.height:void 0},minWidth:function(t){0<t&&t<=this.width&&(this.minW=t)},minHeight:function(t){0<t&&t<=this.height&&(this.minH=t)},maxWidth:function(t){this.maxW=t},maxHeight:function(t){this.maxH=t},w:function(t){this.resizing||this.dragging||(this.parent&&(this.bounds=this.calcResizeLimits()),this.changeWidth(t))},h:function(t){this.resizing||this.dragging||(this.parent&&(this.bounds=this.calcResizeLimits()),this.changeHeight(t))}},render:function(){var t,e,s=this;return _createVNode("div",{style:this.style,class:[((t={})[this.classNameActive]=this.enabled,t[this.classNameDragging]=this.dragging,t[this.classNameResizing]=this.resizing,t[this.classNameDraggable]=this.draggable,t[this.classNameResizable]=this.resizable,t),this.className],onMousedown:this.elementMouseDown,onTouchstart:this.elementTouchDown},[this.actualHandles.map(function(e){var t,i;return _createVNode("div",{key:e,class:[s.classNameHandle,s.classNameHandle+"-"+e],style:{display:s.enabled?"block":"none"},onMousedown:function(t){t.stopPropagation(),s.handleDown(e,t)},onTouchstart:function(t){t.stopPropagation(),s.handleTouchDown(e,t)}},[null==(i=null==(t=s.$slots)?void 0:t[e])?void 0:i.call(t)])}),null==(e=null==(t=this.$slots)?void 0:t.default)?void 0:e.call(t)])}});
//# sourceMappingURL=VueDraggableResizable.js.map
