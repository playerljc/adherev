{"version":3,"file":"searchtableimplement.js","sources":["searchtableimplement.js"],"sourcesContent":["import \"core-js/modules/es.object.assign.js\";\nimport \"core-js/modules/es.string.trim.js\";\nimport \"core-js/modules/es.array.map.js\";\nimport \"core-js/modules/es.array.filter.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.array.find.js\";\nimport \"core-js/modules/es.promise.js\";\nimport \"core-js/modules/es.object.keys.js\";\nimport \"core-js/modules/web.dom-collections.for-each.js\";\nimport { __assign, __spreadArrays } from \"tslib\";\nimport Util from '@baifendian/adherev-util'; // @ts-ignore\n\nimport { cleanMixin, mapActions, mapMutations, mapState } from '@ctsj/vuexgenerator';\nimport SearchTable, { NUMBER_GENERATOR_RULE_CONTINUITY, ROW_SELECTION_CONTINUOUS_MODE, ROW_SELECTION_NORMAL_MODE } from './searchtable';\nvar selectorPrefix = 'adherev-ui-searchtableimplement';\nvar extend = Util._util.extend;\nexport default (function (serviceName) {\n  return extend({\n    className: 'SearchTableImpl',\n    mixins: serviceName ? [SearchTable, cleanMixin([serviceName])] : [SearchTable],\n    data: function data() {\n      var _a;\n\n      return __assign(__assign({}, this.getParams()), (_a = {}, _a[this.getOrderFieldProp()] = this.getOrderFieldValue(), _a[this.getOrderProp()] = this.getOrderPropValue() || 'descend', // 查询参数\n      _a.searchParams = __assign({}, this.getParams()), _a.selectedRowKeys = [], _a.selectedRows = [], _a));\n    },\n    computed: serviceName ? __assign({}, mapState([serviceName])) : {},\n    methods: Object.assign({\n      /**\n       * getFetchListPropName\n       * @override\n       * @description - 获取调用列表接口的函数名\n       */\n      getFetchListPropName: function getFetchListPropName() {\n        return '';\n      },\n\n      /**\n       * getFetchListPropNameToFirstUpper\n       * @override\n       * @description - 获取调用列表接口的函数名首字母大写\n       * @return string\n       */\n      getFetchListPropNameToFirstUpper: function getFetchListPropNameToFirstUpper() {\n        var fetchListPropName = this.getFetchListPropName();\n\n        if (fetchListPropName.length > 1) {\n          return \"\" + fetchListPropName.charAt(0).toUpperCase() + fetchListPropName.substring(1);\n        }\n\n        return fetchListPropName;\n      },\n      // ------------ 不需要重写(override)的方法 start ------------------\n\n      /**\n       * onSelectChange\n       * @description - onSelectChange\n       * @param property\n       * @param v\n       */\n      onSelectChange: function onSelectChange(property, v) {\n        this[property] = v;\n      },\n\n      /**\n       * onInputChange\n       * @description - onInputChange\n       * @param property\n       * @param e\n       */\n      onInputChange: function onInputChange(property, e) {\n        this[property] = e.target.value.trim();\n      },\n\n      /**\n       * onDateTimeRangeChange\n       * @description - onDateTimeRangeChange\n       * @param propertys\n       * @param moments\n       */\n      onDateTimeRangeChange: function onDateTimeRangeChange(propertys, moments) {\n        this[propertys[0]] = moments && moments.length ? moments[0] : null;\n        this[propertys[1]] = moments && moments.length ? moments[1] : null;\n      },\n      // ------------ 不需要重写(override)的方法 end ------------------\n\n      /**\n       * getParams\n       * @override\n       * @description - 获取查询参数对象\n       */\n      getParams: function getParams() {\n        return {};\n      },\n\n      /**\n       * getServiceName\n       * @override\n       * @description - 获取接口服务的model名称\n       */\n      getServiceName: function getServiceName() {\n        return serviceName;\n      },\n\n      /**\n       * getFetchDataParams\n       * @override\n       * @description - 获取调用数据接口的参数\n       */\n      getFetchDataParams: function getFetchDataParams() {\n        return {};\n      },\n\n      /**\n       * isShowNumber\n       * @description - 是否线上序号列\n       * @override\n       * @return {boolean}\n       */\n      isShowNumber: function isShowNumber() {\n        return true;\n      },\n\n      /**\n       * getNumberGeneratorRule\n       * @override\n       * @description - 表格序号列的生成规则\n       */\n      getNumberGeneratorRule: function getNumberGeneratorRule() {\n        return NUMBER_GENERATOR_RULE_CONTINUITY;\n      },\n\n      /**\n       * getNumberGeneratorRule - 获取符号列的生成规则\n       */\n      getRowSelectionMode: function getRowSelectionMode() {\n        return ROW_SELECTION_NORMAL_MODE;\n      },\n\n      /**\n       * getTableNumberColumnWidth\n       * @override\n       * @description - 表格序号列的宽度\n       */\n      getTableNumberColumnWidth: function getTableNumberColumnWidth() {\n        return 80;\n      },\n\n      /**\n       * getTableNumberColumnProps\n       */\n      getTableNumberColumnProps: function getTableNumberColumnProps() {\n        return {};\n      },\n\n      /**\n       * getRowKey\n       * @override\n       * @description - 数据的主键\n       */\n      getRowKey: function getRowKey() {\n        return 'id';\n      },\n\n      /**\n       * getDataKey\n       * @description - 获取数据的key\n       * @protected\n       */\n      getDataKey: function getDataKey() {\n        return 'list';\n      },\n\n      /**\n       * getTotalKey\n       * @description - 获取total的key\n       * @protected\n       */\n      getTotalKey: function getTotalKey() {\n        return 'totalCount';\n      },\n\n      /**\n       * getData\n       * @description - Table的数据(Table的dataSource字段)\n       * @override\n       * @return {Array}\n       */\n      getData: function getData() {\n        return this[\"\" + serviceName + this.getFetchListPropNameToFirstUpper()][this.getDataKey()];\n      },\n\n      /**\n       * getTotal\n       * @description - Table数据的总条数\n       * @override\n       */\n      getTotal: function getTotal() {\n        return this[\"\" + serviceName + this.getFetchListPropNameToFirstUpper()][this.getTotalKey()];\n      },\n\n      /**\n       * getRowSelection\n       * @override\n       * @description - 获取表格行选择对象\n       */\n      getRowSelection: function getRowSelection() {\n        var _this = this;\n\n        var self = this;\n\n        function filter(selected, records) {\n          var rowKey = self.getRowKey();\n\n          if (selected) {\n            // add\n            self.selectedRowKeys = __spreadArrays(self.selectedRowKeys || [], records.map(function (r) {\n              return r[rowKey];\n            }));\n            self.selectedRows = __spreadArrays(self.selectedRows || [], records);\n          } else {\n            // remove\n            self.selectedRows = (self.selectedRows || []).filter(function (row) {\n              return !records.find(function (r) {\n                return r[rowKey] === row[rowKey];\n              });\n            });\n            self.selectedRowKeys = (self.selectedRowKeys || []).filter(function (key) {\n              return !records.find(function (r) {\n                return r[rowKey] === key;\n              });\n            });\n          }\n        }\n\n        return {\n          selectedRowKeys: this.selectedRowKeys,\n          onChange: function onChange(selectedRowKeys, selectedRows) {\n            if (_this.getRowSelectionMode() === ROW_SELECTION_CONTINUOUS_MODE) return;\n            _this.selectedRowKeys = selectedRowKeys;\n            _this.selectedRows = selectedRows;\n          },\n          onSelect: function onSelect(record, selected) {\n            if (_this.getRowSelectionMode() === ROW_SELECTION_NORMAL_MODE) return;\n            filter(selected, [record]);\n          },\n          onSelectAll: function onSelectAll(selected, selectedRows, changeRows) {\n            if (_this.getRowSelectionMode() === ROW_SELECTION_NORMAL_MODE) return;\n            filter(selected, changeRows);\n          }\n        };\n      },\n\n      /**\n       * renderSearchForm\n       * @override\n       * @description - 渲染Table查询的表单\n       */\n      renderSearchForm: function renderSearchForm(h) {\n        return null;\n      },\n      // /**\n      //  * renderSearchTableImplement\n      //  * @description - renderSearchTableImplement\n      //  * @param h\n      //  */\n      // renderSearchTableImplement(h) {\n      //   return this.renderSearchTable(h);\n      // },\n\n      /**\n       * renderInner\n       * @override\n       * @description - 渲染主体\n       */\n      renderInner: function renderInner(h) {\n        var innerVNode = this.$renderInnerSearchTable(h);\n        return h(\"div\", {\n          \"ref\": \"innerWrapRef\",\n          \"class\": selectorPrefix + \"-tablewrapper\"\n        }, [innerVNode]);\n      },\n\n      /**\n       * renderSearchFooterItems\n       * @description - 渲染表格的工具栏\n       * @override\n       */\n      renderSearchFooterItems: function renderSearchFooterItems() {\n        return [];\n      },\n\n      /**\n       * getOrderFieldProp\n       * @description - 获取排序字段\n       * @override\n       */\n      getOrderFieldProp: function getOrderFieldProp() {\n        return 'orderField';\n      },\n\n      /**\n       * getOrderFieldValue\n       * @description - 获取默认排序字段的值\n       * @override\n       * @protected\n       */\n      getOrderFieldValue: function getOrderFieldValue() {\n        return '';\n      },\n\n      /**\n       * getOrderProp\n       * @description - 获取排序方式\n       */\n      getOrderProp: function getOrderProp() {\n        return 'order';\n      },\n\n      /**\n       * getOrderPropValue\n       * @override\n       * @description - 获取默认排序方式\n       * @protected\n       */\n      getOrderPropValue: function getOrderPropValue() {\n        return 'descend';\n      },\n\n      /**\n       * clear\n       * @description - 清空查询条件\n       * @override\n       */\n      clear: function clear() {\n        var _this = this;\n\n        return new Promise(function (resolve) {\n          var _a;\n\n          Object.assign(_this, __assign(__assign({}, _this.getParams()), (_a = {}, _a[_this.getOrderFieldProp()] = _this.getOrderFieldValue(), _a[_this.getOrderProp()] = _this.getOrderPropValue() || 'descend', // 查询参数\n          _a.searchParams = __assign({}, _this.getParams()), _a.selectedRowKeys = [], _a.selectedRows = [], _a)));\n\n          _this.$nextTick(function () {\n            resolve();\n          });\n        });\n      },\n\n      /**\n       * showLoading\n       * @description - 是否显示遮罩\n       * @override\n       */\n      showLoading: function showLoading() {\n        return this.loading[serviceName + \"/\" + this.getFetchListPropName()];\n      },\n\n      /**\n       * getSearchParams\n       * @description - 获取查询参数\n       * @protected\n       */\n      getSearchParams: function getSearchParams() {\n        var _a;\n\n        var _b = this,\n            page = _b.page,\n            limit = _b.limit,\n            searchParams = _b.searchParams;\n\n        var order = this[this.getOrderProp()];\n        return __assign({}, __assign(__assign(__assign({\n          page: page,\n          limit: limit\n        }, searchParams), (_a = {}, _a[this.getOrderProp()] = order === 'descend' ? 'desc' : 'asc', _a[this.getOrderFieldProp()] = this[this.getOrderFieldProp()], _a)), this.getFetchDataParams()));\n      },\n\n      /**\n       * fetchData\n       * @description - 加载数据\n       * @override\n       */\n      fetchData: function fetchData() {\n        return this.fetchDataExecute(this.getSearchParams());\n      },\n\n      /**\n       * fetchDataExecute\n       * @description - 真正的执行获取列表数据的接口\n       * @param searchParams\n       * @protected\n       */\n      fetchDataExecute: function fetchDataExecute(searchParams) {\n        return this[\"\" + serviceName + this.getFetchListPropNameToFirstUpper() + \"Action\"](searchParams);\n      },\n\n      /**\n       * onSearch\n       * @description - 点击查询\n       * @override\n       */\n      onSearch: function onSearch() {\n        var _this = this;\n\n        var keys = Object.keys(this.getParams());\n        var params = {};\n        keys.forEach(function (key) {\n          params[key] = _this[key];\n        });\n        return new Promise(function (resolve) {\n          var _a;\n\n          _this.searchParams = __assign(__assign({}, params), (_a = {}, _a[_this.getOrderFieldProp()] = _this[_this.getOrderFieldProp()], _a[_this.getOrderProp()] = _this[_this.getOrderProp()], _a));\n\n          _this.$nextTick(function () {\n            _this.fetchData().then(function () {\n              resolve();\n            });\n          });\n        });\n      },\n      getColumns: function getColumns() {\n        return [];\n      },\n      onSubTableChange: function onSubTableChange() {},\n      renderSearchFormAfter: function renderSearchFormAfter(h) {\n        return null;\n      },\n      renderSearchFormBefore: function renderSearchFormBefore(h) {\n        return null;\n      },\n      renderTableFooter: function renderTableFooter(h) {\n        return null;\n      },\n      renderTableHeader: function renderTableHeader(h) {\n        return null;\n      }\n    }, serviceName ? __assign(__assign({}, mapActions([serviceName])), mapMutations([serviceName])) : {})\n  });\n});"],"names":["__assign","__spreadArrays","Util","cleanMixin","mapActions","mapMutations","mapState","SearchTable","NUMBER_GENERATOR_RULE_CONTINUITY","ROW_SELECTION_CONTINUOUS_MODE","ROW_SELECTION_NORMAL_MODE","selectorPrefix","extend","_util","serviceName","className","mixins","data","_a","this","getParams","getOrderFieldProp","getOrderFieldValue","getOrderProp","getOrderPropValue","searchParams","selectedRowKeys","selectedRows","computed","methods","Object","assign","getFetchListPropName","getFetchListPropNameToFirstUpper","fetchListPropName","length","charAt","toUpperCase","substring","onSelectChange","property","v","onInputChange","e","target","value","trim","onDateTimeRangeChange","propertys","moments","getServiceName","getFetchDataParams","isShowNumber","getNumberGeneratorRule","getRowSelectionMode","getTableNumberColumnWidth","getTableNumberColumnProps","getRowKey","getDataKey","getTotalKey","getData","getTotal","getRowSelection","_this","self","filter","selected","records","rowKey","map","r","row","find","key","onChange","onSelect","record","onSelectAll","changeRows","renderSearchForm","h","renderInner","innerVNode","$renderInnerSearchTable","ref","class","renderSearchFooterItems","clear","Promise","resolve","$nextTick","showLoading","loading","getSearchParams","page","limit","order","fetchData","fetchDataExecute","onSearch","keys","params","forEach","then","getColumns","onSubTableChange","renderSearchFormAfter","renderSearchFormBefore","renderTableFooter","renderTableHeader"],"mappings":"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"}