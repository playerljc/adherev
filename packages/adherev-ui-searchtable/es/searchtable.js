import _mergeJSXProps from"@vue/babel-helper-vue-jsx-merge-props";import"core-js/modules/es.symbol.js";import"core-js/modules/es.symbol.description.js";import"core-js/modules/es.object.to-string.js";import"core-js/modules/es.array.map.js";import"core-js/modules/es.regexp.to-string.js";import"core-js/modules/es.array.find.js";import"core-js/modules/es.promise.js";import"core-js/modules/es.array.filter.js";import"core-js/modules/es.array.concat.js";import"core-js/modules/es.array.sort.js";import"core-js/modules/es.string.starts-with.js";import{__assign,__spreadArrays}from"tslib";import{Button,Table}from"ant-design-vue";import classNames from"classnames";import Vue from"vue";import ConditionalRender from"@baifendian/adherev-ui-conditionalrender";import FlexLayout from"@baifendian/adherev-ui-flexlayout";import Suspense from"@baifendian/adherev-ui-suspense";import Intl from"@baifendian/adherev-util-intl";import Mixins from"@baifendian/adherev-util-mixins";import ColumnResizable,{SearchTableResizableObserver,SearchTableResizableTitle}from"./Extension/ColumnResizable";import ColumnSetting from"./Extension/ColumnSetting";import TableDensitySetting from"./Extension/TableDensitySetting";import{TableDensity}from"./types";var selectorPrefix="adherev-ui-searchtable",updatedEx=Mixins.updatedEx,watchEffect=Mixins.watchEffect,Fixed=FlexLayout.Fixed,Auto=FlexLayout.Auto,NUMBER_GENERATOR_RULE_ALONE=Symbol(),NUMBER_GENERATOR_RULE_CONTINUITY=Symbol(),ROW_SELECTION_NORMAL_MODE=Symbol(),ROW_SELECTION_CONTINUOUS_MODE=Symbol(),SearchTable=Vue.extend({mixins:[Suspense,updatedEx,watchEffect],props:{className:{type:String,default:""},wrapStyle:{type:String,default:""},tableClassName:{type:String,default:""},tableStyle:{type:String,default:""},searchClassName:{type:String,default:""},searchStyle:{type:String,default:""},reset:{type:Boolean,default:!0},antdTableProps:{type:Object,default:function(){return{}}},isShowExpandSearch:{type:Boolean,default:!0},defaultExpandSearchCollapse:{type:Boolean,default:!0},fitSearch:{type:Boolean,default:!0},fitTable:{type:Boolean,default:!0},autoFixed:{type:Boolean,default:!0},fixedHeaderAutoTable:{type:Boolean,default:!1},fixedTableSpaceBetween:{type:Boolean,default:!1},showColumnSetting:{type:Boolean,default:!1}},slots:["searchFormBefore","searchFormAfter","tableHeader","tableFooter"],data:function(){return{page:1,limit:10,expand:this.defaultExpandSearchCollapse,scrollY:0,columnSetting:[],tableDensity:TableDensity.DEFAULT,$columnResizable:new ColumnResizable,$columnObserver:null}},computed:{components:function(){return{header:{cell:SearchTableResizableTitle(this.getSearchTableTableColumns(this.$createElement))}}}},provide:function(){return{getContext:this.getContext}},created:function(){this.columnSetting=this.getTableColumns().map(function(e,t){return __assign(__assign({},e),{sort:t,display:!0})}),this.tableDensity=this.getTableDensity()},updatedEx:function(e){this.$refs.tableWrapRef&&(this.searchTableResizableEffectLayout(),this.fixedHeaderAutoTableEffectLayout(e))},watchEffect:function(){this.columnSettingEffect()},beforeDestroy:function(){var e;this.fixedHeaderAutoTable&&null!==(e=this.getScrollBodyEl())&&void 0!==e&&e.removeEventListener("scroll",this.onScrollBodyScroll)},methods:{getContext:function(){return this},searchTableResizableEffectLayout:function(){this.$data.$columnObserver||(this.$data.$columnObserver=SearchTableResizableObserver(this))},fixedHeaderAutoTableEffectLayout:function(e){var t,r;!this.fixedHeaderAutoTable||(r=this.getData())&&r.length&&(0===e.scrollY&&0===this.scrollY||e.scrollY!==this.scrollY||e.expand!==this.expand)&&(t=this.$refs.tableWrapRef,(r=this.getScrollBodyEl())&&(r.removeEventListener("scroll",this.onScrollBodyScroll),r.addEventListener("scroll",this.onScrollBodyScroll)),r=(null===(e=t.querySelector(".ant-table-thead"))||void 0===e?void 0:e.offsetHeight)||0,e=(null===(e=t.querySelector(".ant-table-pagination"))||void 0===e?void 0:e.offsetHeight)||0,this.scrollY=t.clientHeight-(r+(e?e+32:0)))},columnSettingEffect:function(){var e,t,r,n=this,o=this.columnSetting||[],a=this.getTableColumns(this.$createElement).map(function(e,t){return __assign(__assign({},e),{sort:t,display:!0})});(null==o?void 0:o.length)===a.length?(e=null===(t=null==o?void 0:o.map)||void 0===t?void 0:t.call(o,function(e){return e[n.getRowKey()]}),t=null===(t=null==a?void 0:a.map)||void 0===t?void 0:t.call(a,function(e){return e[n.getRowKey()]}),(null==e?void 0:e.toString())!==t.toString()&&(r=this.getRowKey()||"id",this.columnSetting=null==a?void 0:a.map(function(t){var e=null==o?void 0:o.find(function(e){return e[r]===t[r]});return __assign(__assign({},t),{display:!e||e.display})}))):this.columnSetting=a},onSearchPanelCollapseBefore:function(){},onSearchPanelCollapseAfter:function(){},onTableChange:function(t,r,n){this[this.getOrderFieldProp()]=n.field||this.getOrderFieldValue(),this[this.getOrderProp()]=n.order||this.getOrderPropValue(),this.$nextTick(function(){var e;n.order&&(this.fetchData(),null!==(e=this.onSubTableChange)&&void 0!==e&&e.call(this,t,r,n))})},onClear:function(){var e=this;return new Promise(function(t){e.page=1,e.limit=e.getLimit(),e.$nextTick(function(){var e=this;this.clear().then(function(){e.fetchData(),t()})})})},onScrollBodyScroll:function(){var e=this.getScrollBodyEl();this.getScrollHeaderEl().scrollLeft=null==e?void 0:e.scrollLeft},sortOrder:function(e){return this[this.getOrderFieldProp()]===e?this[this.getOrderProp()]:""},getLimit:function(){return 10},getSearchTablePagination:function(){var r=this;return{onChange:function(e,t){r.page=e,r.limit=t,r.$nextTick(function(){this.fetchData()})},onShowSizeChange:function(e,t){r.page=e,r.limit=t,r.$nextTick(function(){this.fetchData()})},showTotal:function(e){return Intl.tv("当前 {page}-{pageSize}/共 {total}条",{page:r.page,pageSize:r.limit,total:e})},total:this.getTotal(),current:this.page,pageSize:this.limit,showQuickJumper:!0}},getPagination:function(){return this.getSearchTablePagination()},getTableDensity:function(){return TableDensity.DEFAULT},getSearchTableTableColumns:function(n){var o=this,e=this.isShowNumber(),t=this.getTableNumberColumnWidth(),r=this.getColumns().filter(function(e){return!("authorized"in e)||e.authorized()}).map(function(e,t){return"resizable"in e&&e.resizable?o.$data.$columnResizable.searchTableResizableColumnItem(o,t,e):e});if(e){var a=null!==(e=this.getNumberGeneratorRule())&&void 0!==e?e:SearchTable.NUMBER_GENERATOR_RULE_ALONE,e=this.page,i=void 0===e?0:e,e=this.limit,s=void 0===e?10:e;return[{title:Intl.tv("序号"),key:"_number",align:"center",width:t||80,customRender:function(e,t,r){return n(ConditionalRender,{attrs:{conditional:a===NUMBER_GENERATOR_RULE_ALONE}},[n("span",{slot:"default"},[o.renderTableNumberColumn(n,r+1,{value:e,record:t,index:r})]),n("span",{slot:"noMatch"},[o.renderTableNumberColumn(n,(i-1)*s+(r+1),{value:e,record:t,index:r})])])}}].concat(r)}return r},getTableColumns:function(e){return this.getSearchTableTableColumns(e)},getSortColumnSetting:function(){var e=__spreadArrays(this.columnSetting);return e.sort(function(e,t){return e.sort>t.sort?1:e.sort<t.sort?-1:0}),e},getScrollHeaderEl:function(){var e=this.$refs.tableWrapRef;return null==e?void 0:e.querySelector(".ant-table-wrapper > .ant-spin-nested-loading > .ant-spin-container > .ant-table > .ant-table-content > .ant-table-scroll > .ant-table-header")},getScrollBodyEl:function(){var e=this.$refs.tableWrapRef;return null==e?void 0:e.querySelector(".ant-table-wrapper > .ant-spin-nested-loading > .ant-spin-container > .ant-table > .ant-table-content > .ant-table-scroll > .ant-table-body")},renderTableNumberColumn:function(e,t,r){return e("span",[t=void 0===t?"":t])},renderColumnSetting:function(e){var n=this,t=__spreadArrays(this.columnSetting);return t.sort(function(e,t){return e.sort>t.sort?1:e.sort<t.sort?-1:0}),e(ColumnSetting,{attrs:{columns:t},on:{showColumns:function(t){var e;n.columnSetting=null===(e=n.columnSetting||[])||void 0===e?void 0:e.map(function(e){return __assign(__assign({},e),{display:t})})},reset:function(){n.columnSetting=n.getTableColumns(e).map(function(e,t){return __assign(__assign({},e),{display:!0,sort:t})})},displayColumn:function(t,r){var e;n.columnSetting=null===(e=n.columnSetting||[])||void 0===e?void 0:e.map(function(e){return __assign(__assign({},e),{display:e.key===t.key?r:e.display})})},sortEnd:function(t){var e;n.columnSetting=null===(e=n.columnSetting||[])||void 0===e?void 0:e.map(function(e){return __assign(__assign({},e),{sort:t.get(e.key)})})}}})},renderTableDensitySetting:function(){var t=this;return h(TableDensitySetting,{attrs:{density:this.tableDensity},on:{change:function(e){t.tableDensity=e},reset:function(){t.tableDensity=t.getTableDensity()}}})},renderSearchTableSearchFooter:function(r){var e=this,t=this.isShowExpandSearch,n=[r(Button,{class:selectorPrefix+"-searchfooteritem",attrs:{type:"primary"},key:"search",on:{click:function(){e.page=1,e.$nextTick(function(){this.onSearch()})}}},[r("i",{class:classNames(selectorPrefix+"-searchfooteritem-search-btn-icon","iconfont iconsousuo")}),Intl.tv("查询")]),r(Button,{class:selectorPrefix+"-searchfooteritem",key:"reset",on:{click:this.onClear}},[Intl.tv("重置")])];t&&n.push(r(ConditionalRender,{attrs:{conditional:this.expand}},[r("a",{slot:"noMatch",key:"expand",class:selectorPrefix+"-searchfooteritem-expand-search-up-btn",on:{click:function(){e.onSearchPanelCollapseBefore&&e.onSearchPanelCollapseBefore(),e.expand=!0,e.$nextTick(function(){this.onSearchPanelCollapseAfter&&this.onSearchPanelCollapseAfter()})}}},[r("span",[Intl.tv("展开")]),r("i",{attrs:{className:"iconfont iconup"}})]),r("a",{key:"hide",class:selectorPrefix+"-searchfooteritem-expand-search-down-btn",on:{click:function(){e.onSearchPanelCollapseBefore&&e.onSearchPanelCollapseBefore(),e.expand=!1,e.$nextTick(function(){this.onSearchPanelCollapseAfter&&this.onSearchPanelCollapseAfter()})}}},[r("span",[Intl.tv("关闭")]),r("i",{attrs:{className:"iconfont icondownarrow"}})])]));n=this.renderSearchFooterItems(r,n)||__spreadArrays(n);return r("div",{class:selectorPrefix+"-searchfooterwrapper"},[n.map(function(e,t){return r("div",{key:t,class:selectorPrefix+"-searchfooteritem"},[e])})])},renderSearchFooter:function(e){return this.renderSearchTableSearchFooter(e)},renderSearchTableTable:function(e){var t,r=this.antdTableProps,n=this.fixedHeaderAutoTable,o=__assign({},this.getScopedSlots(e)||{}),a={},i={},s=r||{};for(t in s)t.startsWith("on")?i[t.substring(2).toLowerCase()]=s[t]:a[t]=s[t];var l=this.columnSetting,c=void 0===l?[]:l,r=this.tableDensity,l=this.getTableColumns(e).map(function(e,t){return __assign(__assign({},c[t]),e)}).filter(function(e){return e.display});l.sort(function(e,t){return e.sort>t.sort?1:e.sort<t.sort?-1:0});r={scopedSlots:o,props:__assign({rowKey:this.getRowKey(),dataSource:this.getData(),columns:l,size:r,pagination:this.getPagination(),rowSelection:this.getRowSelection(),components:this.components},a||{}),on:__assign({change:this.onTableChange},i||{})};return n&&(n=this.scrollY,a&&a.scroll?r.props.scroll.y=n:r.props.scroll={y:n}),e(Table,_mergeJSXProps([{},r]))},renderTable:function(e){return this.renderSearchTableTable(e)},renderSearchTableInner:function(e){var t=this,r=t.className,n=t.wrapStyle,o=t.tableClassName,a=t.tableStyle,i=t.searchStyle,s=t.searchClassName,l=t.fitSearch,c=t.fitTable,u=t.autoFixed,t=t.fixedTableSpaceBetween;return e(FlexLayout,{attrs:{direction:"vertical"},style:n||"",class:classNames(selectorPrefix,t?"fixedtablespacebetween":"",r||"")},[e(Fixed,{class:classNames(selectorPrefix+"-searchwrapper",s||""),style:i||"",attrs:{fit:l}},[e(FlexLayout,{attrs:{direction:"vertical"}},[e(ConditionalRender,{attrs:{conditional:this.$slots.searchFormBefore||!!this.renderSearchFormBefore}},[e(Fixed,{slot:"default"},[this.$slots.searchFormBefore||this.renderSearchFormBefore(e)])]),e(Fixed,[e(ConditionalRender,{attrs:{conditional:this.expand}},[this.renderSearchForm(e)])]),e(Fixed,[this.renderSearchFooter(e)]),e(ConditionalRender,{attrs:{conditional:this.$slots.searchFormAfter||!!this.renderSearchFormAfter}},[e(Fixed,{slot:"default"},[this.$slots.searchFormAfter||this.renderSearchFormAfter(e)])])])]),e(ConditionalRender,{attrs:{conditional:!!this.$slots.tableHeader||!!this.renderTableHeader}},[e(Fixed,{slot:"default"},[this.$slots.tableHeader||this.renderTableHeader(e)])]),e(Auto,{class:classNames(selectorPrefix+"-autowrapper",o||"",u?"autofixed":""),style:a||"",attrs:{fit:c,autoFixed:u}},[e("div",{ref:"tableWrapRef",class:selectorPrefix+"-tablewrapper"},[this.renderTable(e)])]),e(ConditionalRender,{attrs:{conditional:!!this.$slots.tableFooter||!!this.renderTableFooter}},[e(Fixed,{slot:"default"},[this.$slots.tableFooter||this.renderTableFooter(e)])])])},renderInner:function(e){return this.renderSearchTableInner(e)},renderSearchTable:function(e){return e("div",{class:selectorPrefix+"-wrap"},[this.$renderSuspense(e)])}},render:function(e){return this.renderSearchTable(e)}});export default SearchTable;export{selectorPrefix,NUMBER_GENERATOR_RULE_ALONE,NUMBER_GENERATOR_RULE_CONTINUITY,ROW_SELECTION_NORMAL_MODE,ROW_SELECTION_CONTINUOUS_MODE};
//# sourceMappingURL=searchtable.js.map
