import _Table from"ant-design-vue/es/table";import _Button from"ant-design-vue/es/button";import{resolveDirective as _resolveDirective,isVNode as _isVNode,createVNode as _createVNode}from"vue";import"core-js/modules/es.symbol.js";import"core-js/modules/es.symbol.description.js";import"core-js/modules/es.object.to-string.js";import"core-js/modules/es.array.map.js";import"core-js/modules/es.regexp.to-string.js";import"core-js/modules/es.array.find.js";import"core-js/modules/es.promise.js";import"core-js/modules/es.array.reduce.js";import"core-js/modules/es.array.find-index.js";import"core-js/modules/es.number.constructor.js";import"core-js/modules/es.array.filter.js";import"core-js/modules/es.array.sort.js";import"core-js/modules/es.array.concat.js";import"core-js/modules/es.string.starts-with.js";import{__assign,__spreadArray}from"tslib";import classNames from"classnames";import cloneDeep from"lodash.clonedeep";import{bool,object,string}from"vue-types";import ConditionalRender from"@baifendian/adherev-ui-conditionalrender";import FlexLayout from"@baifendian/adherev-ui-flexlayout";import Suspense from"@baifendian/adherev-ui-suspense";import Util from"@baifendian/adherev-util";import Intl from"@baifendian/adherev-util-intl";import Mixins from"@baifendian/adherev-util-mixins";import ColumnSetting from"./Extension/ColumnSetting";import TableBody from"./Extension/TableComponents/TableBody";import TableCell from"./Extension/TableComponents/TableCell";import TableRow from"./Extension/TableComponents/TableRow";import TableDensitySetting from"./Extension/TableDensitySetting";import{TableDensity}from"./types";function _isSlot(e){return"function"==typeof e||"[object Object]"===Object.prototype.toString.call(e)&&!_isVNode(e)}var selectorPrefix="adherev-ui-searchtable",updatedEx=Mixins.updatedEx,watchEffect=Mixins.watchEffect,Fixed=FlexLayout.Fixed,Auto=FlexLayout.Auto,extend=Util._util.extend,NUMBER_GENERATOR_RULE_ALONE=Symbol(),NUMBER_GENERATOR_RULE_CONTINUITY=Symbol(),ROW_SELECTION_NORMAL_MODE=Symbol(),ROW_SELECTION_CONTINUOUS_MODE=Symbol(),SearchTable=extend({className:"SearchTable",mixins:[Suspense,updatedEx,watchEffect],props:{className:string().def(""),wrapStyle:object().def({}),tableClassName:string().def(""),tableStyle:object().def({}),searchClassName:string().def(""),searchStyle:object().def({}),reset:bool().def(!0),antdTableProps:object().def({}),isShowExpandSearch:bool().def(!0),defaultExpandSearchCollapse:bool().def(!0),fitSearch:bool().def(!0),fitTable:bool().def(!0),autoFixed:bool().def(!0),fixedHeaderAutoTable:bool().def(!1),fixedTableSpaceBetween:bool().def(!1),showColumnSetting:bool().def(!1)},scopedSlots:["searchFormBefore","searchFormAfter","searchForm","tableHeader","tableFooter","tableNumberColumn","columnSetting","tableDensitySetting","searchFooter","table","inner","searchTable"],data:function(){return{page:1,limit:10,expand:this.defaultExpandSearchCollapse,scrollY:0,columnSetting:[],tableDensity:TableDensity.DEFAULT,$columnObserver:null,$bodyConfigReducers:[],$rowConfigReducers:[],$cellConfigReducers:[],$tableBodyComponentReducers:[],$tableRowComponentReducers:[],$tableCellComponentReducers:[]}},computed:{components:function(){return{body:{wrapper:TableBody,row:TableRow,cell:TableCell}}}},provide:function(){return{getContext:this.getContext}},created:function(){var e,t=this.getColumns();this.$data.$tableBodyComponentReducers=(null==(e=this.onTableBodyComponentReducers)?void 0:e.call(this,t))||[],this.$data.$tableRowComponentReducers=(null==(e=this.onTableRowComponentReducers)?void 0:e.call(this,t))||[],this.$data.$tableCellComponentReducers=(null==(e=this.onTableCellComponentReducers)?void 0:e.call(this,t))||[],this.columnSetting=this.getTableColumns().map(function(e,t){return __assign(__assign({},e),{sort:t,display:!0})}),this.tableDensity=this.getTableDensity()},updatedEx:function(e){this.$refs.tableWrapRef&&this.fixedHeaderAutoTableEffectLayout(e)},watchEffect:function(){this.columnSettingEffect()},beforeUnmount:function(){var e;this.fixedHeaderAutoTable&&null!=(e=this.getScrollBodyEl())&&e.removeEventListener("scroll",this.onScrollBodyScroll)},methods:{getContext:function(){return{context:this}},fixedHeaderAutoTableEffectLayout:function(e){var t,n;this.fixedHeaderAutoTable&&(t=this.getData())&&t.length&&(0===e.scrollY&&0===this.scrollY||e.scrollY!==this.scrollY||e.expand!==this.expand)&&(t=this.$refs.tableWrapRef,(e=this.getScrollBodyEl())&&(e.removeEventListener("scroll",this.onScrollBodyScroll),e.addEventListener("scroll",this.onScrollBodyScroll)),e=(null==(e=t.querySelector(".ant-table-thead"))?void 0:e.offsetHeight)||0,n=(null==(n=t.querySelector(".ant-table-pagination"))?void 0:n.offsetHeight)||0,this.scrollY=t.clientHeight-(e+(n?n+32:0)))},columnSettingEffect:function(){var e,t,n,o=this,r=this.columnSetting||[],l=this.getTableColumns().map(function(e,t){return __assign(__assign({},e),{sort:t,display:!0})});(null==r?void 0:r.length)!==l.length?this.columnSetting=l:(e=null==(e=null==r?void 0:r.map)?void 0:e.call(r,function(e){return e[o.getRowKey()]}),t=null==(t=null==l?void 0:l.map)?void 0:t.call(l,function(e){return e[o.getRowKey()]}),(null==e?void 0:e.toString())!==t.toString()&&(n=this.getRowKey()||"id",this.columnSetting=null==l?void 0:l.map(function(t){var e=null==r?void 0:r.find(function(e){return e[n]===t[n]});return __assign(__assign({},t),{display:!e||e.display})})))},onSearchPanelCollapseBefore:function(){},onSearchPanelCollapseAfter:function(){},onTableChange:function(t,n,o){this[this.getOrderFieldProp()]=o.field||this.getOrderFieldValue(),this[this.getOrderProp()]=o.order,this.$nextTick(function(){var e;o.order&&(this.fetchData(),null!=(e=this.onSubTableChange)&&e.call(this,t,n,o))})},onResizeColumn:function(o,r){this.columnSetting=__spreadArray([],this.columnSetting,!0).map(function(e){return r.dataIndex===e.dataIndex?e.width=o:"children"in e&&Array.isArray(e.children)&&e.children.length&&function e(t){for(var n=0;n<t.length;n++){if(t[n].dataIndex===r.dataIndex){t[n].width=o;break}e(t[n].children||[])}}(e.children),e})},onClear:function(){var e=this;return new Promise(function(t){e.page=1,e.limit=e.getLimit(),e.$nextTick(function(){var e=this;this.clear().then(function(){e.fetchData(),t()})})})},onScrollBodyScroll:function(){var e=this.getScrollBodyEl();this.getScrollHeaderEl().scrollLeft=null==e?void 0:e.scrollLeft},sortOrder:function(e){return this[this.getOrderFieldProp()]===e?this[this.getOrderProp()]:""},onCellConfigReducers:function(e){var n=this,o=e.rowIndex,t=e.column,r=e.record,l=e.columns;return this.$data.$cellConfigReducers.reduce(function(e,t){return e.value=t.call(n,{rowIndex:o,record:r,columns:l,column:e.value}),e},{value:t}).value},onRowConfigReducers:function(e){var n=this,o=e.rowIndex,r=e.record,l=e.columns;return this.$data.$rowConfigReducers.reduce(function(e,t){return e.value=t.call(n,{rowIndex:o,record:r,columns:l,rowConfig:e.value}),e},{value:{}}).value},onBodyConfigReducers:function(){var n=this;return this.$data.$bodyConfigReducers.reduce(function(e,t){return e.value=t.call(n,e.value),e},{value:{}}).value},onBody:function(){return{columns:this.getColumns(),bodyConfig:this.onBodyConfigReducers()}},onRow:function(t){var n=this,e=this.getData();if(e){var o,r=e.findIndex(function(e){return e[n.getRowKey()]===t});if(-1!==r)return{record:e=e[r],rowIndex:r,columns:o=this.getColumns(),rowKey:this.getRowKey(),rowConfig:this.onRowConfigReducers({rowIndex:Number(r),record:e,columns:o})}}},getLimit:function(){return 10},getPagination:function(){var n=this;return{onChange:function(e,t){n.page=e,n.limit=t,n.$nextTick(function(){this.fetchData()})},onShowSizeChange:function(e,t){n.page=e,n.limit=t,n.$nextTick(function(){this.fetchData()})},showTotal:function(e){return Intl.tv("当前 {page}-{pageSize}/共 {total}条",{page:n.page,pageSize:n.limit,total:e})},total:this.getTotal(),current:this.page,pageSize:this.limit,showQuickJumper:!0}},getTableDensity:function(){return TableDensity.DEFAULT},getTableColumns:function(){var r=this,e=this.isShowNumber(),t=this.getTableNumberColumnWidth(),l=this.getColumns().filter(function(e){var t;return!("$hide"in e&&!e.$hide)&&(!("$authorized"in e)||(null==(t=null==e?void 0:e.$authorized)?void 0:t.call(e)))}).map(function(o){return __assign(__assign({},o),{customCell:function(e,t){var n=cloneDeep(o);return{rowIndex:t,record:e,column:r.onCellConfigReducers({rowIndex:t,column:n,record:e,columns:l}),columns:l}}})});return e?__spreadArray([__assign(__assign({},this.getTableNumberColumnProps&&this.getTableNumberColumnProps()||{}),{title:Intl.tv("序号"),key:"_number",dataIndex:"_number",align:"center",width:t||80})],l,!0):l},getTableBodyComponentReducers:function(){return this.$data.$tableBodyComponentReducers},getTableRowComponentReducers:function(){return this.$data.$tableRowComponentReducers},getColumnByDataIndex:function(l){return function e(t){for(var n,o=0;o<t.length;o++){var r=t[o];if(r.dataIndex===l){n=r;break}if(n=e(r.children||[]))break}return n}(this.getTableColumns())},getTableCellComponentReducers:function(){return this.$data.$tableCellComponentReducers},getSortColumnSetting:function(){var e=__spreadArray([],this.columnSetting,!0);return e.sort(function(e,t){return e.sort>t.sort?1:e.sort<t.sort?-1:0}),console.log("this.columnSetting.sort",e),e},getScrollHeaderEl:function(){var e=this.$refs.tableWrapRef;return null==e?void 0:e.querySelector(".ant-table-wrapper > .ant-spin-nested-loading > .ant-spin-container > .ant-table > .ant-table-container > .ant-table-header")},getScrollBodyEl:function(){var e=this.$refs.tableWrapRef;return null==e?void 0:e.querySelector(".ant-table-wrapper > .ant-spin-nested-loading > .ant-spin-container > .ant-table > .ant-table-container > .ant-table-body")},getBodyCellScopedSlotsInner:function(e){var t,n,o,r=this,l=e.record,i=e.index;return"_number"===e.column.dataIndex?(t=(0,this.getNumberGeneratorRule)()||NUMBER_GENERATOR_RULE_ALONE,n=this.page,o=this.limit,_createVNode(ConditionalRender,{conditional:t===NUMBER_GENERATOR_RULE_ALONE},{default:function(){return _createVNode("span",null,[r.renderTableNumberColumn(i+1,{record:e,index:i})])},noMatch:function(){return _createVNode("span",null,[r.renderTableNumberColumn((n-1)*o+(i+1),{record:l,index:i})])}})):null==(t=null==this?void 0:this.getBodyCellScopedSlots)?void 0:t.call(this,e)},receiveDataMutation:function(e){var t=this.getServiceName(),n=this.getFetchListPropName(),o=this["".concat(t).concat(this.getFetchListPropNameToFirstUpper())];this["".concat(t,"ReceiveMutation")]({key:n,value:__assign(__assign({},o),((t={})[this.getDataKey()]=e,t))})},renderTableNumberColumn:function(e,t){var n,o;return void 0===e&&(e=""),(null==(n=null==(o=this.$slots)?void 0:o.tableNumberColumn)?void 0:n.call(o,{context:null==(o=null==(n=this.getContext)?void 0:n.call(this))?void 0:o.context,number:e}))||_createVNode("span",null,[e])},renderColumnSetting:function(){var e,t,n=__spreadArray([],this.columnSetting,!0);return n.sort(function(e,t){return e.sort>t.sort?1:e.sort<t.sort?-1:0}),(null==(e=null==(t=this.$slots)?void 0:t.columnSetting)?void 0:e.call(t,{context:null==(t=null==(e=this.getContext)?void 0:e.call(this))?void 0:t.context,columns:n}))||_createVNode(ColumnSetting,null,null)},renderTableDensitySetting:function(){var e,t;return(null==(t=null==(e=this.$slots)?void 0:e.tableDensitySetting)?void 0:t.call(e,this))||_createVNode(TableDensitySetting,null,null)},renderSearchFooter:function(){var e,t,n=this,o=this.isShowExpandSearch,r=[_createVNode(_Button,{class:"".concat(selectorPrefix,"-searchfooteritem"),type:"primary",key:"search",onClick:function(){n.page=1,n.$nextTick(function(){this.onSearch()})}},{default:function(){return[_createVNode("i",{class:classNames("".concat(selectorPrefix,"-searchfooteritem-search-btn-icon"),"iconfont iconsousuo")},null),Intl.tv("查询")]}}),_createVNode(_Button,{class:"".concat(selectorPrefix,"-searchfooteritem"),key:"reset",onClick:this.onClear},_isSlot(e=Intl.tv("重置"))?e:{default:function(){return[e]}})],o=(o&&r.push(_createVNode(ConditionalRender,{conditional:this.expand},{default:function(){return _createVNode("a",{key:"hide",class:"".concat(selectorPrefix,"-searchfooteritem-expand-search-down-btn"),onClick:function(){n.onSearchPanelCollapseBefore&&n.onSearchPanelCollapseBefore(),n.expand=!1,n.$nextTick(function(){this.onSearchPanelCollapseAfter&&this.onSearchPanelCollapseAfter()})}},[_createVNode("span",null,[Intl.tv("关闭")]),_createVNode("i",{class:"iconfont icondownarrow"},null)])},noMatch:function(){return _createVNode("a",{key:"expand",class:"".concat(selectorPrefix,"-searchfooteritem-expand-search-up-btn"),onClick:function(){n.onSearchPanelCollapseBefore&&n.onSearchPanelCollapseBefore(),n.expand=!0,n.$nextTick(function(){this.onSearchPanelCollapseAfter&&this.onSearchPanelCollapseAfter()})}},[_createVNode("span",null,[Intl.tv("展开")]),_createVNode("i",{class:"iconfont iconup"},null)])}})),this.renderSearchFooterItems(r)||__spreadArray([],r,!0));return _createVNode("div",{class:"".concat(selectorPrefix,"-searchfooterwrapper")},[(null==(t=null==(r=this.$slots)?void 0:r.searchFooter)?void 0:t.call(r,{context:null==(r=null==(t=this.getContext)?void 0:t.call(this))?void 0:r.context,items:o}))||o.map(function(e,t){return _createVNode("div",{key:t,class:"".concat(selectorPrefix,"-searchfooteritem")},[e])})])},renderTable:function(){var o=this;if(null!=(n=this.$slots)&&n.table)return null==(t=null==(n=this.$slots)?void 0:n.table)?void 0:t.call(n,this);var e,t=this.antdTableProps,n=this.fixedHeaderAutoTable,r={},l={},i=t||{};for(e in i)e.startsWith("on")?l[e.substring(2).toLowerCase()]=i[e]:r[e]=i[e];var t=this.columnSetting,a=void 0===t?[]:t,t=this.tableDensity,s=this.getTableColumns().map(function(e,t){return __assign(__assign({},e),a[t])}).filter(function(e){return e.display}),s=(s.sort(function(e,t){return e.sort>t.sort?1:e.sort<t.sort?-1:0}),__assign(__assign({ref:"antdTableRef",rowKey:this.getRowKey(),dataSource:this.getData(),columns:s,size:t,pagination:this.getPagination(),rowSelection:this.getRowSelection(),components:this.components,change:this.onTableChange,onResizeColumn:this.onResizeColumn,customRow:function(e,t,n){return{record:e,rowIndex:t,column:n}}},r||{}),l||{}));return n&&(t=this.scrollY,r&&r.scroll?s.scroll.y=t:0!==t&&(s.scroll={y:t})),_createVNode(_Table,s,{bodyCell:function(e){return o.getBodyCellScopedSlotsInner(e)},customFilterDropdown:function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return null==(e=null==o?void 0:o.getCustomFilterDropdown)?void 0:e.call.apply(e,__spreadArray([o],t,!1))},customFilterIcon:function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return null==(e=null==o?void 0:o.getCustomFilterIcon)?void 0:e.call.apply(e,__spreadArray([o],t,!1))}})},renderInner:function(){var e,t,n,o,r,l,i,a,s,c,u,d=this,f=this;return null!=(t=this.$slots)&&t.inner?null==(u=null==(t=this.$slots)?void 0:t.inner)?void 0:u.call(t,this):(t=(u=this).className,n=u.wrapStyle,o=u.tableClassName,r=u.tableStyle,l=u.searchStyle,i=u.searchClassName,a=u.fitSearch,s=u.fitTable,c=u.autoFixed,u=u.fixedTableSpaceBetween,_createVNode(FlexLayout,{direction:"vertical",style:n||"",class:classNames(selectorPrefix,u?"fixedtablespacebetween":"",t||"")},{default:function(){return[_createVNode(Fixed,{class:classNames("".concat(selectorPrefix,"-searchwrapper"),i||""),style:l||"",fit:a},{default:function(){return[_createVNode(FlexLayout,{direction:"vertical"},{default:function(){return[_createVNode(ConditionalRender,{conditional:d.$slots.searchFormBefore||!!d.renderSearchFormBefore},{default:function(){var e,t;return _createVNode(Fixed,null,{default:function(){return[(null==(t=null==(e=f.$slots)?void 0:e.searchFormBefore)?void 0:t.call(e,f))||f.renderSearchFormBefore()]}})}}),_createVNode(Fixed,null,{default:function(){return[_createVNode(ConditionalRender,{conditional:d.expand},{default:function(){var e,t;return(null==(t=null==(e=f.$slots)?void 0:e.searchForm)?void 0:t.call(e,f))||f.renderSearchForm()}})]}}),_createVNode(Fixed,null,_isSlot(e=d.renderSearchFooter())?e:{default:function(){return[e]}}),_createVNode(ConditionalRender,{conditional:d.$slots.searchFormAfter||!!d.renderSearchFormAfter},{default:function(){var e,t;return _createVNode(Fixed,null,{default:function(){return[(null==(t=null==(e=f.$slots)?void 0:e.searchFormAfter)?void 0:t.call(e,f))||f.renderSearchFormAfter()]}})}})]}})]}}),_createVNode(ConditionalRender,{conditional:!!d.$slots.tableHeader||!!d.renderTableHeader},{default:function(){var e,t;return _createVNode(Fixed,null,{default:function(){return[(null==(t=null==(e=f.$slots)?void 0:e.tableHeader)?void 0:t.call(e,f))||f.renderTableHeader()]}})}}),_createVNode(Auto,{class:classNames("".concat(selectorPrefix,"-autowrapper"),o||"",c?"autofixed":""),style:r||"",fit:s,autoFixed:c},{default:function(){return[_createVNode("div",{ref:"tableWrapRef",class:"".concat(selectorPrefix,"-tablewrapper")},[d.renderTable()])]}}),_createVNode(ConditionalRender,{conditional:!!d.$slots.tableFooter||!!d.renderTableFooter},{default:function(){var e,t;return _createVNode(Fixed,null,{default:function(){return[(null==(t=null==(e=f.$slots)?void 0:e.tableFooter)?void 0:t.call(e,f))||f.renderTableFooter()]}})}})]}}))},renderSearchTable:function(){var e,t;return(null==(t=null==(e=this.$slots)?void 0:e.searchTable)?void 0:t.call(e,this))||_createVNode("div",{class:"".concat(selectorPrefix,"-wrap")},[this.$renderSuspense()])}},render:function(){return this.renderSearchTable()}});export default SearchTable;export{selectorPrefix,NUMBER_GENERATOR_RULE_ALONE,NUMBER_GENERATOR_RULE_CONTINUITY,ROW_SELECTION_NORMAL_MODE,ROW_SELECTION_CONTINUOUS_MODE};
//# sourceMappingURL=SearchTable.js.map
