import _mergeJSXProps from"@vue/babel-helper-vue-jsx-merge-props";import"core-js/modules/es.symbol.js";import"core-js/modules/es.symbol.description.js";import"core-js/modules/es.object.to-string.js";import"core-js/modules/es.array.map.js";import"core-js/modules/es.regexp.to-string.js";import"core-js/modules/es.array.find.js";import"core-js/modules/es.promise.js";import"core-js/modules/es.array.reduce.js";import"core-js/modules/es.array.find-index.js";import"core-js/modules/es.number.constructor.js";import"core-js/modules/es.array.filter.js";import"core-js/modules/web.dom-collections.for-each.js";import"core-js/modules/es.array.concat.js";import"core-js/modules/es.array.sort.js";import"core-js/modules/es.string.starts-with.js";import{__assign,__spreadArray}from"tslib";import{Button,Table}from"ant-design-vue";import classNames from"classnames";import cloneDeep from"lodash.clonedeep";import ConditionalRender from"@baifendian/adherev-ui-conditionalrender";import FlexLayout from"@baifendian/adherev-ui-flexlayout";import Suspense from"@baifendian/adherev-ui-suspense";import Util from"@baifendian/adherev-util";import Intl from"@baifendian/adherev-util-intl";import Mixins from"@baifendian/adherev-util-mixins";import ColumnResizable,{SearchTableResizableObserver,SearchTableResizableTitle}from"./Extension/ColumnResizable";import ColumnSetting from"./Extension/ColumnSetting";import TableCell from"./Extension/TableComponents/TableCell";import TableRow from"./Extension/TableComponents/TableRow";import TableDensitySetting from"./Extension/TableDensitySetting";import{TableDensity}from"./types";var selectorPrefix="adherev-ui-searchtable",updatedEx=Mixins.updatedEx,watchEffect=Mixins.watchEffect,Fixed=FlexLayout.Fixed,Auto=FlexLayout.Auto,extend=Util._util.extend,NUMBER_GENERATOR_RULE_ALONE=Symbol(),NUMBER_GENERATOR_RULE_CONTINUITY=Symbol(),ROW_SELECTION_NORMAL_MODE=Symbol(),ROW_SELECTION_CONTINUOUS_MODE=Symbol(),SearchTable=extend({className:"SearchTable",mixins:[Suspense,updatedEx,watchEffect],props:{className:{type:String,default:""},wrapStyle:{type:String,default:""},tableClassName:{type:String,default:""},tableStyle:{type:String,default:""},searchClassName:{type:String,default:""},searchStyle:{type:String,default:""},reset:{type:Boolean,default:!0},antdTableProps:{type:Object,default:function(){return{}}},isShowExpandSearch:{type:Boolean,default:!0},defaultExpandSearchCollapse:{type:Boolean,default:!0},fitSearch:{type:Boolean,default:!0},fitTable:{type:Boolean,default:!0},autoFixed:{type:Boolean,default:!0},fixedHeaderAutoTable:{type:Boolean,default:!1},fixedTableSpaceBetween:{type:Boolean,default:!1},showColumnSetting:{type:Boolean,default:!1}},scopedSlots:["searchFormBefore","searchFormAfter","searchForm","tableHeader","tableFooter","tableNumberColumn","columnSetting","tableDensitySetting","searchFooter","table","inner","searchTable"],data:function(){return{page:1,limit:10,expand:this.defaultExpandSearchCollapse,scrollY:0,columnSetting:[],tableDensity:TableDensity.DEFAULT,$columnResizable:new ColumnResizable,$columnObserver:null,$rowConfigReducers:[],$cellConfigReducers:[],$tableRowComponentReducers:[],$tableCellComponentReducers:[]}},computed:{components:function(){var e=this.getTableColumns(this.$createElement);return{header:{cell:SearchTableResizableTitle(e)},body:{row:TableRow,cell:TableCell}}}},provide:function(){return{getContext:this.getContext}},created:function(){this.columnSetting=this.getTableColumns(this.$createElement).map(function(e,t){return __assign(__assign({},e),{sort:t,display:!0})}),this.tableDensity=this.getTableDensity()},updatedEx:function(e){this.$refs.tableWrapRef&&(this.searchTableResizableEffectLayout(),this.fixedHeaderAutoTableEffectLayout(e))},watchEffect:function(){this.columnSettingEffect()},beforeDestroy:function(){var e;this.fixedHeaderAutoTable&&null!=(e=this.getScrollBodyEl())&&e.removeEventListener("scroll",this.onScrollBodyScroll)},methods:{getContext:function(){return{context:this}},searchTableResizableEffectLayout:function(){this.$data.$columnObserver||(this.$data.$columnObserver=SearchTableResizableObserver(this))},fixedHeaderAutoTableEffectLayout:function(e){var t,n;this.fixedHeaderAutoTable&&(t=this.getData())&&t.length&&(0===e.scrollY&&0===this.scrollY||e.scrollY!==this.scrollY||e.expand!==this.expand)&&(t=this.$refs.tableWrapRef,(e=this.getScrollBodyEl())&&(e.removeEventListener("scroll",this.onScrollBodyScroll),e.addEventListener("scroll",this.onScrollBodyScroll)),e=(null==(e=t.querySelector(".ant-table-thead"))?void 0:e.offsetHeight)||0,n=(null==(n=t.querySelector(".ant-table-pagination"))?void 0:n.offsetHeight)||0,this.scrollY=t.clientHeight-(e+(n?n+32:0)))},columnSettingEffect:function(){var e,t,n,o=this,r=this.columnSetting||[],l=this.getTableColumns(this.$createElement).map(function(e,t){return __assign(__assign({},e),{sort:t,display:!0})});(null==r?void 0:r.length)!==l.length?this.columnSetting=l:(e=null==(e=null==r?void 0:r.map)?void 0:e.call(r,function(e){return e[o.getRowKey()]}),t=null==(t=null==l?void 0:l.map)?void 0:t.call(l,function(e){return e[o.getRowKey()]}),(null==e?void 0:e.toString())!==t.toString()&&(n=this.getRowKey()||"id",this.columnSetting=null==l?void 0:l.map(function(t){var e=null==r?void 0:r.find(function(e){return e[n]===t[n]});return __assign(__assign({},t),{display:!e||e.display})})))},onSearchPanelCollapseBefore:function(){},onSearchPanelCollapseAfter:function(){},onTableChange:function(t,n,o){this[this.getOrderFieldProp()]=o.field||this.getOrderFieldValue(),this[this.getOrderProp()]=o.order,this.$nextTick(function(){var e;o.order&&(this.fetchData(),null!=(e=this.onSubTableChange))&&e.call(this,t,n,o)})},onClear:function(){var e=this;return new Promise(function(t){e.page=1,e.limit=e.getLimit(),e.$nextTick(function(){var e=this;this.clear().then(function(){e.fetchData(),t()})})})},onScrollBodyScroll:function(){var e=this.getScrollBodyEl();this.getScrollHeaderEl().scrollLeft=null==e?void 0:e.scrollLeft},sortOrder:function(e){return this[this.getOrderFieldProp()]===e?this[this.getOrderProp()]:""},onCellConfigReducers:function(e){var n=this,o=e.rowIndex,t=e.column,r=e.record,l=e.columns;return this.$data.$cellConfigReducers.reduce(function(e,t){return e.value=t.call(n,{rowIndex:o,record:r,columns:l,column:e.value}),e},{value:t}).value},onRowConfigReducers:function(e){var n=this,o=e.rowIndex,r=e.record,l=e.columns;return this.$data.$rowConfigReducers.reduce(function(e,t){return e.value=t.call(n,{rowIndex:o,record:r,columns:l,rowConfig:e.value}),e},{value:{}}).value},onRow:function(t){var n=this,e=this.getData();if(e){var o,r=e.findIndex(function(e){return e[n.getRowKey()]===t});if(-1!==r)return{record:e=e[r],rowIndex:r,columns:o=this.getColumns(),rowKey:this.getRowKey(),rowConfig:this.onRowConfigReducers({rowIndex:Number(r),record:e,columns:o})}}},getLimit:function(){return 10},getPagination:function(){var n=this;return{onChange:function(e,t){n.page=e,n.limit=t,n.$nextTick(function(){this.fetchData()})},onShowSizeChange:function(e,t){n.page=e,n.limit=t,n.$nextTick(function(){this.fetchData()})},showTotal:function(e){return Intl.tv("当前 {page}-{pageSize}/共 {total}条",{page:n.page,pageSize:n.limit,total:e})},total:this.getTotal(),current:this.page,pageSize:this.limit,showQuickJumper:!0}},getTableDensity:function(){return TableDensity.DEFAULT},getTableColumns:function(o){var r,l,i,a=this,e=this.isShowNumber(),t=this.getTableNumberColumnWidth(),s=this.getColumns().filter(function(e){var t;return!("$hide"in e&&!e.$hide)&&(!("$authorized"in e)||(null==(t=null==e?void 0:e.$authorized)?void 0:t.call(e)))}).map(function(e,t){var n={value:e};return n.value=function n(e){var o=e;return null!=(o="$resizable"in e&&null!=e&&e.$resizable?a.$data.$columnResizable.searchTableResizableColumnItem(a,t,e):o)&&o.children&&Array.isArray(o.children)&&o.children.forEach(function(e,t){o.children[t]=n(e)}),o}(e),n.value}).map(function(o){return __assign(__assign({},o),{customCell:function(e,t){var n=cloneDeep(o);return{props:{rowIndex:t,record:e,column:a.onCellConfigReducers({rowIndex:t,column:n,record:e,columns:s}),columns:s}}}})});return e?(r=this.getNumberGeneratorRule()||SearchTable.NUMBER_GENERATOR_RULE_ALONE,e=this.page,l=void 0===e?0:e,e=this.limit,i=void 0===e?10:e,[__assign(__assign({},this.getTableNumberColumnProps&&this.getTableNumberColumnProps()||{}),{title:Intl.tv("序号"),key:"_number",dataIndex:"_number",align:"center",width:t||80,customRender:function(e,t,n){return o(ConditionalRender,{attrs:{conditional:r===NUMBER_GENERATOR_RULE_ALONE}},[o("span",{slot:"default"},[a.renderTableNumberColumn(o,n+1,{value:e,record:t,index:n})]),o("span",{slot:"noMatch"},[a.renderTableNumberColumn(o,(l-1)*i+(n+1),{value:e,record:t,index:n})])])}})].concat(s)):s},getTableRowComponentReducers:function(){return this.$data.$tableRowComponentReducers},getTableCellComponentReducers:function(){return this.$data.$tableCellComponentReducers},getSortColumnSetting:function(){var e=__spreadArray([],this.columnSetting,!0);return e.sort(function(e,t){return e.sort>t.sort?1:e.sort<t.sort?-1:0}),e},getScrollHeaderEl:function(){var e=this.$refs.tableWrapRef;return null==e?void 0:e.querySelector(".ant-table-wrapper > .ant-spin-nested-loading > .ant-spin-container > .ant-table > .ant-table-content > .ant-table-scroll > .ant-table-header")},getScrollBodyEl:function(){var e=this.$refs.tableWrapRef;return null==e?void 0:e.querySelector(".ant-table-wrapper > .ant-spin-nested-loading > .ant-spin-container > .ant-table > .ant-table-content > .ant-table-scroll > .ant-table-body")},renderTableNumberColumn:function(e,t,n){var o,r;return void 0===t&&(t=""),(null==(o=null==(r=this.$scopedSlots)?void 0:r.tableNumberColumn)?void 0:o.call(r,{context:null==(r=null==(o=this.getContext)?void 0:o.call(this))?void 0:r.context,number:t}))||e("span",[t])},renderColumnSetting:function(e){var t,n,o=this,r=__spreadArray([],this.columnSetting,!0);return r.sort(function(e,t){return e.sort>t.sort?1:e.sort<t.sort?-1:0}),(null==(t=null==(n=this.$scopedSlots)?void 0:n.columnSetting)?void 0:t.call(n,{context:null==(n=null==(t=this.getContext)?void 0:t.call(this))?void 0:n.context,columns:r}))||e(ColumnSetting,{attrs:{columns:r},on:{showColumns:function(t){var e;o.columnSetting=null==(e=o.columnSetting||[])?void 0:e.map(function(e){return __assign(__assign({},e),{display:t})})},reset:function(){o.columnSetting=o.getTableColumns(e).map(function(e,t){return __assign(__assign({},e),{display:!0,sort:t})})},displayColumn:function(t,n){var e;o.columnSetting=null==(e=o.columnSetting||[])?void 0:e.map(function(e){return __assign(__assign({},e),{display:e.key===t.key?n:e.display})})},sortEnd:function(t){var e;o.columnSetting=null==(e=o.columnSetting||[])?void 0:e.map(function(e){return __assign(__assign({},e),{sort:t.get(e.key)})})}}})},renderTableDensitySetting:function(e){var t,n,o=this;return(null==(n=null==(t=this.$scopedSlots)?void 0:t.tableDensitySetting)?void 0:n.call(t,this))||e(TableDensitySetting,{attrs:{density:this.tableDensity},on:{change:function(e){o.tableDensity=e},reset:function(){o.tableDensity=o.getTableDensity()}}})},renderSearchFooter:function(n){var e,t=this,o=this.isShowExpandSearch,r=[n(Button,{class:"".concat(selectorPrefix,"-searchfooteritem"),attrs:{type:"primary"},key:"search",on:{click:function(){t.page=1,t.$nextTick(function(){this.onSearch()})}}},[n("i",{class:classNames("".concat(selectorPrefix,"-searchfooteritem-search-btn-icon"),"iconfont iconsousuo")}),Intl.tv("查询")]),n(Button,{class:"".concat(selectorPrefix,"-searchfooteritem"),key:"reset",on:{click:this.onClear}},[Intl.tv("重置")])],o=(o&&r.push(n(ConditionalRender,{attrs:{conditional:this.expand}},[n("a",{slot:"noMatch",key:"expand",class:"".concat(selectorPrefix,"-searchfooteritem-expand-search-up-btn"),on:{click:function(){t.onSearchPanelCollapseBefore&&t.onSearchPanelCollapseBefore(),t.expand=!0,t.$nextTick(function(){this.onSearchPanelCollapseAfter&&this.onSearchPanelCollapseAfter()})}}},[n("span",[Intl.tv("展开")]),n("i",{class:"iconfont iconup"})]),n("a",{key:"hide",class:"".concat(selectorPrefix,"-searchfooteritem-expand-search-down-btn"),on:{click:function(){t.onSearchPanelCollapseBefore&&t.onSearchPanelCollapseBefore(),t.expand=!1,t.$nextTick(function(){this.onSearchPanelCollapseAfter&&this.onSearchPanelCollapseAfter()})}}},[n("span",[Intl.tv("关闭")]),n("i",{class:"iconfont icondownarrow"})])])),this.renderSearchFooterItems(n,r)||__spreadArray([],r,!0));return n("div",{class:"".concat(selectorPrefix,"-searchfooterwrapper")},[(null==(e=null==(r=this.$scopedSlots)?void 0:r.searchFooter)?void 0:e.call(r,{context:null==(r=null==(e=this.getContext)?void 0:e.call(this))?void 0:r.context,items:o}))||o.map(function(e,t){return n("div",{key:t,class:"".concat(selectorPrefix,"-searchfooteritem")},[e])})])},renderTable:function(e){if(null!=(o=this.$scopedSlots)&&o.table)return null==(n=null==(o=this.$scopedSlots)?void 0:o.table)?void 0:n.call(o,this);var t,n=this.antdTableProps,o=this.fixedHeaderAutoTable,r=__assign({},(null==(r=null==this?void 0:this.getScopedSlots)?void 0:r.call(this,e))||{}),l={},i={},a=n||{};for(t in a)t.startsWith("on")?i[t.substring(2).toLowerCase()]=a[t]:l[t]=a[t];var n=this.columnSetting,s=void 0===n?[]:n,n=this.tableDensity,c=this.getTableColumns(e).map(function(e,t){return __assign(__assign({},s[t]),e)}).filter(function(e){return e.display}),r=(c.sort(function(e,t){return e.sort>t.sort?1:e.sort<t.sort?-1:0}),{scopedSlots:r,props:__assign({ref:"antdTableRef",rowKey:this.getRowKey(),dataSource:this.getData(),columns:c,size:n,pagination:this.getPagination(),rowSelection:this.getRowSelection(),components:this.components},l||{}),on:__assign({change:this.onTableChange},i||{})});return o&&(n=this.scrollY,l&&l.scroll?r.props.scroll.y=n:r.props.scroll={y:n}),this.$data.$tableRowComponentReducers=this.onTableRowComponentReducers(c),this.$data.$tableCellComponentReducers=this.onTableCellComponentReducers(c),e(Table,_mergeJSXProps([{},r]))},renderInner:function(e){var t,n,o,r,l,i,a,s,c,u;return null!=(t=this.$scopedSlots)&&t.inner?null==(u=null==(t=this.$scopedSlots)?void 0:t.inner)?void 0:u.call(t,this):(t=(u=this).className,n=u.wrapStyle,o=u.tableClassName,r=u.tableStyle,l=u.searchStyle,i=u.searchClassName,a=u.fitSearch,s=u.fitTable,c=u.autoFixed,u=u.fixedTableSpaceBetween,e(FlexLayout,{attrs:{direction:"vertical"},style:n||"",class:classNames(selectorPrefix,u?"fixedtablespacebetween":"",t||"")},[e(Fixed,{class:classNames("".concat(selectorPrefix,"-searchwrapper"),i||""),style:l||"",attrs:{fit:a}},[e(FlexLayout,{attrs:{direction:"vertical"}},[e(ConditionalRender,{attrs:{conditional:this.$scopedSlots.searchFormBefore||!!this.renderSearchFormBefore}},[e(Fixed,{slot:"default"},[(null==(u=null==(n=this.$scopedSlots)?void 0:n.searchFormBefore)?void 0:u.call(n,this))||this.renderSearchFormBefore(e)])]),e(Fixed,[e(ConditionalRender,{attrs:{conditional:this.expand}},[(null==(i=null==(t=this.$scopedSlots)?void 0:t.searchForm)?void 0:i.call(t,this))||this.renderSearchForm(e)])]),e(Fixed,[this.renderSearchFooter(e)]),e(ConditionalRender,{attrs:{conditional:this.$scopedSlots.searchFormAfter||!!this.renderSearchFormAfter}},[e(Fixed,{slot:"default"},[(null==(a=null==(l=this.$scopedSlots)?void 0:l.searchFormAfter)?void 0:a.call(l,this))||this.renderSearchFormAfter(e)])])])]),e(ConditionalRender,{attrs:{conditional:!!this.$scopedSlots.tableHeader||!!this.renderTableHeader}},[e(Fixed,{slot:"default"},[(null==(n=null==(u=this.$scopedSlots)?void 0:u.tableHeader)?void 0:n.call(u,this))||this.renderTableHeader(e)])]),e(Auto,{class:classNames("".concat(selectorPrefix,"-autowrapper"),o||"",c?"autofixed":""),style:r||"",attrs:{fit:s,autoFixed:c}},[e("div",{ref:"tableWrapRef",class:"".concat(selectorPrefix,"-tablewrapper")},[this.renderTable(e)])]),e(ConditionalRender,{attrs:{conditional:!!this.$scopedSlots.tableFooter||!!this.renderTableFooter}},[e(Fixed,{slot:"default"},[(null==(t=null==(i=this.$scopedSlots)?void 0:i.tableFooter)?void 0:t.call(i,this))||this.renderTableFooter(e)])])]))},renderSearchTable:function(e){var t,n;return(null==(n=null==(t=this.$scopedSlots)?void 0:t.searchTable)?void 0:n.call(t,this))||e("div",{class:"".concat(selectorPrefix,"-wrap")},[this.$renderSuspense(e)])}},render:function(e){return this.renderSearchTable(e)}});export default SearchTable;export{selectorPrefix,NUMBER_GENERATOR_RULE_ALONE,NUMBER_GENERATOR_RULE_CONTINUITY,ROW_SELECTION_NORMAL_MODE,ROW_SELECTION_CONTINUOUS_MODE};
//# sourceMappingURL=SearchTable.js.map
