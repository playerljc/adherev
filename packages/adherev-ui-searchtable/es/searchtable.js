import{resolveDirective as _resolveDirective,isVNode as _isVNode,createVNode as _createVNode}from"vue";import"core-js/modules/es.symbol.js";import"core-js/modules/es.symbol.description.js";import"core-js/modules/es.object.to-string.js";import"core-js/modules/es.regexp.exec.js";import"core-js/modules/es.string.split.js";import"core-js/modules/es.array.map.js";import"core-js/modules/es.string.starts-with.js";import"core-js/modules/es.array.filter.js";import"core-js/modules/es.array.concat.js";import{__assign,__spreadArray}from"tslib";import ConditionalRender from"@baifendian/adherev-ui-conditionalrender";import FlexLayout from"@baifendian/adherev-ui-flexlayout";import Suspense from"@baifendian/adherev-ui-suspense";import Intl from"@baifendian/adherev-util-intl";import Mixins from"@baifendian/adherev-util-mixins";import{Button,Table}from"ant-design-vue";import classNames from"classnames";import{defineComponent}from"vue";function _isSlot(e){return"function"==typeof e||"[object Object]"===Object.prototype.toString.call(e)&&!_isVNode(e)}var selectorPrefix="adherev-ui-searchtable",updatedEx=Mixins.updatedEx,Fixed=FlexLayout.Fixed,Auto=FlexLayout.Auto,NUMBER_GENERATOR_RULE_ALONE=Symbol(),NUMBER_GENERATOR_RULE_CONTINUITY=Symbol();export default defineComponent({mixins:[Suspense,updatedEx],props:{wrapStyle:{type:String,default:""},className:{type:String,default:""},tableClassName:{type:String,default:""},tableStyle:{type:String,default:""},searchClassName:{type:String,default:""},searchStyle:{type:String,default:""},reset:{type:Boolean,default:!0},antdTableProps:{type:Object,default:function(){return{}}},isShowExpandSearch:{type:Boolean,default:!0},defaultExpandSearchCollapse:{type:Boolean,default:!0},fitSearch:{type:Boolean,default:!0},fitTable:{type:Boolean,default:!0},autoFixed:{type:Boolean,default:!0},fixedHeaderAutoTable:{type:Boolean,default:!1},fixedTableSpaceBetween:{type:Boolean,default:!1}},data:function(){return{page:1,limit:10,expand:this.defaultExpandSearchCollapse,scrollY:0}},updatedEx:function(e){var t=this,r=t.$refs,a=t.scrollY,n=t.expand,t=t.fixedHeaderAutoTable;r.tableWrapRef&&(!t||(t=this.getData())&&t.length&&(0===e.scrollY&&0===a||e.scrollY!==a||e.expand!==n)&&(t=r.tableWrapRef,(a=this.getScrollBodyEl())&&(a.removeEventListener("scroll",this.onScrollBodyScroll),a.addEventListener("scroll",this.onScrollBodyScroll)),n=(null===(e=t.querySelector(".ant-table-thead"))||void 0===e?void 0:e.offsetHeight)||0,a=(null===(r=t.querySelector(".ant-table-pagination"))||void 0===r?void 0:r.offsetHeight)||0,this.scrollY=t.clientHeight-(n+(a?a+32:0))))},beforeUnmount:function(){var e;this.fixedHeaderAutoTable&&null!==(e=this.getScrollBodyEl())&&void 0!==e&&e.removeEventListener("scroll",this.onScrollBodyScroll)},methods:{onScrollBodyScroll:function(){var e=this.getScrollBodyEl(),t=this.getScrollHeaderEl();null!==t&&void 0!==t&&(t.scrollLeft=null==e?void 0:e.scrollLeft)},getScrollHeaderEl:function(){var e=this.$refs.tableWrapRef;return null==e?void 0:e.querySelector(".ant-table-wrapper > .ant-spin-nested-loading > .ant-spin-container > .ant-table > .ant-table-content > .ant-table-scroll > .ant-table-header")},getScrollBodyEl:function(){var e=this.$refs.tableWrapRef;return null==e?void 0:e.querySelector(".ant-table-wrapper > .ant-spin-nested-loading > .ant-spin-container > .ant-table > .ant-table-content > .ant-table-scroll > .ant-table-body")},renderTableNumberColumn:function(e,t){return _createVNode("span",null,[e=void 0===e?"":e])},renderSearchTableInner:function(){var e,t,r,a,n=this,o=this,i=o.wrapStyle,l=o.className,d=o.tableClassName,u=o.tableStyle,f=o.searchStyle,h=o.searchClassName,g=o.fitSearch,p=o.fitTable,s=o.autoFixed,N=o.fixedTableSpaceBetween,c=o.$slots;return _createVNode(FlexLayout,{direction:"vertical",style:i||"",class:classNames.apply(void 0,__spreadArray([selectorPrefix,N?"fixedtablespacebetween":""],(l||"").split(/\s+/),!1))},{default:function(){return[_createVNode(Fixed,{style:f||"",class:classNames.apply(void 0,__spreadArray(["".concat(selectorPrefix,"-searchwrapper")],(h||"").split(/\s+/),!1)),fit:g},{default:function(){return[_createVNode(FlexLayout,{direction:"vertical"},{default:function(){return[_createVNode(Fixed,null,{default:function(){return[_createVNode(ConditionalRender,{conditional:n.expand},_isSlot(e=n.renderSearchForm())?e:{default:function(){return[e]}})]}}),_createVNode(Fixed,null,_isSlot(t=n.renderSearchFooter())?t:{default:function(){return[t]}})]}})]}}),_createVNode(ConditionalRender,{conditional:!!c.tableHeader},{default:function(){return[_createVNode(Fixed,null,_isSlot(r=c.tableHeader())?r:{default:function(){return[r]}})]}}),_createVNode(Auto,{style:u||"",class:classNames.apply(void 0,__spreadArray(__spreadArray(["".concat(selectorPrefix,"-autowrapper")],(d||"").split(/\s+/),!1),[s?"autofixed":""],!1)),fit:p,autoFixed:s},{default:function(){return[_createVNode("div",{ref:"tableWrapRef",class:"".concat(selectorPrefix,"-tablewrapper")},[n.renderTable()])]}}),_createVNode(ConditionalRender,{conditional:!!c.tableFooter},{default:function(){return[_createVNode(Fixed,null,_isSlot(a=c.tableFooter())?a:{default:function(){return[a]}})]}})]}})},renderInner:function(){return this.renderSearchTableInner()},renderSearchTableSearchFooter:function(){var e,t=this,r=this.isShowExpandSearch,a=[_createVNode(Button,{class:"".concat(selectorPrefix,"-searchfooteritem"),type:"primary",onClick:function(){t.page=1,t.onSearch()}},{default:function(){return[_createVNode("i",{class:"iconfont iconsousuo"},null),Intl.tv("查询")]}}),_createVNode(Button,{class:"".concat(selectorPrefix,"-searchfooteritem"),onClick:this.onClear},_isSlot(e=Intl.tv("重置"))?e:{default:function(){return[e]}})],r=(r&&a.push(_createVNode(ConditionalRender,{conditional:this.expand},{default:function(){return _createVNode("a",{style:"display: flex; align-items: center",onClick:function(){t.expand=!1}},[_createVNode("span",{style:"margin-right: 5px;"},[Intl.tv("关闭")]),_createVNode("img",{style:"width: 16px;",src:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNjMzODYzMTc4MzI5IiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjE0ODY3IiB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIj48ZGVmcz48c3R5bGUgdHlwZT0idGV4dC9jc3MiPjwvc3R5bGU+PC9kZWZzPjxwYXRoIGQ9Ik00OTMuNTA0IDU1OC4xNDRhMzEuOTA0IDMxLjkwNCAwIDAgMCA0NS4yOCAwbDMwOC4zNTItMzA4LjM1MmEzMS45NjggMzEuOTY4IDAgMSAwLTQ1LjI0OC00NS4yNDhMNTE2LjE2IDQ5MC4yNzIgMjIxLjk4NCAxOTYuMTI4YTMxLjk2OCAzMS45NjggMCAxIDAtNDUuMjQ4IDQ1LjI0OGwzMTYuNzY4IDMxNi43Njh6IiBwLWlkPSIxNDg2OCIgZmlsbD0iIzE4OTBmZiI+PC9wYXRoPjxwYXRoIGQ9Ik04MDEuODg4IDQ2MC41NzZMNTE2LjE2IDc0Ni4zMDQgMjIyLjAxNiA0NTIuMTZhMzEuOTY4IDMxLjk2OCAwIDEgMC00NS4yNDggNDUuMjQ4bDMxNi43NjggMzE2Ljc2OGEzMS45MDQgMzEuOTA0IDAgMCAwIDQ1LjI4IDBsMzA4LjM1Mi0zMDguMzUyYTMyIDMyIDAgMSAwLTQ1LjI4LTQ1LjI0OHoiIHAtaWQ9IjE0ODY5IiBmaWxsPSIjMTg5MGZmIj48L3BhdGg+PC9zdmc+",alt:"down"},null)])},noMatch:function(){return _createVNode("a",{style:"display: flex; align-items: center",onClick:function(){t.expand=!0}},[_createVNode("span",{style:"margin-right: 5px;"},[Intl.tv("展开")]),_createVNode("img",{style:"width: 16px;",src:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNjMzODYzMjYyMTM1IiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjE1MjQ0IiB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIj48ZGVmcz48c3R5bGUgdHlwZT0idGV4dC9jc3MiPjwvc3R5bGU+PC9kZWZzPjxwYXRoIGQ9Ik0xOTkuMzYgNTcyLjc2OGEzMS45MDQgMzEuOTA0IDAgMCAwIDIyLjYyNC05LjM3NmwyOTQuMTQ0LTI5NC4xNDQgMjg1LjcyOCAyODUuNzI4YTMxLjk2OCAzMS45NjggMCAxIDAgNDUuMjQ4LTQ1LjI0OEw1MzguNzUyIDIwMS4zNzZhMzIgMzIgMCAwIDAtNDUuMjggMEwxNzYuNzA0IDUxOC4xNDRhMzEuOTY4IDMxLjk2OCAwIDAgMCAyMi42NTYgNTQuNjI0eiBtMzM5LjQyNC0xMTUuMzkyYTMyIDMyIDAgMCAwLTQ1LjI4IDBMMTc2LjczNiA3NzQuMTQ0YTMxLjk2OCAzMS45NjggMCAxIDAgNDUuMjQ4IDQ1LjI0OGwyOTQuMTQ0LTI5NC4xNDQgMjg1LjcyOCAyODUuNzI4YTMxLjk2OCAzMS45NjggMCAxIDAgNDUuMjQ4LTQ1LjI0OGwtMzA4LjMyLTMwOC4zNTJ6IiBwLWlkPSIxNTI0NSIgZmlsbD0iIzE4OTBmZiI+PC9wYXRoPjwvc3ZnPg==",alt:"up"},null)])}})),this.renderSearchFooterItems(a)||__spreadArray([],a,!0));return _createVNode("div",{class:"".concat(selectorPrefix,"-searchfooterwrapper")},[r.map(function(e){return _createVNode("div",{class:"".concat(selectorPrefix,"-searchfooteritem")},[e])})])},renderSearchFooter:function(){return this.renderSearchTableSearchFooter()},renderSearchTableTable:function(){var e,t=this,r=t.getScopedSlotsInner,a=t.antdTableProps,n=t.fixedHeaderAutoTable,o=t.getRowKey,i=t.getData,t=t.getRowSelection,l={},s={},c=a||{};for(e in c)e.startsWith("on")?s[e.substring(2).toLowerCase()]=c[e]:l[e]=c[e];a=__assign(__assign(__assign({rowKey:o(),dataSource:i(),columns:this.getTableColumns(),pagination:this.getPagination(),rowSelection:t()},l||{}),{onChange:this.onTableChange}),s||{});return n&&(o=this.scrollY,l&&l.scroll?a.scroll.y=o:a.scroll={y:o}),_createVNode(Table,a,{bodyCell:function(e){return r(e)}})},renderTable:function(){return this.renderSearchTableTable()},getScopedSlotsInner:function(e){var t,r,a,n=this,o=e.record,i=e.index;return"number"===e.column.key?(t=(0,this.getNumberGeneratorRule)()||NUMBER_GENERATOR_RULE_ALONE,r=this.page,a=this.limit,_createVNode(ConditionalRender,{conditional:t===NUMBER_GENERATOR_RULE_ALONE},{default:function(){return _createVNode("span",null,[n.renderTableNumberColumn(i+1,{record:e,index:i})])},noMatch:function(){return _createVNode("span",null,[n.renderTableNumberColumn((r-1)*a+(i+1),{record:o,index:i})])}})):this.getScopedSlots(e)},getSearchTableTableColumns:function(){var e=this.getColumns,t=this.isShowNumber(),r=this.getTableNumberColumnWidth(),e=e().filter(function(e){return!("authorized"in e)||e.authorized()});return t?[{title:Intl.tv("序号"),key:"number",align:"center",width:r||80}].concat(e):e},getTableColumns:function(){return this.getSearchTableTableColumns()},onTableChange:function(e,t,r){var a;this[this.getOrderFieldProp()]=r.field,this[this.getOrderProp()]=r.order,r.order&&(this.fetchData(),null!==(a=this.onSubTableChange)&&void 0!==a&&a.call(this,e,t,r))},onClear:function(){var e=this;this.page=1,this.limit=10,this.clear().then(function(){e.fetchData()})},sortOrder:function(e){return this[this.getOrderFieldProp()]===e?this[this.getOrderProp()]:""},getSearchTablePagination:function(){var r=this;return{onChange:function(e,t){r.page=e,r.limit=t,r.fetchData()},onShowSizeChange:function(e,t){r.page=e,r.limit=t,r.fetchData()},showTotal:function(e){return Intl.tv("当前 {page}-{pageSize}/共 {total}条",{page:r.page,pageSize:r.limit,total:e})},total:this.getTotal(),current:this.page,pageSize:this.limit,showQuickJumper:!0}},getPagination:function(){return this.getSearchTablePagination()},renderSearchTable:function(){return _createVNode("div",{class:"".concat(selectorPrefix,"-wrap")},[this.renderSuspense()])}},render:function(){return this.renderSearchTable()}});export{NUMBER_GENERATOR_RULE_ALONE,NUMBER_GENERATOR_RULE_CONTINUITY};
//# sourceMappingURL=searchtable.js.map
