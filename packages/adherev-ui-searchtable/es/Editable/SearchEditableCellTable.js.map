{"version":3,"file":"SearchEditableCellTable.js","sources":["Editable/SearchEditableCellTable.js"],"sourcesContent":["import \"core-js/modules/es.array.from.js\";\nimport \"core-js/modules/es.string.iterator.js\";\nimport \"core-js/modules/es.array.iterator.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.set.js\";\nimport \"core-js/modules/esnext.set.add-all.js\";\nimport \"core-js/modules/esnext.set.delete-all.js\";\nimport \"core-js/modules/esnext.set.difference.js\";\nimport \"core-js/modules/esnext.set.every.js\";\nimport \"core-js/modules/esnext.set.filter.js\";\nimport \"core-js/modules/esnext.set.find.js\";\nimport \"core-js/modules/esnext.set.intersection.js\";\nimport \"core-js/modules/esnext.set.is-disjoint-from.js\";\nimport \"core-js/modules/esnext.set.is-subset-of.js\";\nimport \"core-js/modules/esnext.set.is-superset-of.js\";\nimport \"core-js/modules/esnext.set.join.js\";\nimport \"core-js/modules/esnext.set.map.js\";\nimport \"core-js/modules/esnext.set.reduce.js\";\nimport \"core-js/modules/esnext.set.some.js\";\nimport \"core-js/modules/esnext.set.symmetric-difference.js\";\nimport \"core-js/modules/esnext.set.union.js\";\nimport \"core-js/modules/web.dom-collections.iterator.js\";\nimport \"core-js/modules/es.map.js\";\nimport \"core-js/modules/esnext.map.delete-all.js\";\nimport \"core-js/modules/esnext.map.every.js\";\nimport \"core-js/modules/esnext.map.filter.js\";\nimport \"core-js/modules/esnext.map.find.js\";\nimport \"core-js/modules/esnext.map.find-key.js\";\nimport \"core-js/modules/esnext.map.includes.js\";\nimport \"core-js/modules/esnext.map.key-of.js\";\nimport \"core-js/modules/esnext.map.map-keys.js\";\nimport \"core-js/modules/esnext.map.map-values.js\";\nimport \"core-js/modules/esnext.map.merge.js\";\nimport \"core-js/modules/esnext.map.reduce.js\";\nimport \"core-js/modules/esnext.map.some.js\";\nimport \"core-js/modules/esnext.map.update.js\";\nimport \"core-js/modules/es.promise.js\";\nimport \"core-js/modules/es.array.find.js\";\nimport { __assign, __spreadArray } from \"tslib\";\nimport cloneDeep from 'lodash.clonedeep';\nimport mergeWith from 'lodash.mergewith';\nimport moment from 'moment';\nimport Vue from 'vue';\nimport Util from '@baifendian/adherev-util';\nimport SearchTableImplement from '../SearchTableImplement';\nvar extend = Util._util.extend;\nVue.config.optionMergeStrategies.data = function (toVal, fromVal) {\n  if (fromVal && toVal) {\n    return function () {\n      var fromValue = fromVal();\n      var toValue = toVal();\n      return mergeWith(fromValue, toValue, function (objValue, srcValue) {\n        if (Array.isArray(objValue) && Array.isArray(srcValue)) {\n          return Array.from(new Set(__spreadArray(__spreadArray([], objValue, true), srcValue, true)));\n        }\n      });\n    };\n  }\n  if (fromVal) {\n    return fromVal;\n  }\n  if (toVal) {\n    return toVal;\n  }\n};\n/**\n * SearchEditableCellTable\n * @description 单元格可编辑的SearchTable\n * @param serviceName\n */\nexport default (function (serviceName) {\n  return extend({\n    className: 'SearchEditableCellTable',\n    mixins: [SearchTableImplement(serviceName)],\n    data: function data() {\n      var _this = this;\n      return {\n        $cellConfigReducers: [function () {\n          var params = [];\n          for (var _i = 0; _i < arguments.length; _i++) {\n            params[_i] = arguments[_i];\n          }\n          return _this.cellEditableReducer.apply(_this, params);\n        }],\n        $valueToFormItemValueMap: new Map([['rangePicker', function (_a) {\n          var record = _a.record,\n            dataIndex = _a.dataIndex;\n          var value = record === null || record === void 0 ? void 0 : record[dataIndex];\n          return Array.isArray(value) && value.length === 2 ? [moment(value[0]), moment(value[1])] : [moment(), moment()];\n        }], ['datePicker', function (_a) {\n          var record = _a.record,\n            dataIndex = _a.dataIndex;\n          var value = record === null || record === void 0 ? void 0 : record[dataIndex];\n          return moment(value);\n        }], ['timePicker', function (_a) {\n          var record = _a.record,\n            dataIndex = _a.dataIndex;\n          var value = record === null || record === void 0 ? void 0 : record[dataIndex];\n          return moment(value);\n        }]])\n      };\n    },\n    methods: {\n      /**\n       * onTableRowComponentReducers\n       * @param columns\n       */\n      onTableRowComponentReducers: function onTableRowComponentReducers(columns) {\n        var existsEditable = columns.some(function (column) {\n          var _a;\n          return '$editable' in column && ((_a = column.$editable) === null || _a === void 0 ? void 0 : _a.editable);\n        });\n        if (existsEditable) {\n          return __spreadArray(__spreadArray([], this.$data.$tableRowComponentReducers, true), ['useEditableRow'], false);\n        }\n        return this.$data.$tableRowComponentReducers;\n      },\n      /**\n       * onTableCellComponentReducers\n       * @param columns\n       */\n      onTableCellComponentReducers: function onTableCellComponentReducers(columns) {\n        var existsEditor = columns.some(function (column) {\n          var _a;\n          return '$editable' in column && ((_a = column.$editable) === null || _a === void 0 ? void 0 : _a.editable);\n        });\n        if (existsEditor) {\n          return __spreadArray(__spreadArray([], this.$data.$tableCellComponentReducers, true), ['useEditableCell'], false);\n        }\n        return this.$data.$tableCellComponentReducers;\n      },\n      /**\n       * onEditorRow\n       * @param params\n       */\n      onEditorRow: function onEditorRow(params) {\n        return {\n          editable: false\n        };\n      },\n      /**\n       * onEditorCell\n       * @param params\n       */\n      onEditorCell: function onEditorCell(params) {},\n      /**\n       * cellEditableReducer\n       * @description 可编辑单元格的onCell处理\n       * @param params\n       */\n      cellEditableReducer: function cellEditableReducer(params) {\n        var _a;\n        var rowIndex = params.rowIndex,\n          column = params.column,\n          record = params.record;\n        // 如果设置了$editable则调用onEditorCell方法对每个cell进行props注入\n        if ('$editable' in column && ((_a = column.$editable) === null || _a === void 0 ? void 0 : _a.editable) && this.onEditorCell) {\n          this.onEditorCell({\n            rowIndex: rowIndex,\n            editorConfig: column.$editable,\n            record: __assign({}, record)\n          });\n          return column;\n        }\n        return column;\n      },\n      /**\n       * valueToFormItemValue\n       * @description 值和表单值的转换\n       */\n      valueToFormItemValue: function valueToFormItemValue(_a) {\n        var type = _a.type,\n          record = _a.record,\n          dataIndex = _a.dataIndex;\n        var item = this.$data.$valueToFormItemValueMap.get(type);\n        return item ? item === null || item === void 0 ? void 0 : item({\n          record: record,\n          dataIndex: dataIndex\n        }) : record === null || record === void 0 ? void 0 : record[dataIndex];\n      },\n      /**\n       * updateEditorCellDate\n       * @description 更新可编辑单元格的数据\n       * @param record 行数据\n       * @param dataIndex 列索引\n       * @param value 更新的值\n       * @return Promise<void>\n       */\n      updateEditorCellDate: function updateEditorCellDate(_a) {\n        var _this = this;\n        var record = _a.record,\n          dataIndex = _a.dataIndex,\n          value = _a.value;\n        return new Promise(function (resolve) {\n          var _a;\n          if (record[dataIndex] === value) {\n            resolve();\n            return;\n          }\n          var listData = cloneDeep(_this.state[_this.getServiceName()]);\n          var dataSource = listData[_this.getFetchListPropName()][_this.getDataKey()] || [];\n          var rowKey = _this.getRowKey();\n          var recordItem = dataSource.find(function (t) {\n            return t[rowKey] === record[rowKey];\n          });\n          if (recordItem) {\n            recordItem[dataIndex] = value;\n            _this.setState((_a = {}, _a[_this.getServiceName()] = listData, _a), function () {\n              return resolve();\n            });\n          } else resolve();\n        });\n      },\n      /**\n       * updateEditorCellDateData\n       * @description 更新日期类型可编辑单元格的数据\n       * @param record\n       * @param dataIndex\n       * @param value\n       * @return Promise<void>\n       */\n      updateEditorCellDateData: function updateEditorCellDateData(_a) {\n        var _this = this;\n        var record = _a.record,\n          dataIndex = _a.dataIndex,\n          value = _a.value;\n        return new Promise(function (resolve) {\n          var _a;\n          if (record[dataIndex] === (value === null || value === void 0 ? void 0 : value.valueOf())) {\n            resolve();\n            return;\n          }\n          var listData = cloneDeep(_this.state[_this.getServiceName()]);\n          var dataSource = listData[_this.getFetchListPropName()][_this.getDataKey()] || [];\n          var rowKey = _this.getRowKey();\n          var recordItem = dataSource.find(function (t) {\n            return t[rowKey] === record[rowKey];\n          });\n          if (recordItem) {\n            recordItem[dataIndex] = value === null || value === void 0 ? void 0 : value.valueOf();\n            _this.setState((_a = {}, _a[_this.getServiceName()] = listData, _a), function () {\n              return resolve();\n            });\n          } else resolve();\n        });\n      }\n    }\n  });\n});"],"names":["__assign","__spreadArray","cloneDeep","mergeWith","moment","Vue","Util","SearchTableImplement","extend","_util","config","optionMergeStrategies","data","toVal","fromVal","fromValue","toValue","objValue","srcValue","Array","isArray","from","Set","serviceName","className","mixins","_this","this","$cellConfigReducers","params","_i","arguments","length","cellEditableReducer","apply","$valueToFormItemValueMap","Map","_a","record","dataIndex","value","methods","onTableRowComponentReducers","columns","some","column","$editable","editable","$data","$tableRowComponentReducers","onTableCellComponentReducers","$tableCellComponentReducers","onEditorRow","onEditorCell","rowIndex","editorConfig","valueToFormItemValue","type","item","get","updateEditorCellDate","Promise","resolve","listData","rowKey","recordItem","dataSource","state","getServiceName","getFetchListPropName","getDataKey","getRowKey","find","t","setState","updateEditorCellDateData","valueOf"],"mappings":"MAAO,yCACA,8CACA,6CACA,+CACA,kCACA,8CACA,iDACA,iDACA,4CACA,6CACA,2CACA,mDACA,uDACA,mDACA,qDACA,2CACA,0CACA,6CACA,2CACA,2DACA,4CACA,wDACA,kCACA,iDACA,4CACA,6CACA,2CACA,+CACA,+CACA,6CACA,+CACA,iDACA,4CACA,6CACA,2CACA,6CACA,sCACA,0CACEA,SAAUC,aAA4B,KAAP,eACjCC,cAAe,0BACfC,cAAe,0BACfC,WAAY,gBACZC,QAAS,aACTC,SAAU,kCACVC,yBAA0B,0BACjC,IAAIC,OAASF,KAAKG,MAAMD,OACxBH,IAAIK,OAAOC,sBAAsBC,KAAO,SAAUC,EAAOC,GACvD,OAAIA,GAAWD,EACN,WACL,IAAIE,EAAYD,EAAQ,EACpBE,EAAUH,EAAM,EACpB,OAAOV,UAAUY,EAAWC,EAAS,SAAUC,EAAUC,GACvD,GAAIC,MAAMC,QAAQH,CAAQ,GAAKE,MAAMC,QAAQF,CAAQ,EACnD,OAAOC,MAAME,KAAK,IAAIC,IAAIrB,cAAcA,cAAc,GAAIgB,EAAU,CAAA,CAAI,EAAGC,EAAU,CAAA,CAAI,CAAC,CAAC,CAE/F,CAAC,CACH,EAEEJ,GAGAD,GAAJ,KAAA,CAGF,iBAMe,SAAWU,GACxB,OAAOf,OAAO,CACZgB,UAAW,0BACXC,OAAQ,CAAClB,qBAAqBgB,CAAW,GACzCX,KAAM,WACJ,IAAIc,EAAQC,KACZ,MAAO,CACLC,oBAAqB,CAAC,WAEpB,IADA,IAAIC,EAAS,GACJC,EAAK,EAAGA,EAAKC,UAAUC,OAAQF,CAAE,GACxCD,EAAOC,GAAMC,UAAUD,GAEzB,OAAOJ,EAAMO,oBAAoBC,MAAMR,EAAOG,CAAM,CACtD,GACAM,yBAA0B,IAAIC,IAAI,CAAC,CAAC,cAAe,SAAUC,GAC3D,IAAIC,EAASD,EAAGC,OACdC,EAAYF,EAAGE,UACbC,EAAQF,MAAAA,EAAuC,KAAA,EAASA,EAAOC,GACnE,OAAOpB,MAAMC,QAAQoB,CAAK,GAAsB,IAAjBA,EAAMR,OAAe,CAAC5B,OAAOoC,EAAM,EAAE,EAAGpC,OAAOoC,EAAM,EAAE,GAAK,CAACpC,OAAO,EAAGA,OAAO,EAC/G,GAAI,CAAC,aAAc,SAAUiC,GAC3B,IAAIC,EAASD,EAAGC,OACdC,EAAYF,EAAGE,UACbC,EAAQF,MAAAA,EAAuC,KAAA,EAASA,EAAOC,GACnE,OAAOnC,OAAOoC,CAAK,CACrB,GAAI,CAAC,aAAc,SAAUH,GAC3B,IAAIC,EAASD,EAAGC,OACdC,EAAYF,EAAGE,UACbC,EAAQF,MAAAA,EAAuC,KAAA,EAASA,EAAOC,GACnE,OAAOnC,OAAOoC,CAAK,CACrB,GAAG,CACL,CACF,EACAC,QAAS,CAKPC,4BAA6B,SAAqCC,GAKhE,OAJqBA,EAAQC,KAAK,SAAUC,GAE1C,MAAO,cAAeA,IAAW,OAACR,EAAKQ,EAAOC,WAAuC,KAAA,EAAST,EAAGU,SACnG,CAAC,EAEQ9C,cAAcA,cAAc,GAAI0B,KAAKqB,MAAMC,2BAA4B,CAAA,CAAI,EAAG,CAAC,kBAAmB,CAAA,CAAK,EAEzGtB,KAAKqB,MAAMC,0BACpB,EAKAC,6BAA8B,SAAsCP,GAKlE,OAJmBA,EAAQC,KAAK,SAAUC,GAExC,MAAO,cAAeA,IAAW,OAACR,EAAKQ,EAAOC,WAAuC,KAAA,EAAST,EAAGU,SACnG,CAAC,EAEQ9C,cAAcA,cAAc,GAAI0B,KAAKqB,MAAMG,4BAA6B,CAAA,CAAI,EAAG,CAAC,mBAAoB,CAAA,CAAK,EAE3GxB,KAAKqB,MAAMG,2BACpB,EAKAC,YAAa,SAAqBvB,GAChC,MAAO,CACLkB,SAAU,CAAA,CACZ,CACF,EAKAM,aAAc,SAAsBxB,KAMpCI,oBAAqB,SAA6BJ,GAChD,IAAIQ,EACAiB,EAAWzB,EAAOyB,SACpBT,EAAShB,EAAOgB,OAChBP,EAAST,EAAOS,OAUlB,MARI,cAAeO,GAAW,OAACR,EAAKQ,EAAOC,YAAgDT,EAAGU,UAAapB,KAAK0B,cAC9G1B,KAAK0B,aAAa,CAChBC,SAAUA,EACVC,aAAcV,EAAOC,UACrBR,OAAQtC,SAAS,GAAIsC,CAAM,CAC7B,CAAC,EAGIO,CACT,EAKAW,qBAAsB,SAA8BnB,GAClD,IAAIoB,EAAOpB,EAAGoB,KACZnB,EAASD,EAAGC,OACZC,EAAYF,EAAGE,UACbmB,EAAO/B,KAAKqB,MAAMb,yBAAyBwB,IAAIF,CAAI,EACvD,OAAOC,EAAOA,MAAAA,EAAmC,KAAA,EAASA,EAAK,CAC7DpB,OAAQA,EACRC,UAAWA,CACb,CAAC,EAAID,MAAAA,EAAuC,KAAA,EAASA,EAAOC,EAC9D,EASAqB,qBAAsB,SAA8BvB,GAClD,IAAIX,EAAQC,KACRW,EAASD,EAAGC,OACdC,EAAYF,EAAGE,UACfC,EAAQH,EAAGG,MACb,OAAO,IAAIqB,QAAQ,SAAUC,GAC3B,IAKIC,EAEAC,EACAC,EAPA3B,EAAOC,KAAeC,IAKtB0B,GADAH,EAAW7D,UAAUwB,EAAMyC,MAAMzC,EAAM0C,eAAe,EAAE,GAClC1C,EAAM2C,qBAAqB,GAAG3C,EAAM4C,WAAW,IAAM,GAC3EN,EAAStC,EAAM6C,UAAU,EACzBN,EAAaC,EAAWM,KAAK,SAAUC,GACzC,OAAOA,EAAET,KAAY1B,EAAO0B,EAC9B,CAAC,IAECC,EAAW1B,GAAaC,EACxBd,EAAMgD,WAAUrC,EAAK,IAAOX,EAAM0C,eAAe,GAAKL,EAAU1B,GAAK,WACnE,OAAOyB,EAAQ,CACjB,CAAC,GACIA,EAAQ,CACjB,CAAC,CACH,EASAa,yBAA0B,SAAkCtC,GAC1D,IAAIX,EAAQC,KACRW,EAASD,EAAGC,OACdC,EAAYF,EAAGE,UACfC,EAAQH,EAAGG,MACb,OAAO,IAAIqB,QAAQ,SAAUC,GAC3B,IAKIC,EAEAC,EACAC,EAPA3B,EAAOC,MAAgBC,MAAAA,EAAqC,KAAA,EAASA,EAAMoC,QAAQ,KAKnFV,GADAH,EAAW7D,UAAUwB,EAAMyC,MAAMzC,EAAM0C,eAAe,EAAE,GAClC1C,EAAM2C,qBAAqB,GAAG3C,EAAM4C,WAAW,IAAM,GAC3EN,EAAStC,EAAM6C,UAAU,EACzBN,EAAaC,EAAWM,KAAK,SAAUC,GACzC,OAAOA,EAAET,KAAY1B,EAAO0B,EAC9B,CAAC,IAECC,EAAW1B,GAAaC,MAAAA,EAAqC,KAAA,EAASA,EAAMoC,QAAQ,EACpFlD,EAAMgD,WAAUrC,EAAK,IAAOX,EAAM0C,eAAe,GAAKL,EAAU1B,GAAK,WACnE,OAAOyB,EAAQ,CACjB,CAAC,GACIA,EAAQ,CACjB,CAAC,CACH,CACF,CACF,CAAC,CACF"}