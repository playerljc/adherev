{"version":3,"file":"SearchEditableTable.js","sources":["Editable/SearchEditableTable.js"],"sourcesContent":["import \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.array.from.js\";\nimport \"core-js/modules/es.string.iterator.js\";\nimport \"core-js/modules/es.array.iterator.js\";\nimport \"core-js/modules/es.set.js\";\nimport \"core-js/modules/esnext.set.add-all.js\";\nimport \"core-js/modules/esnext.set.delete-all.js\";\nimport \"core-js/modules/esnext.set.difference.js\";\nimport \"core-js/modules/esnext.set.every.js\";\nimport \"core-js/modules/esnext.set.filter.js\";\nimport \"core-js/modules/esnext.set.find.js\";\nimport \"core-js/modules/esnext.set.intersection.js\";\nimport \"core-js/modules/esnext.set.is-disjoint-from.js\";\nimport \"core-js/modules/esnext.set.is-subset-of.js\";\nimport \"core-js/modules/esnext.set.is-superset-of.js\";\nimport \"core-js/modules/esnext.set.join.js\";\nimport \"core-js/modules/esnext.set.map.js\";\nimport \"core-js/modules/esnext.set.reduce.js\";\nimport \"core-js/modules/esnext.set.some.js\";\nimport \"core-js/modules/esnext.set.symmetric-difference.js\";\nimport \"core-js/modules/esnext.set.union.js\";\nimport \"core-js/modules/web.dom-collections.iterator.js\";\nimport \"core-js/modules/es.array.reduce.js\";\nimport \"core-js/modules/web.dom-collections.for-each.js\";\nimport \"core-js/modules/es.array.concat.js\";\nimport \"core-js/modules/es.object.keys.js\";\nimport \"core-js/modules/es.parse-int.js\";\nimport \"core-js/modules/es.array.last-index-of.js\";\nimport \"core-js/modules/es.promise.js\";\nimport \"core-js/modules/es.array.map.js\";\nimport { __assign, __spreadArray } from \"tslib\";\nimport Util from '@baifendian/adherev-util';\nimport SearchEditableCellTable from './SearchEditableCellTable';\nvar extend = Util._util.extend;\n/**\n * SearchEditableTable\n * @description 表格整体可编辑的SearchTable\n * @param serviceName\n */\nexport default (function (serviceName) {\n  return extend({\n    className: 'SearchEditableTable',\n    mixins: [SearchEditableCellTable(serviceName)],\n    data: function data() {\n      var _this = this;\n      return {\n        $rowConfigReducers: [function () {\n          var params = [];\n          for (var _i = 0; _i < arguments.length; _i++) {\n            params[_i] = arguments[_i];\n          }\n          return _this.rowEditableReducer.apply(_this, params);\n        }],\n        isTableEditor: false\n      };\n    },\n    methods: {\n      /**\n       * onTableRowComponentReducers\n       * @param columns\n       */\n      onTableRowComponentReducers: function onTableRowComponentReducers(columns) {\n        var existsEditor = columns.some(function (column) {\n          var _a;\n          return '$editable' in column && ((_a = column.$editable) === null || _a === void 0 ? void 0 : _a.editable);\n        });\n        if (existsEditor) {\n          return Array.from(new Set(__spreadArray(__spreadArray([], this.$data.$tableRowComponentReducers, true), ['useEditableTableRow'], false)));\n        }\n        return this.$data.$tableRowComponentReducers;\n      },\n      /**\n       * onTableRowComponentReducers\n       * @param columns\n       */\n      onTableCellComponentReducers: function onTableCellComponentReducers(columns) {\n        var existsEditor = columns.some(function (column) {\n          var _a;\n          return '$editable' in column && ((_a = column.$editable) === null || _a === void 0 ? void 0 : _a.editable);\n        });\n        if (existsEditor) {\n          return Array.from(new Set(__spreadArray(__spreadArray([], this.$data.$tableCellComponentReducers, true), ['useEditableTableCell'], false)));\n        }\n        return this.$data.$tableCellComponentReducers;\n      },\n      /**\n       * rowEditableReducer\n       * @description 可编辑row的处理\n       * @param params\n       */\n      rowEditableReducer: function rowEditableReducer(params) {\n        var rowConfig = params.rowConfig,\n          rowIndex = params.rowIndex,\n          columns = params.columns,\n          record = params.record;\n        if (this.onEditorRow) {\n          rowConfig.$editable = this.onEditorRow({\n            rowIndex: rowIndex,\n            record: record,\n            columns: columns\n          });\n        }\n        return rowConfig;\n      },\n      /**\n       * onEditorRow\n       * @param params\n       */\n      onEditorRow: function onEditorRow(params) {\n        return {\n          editable: true\n        };\n      },\n      /**\n       * onEditorCell\n       * @param record\n       * @param editorConfig\n       */\n      onEditorCell: function onEditorCell(_a) {\n        var record = _a.record,\n          editorConfig = _a.editorConfig;\n        if (editorConfig) {\n          editorConfig.useTrigger = false;\n          if (this.isTableEditor) {\n            editorConfig.defaultStatus = 'edit';\n          }\n        }\n      },\n      /**\n       * setFieldValues\n       */\n      setFieldValues: function setFieldValues() {\n        var _a;\n        var form = this.getFormIns();\n        (_a = form === null || form === void 0 ? void 0 : form.setFieldsValue) === null || _a === void 0 ? void 0 : _a.call(form, this.$arrayToValues(this.getData()));\n      },\n      /**\n       * $arrayToValues\n       * @param dataSource\n       */\n      $arrayToValues: function $arrayToValues(dataSource) {\n        var _this = this;\n        var columns = this.getTableColumns();\n        return (dataSource || []).reduce(function (values, record, currentIndex) {\n          columns.forEach(function (_a) {\n            var dataIndex = _a.dataIndex,\n              $editable = _a.$editable;\n            if (dataIndex in record && $editable && 'type' in $editable) {\n              // 这个表格表单数据key的生成规则\n              var key = \"\".concat(dataIndex, \"_\").concat(currentIndex);\n              values[key] = _this.valueToFormItemValue({\n                type: $editable.type,\n                record: record,\n                dataIndex: dataIndex\n              });\n            }\n          });\n          return values;\n        }, {});\n      },\n      /**\n       * $valuesToArray\n       * @param values\n       */\n      $valuesToArray: function $valuesToArray(values) {\n        /**\n         * name_0:1\n         * sex_0:2\n         * address_0:3\n         *\n         * name_1:4\n         * sex_1:5\n         * address_1:6\n         *\n         * [\n         *   {\n         *     name:1,\n         *     sex:2,\n         *     address:3\n         *   },\n         *   {\n         *     name:4,\n         *     sex:5,\n         *     address:6\n         *   }\n         * ]\n         */\n        return Object.keys(values).reduce(function (array, key) {\n          var currentIndex = parseInt(key.substring(key.lastIndexOf('_') + 1));\n          var prop = key.substring(0, key.lastIndexOf('_'));\n          if (!array[currentIndex]) {\n            array[currentIndex] = {};\n          }\n          var record = array[currentIndex];\n          record[prop] = values[key];\n          return array;\n        }, []);\n      },\n      /**\n       * fetchData\n       */\n      fetchData: function fetchData() {\n        var _this = this;\n        return this.$fetchDataSearchTableImpl().then(function (res) {\n          _this.isTableEditor = false;\n          return res;\n        });\n      },\n      /**\n       * updateEditorData\n       * @description 更新可编辑的所有单元格\n       * @return Promise<void>\n       */\n      updateEditorData: function updateEditorData(changeData) {\n        var _this = this;\n        return new Promise(function (resolve) {\n          // 原始的数据\n          var dataSource = _this.getData();\n          // 改变的数据\n          var changeDataSource = _this.$valuesToArray(changeData);\n          // this[`${this.getServiceName()}${this.getFetchListPropNameToFirstUpper()}`][\n          //   this.getDataKey()\n          // ] = dataSource.map((srcRecord, _index) => ({\n          //   // 原始数据和改变的数据做merge\n          //   ...srcRecord,\n          //   ...changeDataSource[_index],\n          // }));\n          _this.receiveDataMutation(dataSource.map(function (srcRecord, _index) {\n            return __assign(__assign({}, srcRecord), changeDataSource[_index]);\n          }));\n          _this.$nextTick(function () {\n            return resolve();\n          });\n        });\n      }\n    }\n  });\n});"],"names":["__assign","__spreadArray","Util","SearchEditableCellTable","extend","_util","serviceName","className","mixins","data","_this","this","$rowConfigReducers","params","_i","arguments","length","rowEditableReducer","apply","isTableEditor","methods","onTableRowComponentReducers","columns","some","column","_a","$editable","editable","Array","from","Set","$data","$tableRowComponentReducers","onTableCellComponentReducers","$tableCellComponentReducers","rowConfig","rowIndex","record","onEditorRow","onEditorCell","editorConfig","useTrigger","defaultStatus","setFieldValues","form","getFormIns","setFieldsValue","call","$arrayToValues","getData","dataSource","getTableColumns","reduce","values","currentIndex","forEach","key","dataIndex","concat","valueToFormItemValue","type","$valuesToArray","Object","keys","array","parseInt","substring","lastIndexOf","prop","fetchData","$fetchDataSearchTableImpl","then","res","updateEditorData","changeData","Promise","resolve","changeDataSource","receiveDataMutation","map","srcRecord","_index","$nextTick"],"mappings":"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"}