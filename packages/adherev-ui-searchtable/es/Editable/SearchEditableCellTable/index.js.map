{"version":3,"file":"index.js","sources":["Editable/SearchEditableCellTable/index.js"],"sourcesContent":["import \"core-js/modules/es.array.iterator.js\";\nimport \"core-js/modules/es.map.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.string.iterator.js\";\nimport \"core-js/modules/esnext.map.delete-all.js\";\nimport \"core-js/modules/esnext.map.every.js\";\nimport \"core-js/modules/esnext.map.filter.js\";\nimport \"core-js/modules/esnext.map.find.js\";\nimport \"core-js/modules/esnext.map.find-key.js\";\nimport \"core-js/modules/esnext.map.includes.js\";\nimport \"core-js/modules/esnext.map.key-of.js\";\nimport \"core-js/modules/esnext.map.map-keys.js\";\nimport \"core-js/modules/esnext.map.map-values.js\";\nimport \"core-js/modules/esnext.map.merge.js\";\nimport \"core-js/modules/esnext.map.reduce.js\";\nimport \"core-js/modules/esnext.map.some.js\";\nimport \"core-js/modules/esnext.map.update.js\";\nimport \"core-js/modules/web.dom-collections.iterator.js\";\nimport \"core-js/modules/es.array.from.js\";\nimport \"core-js/modules/es.set.js\";\nimport \"core-js/modules/esnext.set.add-all.js\";\nimport \"core-js/modules/esnext.set.delete-all.js\";\nimport \"core-js/modules/esnext.set.difference.js\";\nimport \"core-js/modules/esnext.set.every.js\";\nimport \"core-js/modules/esnext.set.filter.js\";\nimport \"core-js/modules/esnext.set.find.js\";\nimport \"core-js/modules/esnext.set.intersection.js\";\nimport \"core-js/modules/esnext.set.is-disjoint-from.js\";\nimport \"core-js/modules/esnext.set.is-subset-of.js\";\nimport \"core-js/modules/esnext.set.is-superset-of.js\";\nimport \"core-js/modules/esnext.set.join.js\";\nimport \"core-js/modules/esnext.set.map.js\";\nimport \"core-js/modules/esnext.set.reduce.js\";\nimport \"core-js/modules/esnext.set.some.js\";\nimport \"core-js/modules/esnext.set.symmetric-difference.js\";\nimport \"core-js/modules/esnext.set.union.js\";\nimport \"core-js/modules/es.promise.js\";\nimport \"core-js/modules/es.array.find.js\";\nimport { __assign, __spreadArray } from \"tslib\";\nimport { Form } from 'ant-design-vue';\n// import cloneDeep from 'lodash.clonedeep';\n// import mergeWith from 'lodash.mergewith';\nimport moment from 'moment';\n// import Vue from 'vue';\nimport Util from '@baifendian/adherev-util';\nimport { selectorPrefix } from '../../SearchTable';\nimport SearchTableImplement from '../../SearchTableImplement';\nvar extend = Util._util.extend;\n// Vue.config.optionMergeStrategies.data = (toVal, fromVal) => {\n//   if (fromVal && toVal) {\n//     return () => {\n//       const fromValue = fromVal();\n//       const toValue = toVal();\n//\n//       return mergeWith(fromValue, toValue, (objValue, srcValue) => {\n//         if (Array.isArray(objValue) && Array.isArray(srcValue)) {\n//           return Array.from(new Set([...objValue, ...srcValue]));\n//         }\n//       });\n//     };\n//   }\n//\n//   if (fromVal) {\n//     return fromVal;\n//   }\n//\n//   if (toVal) {\n//     return toVal;\n//   }\n// };\n/**\n * SearchEditableCellTable\n * @description 单元格可编辑的SearchTable\n * @param serviceName\n */\nexport default (function (serviceName) {\n  return extend({\n    className: 'SearchEditableCellTable',\n    mixins: [SearchTableImplement(serviceName)],\n    provide: function provide() {\n      return {\n        getFormIns: this.getFormIns,\n        getActiveValue: this.getActiveValue,\n        setActiveValue: this.setActiveValue\n      };\n    },\n    data: function data() {\n      var _this = this;\n      return {\n        $cellConfigReducers: [function () {\n          var params = [];\n          for (var _i = 0; _i < arguments.length; _i++) {\n            params[_i] = arguments[_i];\n          }\n          return _this.cellEditableReducer.apply(_this, params);\n        }],\n        $valueToFormItemValueMap: new Map([['rangePicker', function (_a) {\n          var record = _a.record,\n            dataIndex = _a.dataIndex;\n          var value = record === null || record === void 0 ? void 0 : record[dataIndex];\n          return Array.isArray(value) && value.length === 2 ? [moment(value[0]), moment(value[1])] : [moment(), moment()];\n        }], ['datePicker', function (_a) {\n          var record = _a.record,\n            dataIndex = _a.dataIndex;\n          var value = record === null || record === void 0 ? void 0 : record[dataIndex];\n          return moment(value);\n        }], ['timePicker', function (_a) {\n          var record = _a.record,\n            dataIndex = _a.dataIndex;\n          var value = record === null || record === void 0 ? void 0 : record[dataIndex];\n          return moment(value);\n        }]]),\n        form: this.$form.createForm(this, {\n          name: 'SearchEditableCellTableForm'\n        }),\n        // 正在编辑的单元格id\n        activeValue: ''\n      };\n    },\n    methods: {\n      /**\n       * onTableRowComponentReducers\n       * @param columns\n       */\n      onTableRowComponentReducers: function onTableRowComponentReducers(columns) {\n        var existsEditable = columns.some(function (column) {\n          var _a;\n          return '$editable' in column && ((_a = column.$editable) === null || _a === void 0 ? void 0 : _a.editable);\n        });\n        if (existsEditable) {\n          return Array.from(new Set(__spreadArray(__spreadArray([], this.$data.$tableRowComponentReducers, true), ['useEditableRow'], false)));\n        }\n        return this.$data.$tableRowComponentReducers;\n      },\n      /**\n       * onTableCellComponentReducers\n       * @param columns\n       */\n      onTableCellComponentReducers: function onTableCellComponentReducers(columns) {\n        var existsEditor = columns.some(function (column) {\n          var _a;\n          return '$editable' in column && ((_a = column.$editable) === null || _a === void 0 ? void 0 : _a.editable);\n        });\n        if (existsEditor) {\n          return Array.from(new Set(__spreadArray(__spreadArray([], this.$data.$tableCellComponentReducers, true), ['useEditableCell'], false)));\n        }\n        return this.$data.$tableCellComponentReducers;\n      },\n      /**\n       * onEditorRow\n       * @param params\n       */\n      onEditorRow: function onEditorRow(params) {\n        return {\n          editable: false\n        };\n      },\n      /**\n       * onEditorCell\n       * @param params\n       */\n      onEditorCell: function onEditorCell(params) {},\n      /**\n       * cellEditableReducer\n       * @description 可编辑单元格的onCell处理\n       * @param params\n       */\n      cellEditableReducer: function cellEditableReducer(params) {\n        var _a;\n        var rowIndex = params.rowIndex,\n          column = params.column,\n          record = params.record;\n        // 如果设置了$editable则调用onEditorCell方法对每个cell进行props注入\n        if ('$editable' in column && ((_a = column.$editable) === null || _a === void 0 ? void 0 : _a.editable) && this.onEditorCell) {\n          this.onEditorCell({\n            rowIndex: rowIndex,\n            editorConfig: column.$editable,\n            record: __assign({}, record)\n          });\n          return column;\n        }\n        return column;\n      },\n      /**\n       * valueToFormItemValue\n       * @description 值和表单值的转换\n       */\n      valueToFormItemValue: function valueToFormItemValue(_a) {\n        var type = _a.type,\n          record = _a.record,\n          dataIndex = _a.dataIndex;\n        var item = this.$data.$valueToFormItemValueMap.get(type);\n        return item ? item === null || item === void 0 ? void 0 : item({\n          record: record,\n          dataIndex: dataIndex\n        }) : record === null || record === void 0 ? void 0 : record[dataIndex];\n      },\n      /**\n       * updateEditorCellDate\n       * @description 更新可编辑单元格的数据\n       * @param record 行数据\n       * @param dataIndex 列索引\n       * @param rowIndex 行索引\n       * @param value 更新的值\n       * @return Promise<void>\n       */\n      updateEditorCellDate: function updateEditorCellDate(_a) {\n        var _this = this;\n        var record = _a.record,\n          dataIndex = _a.dataIndex,\n          rowIndex = _a.rowIndex,\n          value = _a.value;\n        return new Promise(function (resolve) {\n          if (record[dataIndex] === value) {\n            resolve();\n            return;\n          }\n          var dataSource = _this.getData();\n          var rowKey = _this.getRowKey();\n          var recordItem = dataSource.find(function (t) {\n            return t[rowKey] === record[rowKey];\n          });\n          if (recordItem) {\n            recordItem[dataIndex] = value;\n            _this.receiveDataMutation(dataSource);\n            _this.$nextTick(function () {\n              return resolve();\n            });\n            return;\n          }\n          resolve();\n        });\n      },\n      /**\n       * updateEditorCellDateData\n       * @description 更新日期类型可编辑单元格的数据\n       * @param record\n       * @param dataIndex\n       * @param value\n       * @return Promise<void>\n       */\n      updateEditorCellDateData: function updateEditorCellDateData(_a) {\n        var _this = this;\n        var record = _a.record,\n          dataIndex = _a.dataIndex,\n          value = _a.value;\n        return new Promise(function (resolve) {\n          if (record[dataIndex] === (value === null || value === void 0 ? void 0 : value.valueOf())) {\n            resolve();\n            return;\n          }\n          var dataSource = _this.getData();\n          var rowKey = _this.getRowKey();\n          var recordItem = dataSource.find(function (t) {\n            return t[rowKey] === record[rowKey];\n          });\n          if (recordItem) {\n            recordItem[dataIndex] = value === null || value === void 0 ? void 0 : value.valueOf();\n            _this.receiveDataMutation(dataSource);\n            _this.$nextTick(function () {\n              return resolve();\n            });\n            return;\n          }\n          resolve();\n        });\n      },\n      /**\n       * renderSearchTable\n       * @param h\n       */\n      renderSearchTable: function renderSearchTable(h) {\n        var children = this.$renderSearchTableSearchTable(h);\n        return h(Form, {\n          \"class\": \"\".concat(selectorPrefix, \"-form\"),\n          \"attrs\": {\n            \"form\": this.form\n          }\n        }, [children]);\n      },\n      /**\n       * setActiveValue\n       * @param activeValue\n       */\n      setActiveValue: function setActiveValue(activeValue) {\n        this.activeValue = activeValue;\n      },\n      /**\n       * getActiveValue\n       */\n      getActiveValue: function getActiveValue() {\n        return this.activeValue;\n      },\n      /**\n       * getFormIns\n       * @description 获取form对象实例\n       */\n      getFormIns: function getFormIns() {\n        return this.form;\n      }\n    }\n  });\n});"],"names":["__assign","__spreadArray","Form","moment","Util","selectorPrefix","SearchTableImplement","extend","_util","serviceName","className","mixins","provide","getFormIns","this","getActiveValue","setActiveValue","data","_this","$cellConfigReducers","params","_i","arguments","length","cellEditableReducer","apply","$valueToFormItemValueMap","Map","_a","record","dataIndex","value","Array","isArray","form","$form","createForm","name","activeValue","methods","onTableRowComponentReducers","columns","some","column","$editable","editable","from","Set","$data","$tableRowComponentReducers","onTableCellComponentReducers","$tableCellComponentReducers","onEditorRow","onEditorCell","rowIndex","editorConfig","valueToFormItemValue","type","item","get","updateEditorCellDate","Promise","resolve","dataSource","rowKey","recordItem","getData","getRowKey","find","t","receiveDataMutation","$nextTick","updateEditorCellDateData","valueOf","renderSearchTable","h","children","$renderSearchTableSearchTable","class","concat","attrs"],"mappings":"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"}