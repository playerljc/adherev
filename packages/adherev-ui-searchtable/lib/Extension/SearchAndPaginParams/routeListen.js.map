{"version":3,"file":"routeListen.js","sources":["Extension/SearchAndPaginParams/routeListen.js"],"sourcesContent":["\"use strict\";\n\nrequire(\"core-js/modules/es.object.define-property.js\");\nrequire(\"core-js/modules/es.array.last-index-of.js\");\nrequire(\"core-js/modules/es.array.slice.js\");\nrequire(\"core-js/modules/es.string.starts-with.js\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nvar ProSearchTable_1 = require(\"../../ProSearchTable\");\nvar historyStack = [];\n/**\n * clearSearAndPaginParamsByPathname\n * @description 清除查询条件根据pathname\n * @param pathname\n */\nfunction clearSearAndPaginParamsByPathname(pathname) {\n  var findIndex = ProSearchTable_1.TableImplementSearchAndvPaginParamsMemo.findIndexByPath(pathname);\n  if (findIndex !== -1) ProSearchTable_1.TableImplementSearchAndvPaginParamsMemo.deleteByIndex(findIndex);\n}\nfunction deal(pathname) {\n  var findIndex = historyStack.lastIndexOf(pathname);\n  console.log('del cell', pathname);\n  // 没找到\n  if (findIndex === -1) {\n    // 清除查询条件\n    clearSearAndPaginParamsByPathname(pathname);\n    historyStack.push(pathname);\n  }\n  // 找到了\n  else {\n    var pathArr = historyStack.slice(findIndex + 1);\n    // 1 2 1\n    // 之间只有一个页面的路径\n    if (pathArr.length === 1) {\n      // pathArr[0] /system/task/list/view\n      // pathname   /system/task/list/ 当前\n      if (!pathArr[0].startsWith(pathname)) {\n        // 清除查询条件\n        clearSearAndPaginParamsByPathname(pathname);\n      }\n    } else {\n      // 清除查询条件\n      clearSearAndPaginParamsByPathname(pathname);\n    }\n    // 都需要清空路径\n    historyStack = historyStack.slice(0, findIndex);\n    historyStack.push(pathname);\n  }\n}\nvar popstate = function popstate(context) {\n  deal(window.location.pathname);\n  context.on(routeListen);\n};\nvar popstateHandler;\nfunction routeListen(_a) {\n  var location = _a.location,\n    action = _a.action,\n    context = _a.context;\n  var pathname = location.pathname;\n  context.remove(routeListen);\n  if (popstateHandler) {\n    window.removeEventListener('popstate', popstateHandler);\n  }\n  popstateHandler = popstate.bind(this, context);\n  window.addEventListener('popstate', popstateHandler);\n  deal(pathname);\n}\nexports.default = routeListen;"],"names":["require","Object","defineProperty","exports","value","ProSearchTable_1","historyStack","clearSearAndPaginParamsByPathname","pathname","findIndex","TableImplementSearchAndvPaginParamsMemo","findIndexByPath","deleteByIndex","deal","pathArr","lastIndexOf","console","log","slice","length","startsWith","push","popstateHandler","popstate","context","window","location","on","routeListen","_a","action","remove","removeEventListener","bind","this","addEventListener","default"],"mappings":"AAAA,aAEAA,QAAQ,8CAA8C,EACtDA,QAAQ,2CAA2C,EACnDA,QAAQ,mCAAmC,EAC3CA,QAAQ,0CAA0C,EAClDC,OAAOC,eAAeC,QAAS,aAAc,CAC3CC,MAAO,CAAA,CACT,CAAC,EACD,IAAIC,iBAAmBL,QAAQ,sBAAsB,EACjDM,aAAe,GAMnB,SAASC,kCAAkCC,GACrCC,EAAYJ,iBAAiBK,wCAAwCC,gBAAgBH,CAAQ,EAC/E,CAAC,IAAfC,GAAkBJ,iBAAiBK,wCAAwCE,cAAcH,CAAS,CACxG,CACA,SAASI,KAAKL,GACZ,IAUMM,EAVFL,EAAYH,aAAaS,YAAYP,CAAQ,EACjDQ,QAAQC,IAAI,WAAYT,CAAQ,GAEd,CAAC,IAAfC,GAEFF,kCAAkCC,CAAQ,EAC1CF,eAOuB,KAHnBQ,EAAUR,aAAaY,MAAMT,EAAY,CAAC,GAGlCU,QAGLL,EAAQ,GAAGM,WAAWZ,CAAQ,GAMnCD,kCAAkCC,CAAQ,EAG5CF,aAAeA,aAAaY,MAAM,EAAGT,CAAS,IAnBjCY,KAAKb,CAAQ,CAsB9B,CACA,IAIIc,gBAJAC,SAAW,SAAkBC,GAC/BX,KAAKY,OAAOC,SAASlB,QAAQ,EAC7BgB,EAAQG,GAAGC,WAAW,CACxB,EAEA,SAASA,YAAYC,GACnB,IAAIH,EAAWG,EAAGH,SAEhBF,GADSK,EAAGC,OACFD,EAAGL,SACXhB,EAAWkB,EAASlB,SACxBgB,EAAQO,OAAOH,WAAW,EACtBN,iBACFG,OAAOO,oBAAoB,WAAYV,eAAe,EAExDA,gBAAkBC,SAASU,KAAKC,KAAMV,CAAO,EAC7CC,OAAOU,iBAAiB,WAAYb,eAAe,EACnDT,KAAKL,CAAQ,CACf,CACAL,QAAQiC,QAAUR"}