{"version":3,"file":"index.js","sources":["Extension/EditableCell/EditableRowControl/index.js"],"sourcesContent":["\"use strict\";\n\nvar _vue = require(\"vue\");\nrequire(\"core-js/modules/es.object.define-property.js\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nvar tslib_1 = require(\"tslib\");\nvar vue_1 = require(\"vue\");\nvar vue_types_1 = require(\"vue-types\");\nvar adherev_util_intl_1 = tslib_1.__importDefault(require(\"@baifendian/adherev-util-intl\"));\nvar SearchTable_1 = require(\"../../../SearchTable\");\nexports.default = (0, vue_1.defineComponent)({\n  name: 'adv-searchtable-editable-row-control',\n  props: {\n    rowKey: (0, vue_types_1.string)().def(''),\n    rowIndex: (0, vue_types_1.number)(),\n    editorRowId: (0, vue_types_1.string)().def(''),\n    record: (0, vue_types_1.object)().def({}),\n    renderEditorRow: (0, vue_types_1.oneOfType)([(0, vue_types_1.string)(), (0, vue_types_1.func)()]),\n    renderSave: (0, vue_types_1.oneOfType)([(0, vue_types_1.string)(), (0, vue_types_1.func)()]),\n    renderCancel: (0, vue_types_1.oneOfType)([(0, vue_types_1.string)(), (0, vue_types_1.func)()]),\n    onSave: (0, vue_types_1.func)(),\n    onEditor: (0, vue_types_1.func)()\n  },\n  emits: ['renderEditorRow', 'renderSave', 'renderCancel'],\n  setup: function setup(props, _a) {\n    var _b, _c, _d;\n    var slots = _a.slots;\n    var context = (_c = (_b = (0, vue_1.inject)('getContext')) === null || _b === void 0 ? void 0 : _b()) === null || _c === void 0 ? void 0 : _c.context;\n    var form = (_d = (0, vue_1.inject)('getFormIns')) === null || _d === void 0 ? void 0 : _d();\n    var setRowFieldValue = (0, vue_1.inject)('setRowFieldValue');\n    var renderDefaultEditorRow = function renderDefaultEditorRow() {\n      return (0, _vue.createVNode)(\"a\", null, [adherev_util_intl_1.default.tv('编辑行')]);\n    };\n    var renderDefaultCancel = function renderDefaultCancel() {\n      return (0, _vue.createVNode)(\"a\", null, [adherev_util_intl_1.default.tv('取消')]);\n    };\n    var renderDefaultSave = function renderDefaultSave() {\n      return (0, _vue.createVNode)(\"a\", null, [adherev_util_intl_1.default.tv('保存')]);\n    };\n    var validateFieldsSuccess = function validateFieldsSuccess(values) {\n      if (props.onSave) {\n        props.onSave(values).then(function () {\n          return updateEditorCellRowData(values);\n        });\n        return;\n      }\n      updateEditorCellRowData(values);\n    };\n    var updateEditorCellRowData = function updateEditorCellRowData(values) {\n      var _a;\n      (_a = context === null || context === void 0 ? void 0 : context.updateEditorCellRowData({\n        values: values,\n        record: props.record,\n        rowIndex: props.rowIndex\n      })) === null || _a === void 0 ? void 0 : _a.then(function () {\n        return onReset();\n      });\n    };\n    var updateRowEdit = function updateRowEdit() {\n      if (context) {\n        context.editorRowId = props.record[props.rowKey];\n      }\n    };\n    var onReset = function onReset() {\n      if (context) {\n        context.editorRowId = '';\n        setRowFieldValue === null || setRowFieldValue === void 0 ? void 0 : setRowFieldValue(props.record, props === null || props === void 0 ? void 0 : props.rowIndex);\n        // const formData = {};\n        //\n        // Object.keys(props.record).forEach((dataIndex) => {\n        //   const column = context?.getColumnByDataIndex(dataIndex);\n        //   if (!column) return;\n        //\n        //   const type = column?.$editable?.type as string;\n        //\n        //   const name = `${dataIndex}_${props?.rowIndex}`;\n        //\n        //   if (['datePicker', 'timePicker'].includes(type)) {\n        //     formData[name] = dayjs(props.record[dataIndex]);\n        //   } else {\n        //     formData[name] = props.record[dataIndex];\n        //   }\n        // });\n        //\n        // context.formData = formData;\n      }\n    };\n\n    var onEditor = function onEditor() {\n      var _a, _b;\n      if (props.onEditor) {\n        (_b = (_a = props.onEditor) === null || _a === void 0 ? void 0 : _a.call(props, props.record[props.rowKey])) === null || _b === void 0 ? void 0 : _b.then(function () {\n          return updateRowEdit();\n        });\n        return;\n      }\n      updateRowEdit();\n    };\n    return function () {\n      var _a, _b, _c, _d, _e, _f;\n      return (0, _vue.createVNode)(\"div\", {\n        \"class\": \"\".concat(SearchTable_1.selectorPrefix, \"-editor-row-control\")\n      }, [props.editorRowId !== props.record[props.rowKey] && (0, _vue.createVNode)(\"div\", {\n        \"class\": \"\".concat(SearchTable_1.selectorPrefix, \"-editor-row-control-edit\"),\n        \"onClick\": onEditor\n      }, [((_a = slots === null || slots === void 0 ? void 0 : slots[props === null || props === void 0 ? void 0 : props.renderEditorRow]) === null || _a === void 0 ? void 0 : _a.call(slots)) || ((_b = props === null || props === void 0 ? void 0 : props.renderEditorRow) === null || _b === void 0 ? void 0 : _b.call(props)) || renderDefaultEditorRow()]), props.editorRowId === props.record[props.rowKey] && (0, _vue.createVNode)(\"div\", {\n        \"class\": \"\".concat(SearchTable_1.selectorPrefix, \"-editor-row-control-save-cancel\")\n      }, [(0, _vue.createVNode)(\"div\", {\n        \"class\": \"\".concat(SearchTable_1.selectorPrefix, \"-editor-row-control-save-cancel-item\"),\n        \"onClick\": function onClick() {\n          return form === null || form === void 0 ? void 0 : form.validateFields().then(function (values) {\n            return validateFieldsSuccess(values);\n          });\n        }\n      }, [((_c = slots === null || slots === void 0 ? void 0 : slots[props === null || props === void 0 ? void 0 : props.renderSave]) === null || _c === void 0 ? void 0 : _c.call(slots)) || ((_d = props === null || props === void 0 ? void 0 : props.renderSave) === null || _d === void 0 ? void 0 : _d.call(props)) || renderDefaultSave()]), (0, _vue.createVNode)(\"div\", {\n        \"class\": \"\".concat(SearchTable_1.selectorPrefix, \"-editor-row-control-save-cancel-item\"),\n        \"onClick\": onReset\n      }, [((_e = slots === null || slots === void 0 ? void 0 : slots[props === null || props === void 0 ? void 0 : props.renderCancel]) === null || _e === void 0 ? void 0 : _e.call(slots)) || ((_f = props === null || props === void 0 ? void 0 : props.renderCancel) === null || _f === void 0 ? void 0 : _f.call(props)) || renderDefaultCancel()])])]);\n    };\n  }\n});"],"names":["_vue","require","tslib_1","Object","defineProperty","exports","value","vue_1","vue_types_1","adherev_util_intl_1","__importDefault","SearchTable_1","default","defineComponent","name","props","rowKey","string","def","rowIndex","number","editorRowId","record","object","renderEditorRow","oneOfType","func","renderSave","renderCancel","onSave","onEditor","emits","setup","_a","updateEditorCellRowData","values","context","then","onReset","updateRowEdit","_b","call","slots","_c","inject","form","_d","setRowFieldValue","_f","createVNode","class","concat","selectorPrefix","onClick","tv","validateFields","_e"],"mappings":"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"}