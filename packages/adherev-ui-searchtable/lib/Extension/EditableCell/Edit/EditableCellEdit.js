"use strict";require("core-js/modules/es.object.define-property.js"),require("core-js/modules/es.number.constructor.js"),require("core-js/modules/es.array.reduce.js"),require("core-js/modules/es.object.to-string.js"),Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib"),ant_design_vue_1=require("ant-design-vue"),moment_1=tslib_1.__importDefault(require("moment")),SearchTable_1=require("../../../SearchTable"),EventTypes_1=tslib_1.__importDefault(require("../EventTypes")),FormItemGenerator_1=tslib_1.__importDefault(require("./FormItemGenerator"));exports.default={props:{rowIndex:{type:Number},record:{type:Object},column:{type:Object},columns:{type:Array},editableConfig:{type:Object}},emits:["triggerChange"],inject:["getFormIns","getContext"],methods:{updateEditorCellData:function(){var e,t=this.editableConfig.dataIndex,r=this.record,i=this.getValue();return i instanceof moment_1.default?null==(e=null==(e=null==(e=this.getContext)?void 0:e.call(this))?void 0:e.context)?void 0:e.updateEditorCellDateData({record:r,dataIndex:t,value:i}):null==(e=null==(e=null==(e=this.getContext)?void 0:e.call(this))?void 0:e.context)?void 0:e.updateEditorCellDate({record:r,dataIndex:t,value:i})},renderFormItem:function(e){var r=this,t=this.editableConfig,i=t.useKeepEdit,l=t.dataIndex,n=t.type,a=t.render,o=t.dictName,t=t.renderChildren,d=this.rowIndex,s=this.record,u=this.getFormIns(),i=tslib_1.__assign(tslib_1.__assign({autoFocus:!i},this.editableConfig.props),EventTypes_1.default.reduce(function(e,t){return e[t]=function(e){r.editableConfig.props[t]&&r.editableConfig.props[t](e,{form:u,dataIndex:l,rowIndex:d,updateEditorCellData:function(){return r.updateEditorCellData()}})},e},{})),e=FormItemGenerator_1.default.render(e,{type:n,props:i,dictName:o,renderChildren:t,form:u,dataIndex:l,rowIndex:d}),t=null==(o=null==(i=null==(n=this.getContext)?void 0:n.call(this))?void 0:i.context)?void 0:o.$scopedSlots,n={value:null==s?void 0:s[l],record:s,dataIndex:l,rowIndex:d,form:u,updateEditorCellData:function(){return r.updateEditorCellData()},children:e};return(null==(i=null==t?void 0:t[a])?void 0:i.call(t,n))||(null==a?void 0:a(n))||e},renderDefaultSaveTrigger:function(){return h(ant_design_vue_1.Icon,{attrs:{type:"check"}})},renderDefaultCancelTrigger:function(){return h(ant_design_vue_1.Icon,{attrs:{type:"close"}})},onSaveTrigger:function(){var t=this,e=this.editableConfig,r=e.dataIndex,i=e.onSave,l=this.rowIndex,n=this.record,e=this.getFormIns(),a=this.getValue();i?null!=e&&e.validateFields().then(function(e){null!=(e=i({value:a,values:e,record:n,dataIndex:r,rowIndex:l}))&&e.then(function(){t.$emit("triggerChange")})}):this.$emit("triggerChange")},onCancelTrigger:function(){var e=this,t=this.editableConfig,r=t.dataIndex,t=t.onBeforeCancel,i=this.rowIndex,l=this.record,n=this.getValue();t?null!=(t=t({value:n,record:l,dataIndex:r,rowIndex:i}))&&t.then(function(){return e.$emit("triggerChange")}):this.$emit("triggerChange")},getValue:function(){var e;return null==(e=null==(e=this.getFormIns)?void 0:e.call(this))?void 0:e.getFieldValue(this.editableConfig.dataIndex)}},render:function(e){var t=this,r=this.editableConfig,i=r.useTrigger,l=r.useKeepEdit,n=r.renderSaveTrigger,a=r.renderCancelTrigger,o=r.dataIndex,d=r.type,s=r.render,u=r.rules,r=r.formItemProps,c=this.record,g=this.rowIndex,v=null==(v=null==(v=this.getContext)?void 0:v.call(this))?void 0:v.context,h=null==v?void 0:v.$scopedSlots,f=this.getFormIns(),m=f.getFieldDecorator,f={value:null==c?void 0:c[o],record:c,dataIndex:o,rowIndex:g,form:f,updateEditorCellData:function(){return t.updateEditorCellData()}},x={value:null==c?void 0:c[o],record:c,dataIndex:o,rowIndex:g},g={value:null==c?void 0:c[o],record:c,dataIndex:o,rowIndex:g},v=null==v?void 0:v.valueToFormItemValue({type:d,record:c,dataIndex:o});return e("div",{class:"".concat(SearchTable_1.selectorPrefix,"-editablecell-edit")},[e("div",{class:"".concat(SearchTable_1.selectorPrefix,"-editablecell-edit-inner")},[e(ant_design_vue_1.Form.Item,[m(o,tslib_1.__assign({rules:u,initialValue:v},r||{}))("custom"!==d?this.renderFormItem(e):(null==(c=null==h?void 0:h[s])?void 0:c.call(h,f))||(null==s?void 0:s(f)))])]),!!i&&!l&&e("div",{class:"".concat(SearchTable_1.selectorPrefix,"-editablecell-edit-trigger")},[e("div",{class:"".concat(SearchTable_1.selectorPrefix,"-editablecell-edit-trigger-inner")},[e("div",{class:"".concat(SearchTable_1.selectorPrefix,"-editablecell-edit-trigger-save"),on:{click:this.onSaveTrigger}},[(null==(m=null==h?void 0:h[n])?void 0:m.call(h,x))||(null==n?void 0:n(x))||this.renderDefaultSaveTrigger()]),e("div",{class:"".concat(SearchTable_1.selectorPrefix,"-editablecell-edit-trigger-cancel"),on:{click:this.onCancelTrigger}},[(null==(o=null==h?void 0:h[a])?void 0:o.call(h,g))||(null==a?void 0:a(g))||this.renderDefaultCancelTrigger()])])])])}};
//# sourceMappingURL=EditableCellEdit.js.map
