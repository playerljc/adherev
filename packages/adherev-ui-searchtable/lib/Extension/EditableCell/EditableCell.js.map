{"version":3,"file":"EditableCell.js","sources":["Extension/EditableCell/EditableCell.js"],"sourcesContent":["\"use strict\";\n\nvar _vue = require(\"vue\");\nrequire(\"core-js/modules/es.object.define-property.js\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.useEditableCell = void 0;\nvar tslib_1 = require(\"tslib\");\nvar vue_1 = require(\"vue\");\nvar EditableCellEdit_1 = tslib_1.__importDefault(require(\"./Edit/EditableCellEdit\"));\nvar View_1 = tslib_1.__importDefault(require(\"./View\"));\n/**\n * EditableCell\n * @description 可编辑的单元格\n */\nvar useEditableCell = function useEditableCell(props, _a) {\n  var _b, _c, _d, _e;\n  var getContext = (0, vue_1.inject)('getContext');\n  var context = (_b = getContext === null || getContext === void 0 ? void 0 : getContext()) === null || _b === void 0 ? void 0 : _b.context;\n  var setActiveValue = (0, vue_1.inject)('setActiveValue');\n  var $editableCell = {\n    defaultConfig: {\n      editable: false,\n      defaultStatus: 'view',\n      type: 'input',\n      props: {},\n      formItemProps: {},\n      useTrigger: true,\n      require: true,\n      dataIndex: (_c = props.column) === null || _c === void 0 ? void 0 : _c.dataIndex,\n      useKeepEdit: false\n    }\n  };\n  var status = (0, vue_1.ref)(((_e = (_d = props.column) === null || _d === void 0 ? void 0 : _d.$editable) === null || _e === void 0 ? void 0 : _e.defaultStatus) || 'view');\n  var editableCellEditableConfig = (0, vue_1.computed)(function () {\n    var _a;\n    return tslib_1.__assign(tslib_1.__assign({}, $editableCell.defaultConfig), ((_a = props.column) === null || _a === void 0 ? void 0 : _a.$editable) || {});\n  });\n  var watchHandler1 = (0, vue_1.watch)(function () {\n    return context === null || context === void 0 ? void 0 : context.getData();\n  }, function () {\n    status.value = editableCellEditableConfig.value.defaultStatus;\n  });\n  var watchHandler2 = (0, vue_1.watch)(function () {\n    var _a, _b;\n    return (_b = (_a = props.column) === null || _a === void 0 ? void 0 : _a.$editable) === null || _b === void 0 ? void 0 : _b.defaultStatus;\n  }, function () {\n    status.value = editableCellEditableConfig.value.defaultStatus;\n  });\n  (0, vue_1.onBeforeUnmount)(function () {\n    watchHandler1();\n    watchHandler2();\n  });\n  return function (tdVNode) {\n    var res = tdVNode;\n    // 单元格不是可编辑的单元格\n    if (!editableCellEditableConfig.value.editable) {\n      res = tdVNode;\n    }\n    // 始终保持编辑状态\n    else if (editableCellEditableConfig.value.useKeepEdit) {\n      res = (0, vue_1.h)(tdVNode, {}, [(0, _vue.createVNode)(EditableCellEdit_1.default, (0, _vue.mergeProps)((0, vue_1.toRaw)(props), {\n        \"editableConfig\": editableCellEditableConfig.value,\n        \"onTriggerChange\": function onTriggerChange() {\n          setActiveValue === null || setActiveValue === void 0 ? void 0 : setActiveValue('');\n          status.value = 'view';\n        }\n      }), {\n        default: function _default() {\n          return [tdVNode.children];\n        }\n      })]);\n    }\n    // 查看状态\n    else if (status.value === 'view') {\n      res = (0, vue_1.h)(tdVNode, {}, [(0, _vue.createVNode)(View_1.default, (0, _vue.mergeProps)((0, vue_1.toRaw)(props), {\n        \"editableConfig\": editableCellEditableConfig.value,\n        \"onTriggerChange\": function onTriggerChange() {\n          setActiveValue === null || setActiveValue === void 0 ? void 0 : setActiveValue(props.record[props.column.dataIndex]);\n          status.value = 'edit';\n        }\n      }), {\n        default: function _default() {\n          return [tdVNode.children];\n        }\n      })]);\n    }\n    // 编辑状态\n    else if (status.value === 'edit') {\n      res = (0, vue_1.h)(tdVNode, {}, [(0, _vue.createVNode)(EditableCellEdit_1.default, (0, _vue.mergeProps)((0, vue_1.toRaw)(props), {\n        \"editableConfig\": editableCellEditableConfig.value,\n        \"onTriggerChange\": function onTriggerChange() {\n          setActiveValue === null || setActiveValue === void 0 ? void 0 : setActiveValue('');\n          status.value = 'view';\n        }\n      }), {\n        default: function _default() {\n          return [tdVNode.children];\n        }\n      })]);\n    }\n    return res;\n  };\n};\nexports.useEditableCell = useEditableCell;"],"names":["_vue","require","tslib_1","Object","defineProperty","exports","value","useEditableCell","vue_1","EditableCellEdit_1","__importDefault","View_1","props","_a","getContext","inject","context","_b","setActiveValue","$editableCell","defaultConfig","editable","defaultStatus","type","formItemProps","useTrigger","dataIndex","_c","column","useKeepEdit","status","ref","_e","_d","$editable","editableCellEditableConfig","computed","__assign","watchHandler1","watch","getData","watchHandler2","onBeforeUnmount","tdVNode","res","h","createVNode","default","mergeProps","toRaw","editableConfig","onTriggerChange","children","record"],"mappings":"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"}