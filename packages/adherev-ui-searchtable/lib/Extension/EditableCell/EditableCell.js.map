{"version":3,"file":"EditableCell.js","sources":["Extension/EditableCell/EditableCell.js"],"sourcesContent":["\"use strict\";\n\nrequire(\"core-js/modules/es.object.keys.js\");\nrequire(\"core-js/modules/es.symbol.js\");\nrequire(\"core-js/modules/es.array.filter.js\");\nrequire(\"core-js/modules/es.object.get-own-property-descriptor.js\");\nrequire(\"core-js/modules/es.object.get-own-property-descriptors.js\");\nrequire(\"core-js/modules/es.object.define-properties.js\");\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime/helpers/defineProperty\"));\nrequire(\"core-js/modules/es.object.define-property.js\");\nrequire(\"core-js/modules/es.object.to-string.js\");\nrequire(\"core-js/modules/web.dom-collections.for-each.js\");\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { (0, _defineProperty2.default)(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nvar tslib_1 = require(\"tslib\");\nvar adherev_util_1 = tslib_1.__importDefault(require(\"@baifendian/adherev-util\"));\nvar EditableCellEdit_1 = tslib_1.__importDefault(require(\"./Edit/EditableCellEdit\"));\nvar View_1 = tslib_1.__importDefault(require(\"./View\"));\nvar cloneElement = adherev_util_1.default._util.cloneElement;\n/**\n * EditableCell\n * @description 可编辑的单元格\n */\nexports.default = {\n  inject: ['getActiveValue', 'setActiveValue'],\n  data: function data() {\n    var _a, _b, _c;\n    return {\n      $editableCell: {\n        defaultConfig: {\n          editable: false,\n          defaultStatus: 'view',\n          type: 'input',\n          props: {},\n          formItemProps: {},\n          useTrigger: true,\n          require: true,\n          dataIndex: (_a = this.column) === null || _a === void 0 ? void 0 : _a.dataIndex,\n          useKeepEdit: false\n        },\n        watchHandler: []\n      },\n      editableCell: {\n        status: ((_c = (_b = this.column) === null || _b === void 0 ? void 0 : _b.$editable) === null || _c === void 0 ? void 0 : _c.defaultStatus) || 'view'\n      }\n    };\n  },\n  computed: {\n    editableCellEditableConfig: function editableCellEditableConfig() {\n      var _a;\n      return tslib_1.__assign(tslib_1.__assign({}, this.$data.$editableCell.defaultConfig), ((_a = this.column) === null || _a === void 0 ? void 0 : _a.$editable) || {});\n    }\n  },\n  created: function created() {\n    var $editableCell = this.$data.$editableCell;\n    $editableCell.watchHandler.push(this.$watch(function () {\n      var _a, _b, _c;\n      return (_c = (_b = (_a = this.getContext) === null || _a === void 0 ? void 0 : _a.call(this)) === null || _b === void 0 ? void 0 : _b.context) === null || _c === void 0 ? void 0 : _c.getData();\n    }, function () {\n      this.editableCell.status = this.editableCellEditableConfig.defaultStatus;\n    }));\n    $editableCell.watchHandler.push(this.$watch(function () {\n      var _a, _b;\n      return (_b = (_a = this.column) === null || _a === void 0 ? void 0 : _a.$editable) === null || _b === void 0 ? void 0 : _b.defaultStatus;\n    }, function () {\n      this.editableCell.status = this.editableCellEditableConfig.defaultStatus;\n    }));\n  },\n  beforeDestroy: function beforeDestroy() {\n    this.$data.$editableCell.watchHandler.forEach(function (handler) {\n      return handler();\n    });\n  },\n  methods: {\n    /**\n     * useEditableCell\n     * @description 固定调用的处理函数\n     * @param h\n     * @param tdVNode\n     */\n    useEditableCell: function useEditableCell(h, tdVNode) {\n      var _this = this;\n      var res = tdVNode;\n      var _a = this,\n        _b = _a.editableCellEditableConfig,\n        editable = _b.editable,\n        useKeepEdit = _b.useKeepEdit,\n        status = _a.editableCell.status;\n      // 单元格不是可编辑的单元格\n      if (!editable) {\n        res = tdVNode;\n      }\n      // 始终保持编辑状态\n      else if (useKeepEdit) {\n        res = cloneElement(tdVNode, {\n          children: [// @ts-ignore\n          h(EditableCellEdit_1.default, {\n            \"props\": _objectSpread({}, this.$props),\n            \"attrs\": {\n              \"editableConfig\": this.editableCellEditableConfig\n            },\n            \"on\": {\n              \"triggerChange\": function triggerChange() {\n                _this.setActiveValue('');\n                _this.editableCell.status = 'view';\n              }\n            }\n          }, [tdVNode.children])]\n        });\n      }\n      // 查看状态\n      else if (status === 'view') {\n        res = cloneElement(tdVNode, {\n          children: [// @ts-ignore\n          h(View_1.default, {\n            \"props\": _objectSpread({}, this.$props),\n            \"attrs\": {\n              \"editableConfig\": this.editableCellEditableConfig\n            },\n            \"on\": {\n              \"triggerChange\": function triggerChange() {\n                _this.setActiveValue(_this.record[_this.column.dataIndex]);\n                _this.editableCell.status = 'edit';\n              }\n            }\n          }, [tdVNode.children])]\n        });\n      }\n      // 编辑状态\n      else if (status === 'edit') {\n        res = cloneElement(tdVNode, {\n          children: [// @ts-ignore\n          h(EditableCellEdit_1.default, {\n            \"props\": _objectSpread({}, this.$props),\n            \"attrs\": {\n              \"editableConfig\": this.editableCellEditableConfig\n            },\n            \"on\": {\n              \"triggerChange\": function triggerChange() {\n                _this.setActiveValue('');\n                _this.editableCell.status = 'view';\n              }\n            }\n          }, [tdVNode.children])]\n        });\n      }\n      return res;\n    }\n  }\n};"],"names":["require","_interopRequireDefault","_defineProperty2","ownKeys","object","enumerableOnly","symbols","keys","Object","getOwnPropertySymbols","filter","sym","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","target","i","arguments","length","source","forEach","key","default","getOwnPropertyDescriptors","defineProperties","defineProperty","exports","value","tslib_1","adherev_util_1","__importDefault","EditableCellEdit_1","View_1","cloneElement","_util","inject","data","_c","$editableCell","defaultConfig","editable","defaultStatus","type","props","formItemProps","useTrigger","dataIndex","_a","this","column","useKeepEdit","watchHandler","editableCell","status","_b","$editable","computed","editableCellEditableConfig","__assign","$data","created","$watch","getContext","call","context","getData","beforeDestroy","handler","methods","useEditableCell","h","tdVNode","_this","res","children","$props","attrs","editableConfig","on","triggerChange","setActiveValue","record"],"mappings":"AAAA,aAEAA,QAAQ,mCAAmC,EAC3CA,QAAQ,8BAA8B,EACtCA,QAAQ,oCAAoC,EAC5CA,QAAQ,0DAA0D,EAClEA,QAAQ,2DAA2D,EACnEA,QAAQ,gDAAgD,EACxD,IAAIC,uBAAyBD,QAAQ,8CAA8C,EAC/EE,iBAAmBD,uBAAuBD,QAAQ,uCAAuC,CAAC,EAI9F,SAASG,QAAQC,EAAQC,GAAkB,IAAwEC,EAApEC,EAAOC,OAAOD,KAAKH,CAAM,EAA+P,OAAxPI,OAAOC,wBAA6BH,EAAUE,OAAOC,sBAAsBL,CAAM,EAAGC,IAAmBC,EAAUA,EAAQI,OAAO,SAAUC,GAAO,OAAOH,OAAOI,yBAAyBR,EAAQO,CAAG,EAAEE,UAAY,CAAC,GAAIN,EAAKO,KAAKC,MAAMR,EAAMD,CAAO,GAAYC,CAAM,CACpV,SAASS,cAAcC,GAAU,IAAK,IAAIC,EAAI,EAAGA,EAAIC,UAAUC,OAAQF,CAAC,GAAI,CAAE,IAAIG,EAAS,MAAQF,UAAUD,GAAKC,UAAUD,GAAK,GAAIA,EAAI,EAAIf,QAAQK,OAAOa,CAAM,EAAG,CAAA,CAAE,EAAEC,QAAQ,SAAUC,IAAO,EAAIrB,iBAAiBsB,SAASP,EAAQM,EAAKF,EAAOE,EAAI,CAAG,CAAC,EAAIf,OAAOiB,0BAA4BjB,OAAOkB,iBAAiBT,EAAQT,OAAOiB,0BAA0BJ,CAAM,CAAC,EAAIlB,QAAQK,OAAOa,CAAM,CAAC,EAAEC,QAAQ,SAAUC,GAAOf,OAAOmB,eAAeV,EAAQM,EAAKf,OAAOI,yBAAyBS,EAAQE,CAAG,CAAC,CAAG,CAAC,CAAG,CAAE,OAAON,CAAQ,CAJvgBjB,QAAQ,8CAA8C,EACtDA,QAAQ,wCAAwC,EAChDA,QAAQ,iDAAiD,EAGzDQ,OAAOmB,eAAeC,QAAS,aAAc,CAC3CC,MAAO,CAAA,CACT,CAAC,EACD,IAAIC,QAAU9B,QAAQ,OAAO,EACzB+B,eAAiBD,QAAQE,gBAAgBhC,QAAQ,0BAA0B,CAAC,EAC5EiC,mBAAqBH,QAAQE,gBAAgBhC,QAAQ,yBAAyB,CAAC,EAC/EkC,OAASJ,QAAQE,gBAAgBhC,QAAQ,QAAQ,CAAC,EAClDmC,aAAeJ,eAAeP,QAAQY,MAAMD,aAKhDP,QAAQJ,QAAU,CAChBa,OAAQ,CAAC,iBAAkB,kBAC3BC,KAAM,WACJ,IAAYC,EACZ,MAAO,CACLC,cAAe,CACbC,cAAe,CACbC,SAAU,CAAA,EACVC,cAAe,OACfC,KAAM,QACNC,MAAO,GACPC,cAAe,GACfC,WAAY,CAAA,EACZ/C,QAAS,CAAA,EACTgD,UAAW,OAACC,EAAKC,KAAKC,QAAoC,KAAA,EAASF,EAAGD,UACtEI,YAAa,CAAA,CACf,EACAC,aAAc,EAChB,EACAC,aAAc,CACZC,QAAS,OAAChB,EAAK,OAACiB,EAAKN,KAAKC,QAAoC,KAAA,EAASK,EAAGC,WAAuC,KAAA,EAASlB,EAAGI,gBAAkB,MACjJ,CACF,CACF,EACAe,SAAU,CACRC,2BAA4B,WAC1B,IAAIV,EACJ,OAAOnB,QAAQ8B,SAAS9B,QAAQ8B,SAAS,GAAIV,KAAKW,MAAMrB,cAAcC,aAAa,GAAI,OAACQ,EAAKC,KAAKC,QAAoC,KAAA,EAASF,EAAGQ,YAAc,EAAE,CACpK,CACF,EACAK,QAAS,WACP,IAAItB,EAAgBU,KAAKW,MAAMrB,cAC/BA,EAAca,aAAavC,KAAKoC,KAAKa,OAAO,WAC1C,IAAYxB,EACZ,OAAO,OAACA,EAAK,OAACiB,EAAK,OAACP,EAAKC,KAAKc,YAAwC,KAAA,EAASf,EAAGgB,KAAKf,IAAI,GAA+B,KAAA,EAASM,EAAGU,SAAqC,KAAA,EAAS3B,EAAG4B,QAAQ,CACjM,EAAG,WACDjB,KAAKI,aAAaC,OAASL,KAAKS,2BAA2BhB,aAC7D,CAAC,CAAC,EACFH,EAAca,aAAavC,KAAKoC,KAAKa,OAAO,WAC1C,IAAQP,EACR,OAAO,OAACA,EAAK,OAACP,EAAKC,KAAKC,QAAoC,KAAA,EAASF,EAAGQ,WAAuC,KAAA,EAASD,EAAGb,aAC7H,EAAG,WACDO,KAAKI,aAAaC,OAASL,KAAKS,2BAA2BhB,aAC7D,CAAC,CAAC,CACJ,EACAyB,cAAe,WACblB,KAAKW,MAAMrB,cAAca,aAAa/B,QAAQ,SAAU+C,GACtD,OAAOA,EAAQ,CACjB,CAAC,CACH,EACAC,QAAS,CAOPC,gBAAiB,SAAyBC,EAAGC,GAC3C,IAAIC,EAAQxB,KACRyB,EAAMF,EAERjB,EADON,KACCS,2BACRjB,EAAWc,EAAGd,SACdU,EAAcI,EAAGJ,YACjBG,EAJOL,KAIKI,aAAaC,OA2D3B,OAzDKb,EAIIU,EACPuB,EAAMxC,aAAasC,EAAS,CAC1BG,SAAU,CACVJ,EAAEvC,mBAAmBT,QAAS,CAC5BqB,MAAS7B,cAAc,GAAIkC,KAAK2B,MAAM,EACtCC,MAAS,CACPC,eAAkB7B,KAAKS,0BACzB,EACAqB,GAAM,CACJC,cAAiB,WACfP,EAAMQ,eAAe,EAAE,EACvBR,EAAMpB,aAAaC,OAAS,MAC9B,CACF,CACF,EAAG,CAACkB,EAAQG,SAAS,EACvB,CAAC,EAGiB,SAAXrB,EACPoB,EAAMxC,aAAasC,EAAS,CAC1BG,SAAU,CACVJ,EAAEtC,OAAOV,QAAS,CAChBqB,MAAS7B,cAAc,GAAIkC,KAAK2B,MAAM,EACtCC,MAAS,CACPC,eAAkB7B,KAAKS,0BACzB,EACAqB,GAAM,CACJC,cAAiB,WACfP,EAAMQ,eAAeR,EAAMS,OAAOT,EAAMvB,OAAOH,UAAU,EACzD0B,EAAMpB,aAAaC,OAAS,MAC9B,CACF,CACF,EAAG,CAACkB,EAAQG,SAAS,EACvB,CAAC,EAGiB,SAAXrB,IACPoB,EAAMxC,aAAasC,EAAS,CAC1BG,SAAU,CACVJ,EAAEvC,mBAAmBT,QAAS,CAC5BqB,MAAS7B,cAAc,GAAIkC,KAAK2B,MAAM,EACtCC,MAAS,CACPC,eAAkB7B,KAAKS,0BACzB,EACAqB,GAAM,CACJC,cAAiB,WACfP,EAAMQ,eAAe,EAAE,EACvBR,EAAMpB,aAAaC,OAAS,MAC9B,CACF,CACF,EAAG,CAACkB,EAAQG,SAAS,EACvB,CAAC,GAtDDD,EAAMF,EAwDDE,CACT,CACF,CACF"}