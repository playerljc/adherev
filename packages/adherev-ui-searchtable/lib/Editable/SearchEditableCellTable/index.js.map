{"version":3,"file":"index.js","sources":["Editable/SearchEditableCellTable/index.js"],"sourcesContent":["\"use strict\";\n\nrequire(\"core-js/modules/es.object.define-property.js\");\nrequire(\"core-js/modules/es.array.iterator.js\");\nrequire(\"core-js/modules/es.map.js\");\nrequire(\"core-js/modules/es.object.to-string.js\");\nrequire(\"core-js/modules/es.string.iterator.js\");\nrequire(\"core-js/modules/esnext.map.delete-all.js\");\nrequire(\"core-js/modules/esnext.map.every.js\");\nrequire(\"core-js/modules/esnext.map.filter.js\");\nrequire(\"core-js/modules/esnext.map.find.js\");\nrequire(\"core-js/modules/esnext.map.find-key.js\");\nrequire(\"core-js/modules/esnext.map.includes.js\");\nrequire(\"core-js/modules/esnext.map.key-of.js\");\nrequire(\"core-js/modules/esnext.map.map-keys.js\");\nrequire(\"core-js/modules/esnext.map.map-values.js\");\nrequire(\"core-js/modules/esnext.map.merge.js\");\nrequire(\"core-js/modules/esnext.map.reduce.js\");\nrequire(\"core-js/modules/esnext.map.some.js\");\nrequire(\"core-js/modules/esnext.map.update.js\");\nrequire(\"core-js/modules/web.dom-collections.iterator.js\");\nrequire(\"core-js/modules/es.array.from.js\");\nrequire(\"core-js/modules/es.set.js\");\nrequire(\"core-js/modules/esnext.set.add-all.js\");\nrequire(\"core-js/modules/esnext.set.delete-all.js\");\nrequire(\"core-js/modules/esnext.set.difference.js\");\nrequire(\"core-js/modules/esnext.set.every.js\");\nrequire(\"core-js/modules/esnext.set.filter.js\");\nrequire(\"core-js/modules/esnext.set.find.js\");\nrequire(\"core-js/modules/esnext.set.intersection.js\");\nrequire(\"core-js/modules/esnext.set.is-disjoint-from.js\");\nrequire(\"core-js/modules/esnext.set.is-subset-of.js\");\nrequire(\"core-js/modules/esnext.set.is-superset-of.js\");\nrequire(\"core-js/modules/esnext.set.join.js\");\nrequire(\"core-js/modules/esnext.set.map.js\");\nrequire(\"core-js/modules/esnext.set.reduce.js\");\nrequire(\"core-js/modules/esnext.set.some.js\");\nrequire(\"core-js/modules/esnext.set.symmetric-difference.js\");\nrequire(\"core-js/modules/esnext.set.union.js\");\nrequire(\"core-js/modules/es.promise.js\");\nrequire(\"core-js/modules/es.array.find.js\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nvar tslib_1 = require(\"tslib\");\nvar ant_design_vue_1 = require(\"ant-design-vue\");\n// import cloneDeep from 'lodash.clonedeep';\n// import mergeWith from 'lodash.mergewith';\nvar moment_1 = tslib_1.__importDefault(require(\"moment\"));\n// import Vue from 'vue';\nvar adherev_util_1 = tslib_1.__importDefault(require(\"@baifendian/adherev-util\"));\nvar SearchTable_1 = require(\"../../SearchTable\");\nvar SearchTableImplement_1 = tslib_1.__importDefault(require(\"../../SearchTableImplement\"));\nvar extend = adherev_util_1.default._util.extend;\n// Vue.config.optionMergeStrategies.data = (toVal, fromVal) => {\n//   if (fromVal && toVal) {\n//     return () => {\n//       const fromValue = fromVal();\n//       const toValue = toVal();\n//\n//       return mergeWith(fromValue, toValue, (objValue, srcValue) => {\n//         if (Array.isArray(objValue) && Array.isArray(srcValue)) {\n//           return Array.from(new Set([...objValue, ...srcValue]));\n//         }\n//       });\n//     };\n//   }\n//\n//   if (fromVal) {\n//     return fromVal;\n//   }\n//\n//   if (toVal) {\n//     return toVal;\n//   }\n// };\n/**\n * SearchEditableCellTable\n * @description 单元格可编辑的SearchTable\n * @param serviceName\n */\nexports.default = function (serviceName) {\n  return extend({\n    className: 'SearchEditableCellTable',\n    mixins: [(0, SearchTableImplement_1.default)(serviceName)],\n    provide: function provide() {\n      return {\n        getFormIns: this.getFormIns,\n        getActiveValue: this.getActiveValue,\n        setActiveValue: this.setActiveValue\n      };\n    },\n    data: function data() {\n      var _this = this;\n      return {\n        $cellConfigReducers: [function () {\n          var params = [];\n          for (var _i = 0; _i < arguments.length; _i++) {\n            params[_i] = arguments[_i];\n          }\n          return _this.cellEditableReducer.apply(_this, params);\n        }],\n        $valueToFormItemValueMap: new Map([['rangePicker', function (_a) {\n          var record = _a.record,\n            dataIndex = _a.dataIndex;\n          var value = record === null || record === void 0 ? void 0 : record[dataIndex];\n          return Array.isArray(value) && value.length === 2 ? [(0, moment_1.default)(value[0]), (0, moment_1.default)(value[1])] : [(0, moment_1.default)(), (0, moment_1.default)()];\n        }], ['datePicker', function (_a) {\n          var record = _a.record,\n            dataIndex = _a.dataIndex;\n          var value = record === null || record === void 0 ? void 0 : record[dataIndex];\n          return (0, moment_1.default)(value);\n        }], ['timePicker', function (_a) {\n          var record = _a.record,\n            dataIndex = _a.dataIndex;\n          var value = record === null || record === void 0 ? void 0 : record[dataIndex];\n          return (0, moment_1.default)(value);\n        }]]),\n        form: this.$form.createForm(this, {\n          name: 'SearchEditableCellTableForm'\n        }),\n        // 正在编辑的单元格id\n        activeValue: ''\n      };\n    },\n    methods: {\n      /**\n       * onTableRowComponentReducers\n       * @param columns\n       */\n      onTableRowComponentReducers: function onTableRowComponentReducers(columns) {\n        var existsEditable = columns.some(function (column) {\n          var _a;\n          return '$editable' in column && ((_a = column.$editable) === null || _a === void 0 ? void 0 : _a.editable);\n        });\n        if (existsEditable) {\n          return Array.from(new Set(tslib_1.__spreadArray(tslib_1.__spreadArray([], this.$data.$tableRowComponentReducers, true), ['useEditableRow'], false)));\n        }\n        return this.$data.$tableRowComponentReducers;\n      },\n      /**\n       * onTableCellComponentReducers\n       * @param columns\n       */\n      onTableCellComponentReducers: function onTableCellComponentReducers(columns) {\n        var existsEditor = columns.some(function (column) {\n          var _a;\n          return '$editable' in column && ((_a = column.$editable) === null || _a === void 0 ? void 0 : _a.editable);\n        });\n        if (existsEditor) {\n          return Array.from(new Set(tslib_1.__spreadArray(tslib_1.__spreadArray([], this.$data.$tableCellComponentReducers, true), ['useEditableCell'], false)));\n        }\n        return this.$data.$tableCellComponentReducers;\n      },\n      /**\n       * onEditorRow\n       * @param params\n       */\n      onEditorRow: function onEditorRow(params) {\n        return {\n          editable: false\n        };\n      },\n      /**\n       * onEditorCell\n       * @param params\n       */\n      onEditorCell: function onEditorCell(params) {},\n      /**\n       * cellEditableReducer\n       * @description 可编辑单元格的onCell处理\n       * @param params\n       */\n      cellEditableReducer: function cellEditableReducer(params) {\n        var _a;\n        var rowIndex = params.rowIndex,\n          column = params.column,\n          record = params.record;\n        // 如果设置了$editable则调用onEditorCell方法对每个cell进行props注入\n        if ('$editable' in column && ((_a = column.$editable) === null || _a === void 0 ? void 0 : _a.editable) && this.onEditorCell) {\n          this.onEditorCell({\n            rowIndex: rowIndex,\n            editorConfig: column.$editable,\n            record: tslib_1.__assign({}, record)\n          });\n          return column;\n        }\n        return column;\n      },\n      /**\n       * valueToFormItemValue\n       * @description 值和表单值的转换\n       */\n      valueToFormItemValue: function valueToFormItemValue(_a) {\n        var type = _a.type,\n          record = _a.record,\n          dataIndex = _a.dataIndex;\n        var item = this.$data.$valueToFormItemValueMap.get(type);\n        return item ? item === null || item === void 0 ? void 0 : item({\n          record: record,\n          dataIndex: dataIndex\n        }) : record === null || record === void 0 ? void 0 : record[dataIndex];\n      },\n      /**\n       * updateEditorCellDate\n       * @description 更新可编辑单元格的数据\n       * @param record 行数据\n       * @param dataIndex 列索引\n       * @param rowIndex 行索引\n       * @param value 更新的值\n       * @return Promise<void>\n       */\n      updateEditorCellDate: function updateEditorCellDate(_a) {\n        var _this = this;\n        var record = _a.record,\n          dataIndex = _a.dataIndex,\n          rowIndex = _a.rowIndex,\n          value = _a.value;\n        return new Promise(function (resolve) {\n          if (record[dataIndex] === value) {\n            resolve();\n            return;\n          }\n          var dataSource = _this.getData();\n          var rowKey = _this.getRowKey();\n          var recordItem = dataSource.find(function (t) {\n            return t[rowKey] === record[rowKey];\n          });\n          if (recordItem) {\n            recordItem[dataIndex] = value;\n            _this.receiveDataMutation(dataSource);\n            _this.$nextTick(function () {\n              return resolve();\n            });\n            return;\n          }\n          resolve();\n        });\n      },\n      /**\n       * updateEditorCellDateData\n       * @description 更新日期类型可编辑单元格的数据\n       * @param record\n       * @param dataIndex\n       * @param value\n       * @return Promise<void>\n       */\n      updateEditorCellDateData: function updateEditorCellDateData(_a) {\n        var _this = this;\n        var record = _a.record,\n          dataIndex = _a.dataIndex,\n          value = _a.value;\n        return new Promise(function (resolve) {\n          if (record[dataIndex] === (value === null || value === void 0 ? void 0 : value.valueOf())) {\n            resolve();\n            return;\n          }\n          var dataSource = _this.getData();\n          var rowKey = _this.getRowKey();\n          var recordItem = dataSource.find(function (t) {\n            return t[rowKey] === record[rowKey];\n          });\n          if (recordItem) {\n            recordItem[dataIndex] = value === null || value === void 0 ? void 0 : value.valueOf();\n            _this.receiveDataMutation(dataSource);\n            _this.$nextTick(function () {\n              return resolve();\n            });\n            return;\n          }\n          resolve();\n        });\n      },\n      /**\n       * renderSearchTable\n       * @param h\n       */\n      renderSearchTable: function renderSearchTable(h) {\n        var children = this.$renderSearchTableSearchTable(h);\n        return h(ant_design_vue_1.Form, {\n          \"class\": \"\".concat(SearchTable_1.selectorPrefix, \"-form\"),\n          \"attrs\": {\n            \"form\": this.form\n          }\n        }, [children]);\n      },\n      /**\n       * setActiveValue\n       * @param activeValue\n       */\n      setActiveValue: function setActiveValue(activeValue) {\n        this.activeValue = activeValue;\n      },\n      /**\n       * getActiveValue\n       */\n      getActiveValue: function getActiveValue() {\n        return this.activeValue;\n      },\n      /**\n       * getFormIns\n       * @description 获取form对象实例\n       */\n      getFormIns: function getFormIns() {\n        return this.form;\n      }\n    }\n  });\n};"],"names":["require","Object","defineProperty","exports","value","tslib_1","ant_design_vue_1","moment_1","__importDefault","adherev_util_1","SearchTable_1","SearchTableImplement_1","extend","default","_util","serviceName","className","mixins","provide","getFormIns","this","getActiveValue","setActiveValue","data","_this","$cellConfigReducers","params","_i","arguments","length","cellEditableReducer","apply","$valueToFormItemValueMap","Map","_a","record","dataIndex","Array","isArray","form","$form","createForm","name","activeValue","methods","onTableRowComponentReducers","columns","some","column","$editable","editable","from","Set","__spreadArray","$data","$tableRowComponentReducers","onTableCellComponentReducers","$tableCellComponentReducers","onEditorRow","onEditorCell","rowIndex","editorConfig","__assign","valueToFormItemValue","type","item","get","updateEditorCellDate","Promise","resolve","dataSource","rowKey","recordItem","getData","getRowKey","find","t","receiveDataMutation","$nextTick","updateEditorCellDateData","valueOf","renderSearchTable","h","children","$renderSearchTableSearchTable","Form","class","concat","selectorPrefix","attrs"],"mappings":"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"}