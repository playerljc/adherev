{"version":3,"file":"SearchEditableCellTable.js","sources":["Editable/SearchEditableCellTable.js"],"sourcesContent":["\"use strict\";\n\nrequire(\"core-js/modules/es.object.define-property.js\");\nrequire(\"core-js/modules/es.array.from.js\");\nrequire(\"core-js/modules/es.string.iterator.js\");\nrequire(\"core-js/modules/es.array.iterator.js\");\nrequire(\"core-js/modules/es.object.to-string.js\");\nrequire(\"core-js/modules/es.set.js\");\nrequire(\"core-js/modules/esnext.set.add-all.js\");\nrequire(\"core-js/modules/esnext.set.delete-all.js\");\nrequire(\"core-js/modules/esnext.set.difference.js\");\nrequire(\"core-js/modules/esnext.set.every.js\");\nrequire(\"core-js/modules/esnext.set.filter.js\");\nrequire(\"core-js/modules/esnext.set.find.js\");\nrequire(\"core-js/modules/esnext.set.intersection.js\");\nrequire(\"core-js/modules/esnext.set.is-disjoint-from.js\");\nrequire(\"core-js/modules/esnext.set.is-subset-of.js\");\nrequire(\"core-js/modules/esnext.set.is-superset-of.js\");\nrequire(\"core-js/modules/esnext.set.join.js\");\nrequire(\"core-js/modules/esnext.set.map.js\");\nrequire(\"core-js/modules/esnext.set.reduce.js\");\nrequire(\"core-js/modules/esnext.set.some.js\");\nrequire(\"core-js/modules/esnext.set.symmetric-difference.js\");\nrequire(\"core-js/modules/esnext.set.union.js\");\nrequire(\"core-js/modules/web.dom-collections.iterator.js\");\nrequire(\"core-js/modules/es.map.js\");\nrequire(\"core-js/modules/esnext.map.delete-all.js\");\nrequire(\"core-js/modules/esnext.map.every.js\");\nrequire(\"core-js/modules/esnext.map.filter.js\");\nrequire(\"core-js/modules/esnext.map.find.js\");\nrequire(\"core-js/modules/esnext.map.find-key.js\");\nrequire(\"core-js/modules/esnext.map.includes.js\");\nrequire(\"core-js/modules/esnext.map.key-of.js\");\nrequire(\"core-js/modules/esnext.map.map-keys.js\");\nrequire(\"core-js/modules/esnext.map.map-values.js\");\nrequire(\"core-js/modules/esnext.map.merge.js\");\nrequire(\"core-js/modules/esnext.map.reduce.js\");\nrequire(\"core-js/modules/esnext.map.some.js\");\nrequire(\"core-js/modules/esnext.map.update.js\");\nrequire(\"core-js/modules/es.promise.js\");\nrequire(\"core-js/modules/es.array.find.js\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nvar tslib_1 = require(\"tslib\");\nvar lodash_clonedeep_1 = tslib_1.__importDefault(require(\"lodash.clonedeep\"));\nvar lodash_mergewith_1 = tslib_1.__importDefault(require(\"lodash.mergewith\"));\nvar moment_1 = tslib_1.__importDefault(require(\"moment\"));\nvar vue_1 = tslib_1.__importDefault(require(\"vue\"));\nvar adherev_util_1 = tslib_1.__importDefault(require(\"@baifendian/adherev-util\"));\nvar SearchTableImplement_1 = tslib_1.__importDefault(require(\"../SearchTableImplement\"));\nvar extend = adherev_util_1.default._util.extend;\nvue_1.default.config.optionMergeStrategies.data = function (toVal, fromVal) {\n  if (fromVal && toVal) {\n    return function () {\n      var fromValue = fromVal();\n      var toValue = toVal();\n      return (0, lodash_mergewith_1.default)(fromValue, toValue, function (objValue, srcValue) {\n        if (Array.isArray(objValue) && Array.isArray(srcValue)) {\n          return Array.from(new Set(tslib_1.__spreadArray(tslib_1.__spreadArray([], objValue, true), srcValue, true)));\n        }\n      });\n    };\n  }\n  if (fromVal) {\n    return fromVal;\n  }\n  if (toVal) {\n    return toVal;\n  }\n};\n/**\n * SearchEditableCellTable\n * @description 单元格可编辑的SearchTable\n * @param serviceName\n */\nexports.default = function (serviceName) {\n  return extend({\n    className: 'SearchEditableCellTable',\n    mixins: [(0, SearchTableImplement_1.default)(serviceName)],\n    data: function data() {\n      var _this = this;\n      return {\n        $cellConfigReducers: [function () {\n          var params = [];\n          for (var _i = 0; _i < arguments.length; _i++) {\n            params[_i] = arguments[_i];\n          }\n          return _this.cellEditableReducer.apply(_this, params);\n        }],\n        $valueToFormItemValueMap: new Map([['rangePicker', function (_a) {\n          var record = _a.record,\n            dataIndex = _a.dataIndex;\n          var value = record === null || record === void 0 ? void 0 : record[dataIndex];\n          return Array.isArray(value) && value.length === 2 ? [(0, moment_1.default)(value[0]), (0, moment_1.default)(value[1])] : [(0, moment_1.default)(), (0, moment_1.default)()];\n        }], ['datePicker', function (_a) {\n          var record = _a.record,\n            dataIndex = _a.dataIndex;\n          var value = record === null || record === void 0 ? void 0 : record[dataIndex];\n          return (0, moment_1.default)(value);\n        }], ['timePicker', function (_a) {\n          var record = _a.record,\n            dataIndex = _a.dataIndex;\n          var value = record === null || record === void 0 ? void 0 : record[dataIndex];\n          return (0, moment_1.default)(value);\n        }]])\n      };\n    },\n    methods: {\n      /**\n       * onTableRowComponentReducers\n       * @param columns\n       */\n      onTableRowComponentReducers: function onTableRowComponentReducers(columns) {\n        var existsEditable = columns.some(function (column) {\n          var _a;\n          return '$editable' in column && ((_a = column.$editable) === null || _a === void 0 ? void 0 : _a.editable);\n        });\n        if (existsEditable) {\n          return tslib_1.__spreadArray(tslib_1.__spreadArray([], this.$data.$tableRowComponentReducers, true), ['useEditableRow'], false);\n        }\n        return this.$data.$tableRowComponentReducers;\n      },\n      /**\n       * onTableCellComponentReducers\n       * @param columns\n       */\n      onTableCellComponentReducers: function onTableCellComponentReducers(columns) {\n        var existsEditor = columns.some(function (column) {\n          var _a;\n          return '$editable' in column && ((_a = column.$editable) === null || _a === void 0 ? void 0 : _a.editable);\n        });\n        if (existsEditor) {\n          return tslib_1.__spreadArray(tslib_1.__spreadArray([], this.$data.$tableCellComponentReducers, true), ['useEditableCell'], false);\n        }\n        return this.$data.$tableCellComponentReducers;\n      },\n      /**\n       * onEditorRow\n       * @param params\n       */\n      onEditorRow: function onEditorRow(params) {\n        return {\n          editable: false\n        };\n      },\n      /**\n       * onEditorCell\n       * @param params\n       */\n      onEditorCell: function onEditorCell(params) {},\n      /**\n       * cellEditableReducer\n       * @description 可编辑单元格的onCell处理\n       * @param params\n       */\n      cellEditableReducer: function cellEditableReducer(params) {\n        var _a;\n        var rowIndex = params.rowIndex,\n          column = params.column,\n          record = params.record;\n        // 如果设置了$editable则调用onEditorCell方法对每个cell进行props注入\n        if ('$editable' in column && ((_a = column.$editable) === null || _a === void 0 ? void 0 : _a.editable) && this.onEditorCell) {\n          this.onEditorCell({\n            rowIndex: rowIndex,\n            editorConfig: column.$editable,\n            record: tslib_1.__assign({}, record)\n          });\n          return column;\n        }\n        return column;\n      },\n      /**\n       * valueToFormItemValue\n       * @description 值和表单值的转换\n       */\n      valueToFormItemValue: function valueToFormItemValue(_a) {\n        var type = _a.type,\n          record = _a.record,\n          dataIndex = _a.dataIndex;\n        var item = this.$data.$valueToFormItemValueMap.get(type);\n        return item ? item === null || item === void 0 ? void 0 : item({\n          record: record,\n          dataIndex: dataIndex\n        }) : record === null || record === void 0 ? void 0 : record[dataIndex];\n      },\n      /**\n       * updateEditorCellDate\n       * @description 更新可编辑单元格的数据\n       * @param record 行数据\n       * @param dataIndex 列索引\n       * @param value 更新的值\n       * @return Promise<void>\n       */\n      updateEditorCellDate: function updateEditorCellDate(_a) {\n        var _this = this;\n        var record = _a.record,\n          dataIndex = _a.dataIndex,\n          value = _a.value;\n        return new Promise(function (resolve) {\n          var _a;\n          if (record[dataIndex] === value) {\n            resolve();\n            return;\n          }\n          var listData = (0, lodash_clonedeep_1.default)(_this.state[_this.getServiceName()]);\n          var dataSource = listData[_this.getFetchListPropName()][_this.getDataKey()] || [];\n          var rowKey = _this.getRowKey();\n          var recordItem = dataSource.find(function (t) {\n            return t[rowKey] === record[rowKey];\n          });\n          if (recordItem) {\n            recordItem[dataIndex] = value;\n            _this.setState((_a = {}, _a[_this.getServiceName()] = listData, _a), function () {\n              return resolve();\n            });\n          } else resolve();\n        });\n      },\n      /**\n       * updateEditorCellDateData\n       * @description 更新日期类型可编辑单元格的数据\n       * @param record\n       * @param dataIndex\n       * @param value\n       * @return Promise<void>\n       */\n      updateEditorCellDateData: function updateEditorCellDateData(_a) {\n        var _this = this;\n        var record = _a.record,\n          dataIndex = _a.dataIndex,\n          value = _a.value;\n        return new Promise(function (resolve) {\n          var _a;\n          if (record[dataIndex] === (value === null || value === void 0 ? void 0 : value.valueOf())) {\n            resolve();\n            return;\n          }\n          var listData = (0, lodash_clonedeep_1.default)(_this.state[_this.getServiceName()]);\n          var dataSource = listData[_this.getFetchListPropName()][_this.getDataKey()] || [];\n          var rowKey = _this.getRowKey();\n          var recordItem = dataSource.find(function (t) {\n            return t[rowKey] === record[rowKey];\n          });\n          if (recordItem) {\n            recordItem[dataIndex] = value === null || value === void 0 ? void 0 : value.valueOf();\n            _this.setState((_a = {}, _a[_this.getServiceName()] = listData, _a), function () {\n              return resolve();\n            });\n          } else resolve();\n        });\n      }\n    }\n  });\n};"],"names":["require","Object","defineProperty","exports","value","tslib_1","lodash_clonedeep_1","__importDefault","lodash_mergewith_1","moment_1","vue_1","adherev_util_1","SearchTableImplement_1","extend","default","_util","config","optionMergeStrategies","data","toVal","fromVal","fromValue","toValue","objValue","srcValue","Array","isArray","from","Set","__spreadArray","serviceName","className","mixins","_this","this","$cellConfigReducers","params","_i","arguments","length","cellEditableReducer","apply","$valueToFormItemValueMap","Map","_a","record","dataIndex","methods","onTableRowComponentReducers","columns","some","column","$editable","editable","$data","$tableRowComponentReducers","onTableCellComponentReducers","$tableCellComponentReducers","onEditorRow","onEditorCell","rowIndex","editorConfig","__assign","valueToFormItemValue","type","item","get","updateEditorCellDate","Promise","resolve","listData","rowKey","recordItem","dataSource","state","getServiceName","getFetchListPropName","getDataKey","getRowKey","find","t","setState","updateEditorCellDateData","valueOf"],"mappings":"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"}