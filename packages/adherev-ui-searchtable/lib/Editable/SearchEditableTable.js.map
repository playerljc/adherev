{"version":3,"file":"SearchEditableTable.js","sources":["Editable/SearchEditableTable.js"],"sourcesContent":["\"use strict\";\n\nrequire(\"core-js/modules/es.object.define-property.js\");\nrequire(\"core-js/modules/es.object.to-string.js\");\nrequire(\"core-js/modules/es.array.from.js\");\nrequire(\"core-js/modules/es.string.iterator.js\");\nrequire(\"core-js/modules/es.array.iterator.js\");\nrequire(\"core-js/modules/es.set.js\");\nrequire(\"core-js/modules/esnext.set.add-all.js\");\nrequire(\"core-js/modules/esnext.set.delete-all.js\");\nrequire(\"core-js/modules/esnext.set.difference.js\");\nrequire(\"core-js/modules/esnext.set.every.js\");\nrequire(\"core-js/modules/esnext.set.filter.js\");\nrequire(\"core-js/modules/esnext.set.find.js\");\nrequire(\"core-js/modules/esnext.set.intersection.js\");\nrequire(\"core-js/modules/esnext.set.is-disjoint-from.js\");\nrequire(\"core-js/modules/esnext.set.is-subset-of.js\");\nrequire(\"core-js/modules/esnext.set.is-superset-of.js\");\nrequire(\"core-js/modules/esnext.set.join.js\");\nrequire(\"core-js/modules/esnext.set.map.js\");\nrequire(\"core-js/modules/esnext.set.reduce.js\");\nrequire(\"core-js/modules/esnext.set.some.js\");\nrequire(\"core-js/modules/esnext.set.symmetric-difference.js\");\nrequire(\"core-js/modules/esnext.set.union.js\");\nrequire(\"core-js/modules/web.dom-collections.iterator.js\");\nrequire(\"core-js/modules/es.array.reduce.js\");\nrequire(\"core-js/modules/web.dom-collections.for-each.js\");\nrequire(\"core-js/modules/es.array.concat.js\");\nrequire(\"core-js/modules/es.object.keys.js\");\nrequire(\"core-js/modules/es.parse-int.js\");\nrequire(\"core-js/modules/es.array.last-index-of.js\");\nrequire(\"core-js/modules/es.promise.js\");\nrequire(\"core-js/modules/es.array.map.js\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nvar tslib_1 = require(\"tslib\");\nvar adherev_util_1 = tslib_1.__importDefault(require(\"@baifendian/adherev-util\"));\nvar SearchEditableCellTable_1 = tslib_1.__importDefault(require(\"./SearchEditableCellTable\"));\nvar extend = adherev_util_1.default._util.extend;\n/**\n * SearchEditableTable\n * @description 表格整体可编辑的SearchTable\n * @param serviceName\n */\nvar SearchEditableTable = function SearchEditableTable(serviceName) {\n  return extend({\n    className: 'SearchEditableTable',\n    mixins: [(0, SearchEditableCellTable_1.default)(serviceName)],\n    data: function data() {\n      var _this = this;\n      return {\n        $rowConfigReducers: [function () {\n          var params = [];\n          for (var _i = 0; _i < arguments.length; _i++) {\n            params[_i] = arguments[_i];\n          }\n          return _this.rowEditableReducer.apply(_this, params);\n        }],\n        isTableEditor: false\n      };\n    },\n    methods: {\n      /**\n       * onTableRowComponentReducers\n       * @param columns\n       */\n      onTableRowComponentReducers: function onTableRowComponentReducers(columns) {\n        var existsEditor = columns.some(function (column) {\n          var _a;\n          return '$editable' in column && ((_a = column.$editable) === null || _a === void 0 ? void 0 : _a.editable);\n        });\n        if (existsEditor) {\n          return Array.from(new Set(tslib_1.__spreadArray(tslib_1.__spreadArray([], this.$data.$tableRowComponentReducers, true), ['useEditableTableRow'], false)));\n        }\n        return this.$data.$tableRowComponentReducers;\n      },\n      /**\n       * onTableRowComponentReducers\n       * @param columns\n       */\n      onTableCellComponentReducers: function onTableCellComponentReducers(columns) {\n        var existsEditor = columns.some(function (column) {\n          var _a;\n          return '$editable' in column && ((_a = column.$editable) === null || _a === void 0 ? void 0 : _a.editable);\n        });\n        if (existsEditor) {\n          return Array.from(new Set(tslib_1.__spreadArray(tslib_1.__spreadArray([], this.$data.$tableCellComponentReducers, true), ['useEditableTableCell'], false)));\n        }\n        return this.$data.$tableCellComponentReducers;\n      },\n      /**\n       * rowEditableReducer\n       * @description 可编辑row的处理\n       * @param params\n       */\n      rowEditableReducer: function rowEditableReducer(params) {\n        var rowConfig = params.rowConfig,\n          rowIndex = params.rowIndex,\n          columns = params.columns,\n          record = params.record;\n        if (this.onEditorRow) {\n          rowConfig.$editable = this.onEditorRow({\n            rowIndex: rowIndex,\n            record: record,\n            columns: columns\n          });\n        }\n        return rowConfig;\n      },\n      /**\n       * onEditorRow\n       * @param params\n       */\n      onEditorRow: function onEditorRow(params) {\n        return {\n          editable: true\n        };\n      },\n      /**\n       * onEditorCell\n       * @param record\n       * @param editorConfig\n       */\n      onEditorCell: function onEditorCell(_a) {\n        var record = _a.record,\n          editorConfig = _a.editorConfig;\n        if (editorConfig) {\n          editorConfig.useTrigger = false;\n          if (this.isTableEditor) {\n            editorConfig.defaultStatus = 'edit';\n          }\n        }\n      },\n      /**\n       * setFieldValues\n       */\n      setFieldValues: function setFieldValues() {\n        var _a;\n        var form = this.getFormIns();\n        (_a = form === null || form === void 0 ? void 0 : form.setFieldsValue) === null || _a === void 0 ? void 0 : _a.call(form, this.$arrayToValues(this.getData()));\n      },\n      /**\n       * $arrayToValues\n       * @param dataSource\n       */\n      $arrayToValues: function $arrayToValues(dataSource) {\n        var _this = this;\n        var columns = this.getTableColumns();\n        return (dataSource || []).reduce(function (values, record, currentIndex) {\n          columns.forEach(function (_a) {\n            var dataIndex = _a.dataIndex,\n              $editable = _a.$editable;\n            if (dataIndex in record && $editable && 'type' in $editable) {\n              // 这个表格表单数据key的生成规则\n              var key = \"\".concat(dataIndex, \"_\").concat(currentIndex);\n              values[key] = _this.valueToFormItemValue({\n                type: $editable.type,\n                record: record,\n                dataIndex: dataIndex\n              });\n            }\n          });\n          return values;\n        }, {});\n      },\n      /**\n       * $valuesToArray\n       * @param values\n       */\n      $valuesToArray: function $valuesToArray(values) {\n        /**\n         * name_0:1\n         * sex_0:2\n         * address_0:3\n         *\n         * name_1:4\n         * sex_1:5\n         * address_1:6\n         *\n         * [\n         *   {\n         *     name:1,\n         *     sex:2,\n         *     address:3\n         *   },\n         *   {\n         *     name:4,\n         *     sex:5,\n         *     address:6\n         *   }\n         * ]\n         */\n        return Object.keys(values).reduce(function (array, key) {\n          var currentIndex = parseInt(key.substring(key.lastIndexOf('_') + 1));\n          var prop = key.substring(0, key.lastIndexOf('_'));\n          if (!array[currentIndex]) {\n            array[currentIndex] = {};\n          }\n          var record = array[currentIndex];\n          record[prop] = values[key];\n          return array;\n        }, []);\n      },\n      /**\n       * fetchData\n       */\n      fetchData: function fetchData() {\n        var _this = this;\n        return this.$fetchDataSearchTableImpl().then(function (res) {\n          _this.isTableEditor = false;\n          return res;\n        });\n      },\n      /**\n       * updateEditorData\n       * @description 更新可编辑的所有单元格\n       * @return Promise<void>\n       */\n      updateEditorData: function updateEditorData(changeData) {\n        var _this = this;\n        return new Promise(function (resolve) {\n          // 原始的数据\n          var dataSource = _this.getData();\n          // 改变的数据\n          var changeDataSource = _this.$valuesToArray(changeData);\n          // this[`${this.getServiceName()}${this.getFetchListPropNameToFirstUpper()}`][\n          //   this.getDataKey()\n          // ] = dataSource.map((srcRecord, _index) => ({\n          //   // 原始数据和改变的数据做merge\n          //   ...srcRecord,\n          //   ...changeDataSource[_index],\n          // }));\n          _this.receiveDataMutation(dataSource.map(function (srcRecord, _index) {\n            return tslib_1.__assign(tslib_1.__assign({}, srcRecord), changeDataSource[_index]);\n          }));\n          _this.$nextTick(function () {\n            return resolve();\n          });\n        });\n      }\n    }\n  });\n};\nexports.default = SearchEditableTable;"],"names":["require","Object","defineProperty","exports","value","tslib_1","adherev_util_1","__importDefault","SearchEditableCellTable_1","extend","default","_util","SearchEditableTable","serviceName","className","mixins","data","_this","this","$rowConfigReducers","params","_i","arguments","length","rowEditableReducer","apply","isTableEditor","methods","onTableRowComponentReducers","columns","some","column","_a","$editable","editable","Array","from","Set","__spreadArray","$data","$tableRowComponentReducers","onTableCellComponentReducers","$tableCellComponentReducers","rowConfig","rowIndex","record","onEditorRow","onEditorCell","editorConfig","useTrigger","defaultStatus","setFieldValues","form","getFormIns","setFieldsValue","call","$arrayToValues","getData","dataSource","getTableColumns","reduce","values","currentIndex","forEach","key","dataIndex","concat","valueToFormItemValue","type","$valuesToArray","keys","array","parseInt","substring","lastIndexOf","prop","fetchData","$fetchDataSearchTableImpl","then","res","updateEditorData","changeData","Promise","resolve","changeDataSource","receiveDataMutation","map","srcRecord","_index","__assign","$nextTick"],"mappings":"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"}