"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_babelHelperVueJsxMergeProps=_interopRequireDefault(require("@vue/babel-helper-vue-jsx-merge-props"));require("core-js/modules/es.object.define-property.js"),require("core-js/modules/es.symbol.js"),require("core-js/modules/es.symbol.description.js"),require("core-js/modules/es.object.to-string.js"),require("core-js/modules/es.array.map.js"),require("core-js/modules/es.regexp.to-string.js"),require("core-js/modules/es.array.find.js"),require("core-js/modules/es.promise.js"),require("core-js/modules/es.array.filter.js"),require("core-js/modules/es.array.concat.js"),require("core-js/modules/es.array.sort.js"),require("core-js/modules/es.string.starts-with.js"),Object.defineProperty(exports,"__esModule",{value:!0}),exports.ROW_SELECTION_CONTINUOUS_MODE=exports.ROW_SELECTION_NORMAL_MODE=exports.NUMBER_GENERATOR_RULE_CONTINUITY=exports.NUMBER_GENERATOR_RULE_ALONE=exports.selectorPrefix=void 0;var tslib_1=require("tslib"),ant_design_vue_1=require("ant-design-vue"),classnames_1=tslib_1.__importDefault(require("classnames")),adherev_ui_conditionalrender_1=tslib_1.__importDefault(require("@baifendian/adherev-ui-conditionalrender")),adherev_ui_flexlayout_1=tslib_1.__importDefault(require("@baifendian/adherev-ui-flexlayout")),adherev_ui_suspense_1=tslib_1.__importDefault(require("@baifendian/adherev-ui-suspense")),adherev_util_1=tslib_1.__importDefault(require("@baifendian/adherev-util")),adherev_util_intl_1=tslib_1.__importDefault(require("@baifendian/adherev-util-intl")),adherev_util_mixins_1=tslib_1.__importDefault(require("@baifendian/adherev-util-mixins")),ColumnResizable_1=tslib_1.__importStar(require("./Extension/ColumnResizable")),ColumnSetting_1=tslib_1.__importDefault(require("./Extension/ColumnSetting")),TableDensitySetting_1=tslib_1.__importDefault(require("./Extension/TableDensitySetting")),types_1=require("./types");exports.selectorPrefix="adherev-ui-searchtable";var updatedEx=adherev_util_mixins_1.default.updatedEx,watchEffect=adherev_util_mixins_1.default.watchEffect,Fixed=adherev_ui_flexlayout_1.default.Fixed,Auto=adherev_ui_flexlayout_1.default.Auto,extend=adherev_util_1.default._util.extend;exports.NUMBER_GENERATOR_RULE_ALONE=Symbol(),exports.NUMBER_GENERATOR_RULE_CONTINUITY=Symbol(),exports.ROW_SELECTION_NORMAL_MODE=Symbol(),exports.ROW_SELECTION_CONTINUOUS_MODE=Symbol();var SearchTable=extend({className:"SearchTable",mixins:[adherev_ui_suspense_1.default,updatedEx,watchEffect],props:{className:{type:String,default:""},wrapStyle:{type:String,default:""},tableClassName:{type:String,default:""},tableStyle:{type:String,default:""},searchClassName:{type:String,default:""},searchStyle:{type:String,default:""},reset:{type:Boolean,default:!0},antdTableProps:{type:Object,default:function(){return{}}},isShowExpandSearch:{type:Boolean,default:!0},defaultExpandSearchCollapse:{type:Boolean,default:!0},fitSearch:{type:Boolean,default:!0},fitTable:{type:Boolean,default:!0},autoFixed:{type:Boolean,default:!0},fixedHeaderAutoTable:{type:Boolean,default:!1},fixedTableSpaceBetween:{type:Boolean,default:!1},showColumnSetting:{type:Boolean,default:!1}},scopedSlots:["searchFormBefore","searchFormAfter","searchForm","tableHeader","tableFooter","tableNumberColumn","columnSetting","tableDensitySetting","searchFooter","table","inner","searchTable"],data:function(){return{page:1,limit:10,expand:this.defaultExpandSearchCollapse,scrollY:0,columnSetting:[],tableDensity:types_1.TableDensity.DEFAULT,$columnResizable:new ColumnResizable_1.default,$columnObserver:null}},computed:{components:function(){return{header:{cell:ColumnResizable_1.SearchTableResizableTitle(this.getTableColumns(this.$createElement))}}}},provide:function(){return{getContext:this.getContext}},created:function(){this.columnSetting=this.getTableColumns(this.$createElement).map(function(e,t){return tslib_1.__assign(tslib_1.__assign({},e),{sort:t,display:!0})}),this.tableDensity=this.getTableDensity()},updatedEx:function(e){this.$refs.tableWrapRef&&(this.searchTableResizableEffectLayout(),this.fixedHeaderAutoTableEffectLayout(e))},watchEffect:function(){this.columnSettingEffect()},beforeDestroy:function(){var e;this.fixedHeaderAutoTable&&null!==(e=this.getScrollBodyEl())&&void 0!==e&&e.removeEventListener("scroll",this.onScrollBodyScroll)},methods:{getContext:function(){return this},searchTableResizableEffectLayout:function(){this.$data.$columnObserver||(this.$data.$columnObserver=ColumnResizable_1.SearchTableResizableObserver(this))},fixedHeaderAutoTableEffectLayout:function(e){var t,i;!this.fixedHeaderAutoTable||(i=this.getData())&&i.length&&(0===e.scrollY&&0===this.scrollY||e.scrollY!==this.scrollY||e.expand!==this.expand)&&(t=this.$refs.tableWrapRef,(i=this.getScrollBodyEl())&&(i.removeEventListener("scroll",this.onScrollBodyScroll),i.addEventListener("scroll",this.onScrollBodyScroll)),i=(null===(e=t.querySelector(".ant-table-thead"))||void 0===e?void 0:e.offsetHeight)||0,e=(null===(e=t.querySelector(".ant-table-pagination"))||void 0===e?void 0:e.offsetHeight)||0,this.scrollY=t.clientHeight-(i+(e?e+32:0)))},columnSettingEffect:function(){var e,t,i,r=this,l=this.columnSetting||[],n=this.getTableColumns(this.$createElement).map(function(e,t){return tslib_1.__assign(tslib_1.__assign({},e),{sort:t,display:!0})});(null==l?void 0:l.length)===n.length?(e=null===(t=null==l?void 0:l.map)||void 0===t?void 0:t.call(l,function(e){return e[r.getRowKey()]}),t=null===(t=null==n?void 0:n.map)||void 0===t?void 0:t.call(n,function(e){return e[r.getRowKey()]}),(null==e?void 0:e.toString())!==t.toString()&&(i=this.getRowKey()||"id",this.columnSetting=null==n?void 0:n.map(function(t){var e=null==l?void 0:l.find(function(e){return e[i]===t[i]});return tslib_1.__assign(tslib_1.__assign({},t),{display:!e||e.display})}))):this.columnSetting=n},onSearchPanelCollapseBefore:function(){},onSearchPanelCollapseAfter:function(){},onTableChange:function(t,i,r){this[this.getOrderFieldProp()]=r.field||this.getOrderFieldValue(),this[this.getOrderProp()]=r.order||this.getOrderPropValue(),this.$nextTick(function(){var e;r.order&&(this.fetchData(),null!==(e=this.onSubTableChange)&&void 0!==e&&e.call(this,t,i,r))})},onClear:function(){var e=this;return new Promise(function(t){e.page=1,e.limit=e.getLimit(),e.$nextTick(function(){var e=this;this.clear().then(function(){e.fetchData(),t()})})})},onScrollBodyScroll:function(){var e=this.getScrollBodyEl();this.getScrollHeaderEl().scrollLeft=null==e?void 0:e.scrollLeft},sortOrder:function(e){return this[this.getOrderFieldProp()]===e?this[this.getOrderProp()]:""},getLimit:function(){return 10},getPagination:function(){var i=this;return{onChange:function(e,t){i.page=e,i.limit=t,i.$nextTick(function(){this.fetchData()})},onShowSizeChange:function(e,t){i.page=e,i.limit=t,i.$nextTick(function(){this.fetchData()})},showTotal:function(e){return adherev_util_intl_1.default.tv("当前 {page}-{pageSize}/共 {total}条",{page:i.page,pageSize:i.limit,total:e})},total:this.getTotal(),current:this.page,pageSize:this.limit,showQuickJumper:!0}},getTableDensity:function(){return types_1.TableDensity.DEFAULT},getTableColumns:function(r){var l=this,e=this.isShowNumber(),t=this.getTableNumberColumnWidth(),i=this.getColumns().filter(function(e){return!("authorized"in e)||e.authorized()}).map(function(e,t){return"resizable"in e&&e.resizable?l.$data.$columnResizable.searchTableResizableColumnItem(l,t,e):e});if(e){var n=null!==(e=this.getNumberGeneratorRule())&&void 0!==e?e:SearchTable.NUMBER_GENERATOR_RULE_ALONE,e=this.page,o=void 0===e?0:e,e=this.limit,a=void 0===e?10:e;return[tslib_1.__assign(tslib_1.__assign({},this.getTableNumberColumnProps&&this.getTableNumberColumnProps()||{}),{title:adherev_util_intl_1.default.tv("序号"),key:"_number",align:"center",width:t||80,customRender:function(e,t,i){return r(adherev_ui_conditionalrender_1.default,{attrs:{conditional:n===exports.NUMBER_GENERATOR_RULE_ALONE}},[r("span",{slot:"default"},[l.renderTableNumberColumn(r,i+1,{value:e,record:t,index:i})]),r("span",{slot:"noMatch"},[l.renderTableNumberColumn(r,(o-1)*a+(i+1),{value:e,record:t,index:i})])])}})].concat(i)}return i},getSortColumnSetting:function(){var e=tslib_1.__spreadArrays(this.columnSetting);return e.sort(function(e,t){return e.sort>t.sort?1:e.sort<t.sort?-1:0}),e},getScrollHeaderEl:function(){var e=this.$refs.tableWrapRef;return null==e?void 0:e.querySelector(".ant-table-wrapper > .ant-spin-nested-loading > .ant-spin-container > .ant-table > .ant-table-content > .ant-table-scroll > .ant-table-header")},getScrollBodyEl:function(){var e=this.$refs.tableWrapRef;return null==e?void 0:e.querySelector(".ant-table-wrapper > .ant-spin-nested-loading > .ant-spin-container > .ant-table > .ant-table-content > .ant-table-scroll > .ant-table-body")},renderTableNumberColumn:function(e,t,i){var r,l;return void 0===t&&(t=""),(null===(l=null===(r=this.$scopedSlots)||void 0===r?void 0:r.tableNumberColumn)||void 0===l?void 0:l.call(r,{context:this.getContext(),number:t}))||e("span",[t])},renderColumnSetting:function(e){var t,i,r=this,l=tslib_1.__spreadArrays(this.columnSetting);return l.sort(function(e,t){return e.sort>t.sort?1:e.sort<t.sort?-1:0}),(null===(i=null===(t=this.$scopedSlots)||void 0===t?void 0:t.columnSetting)||void 0===i?void 0:i.call(t,{context:this.getContext(),columns:l}))||e(ColumnSetting_1.default,{attrs:{columns:l},on:{showColumns:function(t){var e;r.columnSetting=null===(e=r.columnSetting||[])||void 0===e?void 0:e.map(function(e){return tslib_1.__assign(tslib_1.__assign({},e),{display:t})})},reset:function(){r.columnSetting=r.getTableColumns(e).map(function(e,t){return tslib_1.__assign(tslib_1.__assign({},e),{display:!0,sort:t})})},displayColumn:function(t,i){var e;r.columnSetting=null===(e=r.columnSetting||[])||void 0===e?void 0:e.map(function(e){return tslib_1.__assign(tslib_1.__assign({},e),{display:e.key===t.key?i:e.display})})},sortEnd:function(t){var e;r.columnSetting=null===(e=r.columnSetting||[])||void 0===e?void 0:e.map(function(e){return tslib_1.__assign(tslib_1.__assign({},e),{sort:t.get(e.key)})})}}})},renderTableDensitySetting:function(){var e,t,i=this;return(null===(t=null===(e=this.$scopedSlots)||void 0===e?void 0:e.tableDensitySetting)||void 0===t?void 0:t.call(e,this))||h(TableDensitySetting_1.default,{attrs:{density:this.tableDensity},on:{change:function(e){i.tableDensity=e},reset:function(){i.tableDensity=i.getTableDensity()}}})},renderSearchFooter:function(i){var e=this,t=this.isShowExpandSearch,r=[i(ant_design_vue_1.Button,{class:exports.selectorPrefix+"-searchfooteritem",attrs:{type:"primary"},key:"search",on:{click:function(){e.page=1,e.$nextTick(function(){this.onSearch()})}}},[i("i",{class:classnames_1.default(exports.selectorPrefix+"-searchfooteritem-search-btn-icon","iconfont iconsousuo")}),adherev_util_intl_1.default.tv("查询")]),i(ant_design_vue_1.Button,{class:exports.selectorPrefix+"-searchfooteritem",key:"reset",on:{click:this.onClear}},[adherev_util_intl_1.default.tv("重置")])];t&&r.push(i(adherev_ui_conditionalrender_1.default,{attrs:{conditional:this.expand}},[i("a",{slot:"noMatch",key:"expand",class:exports.selectorPrefix+"-searchfooteritem-expand-search-up-btn",on:{click:function(){e.onSearchPanelCollapseBefore&&e.onSearchPanelCollapseBefore(),e.expand=!0,e.$nextTick(function(){this.onSearchPanelCollapseAfter&&this.onSearchPanelCollapseAfter()})}}},[i("span",[adherev_util_intl_1.default.tv("展开")]),i("i",{attrs:{className:"iconfont iconup"}})]),i("a",{key:"hide",class:exports.selectorPrefix+"-searchfooteritem-expand-search-down-btn",on:{click:function(){e.onSearchPanelCollapseBefore&&e.onSearchPanelCollapseBefore(),e.expand=!1,e.$nextTick(function(){this.onSearchPanelCollapseAfter&&this.onSearchPanelCollapseAfter()})}}},[i("span",[adherev_util_intl_1.default.tv("关闭")]),i("i",{attrs:{className:"iconfont icondownarrow"}})])]));var l=this.renderSearchFooterItems(i,r)||tslib_1.__spreadArrays(r);return i("div",{class:exports.selectorPrefix+"-searchfooterwrapper"},[(null===(r=null===(t=this.$scopedSlots)||void 0===t?void 0:t.searchFooter)||void 0===r?void 0:r.call(t,{context:this.getContext(),items:l}))||l.map(function(e,t){return i("div",{key:t,class:exports.selectorPrefix+"-searchfooteritem"},[e])})])},renderTable:function(e){if(null!==(r=this.$scopedSlots)&&void 0!==r&&r.table)return null===(l=null===(s=this.$scopedSlots)||void 0===s?void 0:s.table)||void 0===l?void 0:l.call(s,this);var t,i=this.antdTableProps,r=this.fixedHeaderAutoTable,l=tslib_1.__assign({},this.getScopedSlots(e)||{}),n={},o={},a=i||{};for(t in a)t.startsWith("on")?o[t.substring(2).toLowerCase()]=a[t]:n[t]=a[t];var s=this.columnSetting,u=void 0===s?[]:s,i=this.tableDensity,s=this.getTableColumns(e).map(function(e,t){return tslib_1.__assign(tslib_1.__assign({},u[t]),e)}).filter(function(e){return e.display});s.sort(function(e,t){return e.sort>t.sort?1:e.sort<t.sort?-1:0});i={scopedSlots:l,props:tslib_1.__assign({rowKey:this.getRowKey(),dataSource:this.getData(),columns:s,size:i,pagination:this.getPagination(),rowSelection:this.getRowSelection(),components:this.components},n||{}),on:tslib_1.__assign({change:this.onTableChange},o||{})};return r&&(r=this.scrollY,n&&n.scroll?i.props.scroll.y=r:i.props.scroll={y:r}),e(ant_design_vue_1.Table,(0,_babelHelperVueJsxMergeProps.default)([{},i]))},renderInner:function(e){if(null!==(s=this.$scopedSlots)&&void 0!==s&&s.inner)return null===(u=null===(d=this.$scopedSlots)||void 0===d?void 0:d.inner)||void 0===u?void 0:u.call(d,this);var t=this,i=t.className,r=t.wrapStyle,l=t.tableClassName,n=t.tableStyle,o=t.searchStyle,a=t.searchClassName,s=t.fitSearch,u=t.fitTable,d=t.autoFixed,t=t.fixedTableSpaceBetween;return e(adherev_ui_flexlayout_1.default,{attrs:{direction:"vertical"},style:r||"",class:classnames_1.default(exports.selectorPrefix,t?"fixedtablespacebetween":"",i||"")},[e(Fixed,{class:classnames_1.default(exports.selectorPrefix+"-searchwrapper",a||""),style:o||"",attrs:{fit:s}},[e(adherev_ui_flexlayout_1.default,{attrs:{direction:"vertical"}},[e(adherev_ui_conditionalrender_1.default,{attrs:{conditional:this.$scopedSlots.searchFormBefore||!!this.renderSearchFormBefore}},[e(Fixed,{slot:"default"},[(null===(s=null===(o=this.$scopedSlots)||void 0===o?void 0:o.searchFormBefore)||void 0===s?void 0:s.call(o,this))||this.renderSearchFormBefore(e)])]),e(Fixed,[e(adherev_ui_conditionalrender_1.default,{attrs:{conditional:this.expand}},[(null===(o=null===(s=this.$scopedSlots)||void 0===s?void 0:s.searchForm)||void 0===o?void 0:o.call(s,this))||this.renderSearchForm(e)])]),e(Fixed,[this.renderSearchFooter(e)]),e(adherev_ui_conditionalrender_1.default,{attrs:{conditional:this.$scopedSlots.searchFormAfter||!!this.renderSearchFormAfter}},[e(Fixed,{slot:"default"},[(null===(s=null===(o=this.$scopedSlots)||void 0===o?void 0:o.searchFormAfter)||void 0===s?void 0:s.call(o,this))||this.renderSearchFormAfter(e)])])])]),e(adherev_ui_conditionalrender_1.default,{attrs:{conditional:!!this.$scopedSlots.tableHeader||!!this.renderTableHeader}},[e(Fixed,{slot:"default"},[(null===(o=null===(s=this.$scopedSlots)||void 0===s?void 0:s.tableHeader)||void 0===o?void 0:o.call(s,this))||this.renderTableHeader(e)])]),e(Auto,{class:classnames_1.default(exports.selectorPrefix+"-autowrapper",l||"",d?"autofixed":""),style:n||"",attrs:{fit:u,autoFixed:d}},[e("div",{ref:"tableWrapRef",class:exports.selectorPrefix+"-tablewrapper"},[this.renderTable(e)])]),e(adherev_ui_conditionalrender_1.default,{attrs:{conditional:!!this.$scopedSlots.tableFooter||!!this.renderTableFooter}},[e(Fixed,{slot:"default"},[(null===(d=null===(u=this.$scopedSlots)||void 0===u?void 0:u.tableFooter)||void 0===d?void 0:d.call(u,this))||this.renderTableFooter(e)])])])},renderSearchTable:function(e){var t,i;return(null===(i=null===(t=this.$scopedSlots)||void 0===t?void 0:t.searchTable)||void 0===i?void 0:i.call(t,this))||e("div",{class:exports.selectorPrefix+"-wrap"},[this.$renderSuspense(e)])}},render:function(e){return this.renderSearchTable(e)}});exports.default=SearchTable;
//# sourceMappingURL=searchtable.js.map
