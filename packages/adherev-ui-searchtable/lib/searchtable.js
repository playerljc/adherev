"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_babelHelperVueJsxMergeProps=_interopRequireDefault(require("@vue/babel-helper-vue-jsx-merge-props")),tslib_1=(require("core-js/modules/es.object.define-property.js"),require("core-js/modules/es.symbol.js"),require("core-js/modules/es.symbol.description.js"),require("core-js/modules/es.object.to-string.js"),require("core-js/modules/es.array.map.js"),require("core-js/modules/es.regexp.to-string.js"),require("core-js/modules/es.array.find.js"),require("core-js/modules/es.promise.js"),require("core-js/modules/es.array.reduce.js"),require("core-js/modules/es.array.find-index.js"),require("core-js/modules/es.number.constructor.js"),require("core-js/modules/es.array.filter.js"),require("core-js/modules/web.dom-collections.for-each.js"),require("core-js/modules/es.array.concat.js"),require("core-js/modules/es.array.sort.js"),require("core-js/modules/es.string.starts-with.js"),Object.defineProperty(exports,"__esModule",{value:!0}),exports.ROW_SELECTION_CONTINUOUS_MODE=exports.ROW_SELECTION_NORMAL_MODE=exports.NUMBER_GENERATOR_RULE_CONTINUITY=exports.NUMBER_GENERATOR_RULE_ALONE=exports.selectorPrefix=void 0,require("tslib")),ant_design_vue_1=require("ant-design-vue"),classnames_1=tslib_1.__importDefault(require("classnames")),lodash_clonedeep_1=tslib_1.__importDefault(require("lodash.clonedeep")),adherev_ui_conditionalrender_1=tslib_1.__importDefault(require("@baifendian/adherev-ui-conditionalrender")),adherev_ui_flexlayout_1=tslib_1.__importDefault(require("@baifendian/adherev-ui-flexlayout")),adherev_ui_suspense_1=tslib_1.__importDefault(require("@baifendian/adherev-ui-suspense")),adherev_util_1=tslib_1.__importDefault(require("@baifendian/adherev-util")),adherev_util_intl_1=tslib_1.__importDefault(require("@baifendian/adherev-util-intl")),adherev_util_mixins_1=tslib_1.__importDefault(require("@baifendian/adherev-util-mixins")),ColumnResizable_1=tslib_1.__importStar(require("./Extension/ColumnResizable")),ColumnSetting_1=tslib_1.__importDefault(require("./Extension/ColumnSetting")),TableBody_1=tslib_1.__importDefault(require("./Extension/TableComponents/TableBody")),TableCell_1=tslib_1.__importDefault(require("./Extension/TableComponents/TableCell")),TableRow_1=tslib_1.__importDefault(require("./Extension/TableComponents/TableRow")),TableDensitySetting_1=tslib_1.__importDefault(require("./Extension/TableDensitySetting")),types_1=require("./types"),updatedEx=(exports.selectorPrefix="adherev-ui-searchtable",adherev_util_mixins_1.default.updatedEx),watchEffect=adherev_util_mixins_1.default.watchEffect,Fixed=adherev_ui_flexlayout_1.default.Fixed,Auto=adherev_ui_flexlayout_1.default.Auto,extend=adherev_util_1.default._util.extend,SearchTable=(exports.NUMBER_GENERATOR_RULE_ALONE=Symbol(),exports.NUMBER_GENERATOR_RULE_CONTINUITY=Symbol(),exports.ROW_SELECTION_NORMAL_MODE=Symbol(),exports.ROW_SELECTION_CONTINUOUS_MODE=Symbol(),extend({className:"SearchTable",mixins:[adherev_ui_suspense_1.default,updatedEx,watchEffect],props:{className:{type:String,default:""},wrapStyle:{type:String,default:""},tableClassName:{type:String,default:""},tableStyle:{type:String,default:""},searchClassName:{type:String,default:""},searchStyle:{type:String,default:""},reset:{type:Boolean,default:!0},antdTableProps:{type:Object,default:function(){return{}}},isShowExpandSearch:{type:Boolean,default:!0},defaultExpandSearchCollapse:{type:Boolean,default:!0},fitSearch:{type:Boolean,default:!0},fitTable:{type:Boolean,default:!0},autoFixed:{type:Boolean,default:!0},fixedHeaderAutoTable:{type:Boolean,default:!1},fixedTableSpaceBetween:{type:Boolean,default:!1},showColumnSetting:{type:Boolean,default:!1}},scopedSlots:["searchFormBefore","searchFormAfter","searchForm","tableHeader","tableFooter","tableNumberColumn","columnSetting","tableDensitySetting","searchFooter","table","inner","searchTable"],data:function(){return{page:1,limit:10,expand:this.defaultExpandSearchCollapse,scrollY:0,columnSetting:[],tableDensity:types_1.TableDensity.DEFAULT,$columnResizable:new ColumnResizable_1.default,$columnObserver:null,$bodyConfigReducers:[],$rowConfigReducers:[],$cellConfigReducers:[],$tableBodyComponentReducers:[],$tableRowComponentReducers:[],$tableCellComponentReducers:[]}},computed:{components:function(){var e=this.getTableColumns(this.$createElement);return{header:{cell:(0,ColumnResizable_1.SearchTableResizableTitle)(e)},body:{wrapper:TableBody_1.default,row:TableRow_1.default,cell:TableCell_1.default}}}},provide:function(){return{getContext:this.getContext}},created:function(){var e,t=this.getColumns();this.$data.$tableBodyComponentReducers=(null==(e=this.onTableBodyComponentReducers)?void 0:e.call(this,t))||[],this.$data.$tableRowComponentReducers=(null==(e=this.onTableRowComponentReducers)?void 0:e.call(this,t))||[],this.$data.$tableCellComponentReducers=(null==(e=this.onTableCellComponentReducers)?void 0:e.call(this,t))||[],this.columnSetting=this.getTableColumns(this.$createElement).map(function(e,t){return tslib_1.__assign(tslib_1.__assign({},e),{sort:t,display:!0})}),this.tableDensity=this.getTableDensity()},updatedEx:function(e){this.$refs.tableWrapRef&&(this.searchTableResizableEffectLayout(),this.fixedHeaderAutoTableEffectLayout(e))},watchEffect:function(){this.columnSettingEffect()},beforeDestroy:function(){var e;this.fixedHeaderAutoTable&&null!=(e=this.getScrollBodyEl())&&e.removeEventListener("scroll",this.onScrollBodyScroll)},methods:{getContext:function(){return{context:this}},searchTableResizableEffectLayout:function(){this.$data.$columnObserver||(this.$data.$columnObserver=(0,ColumnResizable_1.SearchTableResizableObserver)(this))},fixedHeaderAutoTableEffectLayout:function(e){var t,r;this.fixedHeaderAutoTable&&(t=this.getData())&&t.length&&(0===e.scrollY&&0===this.scrollY||e.scrollY!==this.scrollY||e.expand!==this.expand)&&(t=this.$refs.tableWrapRef,(e=this.getScrollBodyEl())&&(e.removeEventListener("scroll",this.onScrollBodyScroll),e.addEventListener("scroll",this.onScrollBodyScroll)),e=(null==(e=t.querySelector(".ant-table-thead"))?void 0:e.offsetHeight)||0,r=(null==(r=t.querySelector(".ant-table-pagination"))?void 0:r.offsetHeight)||0,this.scrollY=t.clientHeight-(e+(r?r+32:0)))},columnSettingEffect:function(){var e,t,r,l=this,o=this.columnSetting||[],n=this.getTableColumns(this.$createElement).map(function(e,t){return tslib_1.__assign(tslib_1.__assign({},e),{sort:t,display:!0})});(null==o?void 0:o.length)!==n.length?this.columnSetting=n:(e=null==(e=null==o?void 0:o.map)?void 0:e.call(o,function(e){return e[l.getRowKey()]}),t=null==(t=null==n?void 0:n.map)?void 0:t.call(n,function(e){return e[l.getRowKey()]}),(null==e?void 0:e.toString())!==t.toString()&&(r=this.getRowKey()||"id",this.columnSetting=null==n?void 0:n.map(function(t){var e=null==o?void 0:o.find(function(e){return e[r]===t[r]});return tslib_1.__assign(tslib_1.__assign({},t),{display:!e||e.display})})))},onSearchPanelCollapseBefore:function(){},onSearchPanelCollapseAfter:function(){},onTableChange:function(t,r,l){this[this.getOrderFieldProp()]=l.field||this.getOrderFieldValue(),this[this.getOrderProp()]=l.order,this.$nextTick(function(){var e;l.order&&(this.fetchData(),null!=(e=this.onSubTableChange))&&e.call(this,t,r,l)})},onClear:function(){var e=this;return new Promise(function(t){e.page=1,e.limit=e.getLimit(),e.$nextTick(function(){var e=this;this.clear().then(function(){e.fetchData(),t()})})})},onScrollBodyScroll:function(){var e=this.getScrollBodyEl();this.getScrollHeaderEl().scrollLeft=null==e?void 0:e.scrollLeft},sortOrder:function(e){return this[this.getOrderFieldProp()]===e?this[this.getOrderProp()]:""},onCellConfigReducers:function(e){var r=this,l=e.rowIndex,t=e.column,o=e.record,n=e.columns;return this.$data.$cellConfigReducers.reduce(function(e,t){return e.value=t.call(r,{rowIndex:l,record:o,columns:n,column:e.value}),e},{value:t}).value},onRowConfigReducers:function(e){var r=this,l=e.rowIndex,o=e.record,n=e.columns;return this.$data.$rowConfigReducers.reduce(function(e,t){return e.value=t.call(r,{rowIndex:l,record:o,columns:n,rowConfig:e.value}),e},{value:{}}).value},onBodyConfigReducers:function(){var r=this;return this.$data.$bodyConfigReducers.reduce(function(e,t){return e.value=t.call(r,e.value),e},{value:{}}).value},onBody:function(){return{columns:this.getColumns(),bodyConfig:this.onBodyConfigReducers()}},onRow:function(t){var r=this,e=this.getData();if(e){var l,o=e.findIndex(function(e){return e[r.getRowKey()]===t});if(-1!==o)return{record:e=e[o],rowIndex:o,columns:l=this.getColumns(),rowKey:this.getRowKey(),rowConfig:this.onRowConfigReducers({rowIndex:Number(o),record:e,columns:l})}}},getLimit:function(){return 10},getPagination:function(){var r=this;return{onChange:function(e,t){r.page=e,r.limit=t,r.$nextTick(function(){this.fetchData()})},onShowSizeChange:function(e,t){r.page=e,r.limit=t,r.$nextTick(function(){this.fetchData()})},showTotal:function(e){return adherev_util_intl_1.default.tv("当前 {page}-{pageSize}/共 {total}条",{page:r.page,pageSize:r.limit,total:e})},total:this.getTotal(),current:this.page,pageSize:this.limit,showQuickJumper:!0}},getTableDensity:function(){return types_1.TableDensity.DEFAULT},getTableColumns:function(l){var o,n,i,a=this,e=this.isShowNumber(),t=this.getTableNumberColumnWidth(),s=this.getColumns().filter(function(e){var t;return!("$hide"in e&&!e.$hide)&&(!("$authorized"in e)||(null==(t=null==e?void 0:e.$authorized)?void 0:t.call(e)))}).map(function(e,n){var t={value:e};return t.value=function r(e){var t,l,o=e;return null!=(o="$resizable"in e&&null!=e&&e.$resizable?null==(l=null==(t=null==(t=null==a?void 0:a.$data)?void 0:t.$columnResizable)?void 0:t.searchTableResizableColumnItem)?void 0:l.call(t,a,n,e):o)&&o.children&&Array.isArray(o.children)&&o.children.forEach(function(e,t){o.children[t]=r(e)}),o}(e),t.value}).map(function(l){return tslib_1.__assign(tslib_1.__assign({},l),{customCell:function(e,t){var r=(0,lodash_clonedeep_1.default)(l);return{props:{rowIndex:t,record:e,column:a.onCellConfigReducers({rowIndex:t,column:r,record:e,columns:s}),columns:s}}}})});return e?(o=this.getNumberGeneratorRule()||SearchTable.NUMBER_GENERATOR_RULE_ALONE,e=this.page,n=void 0===e?0:e,e=this.limit,i=void 0===e?10:e,[tslib_1.__assign(tslib_1.__assign({},this.getTableNumberColumnProps&&this.getTableNumberColumnProps()||{}),{title:adherev_util_intl_1.default.tv("序号"),key:"_number",dataIndex:"_number",align:"center",width:t||80,customRender:function(e,t,r){return l(adherev_ui_conditionalrender_1.default,{attrs:{conditional:o===exports.NUMBER_GENERATOR_RULE_ALONE}},[l("span",{slot:"default"},[a.renderTableNumberColumn(l,r+1,{value:e,record:t,index:r})]),l("span",{slot:"noMatch"},[a.renderTableNumberColumn(l,(n-1)*i+(r+1),{value:e,record:t,index:r})])])}})].concat(s)):s},getTableBodyComponentReducers:function(){return this.$data.$tableBodyComponentReducers},getTableRowComponentReducers:function(){return this.$data.$tableRowComponentReducers},getTableCellComponentReducers:function(){return this.$data.$tableCellComponentReducers},getSortColumnSetting:function(){var e=tslib_1.__spreadArray([],this.columnSetting,!0);return e.sort(function(e,t){return e.sort>t.sort?1:e.sort<t.sort?-1:0}),e},getScrollHeaderEl:function(){var e=this.$refs.tableWrapRef;return null==e?void 0:e.querySelector(".ant-table-wrapper > .ant-spin-nested-loading > .ant-spin-container > .ant-table > .ant-table-content > .ant-table-scroll > .ant-table-header")},getScrollBodyEl:function(){var e=this.$refs.tableWrapRef;return null==e?void 0:e.querySelector(".ant-table-wrapper > .ant-spin-nested-loading > .ant-spin-container > .ant-table > .ant-table-content > .ant-table-scroll > .ant-table-body")},receiveDataMutation:function(e){var t=this.getServiceName(),r=this.getFetchListPropName(),l=this["".concat(t).concat(this.getFetchListPropNameToFirstUpper())];this["".concat(t,"ReceiveMutation")](((t={})[r]=tslib_1.__assign(tslib_1.__assign({},l),((r={})[this.getDataKey()]=e,r)),t))},renderTableNumberColumn:function(e,t,r){var l,o;return void 0===t&&(t=""),(null==(l=null==(o=this.$scopedSlots)?void 0:o.tableNumberColumn)?void 0:l.call(o,{context:null==(o=null==(l=this.getContext)?void 0:l.call(this))?void 0:o.context,number:t}))||e("span",[t])},renderColumnSetting:function(e){var t,r,l=tslib_1.__spreadArray([],this.columnSetting,!0);return l.sort(function(e,t){return e.sort>t.sort?1:e.sort<t.sort?-1:0}),(null==(t=null==(r=this.$scopedSlots)?void 0:r.columnSetting)?void 0:t.call(r,{context:null==(r=null==(t=this.getContext)?void 0:t.call(this))?void 0:r.context,columns:l}))||e(ColumnSetting_1.default)},renderTableDensitySetting:function(e){var t,r;return(null==(r=null==(t=this.$scopedSlots)?void 0:t.tableDensitySetting)?void 0:r.call(t,this))||e(TableDensitySetting_1.default,{attrs:{density:this.tableDensity}})},renderSearchFooter:function(r){var e,t=this,l=this.isShowExpandSearch,o=[r(ant_design_vue_1.Button,{class:"".concat(exports.selectorPrefix,"-searchfooteritem"),attrs:{type:"primary"},key:"search",on:{click:function(){t.page=1,t.$nextTick(function(){this.onSearch()})}}},[r("i",{class:(0,classnames_1.default)("".concat(exports.selectorPrefix,"-searchfooteritem-search-btn-icon"),"iconfont iconsousuo")}),adherev_util_intl_1.default.tv("查询")]),r(ant_design_vue_1.Button,{class:"".concat(exports.selectorPrefix,"-searchfooteritem"),key:"reset",on:{click:this.onClear}},[adherev_util_intl_1.default.tv("重置")])],l=(l&&o.push(r(adherev_ui_conditionalrender_1.default,{attrs:{conditional:this.expand}},[r("a",{slot:"noMatch",key:"expand",class:"".concat(exports.selectorPrefix,"-searchfooteritem-expand-search-up-btn"),on:{click:function(){t.onSearchPanelCollapseBefore&&t.onSearchPanelCollapseBefore(),t.expand=!0,t.$nextTick(function(){this.onSearchPanelCollapseAfter&&this.onSearchPanelCollapseAfter()})}}},[r("span",[adherev_util_intl_1.default.tv("展开")]),r("i",{class:"iconfont iconup"})]),r("a",{key:"hide",class:"".concat(exports.selectorPrefix,"-searchfooteritem-expand-search-down-btn"),on:{click:function(){t.onSearchPanelCollapseBefore&&t.onSearchPanelCollapseBefore(),t.expand=!1,t.$nextTick(function(){this.onSearchPanelCollapseAfter&&this.onSearchPanelCollapseAfter()})}}},[r("span",[adherev_util_intl_1.default.tv("关闭")]),r("i",{class:"iconfont icondownarrow"})])])),this.renderSearchFooterItems(r,o)||tslib_1.__spreadArray([],o,!0));return r("div",{class:"".concat(exports.selectorPrefix,"-searchfooterwrapper")},[(null==(e=null==(o=this.$scopedSlots)?void 0:o.searchFooter)?void 0:e.call(o,{context:null==(o=null==(e=this.getContext)?void 0:e.call(this))?void 0:o.context,items:l}))||l.map(function(e,t){return r("div",{key:t,class:"".concat(exports.selectorPrefix,"-searchfooteritem")},[e])})])},renderTable:function(e){if(null!=(l=this.$scopedSlots)&&l.table)return null==(r=null==(l=this.$scopedSlots)?void 0:l.table)?void 0:r.call(l,this);var t,r=this.antdTableProps,l=this.fixedHeaderAutoTable,o=tslib_1.__assign({},(null==(o=null==this?void 0:this.getScopedSlots)?void 0:o.call(this,e))||{}),n={},i={},a=r||{};for(t in a)t.startsWith("on")?i[t.substring(2).toLowerCase()]=a[t]:n[t]=a[t];var r=this.columnSetting,s=void 0===r?[]:r,r=this.tableDensity,u=this.getTableColumns(e).map(function(e,t){return tslib_1.__assign(tslib_1.__assign({},s[t]),e)}).filter(function(e){return e.display}),o=(u.sort(function(e,t){return e.sort>t.sort?1:e.sort<t.sort?-1:0}),{scopedSlots:o,props:tslib_1.__assign({ref:"antdTableRef",rowKey:this.getRowKey(),dataSource:this.getData(),columns:u,size:r,pagination:this.getPagination(),rowSelection:this.getRowSelection(),components:this.components},n||{}),on:tslib_1.__assign({change:this.onTableChange},i||{})});return l&&(u=this.scrollY,n&&n.scroll?o.props.scroll.y=u:o.props.scroll={y:u}),e(ant_design_vue_1.Table,(0,_babelHelperVueJsxMergeProps.default)([{},o]))},renderInner:function(e){var t,r,l,o,n,i,a,s,u,c;return null!=(t=this.$scopedSlots)&&t.inner?null==(c=null==(t=this.$scopedSlots)?void 0:t.inner)?void 0:c.call(t,this):(t=(c=this).className,r=c.wrapStyle,l=c.tableClassName,o=c.tableStyle,n=c.searchStyle,i=c.searchClassName,a=c.fitSearch,s=c.fitTable,u=c.autoFixed,c=c.fixedTableSpaceBetween,e(adherev_ui_flexlayout_1.default,{attrs:{direction:"vertical"},style:r||"",class:(0,classnames_1.default)(exports.selectorPrefix,c?"fixedtablespacebetween":"",t||"")},[e(Fixed,{class:(0,classnames_1.default)("".concat(exports.selectorPrefix,"-searchwrapper"),i||""),style:n||"",attrs:{fit:a}},[e(adherev_ui_flexlayout_1.default,{attrs:{direction:"vertical"}},[e(adherev_ui_conditionalrender_1.default,{attrs:{conditional:this.$scopedSlots.searchFormBefore||!!this.renderSearchFormBefore}},[e(Fixed,{slot:"default"},[(null==(c=null==(r=this.$scopedSlots)?void 0:r.searchFormBefore)?void 0:c.call(r,this))||this.renderSearchFormBefore(e)])]),e(Fixed,[e(adherev_ui_conditionalrender_1.default,{attrs:{conditional:this.expand}},[(null==(i=null==(t=this.$scopedSlots)?void 0:t.searchForm)?void 0:i.call(t,this))||this.renderSearchForm(e)])]),e(Fixed,[this.renderSearchFooter(e)]),e(adherev_ui_conditionalrender_1.default,{attrs:{conditional:this.$scopedSlots.searchFormAfter||!!this.renderSearchFormAfter}},[e(Fixed,{slot:"default"},[(null==(a=null==(n=this.$scopedSlots)?void 0:n.searchFormAfter)?void 0:a.call(n,this))||this.renderSearchFormAfter(e)])])])]),e(adherev_ui_conditionalrender_1.default,{attrs:{conditional:!!this.$scopedSlots.tableHeader||!!this.renderTableHeader}},[e(Fixed,{slot:"default"},[(null==(r=null==(c=this.$scopedSlots)?void 0:c.tableHeader)?void 0:r.call(c,this))||this.renderTableHeader(e)])]),e(Auto,{class:(0,classnames_1.default)("".concat(exports.selectorPrefix,"-autowrapper"),l||"",u?"autofixed":""),style:o||"",attrs:{fit:s,autoFixed:u}},[e("div",{ref:"tableWrapRef",class:"".concat(exports.selectorPrefix,"-tablewrapper")},[this.renderTable(e)])]),e(adherev_ui_conditionalrender_1.default,{attrs:{conditional:!!this.$scopedSlots.tableFooter||!!this.renderTableFooter}},[e(Fixed,{slot:"default"},[(null==(t=null==(i=this.$scopedSlots)?void 0:i.tableFooter)?void 0:t.call(i,this))||this.renderTableFooter(e)])])]))},renderSearchTable:function(e){var t,r;return(null==(r=null==(t=this.$scopedSlots)?void 0:t.searchTable)?void 0:r.call(t,this))||e("div",{class:"".concat(exports.selectorPrefix,"-wrap")},[this.$renderSuspense(e)])}},render:function(e){return this.renderSearchTable(e)}}));exports.default=SearchTable;
//# sourceMappingURL=SearchTable.js.map
