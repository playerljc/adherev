"use strict";var _vue=require("vue");function _isSlot(e){return"function"==typeof e||"[object Object]"===Object.prototype.toString.call(e)&&!(0,_vue.isVNode)(e)}require("core-js/modules/es.object.define-property.js"),require("core-js/modules/es.symbol.js"),require("core-js/modules/es.symbol.description.js"),require("core-js/modules/es.object.to-string.js"),require("core-js/modules/es.array.map.js"),require("core-js/modules/es.regexp.to-string.js"),require("core-js/modules/es.array.find.js"),require("core-js/modules/es.promise.js"),require("core-js/modules/es.array.reduce.js"),require("core-js/modules/es.array.find-index.js"),require("core-js/modules/es.number.constructor.js"),require("core-js/modules/es.array.filter.js"),require("core-js/modules/es.array.sort.js"),require("core-js/modules/es.array.concat.js"),require("core-js/modules/es.string.starts-with.js"),Object.defineProperty(exports,"__esModule",{value:!0}),exports.ROW_SELECTION_CONTINUOUS_MODE=exports.ROW_SELECTION_NORMAL_MODE=exports.NUMBER_GENERATOR_RULE_CONTINUITY=exports.NUMBER_GENERATOR_RULE_ALONE=exports.selectorPrefix=void 0;var tslib_1=require("tslib"),ant_design_vue_1=require("ant-design-vue"),classnames_1=tslib_1.__importDefault(require("classnames")),lodash_clonedeep_1=tslib_1.__importDefault(require("lodash.clonedeep")),vue_types_1=require("vue-types"),adherev_ui_conditionalrender_1=tslib_1.__importDefault(require("@baifendian/adherev-ui-conditionalrender")),adherev_ui_flexlayout_1=tslib_1.__importDefault(require("@baifendian/adherev-ui-flexlayout")),adherev_ui_suspense_1=tslib_1.__importDefault(require("@baifendian/adherev-ui-suspense")),adherev_util_1=tslib_1.__importDefault(require("@baifendian/adherev-util")),adherev_util_intl_1=tslib_1.__importDefault(require("@baifendian/adherev-util-intl")),adherev_util_mixins_1=tslib_1.__importDefault(require("@baifendian/adherev-util-mixins")),ColumnSetting_1=tslib_1.__importDefault(require("./Extension/ColumnSetting")),TableBody_1=tslib_1.__importDefault(require("./Extension/TableComponents/TableBody")),TableCell_1=tslib_1.__importDefault(require("./Extension/TableComponents/TableCell")),TableRow_1=tslib_1.__importDefault(require("./Extension/TableComponents/TableRow")),TableDensitySetting_1=tslib_1.__importDefault(require("./Extension/TableDensitySetting")),types_1=require("./types"),updatedEx=(exports.selectorPrefix="adherev-ui-searchtable",adherev_util_mixins_1.default.updatedEx),watchEffect=adherev_util_mixins_1.default.watchEffect,Fixed=adherev_ui_flexlayout_1.default.Fixed,Auto=adherev_ui_flexlayout_1.default.Auto,extend=adherev_util_1.default._util.extend,SearchTable=(exports.NUMBER_GENERATOR_RULE_ALONE=Symbol(),exports.NUMBER_GENERATOR_RULE_CONTINUITY=Symbol(),exports.ROW_SELECTION_NORMAL_MODE=Symbol(),exports.ROW_SELECTION_CONTINUOUS_MODE=Symbol(),extend({className:"SearchTable",mixins:[adherev_ui_suspense_1.default,updatedEx,watchEffect],props:{className:(0,vue_types_1.string)().def(""),wrapStyle:(0,vue_types_1.object)().def({}),tableClassName:(0,vue_types_1.string)().def(""),tableStyle:(0,vue_types_1.object)().def({}),searchClassName:(0,vue_types_1.string)().def(""),searchStyle:(0,vue_types_1.object)().def({}),reset:(0,vue_types_1.bool)().def(!0),antdTableProps:(0,vue_types_1.object)().def({}),isShowExpandSearch:(0,vue_types_1.bool)().def(!0),defaultExpandSearchCollapse:(0,vue_types_1.bool)().def(!0),fitSearch:(0,vue_types_1.bool)().def(!0),fitTable:(0,vue_types_1.bool)().def(!0),autoFixed:(0,vue_types_1.bool)().def(!0),fixedHeaderAutoTable:(0,vue_types_1.bool)().def(!1),fixedTableSpaceBetween:(0,vue_types_1.bool)().def(!1),showColumnSetting:(0,vue_types_1.bool)().def(!1)},scopedSlots:["searchFormBefore","searchFormAfter","searchForm","tableHeader","tableFooter","tableNumberColumn","columnSetting","tableDensitySetting","searchFooter","table","inner","searchTable"],data:function(){return{page:1,limit:10,expand:this.defaultExpandSearchCollapse,scrollY:0,columnSetting:[],tableDensity:types_1.TableDensity.DEFAULT,$columnObserver:null,$bodyConfigReducers:[],$rowConfigReducers:[],$cellConfigReducers:[],$tableBodyComponentReducers:[],$tableRowComponentReducers:[],$tableCellComponentReducers:[]}},computed:{components:function(){return{body:{wrapper:TableBody_1.default,row:TableRow_1.default,cell:TableCell_1.default}}}},provide:function(){return{getContext:this.getContext}},created:function(){var e,t=this.getColumns();this.$data.$tableBodyComponentReducers=(null==(e=this.onTableBodyComponentReducers)?void 0:e.call(this,t))||[],this.$data.$tableRowComponentReducers=(null==(e=this.onTableRowComponentReducers)?void 0:e.call(this,t))||[],this.$data.$tableCellComponentReducers=(null==(e=this.onTableCellComponentReducers)?void 0:e.call(this,t))||[],this.columnSetting=this.getTableColumns().map(function(e,t){return tslib_1.__assign(tslib_1.__assign({},e),{sort:t,display:!0})}),this.tableDensity=this.getTableDensity()},updatedEx:function(e){this.$refs.tableWrapRef&&this.fixedHeaderAutoTableEffectLayout(e)},watchEffect:function(){this.columnSettingEffect()},beforeUnmount:function(){var e;this.fixedHeaderAutoTable&&null!=(e=this.getScrollBodyEl())&&e.removeEventListener("scroll",this.onScrollBodyScroll)},methods:{getContext:function(){return{context:this}},fixedHeaderAutoTableEffectLayout:function(e){var t,r;this.fixedHeaderAutoTable&&(t=this.getData())&&t.length&&(0===e.scrollY&&0===this.scrollY||e.scrollY!==this.scrollY||e.expand!==this.expand)&&(t=this.$refs.tableWrapRef,(e=this.getScrollBodyEl())&&(e.removeEventListener("scroll",this.onScrollBodyScroll),e.addEventListener("scroll",this.onScrollBodyScroll)),e=(null==(e=t.querySelector(".ant-table-thead"))?void 0:e.offsetHeight)||0,r=(null==(r=t.querySelector(".ant-table-pagination"))?void 0:r.offsetHeight)||0,this.scrollY=t.clientHeight-(e+(r?r+32:0)))},columnSettingEffect:function(){var e,t,r,n=this,o=this.columnSetting||[],l=this.getTableColumns().map(function(e,t){return tslib_1.__assign(tslib_1.__assign({},e),{sort:t,display:!0})});(null==o?void 0:o.length)!==l.length?this.columnSetting=l:(e=null==(e=null==o?void 0:o.map)?void 0:e.call(o,function(e){return e[n.getRowKey()]}),t=null==(t=null==l?void 0:l.map)?void 0:t.call(l,function(e){return e[n.getRowKey()]}),(null==e?void 0:e.toString())!==t.toString()&&(r=this.getRowKey()||"id",this.columnSetting=null==l?void 0:l.map(function(t){var e=null==o?void 0:o.find(function(e){return e[r]===t[r]});return tslib_1.__assign(tslib_1.__assign({},t),{display:!e||e.display})})))},onSearchPanelCollapseBefore:function(){},onSearchPanelCollapseAfter:function(){},onTableChange:function(t,r,n){this[this.getOrderFieldProp()]=n.field||this.getOrderFieldValue(),this[this.getOrderProp()]=n.order,this.$nextTick(function(){var e;n.order&&(this.fetchData(),null!=(e=this.onSubTableChange)&&e.call(this,t,r,n))})},onResizeColumn:function(n,o){this.columnSetting=tslib_1.__spreadArray([],this.columnSetting,!0).map(function(e){return o.dataIndex===e.dataIndex?e.width=n:"children"in e&&Array.isArray(e.children)&&e.children.length&&function e(t){for(var r=0;r<t.length;r++){if(t[r].dataIndex===o.dataIndex){t[r].width=n;break}e(t[r].children||[])}}(e.children),e})},onClear:function(){var e=this;return new Promise(function(t){e.page=1,e.limit=e.getLimit(),e.$nextTick(function(){var e=this;this.clear().then(function(){e.fetchData(),t()})})})},onScrollBodyScroll:function(){var e=this.getScrollBodyEl();this.getScrollHeaderEl().scrollLeft=null==e?void 0:e.scrollLeft},sortOrder:function(e){return this[this.getOrderFieldProp()]===e?this[this.getOrderProp()]:""},onCellConfigReducers:function(e){var r=this,n=e.rowIndex,t=e.column,o=e.record,l=e.columns;return this.$data.$cellConfigReducers.reduce(function(e,t){return e.value=t.call(r,{rowIndex:n,record:o,columns:l,column:e.value}),e},{value:t}).value},onRowConfigReducers:function(e){var r=this,n=e.rowIndex,o=e.record,l=e.columns;return this.$data.$rowConfigReducers.reduce(function(e,t){return e.value=t.call(r,{rowIndex:n,record:o,columns:l,rowConfig:e.value}),e},{value:{}}).value},onBodyConfigReducers:function(){var r=this;return this.$data.$bodyConfigReducers.reduce(function(e,t){return e.value=t.call(r,e.value),e},{value:{}}).value},onBody:function(){return{columns:this.getColumns(),bodyConfig:this.onBodyConfigReducers()}},onRow:function(t){var r=this,e=this.getData();if(e){var n,o=e.findIndex(function(e){return e[r.getRowKey()]===t});if(-1!==o)return{record:e=e[o],rowIndex:o,columns:n=this.getColumns(),rowKey:this.getRowKey(),rowConfig:this.onRowConfigReducers({rowIndex:Number(o),record:e,columns:n})}}},getLimit:function(){return 10},getPagination:function(){var r=this;return{onChange:function(e,t){r.page=e,r.limit=t,r.$nextTick(function(){this.fetchData()})},onShowSizeChange:function(e,t){r.page=e,r.limit=t,r.$nextTick(function(){this.fetchData()})},showTotal:function(e){return adherev_util_intl_1.default.tv("当前 {page}-{pageSize}/共 {total}条",{page:r.page,pageSize:r.limit,total:e})},total:this.getTotal(),current:this.page,pageSize:this.limit,showQuickJumper:!0}},getTableDensity:function(){return types_1.TableDensity.DEFAULT},getTableColumns:function(){var o=this,e=this.isShowNumber(),t=this.getTableNumberColumnWidth(),l=this.getColumns().filter(function(e){var t;return!("$hide"in e&&!e.$hide)&&(!("$authorized"in e)||(null==(t=null==e?void 0:e.$authorized)?void 0:t.call(e)))}).map(function(n){return tslib_1.__assign(tslib_1.__assign({},n),{customCell:function(e,t){var r=(0,lodash_clonedeep_1.default)(n);return{rowIndex:t,record:e,column:o.onCellConfigReducers({rowIndex:t,column:r,record:e,columns:l}),columns:l}}})});return e?tslib_1.__spreadArray([tslib_1.__assign(tslib_1.__assign({},this.getTableNumberColumnProps&&this.getTableNumberColumnProps()||{}),{title:adherev_util_intl_1.default.tv("序号"),key:"_number",dataIndex:"_number",align:"center",width:t||80})],l,!0):l},getTableBodyComponentReducers:function(){return this.$data.$tableBodyComponentReducers},getTableRowComponentReducers:function(){return this.$data.$tableRowComponentReducers},getColumnByDataIndex:function(l){return function e(t){for(var r,n=0;n<t.length;n++){var o=t[n];if(o.dataIndex===l){r=o;break}if(r=e(o.children||[]))break}return r}(this.getTableColumns())},getTableCellComponentReducers:function(){return this.$data.$tableCellComponentReducers},getSortColumnSetting:function(){var e=tslib_1.__spreadArray([],this.columnSetting,!0);return e.sort(function(e,t){return e.sort>t.sort?1:e.sort<t.sort?-1:0}),e},getScrollHeaderEl:function(){var e=this.$refs.tableWrapRef;return null==e?void 0:e.querySelector(".ant-table-wrapper > .ant-spin-nested-loading > .ant-spin-container > .ant-table > .ant-table-container > .ant-table-header")},getScrollBodyEl:function(){var e=this.$refs.tableWrapRef;return null==e?void 0:e.querySelector(".ant-table-wrapper > .ant-spin-nested-loading > .ant-spin-container > .ant-table > .ant-table-container > .ant-table-body")},getBodyCellScopedSlotsInner:function(e){var t,r,n,o=this,l=e.record,i=e.index;return"_number"===e.column.dataIndex?(t=(0,this.getNumberGeneratorRule)()||exports.NUMBER_GENERATOR_RULE_ALONE,r=this.page,n=this.limit,(0,_vue.createVNode)(adherev_ui_conditionalrender_1.default,{conditional:t===exports.NUMBER_GENERATOR_RULE_ALONE},{default:function(){return(0,_vue.createVNode)("span",null,[o.renderTableNumberColumn(i+1,{record:e,index:i})])},noMatch:function(){return(0,_vue.createVNode)("span",null,[o.renderTableNumberColumn((r-1)*n+(i+1),{record:l,index:i})])}})):null==(t=null==this?void 0:this.getBodyCellScopedSlots)?void 0:t.call(this,e)},receiveDataMutation:function(e){var t=this.getServiceName(),r=this.getFetchListPropName(),n=this["".concat(t).concat(this.getFetchListPropNameToFirstUpper())];this["".concat(t,"ReceiveMutation")]({key:r,value:tslib_1.__assign(tslib_1.__assign({},n),((t={})[this.getDataKey()]=e,t))})},renderTableNumberColumn:function(e,t){var r,n;return void 0===e&&(e=""),(null==(r=null==(n=this.$slots)?void 0:n.tableNumberColumn)?void 0:r.call(n,{context:null==(n=null==(r=this.getContext)?void 0:r.call(this))?void 0:n.context,number:e}))||(0,_vue.createVNode)("span",null,[e])},renderColumnSetting:function(){var e,t,r=tslib_1.__spreadArray([],this.columnSetting,!0);return r.sort(function(e,t){return e.sort>t.sort?1:e.sort<t.sort?-1:0}),(null==(e=null==(t=this.$slots)?void 0:t.columnSetting)?void 0:e.call(t,{context:null==(t=null==(e=this.getContext)?void 0:e.call(this))?void 0:t.context,columns:r}))||(0,_vue.createVNode)(ColumnSetting_1.default,null,null)},renderTableDensitySetting:function(){var e,t;return(null==(t=null==(e=this.$slots)?void 0:e.tableDensitySetting)?void 0:t.call(e,this))||(0,_vue.createVNode)(TableDensitySetting_1.default,null,null)},renderSearchFooter:function(){var e,t,r=this,n=this.isShowExpandSearch,o=[(0,_vue.createVNode)(ant_design_vue_1.Button,{class:"".concat(exports.selectorPrefix,"-searchfooteritem"),type:"primary",key:"search",onClick:function(){r.page=1,r.$nextTick(function(){this.onSearch()})}},{default:function(){return[(0,_vue.createVNode)("i",{class:(0,classnames_1.default)("".concat(exports.selectorPrefix,"-searchfooteritem-search-btn-icon"),"iconfont iconsousuo")},null),adherev_util_intl_1.default.tv("查询")]}}),(0,_vue.createVNode)(ant_design_vue_1.Button,{class:"".concat(exports.selectorPrefix,"-searchfooteritem"),key:"reset",onClick:this.onClear},_isSlot(e=adherev_util_intl_1.default.tv("重置"))?e:{default:function(){return[e]}})],n=(n&&o.push((0,_vue.createVNode)(adherev_ui_conditionalrender_1.default,{conditional:this.expand},{default:function(){return(0,_vue.createVNode)("a",{key:"hide",class:"".concat(exports.selectorPrefix,"-searchfooteritem-expand-search-down-btn"),onClick:function(){r.onSearchPanelCollapseBefore&&r.onSearchPanelCollapseBefore(),r.expand=!1,r.$nextTick(function(){this.onSearchPanelCollapseAfter&&this.onSearchPanelCollapseAfter()})}},[(0,_vue.createVNode)("span",null,[adherev_util_intl_1.default.tv("关闭")]),(0,_vue.createVNode)("i",{class:"iconfont icondownarrow"},null)])},noMatch:function(){return(0,_vue.createVNode)("a",{key:"expand",class:"".concat(exports.selectorPrefix,"-searchfooteritem-expand-search-up-btn"),onClick:function(){r.onSearchPanelCollapseBefore&&r.onSearchPanelCollapseBefore(),r.expand=!0,r.$nextTick(function(){this.onSearchPanelCollapseAfter&&this.onSearchPanelCollapseAfter()})}},[(0,_vue.createVNode)("span",null,[adherev_util_intl_1.default.tv("展开")]),(0,_vue.createVNode)("i",{class:"iconfont iconup"},null)])}})),this.renderSearchFooterItems(o)||tslib_1.__spreadArray([],o,!0));return(0,_vue.createVNode)("div",{class:"".concat(exports.selectorPrefix,"-searchfooterwrapper")},[(null==(t=null==(o=this.$slots)?void 0:o.searchFooter)?void 0:t.call(o,{context:null==(o=null==(t=this.getContext)?void 0:t.call(this))?void 0:o.context,items:n}))||n.map(function(e,t){return(0,_vue.createVNode)("div",{key:t,class:"".concat(exports.selectorPrefix,"-searchfooteritem")},[e])})])},renderTable:function(){var n=this;if(null!=(r=this.$slots)&&r.table)return null==(t=null==(r=this.$slots)?void 0:r.table)?void 0:t.call(r,this);var e,t=this.antdTableProps,r=this.fixedHeaderAutoTable,o={},l={},i=t||{};for(e in i)e.startsWith("on")?l[e.substring(2).toLowerCase()]=i[e]:o[e]=i[e];var t=this.columnSetting,a=void 0===t?[]:t,t=this.tableDensity,s=this.getTableColumns().map(function(e,t){return tslib_1.__assign(tslib_1.__assign({},e),a[t])}).filter(function(e){return e.display}),s=(s.sort(function(e,t){return e.sort>t.sort?1:e.sort<t.sort?-1:0}),tslib_1.__assign(tslib_1.__assign({ref:"antdTableRef",rowKey:this.getRowKey(),dataSource:this.getData(),columns:s,size:t,pagination:this.getPagination(),rowSelection:this.getRowSelection(),components:this.components,change:this.onTableChange,onResizeColumn:this.onResizeColumn,customRow:function(e,t,r){return{record:e,rowIndex:t,column:r}}},o||{}),l||{}));return r&&(t=this.scrollY,o&&o.scroll?s.scroll.y=t:0!==t&&(s.scroll={y:t})),(0,_vue.createVNode)(ant_design_vue_1.Table,s,{bodyCell:function(e){return n.getBodyCellScopedSlotsInner(e)},customFilterDropdown:function(){for(var e,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return null==(e=null==n?void 0:n.getCustomFilterDropdown)?void 0:e.call.apply(e,tslib_1.__spreadArray([n],t,!1))},customFilterIcon:function(){for(var e,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return null==(e=null==n?void 0:n.getCustomFilterIcon)?void 0:e.call.apply(e,tslib_1.__spreadArray([n],t,!1))}})},renderInner:function(){var e,t,r,n,o,l,i,a,s,u,c,d=this,f=this;return null!=(t=this.$slots)&&t.inner?null==(c=null==(t=this.$slots)?void 0:t.inner)?void 0:c.call(t,this):(t=(c=this).className,r=c.wrapStyle,n=c.tableClassName,o=c.tableStyle,l=c.searchStyle,i=c.searchClassName,a=c.fitSearch,s=c.fitTable,u=c.autoFixed,c=c.fixedTableSpaceBetween,(0,_vue.createVNode)(adherev_ui_flexlayout_1.default,{direction:"vertical",style:r||"",class:(0,classnames_1.default)(exports.selectorPrefix,c?"fixedtablespacebetween":"",t||"")},{default:function(){return[(0,_vue.createVNode)(Fixed,{class:(0,classnames_1.default)("".concat(exports.selectorPrefix,"-searchwrapper"),i||""),style:l||"",fit:a},{default:function(){return[(0,_vue.createVNode)(adherev_ui_flexlayout_1.default,{direction:"vertical"},{default:function(){return[(0,_vue.createVNode)(adherev_ui_conditionalrender_1.default,{conditional:d.$slots.searchFormBefore||!!d.renderSearchFormBefore},{default:function(){var e,t;return(0,_vue.createVNode)(Fixed,null,{default:function(){return[(null==(t=null==(e=f.$slots)?void 0:e.searchFormBefore)?void 0:t.call(e,f))||f.renderSearchFormBefore()]}})}}),(0,_vue.createVNode)(Fixed,null,{default:function(){return[(0,_vue.createVNode)(adherev_ui_conditionalrender_1.default,{conditional:d.expand},{default:function(){var e,t;return(null==(t=null==(e=f.$slots)?void 0:e.searchForm)?void 0:t.call(e,f))||f.renderSearchForm()}})]}}),(0,_vue.createVNode)(Fixed,null,_isSlot(e=d.renderSearchFooter())?e:{default:function(){return[e]}}),(0,_vue.createVNode)(adherev_ui_conditionalrender_1.default,{conditional:d.$slots.searchFormAfter||!!d.renderSearchFormAfter},{default:function(){var e,t;return(0,_vue.createVNode)(Fixed,null,{default:function(){return[(null==(t=null==(e=f.$slots)?void 0:e.searchFormAfter)?void 0:t.call(e,f))||f.renderSearchFormAfter()]}})}})]}})]}}),(0,_vue.createVNode)(adherev_ui_conditionalrender_1.default,{conditional:!!d.$slots.tableHeader||!!d.renderTableHeader},{default:function(){var e,t;return(0,_vue.createVNode)(Fixed,null,{default:function(){return[(null==(t=null==(e=f.$slots)?void 0:e.tableHeader)?void 0:t.call(e,f))||f.renderTableHeader()]}})}}),(0,_vue.createVNode)(Auto,{class:(0,classnames_1.default)("".concat(exports.selectorPrefix,"-autowrapper"),n||"",u?"autofixed":""),style:o||"",fit:s,autoFixed:u},{default:function(){return[(0,_vue.createVNode)("div",{ref:"tableWrapRef",class:"".concat(exports.selectorPrefix,"-tablewrapper")},[d.renderTable()])]}}),(0,_vue.createVNode)(adherev_ui_conditionalrender_1.default,{conditional:!!d.$slots.tableFooter||!!d.renderTableFooter},{default:function(){var e,t;return(0,_vue.createVNode)(Fixed,null,{default:function(){return[(null==(t=null==(e=f.$slots)?void 0:e.tableFooter)?void 0:t.call(e,f))||f.renderTableFooter()]}})}})]}}))},renderSearchTable:function(){var e,t;return(null==(t=null==(e=this.$slots)?void 0:e.searchTable)?void 0:t.call(e,this))||(0,_vue.createVNode)("div",{class:"".concat(exports.selectorPrefix,"-wrap")},[this.$renderSuspense()])}},render:function(){return this.renderSearchTable()}}));exports.default=SearchTable;
//# sourceMappingURL=SearchTable.js.map
