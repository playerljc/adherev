{"version":3,"file":"popup.js","sources":["popup.js"],"sourcesContent":["import { v1 } from 'uuid';\nimport { createApp, h } from 'vue';\nvar selectorPrefix = 'adherev-ui-popup'; // @ts-ignore\n\nvar prePopup;\nvar maskEl;\nvar el = null;\n/**\n * Popup\n * @class Popup\n * @classdesc Popup\n */\n\nvar Popup =\n/** @class */\nfunction () {\n  /**\n   * constructor\n   * @param config {Object} - config\n   */\n  function Popup(config) {\n    this.id = '';\n    this.config = null;\n    this.isShow = false;\n    this.el = null;\n    this.popupEl = null;\n    this.popupInnerEl = null;\n    this.isShow = false;\n    this.el = PopupFactory.getEl();\n    this.id = v1();\n    this.config = config;\n    this.onMaskElTransitionend = this.onMaskElTransitionend.bind(this);\n    this.onInnerElTransitionend = this.onInnerElTransitionend.bind(this);\n    this.render();\n  }\n  /**\n   * createMask\n   */\n\n\n  Popup.prototype.createMask = function () {\n    var _a;\n\n    var zIndex = this.config.zIndex;\n    maskEl = document.createElement('div');\n    maskEl.className = \"\".concat(selectorPrefix, \"-mask\");\n    maskEl.style.zIndex = String((zIndex || 11000) - 1500);\n    (_a = this === null || this === void 0 ? void 0 : this.el) === null || _a === void 0 ? void 0 : _a.appendChild(maskEl);\n    maskEl.addEventListener('transitionend', this.onMaskElTransitionend);\n  };\n  /**\n   * render\n   */\n\n\n  Popup.prototype.render = function () {\n    var _a = this.config,\n        children = _a.children,\n        zIndex = _a.zIndex;\n    this.popupEl = document.createElement('div');\n    this.popupEl.addEventListener('transitionend', this.onInnerElTransitionend);\n    this.popupEl.className = selectorPrefix;\n    this.popupEl.style.zIndex = String(zIndex || 11000);\n    this.popupInnerEl = document.createElement('div');\n    this.popupEl.appendChild(this.popupInnerEl);\n    var self = this;\n    this.vm = createApp({\n      mounted: function mounted() {\n        var _a;\n\n        (_a = self === null || self === void 0 ? void 0 : self.el) === null || _a === void 0 ? void 0 : _a.appendChild(self.popupEl);\n        self.trigger('onCreate');\n      },\n      render: function render() {\n        return h(children);\n      }\n    }).mount(this.popupInnerEl);\n  };\n  /**\n   * trigger\n   * @param hookName\n   */\n\n\n  Popup.prototype.trigger = function (hookName) {\n    var config = this.config;\n    if (!config) return; // @ts-ignore\n\n    if (config[hookName]) {\n      // @ts-ignore\n      return config[hookName]();\n    }\n  };\n  /**\n   * show - 显示一个popup\n   * @return boolean\n   */\n\n\n  Popup.prototype.show = function () {\n    var _this = this;\n\n    if (!maskEl) {\n      this.createMask();\n    }\n\n    if (prePopup) {\n      prePopup.close();\n    }\n\n    maskEl.style.display = 'block';\n    this.popupEl.style.display = 'block';\n    this.isShow = true;\n    this.trigger('onBeforeShow');\n    setTimeout(function () {\n      maskEl.classList.add('modal-in');\n\n      _this.popupEl.classList.add('modal-in');\n    }, 100);\n    return true;\n  };\n  /**\n   * close - 关闭一个popup\n   * @return boolean\n   */\n\n\n  Popup.prototype.close = function () {\n    var _this = this;\n\n    if (!maskEl) {\n      this.createMask();\n    }\n\n    this.isShow = false;\n    var promise = this.trigger('onBeforeClose');\n\n    if (promise) {\n      promise.then(function () {\n        _this.popupEl.classList.remove('modal-in');\n\n        maskEl.classList.remove('modal-in');\n      });\n    } else {\n      this.popupEl.classList.remove('modal-in');\n      maskEl.classList.remove('modal-in');\n    }\n\n    return true;\n  };\n  /**\n   * destroy - 销毁一个popup\n   */\n\n\n  Popup.prototype.destroy = function () {\n    var _a, _b;\n\n    try {\n      this.vm.unmount();\n    } catch (err) {\n      (_b = (_a = this.popupEl) === null || _a === void 0 ? void 0 : _a.parentNode) === null || _b === void 0 ? void 0 : _b.removeChild(this.popupEl);\n    }\n\n    this.popupEl = null;\n    this.trigger('onDestroy');\n    return true;\n  };\n  /**\n   * isDestroy - 是否已经销毁\n   * @return {boolean}\n   */\n\n\n  Popup.prototype.isDestroy = function () {\n    return !this.popupEl;\n  };\n  /**\n   * getId\n   * @return {string} - id\n   */\n\n\n  Popup.prototype.getId = function () {\n    return this.id;\n  };\n  /**\n   * onInnerElTransitionend\n   */\n\n\n  Popup.prototype.onInnerElTransitionend = function () {\n    if (!this.isShow) {\n      prePopup = null;\n      this.popupEl.style.display = 'none';\n      this.trigger('onAfterClose');\n    } else {\n      prePopup = this;\n      this.trigger('onAfterShow');\n    }\n  };\n  /**\n   * onMaskElTransitionend\n   */\n\n\n  Popup.prototype.onMaskElTransitionend = function () {\n    if (!this.isShow) {\n      maskEl.style.display = 'none';\n    }\n  };\n\n  return Popup;\n}();\n\nexport { Popup };\n/**\n * PopupFactory\n */\n\nvar PopupFactory = {\n  /**\n   * create\n   * @param config\n   * @return Popup\n   */\n  create: function create(config) {\n    return new Popup(config);\n  },\n\n  /**\n   * show - 显示一个popup\n   * @param popup\n   * @return boolean\n   */\n  show: function show(popup) {\n    if (!popup) return false;\n    if (popup.isDestroy()) return false;\n    if (popup === prePopup) return false;\n    if (prePopup && popup.getId() === prePopup.getId()) return false;\n    return popup.show();\n  },\n\n  /**\n   * close - 关闭一个popup\n   * @param {Popup} popup\n   * @return boolean\n   */\n  close: function close(popup) {\n    if (!popup) return false;\n    if (popup.isDestroy()) return false;\n    return popup.close();\n  },\n\n  /**\n   * closeAll - 关闭所有\n   * @return boolean\n   */\n  closeAll: function closeAll() {\n    if (prePopup) {\n      return this.close(prePopup);\n    }\n\n    return false;\n  },\n\n  /**\n   * destroy - 销毁一个popup\n   * @param {Popup} popup\n   * @return bool\n   */\n  destroy: function destroy(popup) {\n    if (!popup) return false;\n    if (popup.isDestroy()) return false;\n    return popup.destroy();\n  },\n\n  /**\n   * getEl\n   * @return {HTMLElement}\n   */\n  getEl: function getEl() {\n    return el || document.body;\n  },\n\n  /**\n   * setEl\n   * @param tel\n   */\n  setEl: function setEl(tel) {\n    el = tel;\n  }\n};\nexport default PopupFactory;"],"names":["v1","createApp","h","prePopup","maskEl","selectorPrefix","el","Popup","config","this","id","isShow","popupEl","popupInnerEl","PopupFactory","getEl","onMaskElTransitionend","bind","onInnerElTransitionend","render","prototype","createMask","zIndex","document","createElement","className","concat","style","String","_a","appendChild","addEventListener","children","self","vm","mounted","trigger","mount","hookName","show","_this","close","display","setTimeout","classList","add","promise","then","remove","destroy","_b","unmount","err","parentNode","removeChild","isDestroy","getId","create","popup","closeAll","body","setEl","tel"],"mappings":"OAASA,qBACAC,UAAWC,YACpB,IAEIC,SACAC,OAHAC,eAAiB,mBAIjBC,GAAK,KAOLC,MAEJ,WAKE,SAASA,EAAMC,GACbC,KAAKC,GAAK,GACVD,KAAKD,OAAS,KACdC,KAAKE,QAAS,EACdF,KAAKH,GAAK,KACVG,KAAKG,QAAU,KACfH,KAAKI,aAAe,KACpBJ,KAAKE,QAAS,EACdF,KAAKH,GAAKQ,aAAaC,QACvBN,KAAKC,GAAKV,KACVS,KAAKD,OAASA,EACdC,KAAKO,sBAAwBP,KAAKO,sBAAsBC,KAAKR,MAC7DA,KAAKS,uBAAyBT,KAAKS,uBAAuBD,KAAKR,MAC/DA,KAAKU,SAmLP,OA5KAZ,EAAMa,UAAUC,WAAa,WAC3B,IAEIC,EAASb,KAAKD,OAAOc,QACzBlB,OAASmB,SAASC,cAAc,QACzBC,UAAY,GAAGC,OAAOrB,eAAgB,SAC7CD,OAAOuB,MAAML,OAASM,QAAQN,GAAU,MAAS,MACc,QAA9DO,EAAKpB,MAAAA,UAAmC,EAASA,KAAKH,UAAuB,IAAPuB,GAAyBA,EAAGC,YAAY1B,QAC/GA,OAAO2B,iBAAiB,gBAAiBtB,KAAKO,wBAOhDT,EAAMa,UAAUD,OAAS,WACvB,IAAIU,EAAKpB,KAAKD,OACVwB,EAAWH,EAAGG,SACdV,EAASO,EAAGP,OAOZW,GANJxB,KAAKG,QAAUW,SAASC,cAAc,OACtCf,KAAKG,QAAQmB,iBAAiB,gBAAiBtB,KAAKS,wBACpDT,KAAKG,QAAQa,UAAYpB,eACzBI,KAAKG,QAAQe,MAAML,OAASM,OAAON,GAAU,MAC7Cb,KAAKI,aAAeU,SAASC,cAAc,OAC3Cf,KAAKG,QAAQkB,YAAYrB,KAAKI,cACnBJ,MACXA,KAAKyB,GAAKjC,UAAU,CAClBkC,QAAS,WACP,IAAIN,EAE2D,QAA9DA,EAAKI,MAAAA,OAAmC,EAASA,EAAK3B,UAAuB,IAAPuB,GAAyBA,EAAGC,YAAYG,EAAKrB,SACpHqB,EAAKG,QAAQ,aAEfjB,OAAQ,WACN,OAAOjB,EAAE8B,MAEVK,MAAM5B,KAAKI,eAQhBN,EAAMa,UAAUgB,QAAU,SAAUE,GAClC,IAAI9B,EAASC,KAAKD,OAClB,GAAKA,EAEL,OAAIA,EAAO8B,GAEF9B,EAAO8B,UAFhB,GAWF/B,EAAMa,UAAUmB,KAAO,WACrB,IAAIC,EAAQ/B,KAmBZ,OAjBKL,QACHK,KAAKY,aAGHlB,UACFA,SAASsC,QAGXrC,OAAOuB,MAAMe,QAAU,QACvBjC,KAAKG,QAAQe,MAAMe,QAAU,QAC7BjC,KAAKE,QAAS,EACdF,KAAK2B,QAAQ,gBACbO,WAAW,WACTvC,OAAOwC,UAAUC,IAAI,YAErBL,EAAM5B,QAAQgC,UAAUC,IAAI,aAC3B,MACI,GAQTtC,EAAMa,UAAUqB,MAAQ,WACtB,IAAID,EAAQ/B,KAORqC,GALC1C,QACHK,KAAKY,aAGPZ,KAAKE,QAAS,EACAF,KAAK2B,QAAQ,kBAa3B,OAXIU,EACFA,EAAQC,KAAK,WACXP,EAAM5B,QAAQgC,UAAUI,OAAO,YAE/B5C,OAAOwC,UAAUI,OAAO,eAG1BvC,KAAKG,QAAQgC,UAAUI,OAAO,YAC9B5C,OAAOwC,UAAUI,OAAO,cAGnB,GAOTzC,EAAMa,UAAU6B,QAAU,WACxB,IAAQC,EAER,IACEzC,KAAKyB,GAAGiB,UACR,MAAOC,GAC2E,QAAjFF,EAA6B,QAAvBrB,EAAKpB,KAAKG,eAA4B,IAAPiB,OAAgB,EAASA,EAAGwB,kBAA+B,IAAPH,GAAyBA,EAAGI,YAAY7C,KAAKG,SAKzI,OAFAH,KAAKG,QAAU,KACfH,KAAK2B,QAAQ,cACN,GAQT7B,EAAMa,UAAUmC,UAAY,WAC1B,OAAQ9C,KAAKG,SAQfL,EAAMa,UAAUoC,MAAQ,WACtB,OAAO/C,KAAKC,IAOdH,EAAMa,UAAUF,uBAAyB,WAClCT,KAAKE,QAKRR,SAAWM,MACN2B,QAAQ,gBALbjC,SAAW,KACXM,KAAKG,QAAQe,MAAMe,QAAU,OAC7BjC,KAAK2B,QAAQ,kBAWjB7B,EAAMa,UAAUJ,sBAAwB,WACjCP,KAAKE,SACRP,OAAOuB,MAAMe,QAAU,SAIpBnC,EArMT,GA6MIO,aAAe,CAMjB2C,OAAQ,SAAgBjD,GACtB,OAAO,IAAID,MAAMC,IAQnB+B,KAAM,SAAcmB,GAClB,QAAKA,KACDA,EAAMH,cACNG,IAAUvD,aACVA,UAAYuD,EAAMF,UAAYrD,SAASqD,UACpCE,EAAMnB,WAQfE,MAAO,SAAeiB,GACpB,QAAKA,KACDA,EAAMH,aACHG,EAAMjB,UAOfkB,SAAU,WACR,QAAIxD,UACKM,KAAKgC,MAAMtC,WAWtB8C,QAAS,SAAiBS,GACxB,QAAKA,KACDA,EAAMH,aACHG,EAAMT,YAOflC,MAAO,WACL,OAAOT,IAAMiB,SAASqC,MAOxBC,MAAO,SAAeC,GACpBxD,GAAKwD,mBAGMhD,oBA9ENP"}