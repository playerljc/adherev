{"version":3,"file":"popup.js","sources":["popup.js"],"sourcesContent":["\"use strict\";\n\nrequire(\"core-js/modules/es.object.define-property.js\");\n\nvar __importDefault = void 0 && (void 0).__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar vue_1 = __importDefault(require(\"vue\"));\n\nvar uuid_1 = require(\"uuid\");\n\nvar selectorPrefix = 'adherev-ui-popup';\nvar prePopup;\nvar maskEl;\nvar el = null;\n/**\n * Popup\n * @class Popup\n * @classdesc Popup\n */\n\nvar Popup =\n/** @class */\nfunction () {\n  /**\n   * constructor\n   * @param config {Object} - config\n   */\n  function Popup(config) {\n    this.id = '';\n    this.config = null;\n    this.isShow = false;\n    this.el = null;\n    this.popupEl = null;\n    this.popupInnerEl = null;\n    this.isShow = false;\n    this.el = PopupFactory.getEl();\n    this.id = uuid_1.v1();\n    this.config = config;\n    this.onMaskElTransitionend = this.onMaskElTransitionend.bind(this);\n    this.onInnerElTransitionend = this.onInnerElTransitionend.bind(this);\n    this.render();\n  }\n  /**\n   * createMask\n   */\n\n\n  Popup.prototype.createMask = function () {\n    var zIndex = this.config.zIndex;\n    maskEl = document.createElement('div');\n    maskEl.className = selectorPrefix + \"-mask\";\n    maskEl.style.zIndex = String((zIndex || 11000) - 1500);\n    this.el.appendChild(maskEl);\n    maskEl.addEventListener('transitionend', this.onMaskElTransitionend);\n  };\n  /**\n   * render\n   */\n\n\n  Popup.prototype.render = function () {\n    var _a = this.config,\n        children = _a.children,\n        zIndex = _a.zIndex;\n    this.popupEl = document.createElement('div');\n    this.popupEl.addEventListener('transitionend', this.onInnerElTransitionend);\n    this.popupEl.className = selectorPrefix;\n    this.popupEl.style.zIndex = String(zIndex || 11000);\n    this.popupInnerEl = document.createElement('div');\n    this.popupEl.appendChild(this.popupInnerEl);\n    var self = this;\n    this.vm = new vue_1.default({\n      mounted: function mounted() {\n        self.el.appendChild(self.popupEl);\n        self.trigger('onCreate');\n      },\n      render: function render(h) {\n        return h(children);\n      }\n    });\n    this.vm.$mount(this.popupInnerEl);\n  };\n  /**\n   * trigger\n   * @param hookName\n   */\n\n\n  Popup.prototype.trigger = function (hookName) {\n    if (this.config[hookName]) {\n      return this.config[hookName]();\n    }\n  };\n  /**\n   * show - 显示一个popup\n   * @return boolean\n   */\n\n\n  Popup.prototype.show = function () {\n    var _this = this;\n\n    if (!maskEl) {\n      this.createMask();\n    }\n\n    if (prePopup) {\n      prePopup.close();\n    }\n\n    maskEl.style.display = 'block';\n    this.popupEl.style.display = 'block';\n    this.isShow = true;\n    this.trigger('onBeforeShow');\n    setTimeout(function () {\n      maskEl.classList.add('modal-in');\n\n      _this.popupEl.classList.add('modal-in');\n    }, 100);\n    return true;\n  };\n  /**\n   * close - 关闭一个popup\n   * @return boolean\n   */\n\n\n  Popup.prototype.close = function () {\n    var _this = this;\n\n    if (!maskEl) {\n      this.createMask();\n    }\n\n    this.isShow = false;\n    var promise = this.trigger('onBeforeClose');\n\n    if (promise) {\n      promise.then(function () {\n        _this.popupEl.classList.remove('modal-in');\n\n        maskEl.classList.remove('modal-in');\n      });\n    } else {\n      this.popupEl.classList.remove('modal-in');\n      maskEl.classList.remove('modal-in');\n    }\n\n    return true;\n  };\n  /**\n   * destroy - 销毁一个popup\n   */\n\n\n  Popup.prototype.destroy = function () {\n    this.vm.$destroy();\n    this.popupEl.parentNode.removeChild(this.popupEl);\n    this.popupEl = null;\n    this.trigger('onDestroy');\n    return true;\n  };\n  /**\n   * isDestroy - 是否已经销毁\n   * @return {boolean}\n   */\n\n\n  Popup.prototype.isDestroy = function () {\n    return !this.popupEl;\n  };\n  /**\n   * getId\n   * @return {string} - id\n   */\n\n\n  Popup.prototype.getId = function () {\n    return this.id;\n  };\n  /**\n   * onInnerElTransitionend\n   */\n\n\n  Popup.prototype.onInnerElTransitionend = function () {\n    if (!this.isShow) {\n      prePopup = null;\n      this.popupEl.style.display = 'none';\n      this.trigger('onAfterClose');\n    } else {\n      prePopup = this;\n      this.trigger('onAfterShow');\n    }\n  };\n  /**\n   * onMaskElTransitionend\n   */\n\n\n  Popup.prototype.onMaskElTransitionend = function () {\n    if (!this.isShow) {\n      maskEl.style.display = 'none';\n    }\n  };\n\n  return Popup;\n}();\n/**\n * PopupFactory\n */\n\n\nvar PopupFactory = {\n  /**\n   * create\n   * @param config\n   * @return Popup\n   */\n  create: function create(config) {\n    return new Popup(config);\n  },\n\n  /**\n   * show - 显示一个popup\n   * @param popup\n   * @return boolean\n   */\n  show: function show(popup) {\n    if (!popup) return false;\n    if (popup.isDestroy()) return false;\n    if (popup === prePopup) return false;\n    if (prePopup && popup.getId() === prePopup.getId()) return false;\n    return popup.show();\n  },\n\n  /**\n   * close - 关闭一个popup\n   * @param {Popup} popup\n   * @return boolean\n   */\n  close: function close(popup) {\n    if (!popup) return false;\n    if (popup.isDestroy()) return false;\n    return popup.close();\n  },\n\n  /**\n   * closeAll - 关闭所有\n   * @return boolean\n   */\n  closeAll: function closeAll() {\n    if (prePopup) {\n      return this.close(prePopup);\n    }\n\n    return false;\n  },\n\n  /**\n   * destroy - 销毁一个popup\n   * @param {Popup} popup\n   * @return bool\n   */\n  destroy: function destroy(popup) {\n    if (!popup) return false;\n    if (popup.isDestroy()) return false;\n    return popup.destroy();\n  },\n\n  /**\n   * getEl\n   * @return {HTMLElement}\n   */\n  getEl: function getEl() {\n    return el || document.body;\n  },\n\n  /**\n   * setEl\n   * @param tel\n   */\n  setEl: function setEl(tel) {\n    el = tel;\n  }\n};\nexports.default = PopupFactory;"],"names":["require","__importDefault","mod","__esModule","default","Object","defineProperty","exports","value","prePopup","maskEl","vue_1","uuid_1","selectorPrefix","el","Popup","config","this","id","isShow","popupEl","popupInnerEl","PopupFactory","getEl","v1","onMaskElTransitionend","bind","onInnerElTransitionend","render","prototype","createMask","zIndex","document","createElement","className","style","String","appendChild","addEventListener","_a","children","self","vm","mounted","trigger","h","$mount","hookName","show","_this","close","display","setTimeout","classList","add","promise","then","remove","destroy","$destroy","parentNode","removeChild","isDestroy","getId","create","popup","closeAll","body","setEl","tel"],"mappings":"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"}