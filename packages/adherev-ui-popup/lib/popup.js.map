{"version":3,"file":"popup.js","sources":["popup.js"],"sourcesContent":["\"use strict\";\n\nrequire(\"core-js/modules/es.object.define-property.js\");\n\nrequire(\"core-js/modules/es.object.to-string.js\");\n\nrequire(\"core-js/modules/es.array.find-index.js\");\n\nrequire(\"core-js/modules/es.array.splice.js\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Popup = void 0;\n\nvar tslib_1 = require(\"tslib\");\n\nvar uuid_1 = require(\"uuid\");\n\nvar vue_1 = tslib_1.__importDefault(require(\"vue\"));\n\nvar selectorPrefix = 'adherev-ui-popup';\nvar prePopup = null;\nvar popups = [];\nvar maskEl;\nvar el = null;\nvar globalConfig;\n/**\n * Popup\n * @class Popup\n * @classdesc Popup\n */\n\nvar Popup =\n/** @class */\nfunction () {\n  /**\n   * constructor\n   * @param config {Object} - config\n   */\n  function Popup(config) {\n    this.id = '';\n    this.config = null;\n    this.isShow = false;\n    this.el = null;\n    this.popupEl = null;\n    this.popupInnerEl = null;\n    this.isShow = false;\n    this.el = PopupFactory.getEl();\n    this.id = uuid_1.v1();\n    this.config = config;\n    this.onInnerElTransitionend = this.onInnerElTransitionend.bind(this);\n    this.render();\n  }\n  /**\n   * createMask\n   */\n\n\n  Popup.prototype.createMask = function () {\n    var _a; // @ts-ignore\n\n\n    var zIndex = this.config.zIndex;\n    maskEl = document.createElement('div');\n    maskEl.className = selectorPrefix + \"-mask\";\n    maskEl.style.zIndex = String((zIndex || 11000) - 1500);\n    (_a = this === null || this === void 0 ? void 0 : this.el) === null || _a === void 0 ? void 0 : _a.appendChild(maskEl);\n  };\n  /**\n   * render\n   */\n\n\n  Popup.prototype.render = function () {\n    // @ts-ignore\n    var _a = this.config,\n        children = _a.children,\n        zIndex = _a.zIndex;\n    this.popupEl = document.createElement('div');\n    this.popupEl.addEventListener('transitionend', this.onInnerElTransitionend);\n    this.popupEl.className = selectorPrefix;\n    this.popupEl.style.zIndex = String(zIndex || 11000);\n    this.popupInnerEl = document.createElement('div');\n    this.popupEl.appendChild(this.popupInnerEl);\n    var self = this;\n    this.vm = new vue_1.default(tslib_1.__assign(tslib_1.__assign({}, globalConfig || {}), {\n      mounted: function mounted() {\n        var _a;\n\n        (_a = self === null || self === void 0 ? void 0 : self.el) === null || _a === void 0 ? void 0 : _a.appendChild(self.popupEl);\n        self.trigger('onCreate');\n      },\n      render: function render(h) {\n        return h(children);\n      }\n    }));\n    this.vm.$mount(this.popupInnerEl);\n  };\n  /**\n   * trigger\n   * @param hookName\n   */\n\n\n  Popup.prototype.trigger = function (hookName) {\n    // @ts-ignore\n    if (this.config[hookName]) {\n      // @ts-ignore\n      return this.config[hookName]();\n    }\n  };\n  /**\n   * show - 显示一个popup\n   * @return boolean\n   */\n\n\n  Popup.prototype.show = function () {\n    var _this = this;\n\n    if (!maskEl) {\n      this.createMask();\n    } // if (prePopup) {\n    //   prePopup.close();\n    // }\n\n\n    maskEl.style.display = 'block';\n    this.popupEl.style.display = 'block';\n    this.isShow = true;\n    this.trigger('onBeforeShow');\n    setTimeout(function () {\n      maskEl.classList.add('modal-in');\n\n      _this.popupEl.classList.add('modal-in');\n    }, 100);\n    return true;\n  };\n  /**\n   * show - 显示一个popup\n   * @return boolean\n   */\n\n\n  Popup.prototype.showClosePrePopup = function () {\n    var _this = this;\n\n    if (!maskEl) {\n      this.createMask();\n    }\n\n    if (prePopup) {\n      prePopup.close();\n    }\n\n    maskEl.style.display = 'block';\n    this.popupEl.style.display = 'block';\n    this.isShow = true;\n    this.trigger('onBeforeShow');\n    setTimeout(function () {\n      maskEl.classList.add('modal-in');\n\n      _this.popupEl.classList.add('modal-in');\n    }, 100);\n    return true;\n  };\n  /**\n   * close - 关闭一个popup\n   * @return boolean\n   */\n\n\n  Popup.prototype.close = function () {\n    var _this = this;\n\n    var _a;\n\n    if (!maskEl) {\n      this.createMask();\n    }\n\n    this.isShow = false;\n    var promise = this.trigger('onBeforeClose'); // @ts-ignore\n\n    if (promise) {\n      promise.then(function () {\n        var _a;\n\n        (_a = _this.popupEl) === null || _a === void 0 ? void 0 : _a.classList.remove('modal-in');\n        maskEl.classList.remove('modal-in');\n      });\n    } else {\n      (_a = this.popupEl) === null || _a === void 0 ? void 0 : _a.classList.remove('modal-in');\n      maskEl.classList.remove('modal-in');\n    }\n\n    return true;\n  };\n  /**\n   * destroy - 销毁一个popup\n   */\n\n\n  Popup.prototype.destroy = function () {\n    var _a, _b; // @ts-ignore\n\n\n    this.vm.$destroy();\n    (_b = (_a = this.popupEl) === null || _a === void 0 ? void 0 : _a.parentNode) === null || _b === void 0 ? void 0 : _b.removeChild(this.popupEl);\n    this.popupEl = null;\n    this.trigger('onDestroy');\n    return true;\n  };\n  /**\n   * isDestroy - 是否已经销毁\n   * @return {boolean}\n   */\n\n\n  Popup.prototype.isDestroy = function () {\n    return !this.popupEl;\n  };\n  /**\n   * getId\n   * @return {string} - id\n   */\n\n\n  Popup.prototype.getId = function () {\n    return this.id;\n  };\n  /**\n   * onInnerElTransitionend\n   */\n\n\n  Popup.prototype.onInnerElTransitionend = function () {\n    if (!this.isShow) {\n      prePopup = null;\n      this.popupEl.style.display = 'none';\n      maskEl.style.display = 'none';\n      this.trigger('onAfterClose');\n    } else {\n      prePopup = this;\n      this.trigger('onAfterShow');\n    }\n  };\n\n  return Popup;\n}();\n\nexports.Popup = Popup;\n/**\n * PopupFactory\n */\n\nvar PopupFactory = {\n  /**\n   * setConfig\n   * @param gc\n   */\n  setConfig: function setConfig(gc) {\n    globalConfig = gc;\n  },\n\n  /**\n   * create\n   * @param config\n   * @return Popup\n   */\n  create: function create(config) {\n    var ins = new Popup(config);\n    popups.push(ins);\n    return ins;\n  },\n\n  /**\n   * show - 显示一个popup\n   * @param popup\n   * @return boolean\n   */\n  show: function show(popup) {\n    if (!popup) return false;\n    if (popup.isDestroy()) return false;\n    if (popup === prePopup) return false;\n    if (prePopup && popup.getId() === prePopup.getId()) return false;\n    return popup.show();\n  },\n\n  /**\n   * showClosePrePopup\n   * @description 关闭之前的显示\n   * @param popup\n   * @return boolean\n   */\n  showClosePrePopup: function showClosePrePopup(popup) {\n    if (!popup) return false;\n    if (popup.isDestroy()) return false;\n    if (popup === prePopup) return false;\n    if (prePopup && popup.getId() === prePopup.getId()) return false;\n\n    if (prePopup) {\n      prePopup.close();\n    }\n\n    return popup.show();\n  },\n\n  /**\n   * close - 关闭一个popup\n   * @param {Popup} popup\n   * @return boolean\n   */\n  close: function close(popup) {\n    if (!popup) return false;\n    if (popup.isDestroy()) return false;\n    return popup.close();\n  },\n\n  /**\n   * closeAll - 关闭所有\n   * @return boolean\n   */\n  closeAll: function closeAll() {\n    var _this = this;\n\n    var flags = [];\n    popups.forEach(function (p) {\n      var flag = _this.close(p);\n\n      flags.push(flag);\n    });\n    return flags.every(function (flag) {\n      return flag;\n    });\n  },\n\n  /**\n   * destroy - 销毁一个popup\n   * @param {Popup} popup\n   * @return bool\n   */\n  destroy: function destroy(popup) {\n    if (!popup) return false;\n    if (popup.isDestroy()) return false;\n    var res = popup.destroy();\n\n    if (res) {\n      var index = popups.findIndex(function (p) {\n        return p === popup;\n      });\n\n      if (index !== -1) {\n        popups.splice(index, 1);\n      }\n    }\n\n    return res;\n  },\n\n  /**\n   * getEl\n   * @return {HTMLElement}\n   */\n  getEl: function getEl() {\n    return el || document.body;\n  },\n\n  /**\n   * setEl\n   * @param tel\n   */\n  setEl: function setEl(tel) {\n    el = tel;\n  }\n};\nexports.default = PopupFactory;"],"names":["require","Object","defineProperty","exports","value","Popup","maskEl","globalConfig","tslib_1","uuid_1","vue_1","__importDefault","selectorPrefix","prePopup","popups","el","config","this","id","isShow","popupEl","popupInnerEl","PopupFactory","getEl","v1","onInnerElTransitionend","bind","render","prototype","createMask","zIndex","document","createElement","className","style","String","_a","appendChild","children","addEventListener","self","vm","default","__assign","mounted","trigger","h","$mount","hookName","show","_this","display","setTimeout","classList","add","showClosePrePopup","close","promise","then","remove","destroy","_b","$destroy","parentNode","removeChild","isDestroy","getId","setConfig","gc","create","ins","push","popup","closeAll","flags","forEach","p","flag","every","index","res","findIndex","splice","body","setEl","tel"],"mappings":"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"}