{"version":3,"file":"popup.js","sources":["popup.js"],"sourcesContent":["\"use strict\";\n\nrequire(\"core-js/modules/es.object.define-property.js\");\nrequire(\"core-js/modules/es.object.to-string.js\");\nrequire(\"core-js/modules/es.array.find-index.js\");\nrequire(\"core-js/modules/es.array.splice.js\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Popup = void 0;\nvar uuid_1 = require(\"uuid\");\nvar vue_1 = require(\"vue\");\nvar selectorPrefix = 'adherev-ui-popup';\nvar prePopup = null;\nvar popups = [];\nvar maskEl;\nvar el = null;\n/**\n * Popup\n * @class Popup\n * @classdesc Popup\n */\nvar Popup = /** @class */function () {\n  /**\n   * constructor\n   * @param config {Object} - config\n   */\n  function Popup(config) {\n    this.id = '';\n    this.config = null;\n    this.isShow = false;\n    this.el = null;\n    this.popupEl = null;\n    this.popupInnerEl = null;\n    this.isShow = false;\n    this.el = PopupFactory.getEl();\n    this.id = (0, uuid_1.v1)();\n    this.config = config;\n    this.onInnerElTransitionend = this.onInnerElTransitionend.bind(this);\n    this.render();\n  }\n  /**\n   * createMask\n   */\n  Popup.prototype.createMask = function () {\n    var _a;\n    var zIndex = this.config.zIndex;\n    maskEl = document.createElement('div');\n    maskEl.className = \"\".concat(selectorPrefix, \"-mask\");\n    maskEl.style.zIndex = String((zIndex || 11000) - 1500);\n    (_a = this === null || this === void 0 ? void 0 : this.el) === null || _a === void 0 ? void 0 : _a.appendChild(maskEl);\n  };\n  /**\n   * render\n   */\n  Popup.prototype.render = function () {\n    var _a;\n    var _b = this.config,\n      children = _b.children,\n      zIndex = _b.zIndex;\n    this.popupEl = document.createElement('div');\n    this.popupEl.addEventListener('transitionend', this.onInnerElTransitionend);\n    this.popupEl.className = selectorPrefix;\n    this.popupEl.style.zIndex = String(zIndex || 11000);\n    this.popupInnerEl = document.createElement('div');\n    this.popupEl.appendChild(this.popupInnerEl);\n    var self = this;\n    this.vm = (0, vue_1.createApp)({\n      mounted: function mounted() {\n        var _a;\n        (_a = self === null || self === void 0 ? void 0 : self.el) === null || _a === void 0 ? void 0 : _a.appendChild(self.popupEl);\n        self.trigger('onCreate');\n      },\n      render: function render() {\n        return (0, vue_1.h)(children);\n      }\n    });\n    if (globalConfig) (_a = globalConfig === null || globalConfig === void 0 ? void 0 : globalConfig.beforeMount) === null || _a === void 0 ? void 0 : _a.call(globalConfig, this.vm);\n    this.vm.mount(this.popupInnerEl);\n  };\n  /**\n   * trigger\n   * @param hookName\n   */\n  Popup.prototype.trigger = function (hookName) {\n    var config = this.config;\n    if (!config) return;\n    if (config[hookName]) {\n      return config[hookName]();\n    }\n  };\n  /**\n   * show - 显示一个popup\n   * @return boolean\n   */\n  Popup.prototype.show = function () {\n    var _this = this;\n    if (!maskEl) {\n      this.createMask();\n    }\n    // if (prePopup) {\n    //   prePopup.close();\n    // }\n    maskEl.style.display = 'block';\n    this.popupEl.style.display = 'block';\n    this.isShow = true;\n    this.trigger('onBeforeShow');\n    setTimeout(function () {\n      maskEl.classList.add('modal-in');\n      _this.popupEl.classList.add('modal-in');\n    }, 100);\n    return true;\n  };\n  /**\n   * show - 显示一个popup\n   * @return boolean\n   */\n  Popup.prototype.showClosePrePopup = function () {\n    var _this = this;\n    if (!maskEl) {\n      this.createMask();\n    }\n    if (prePopup) {\n      prePopup.close();\n    }\n    maskEl.style.display = 'block';\n    this.popupEl.style.display = 'block';\n    this.isShow = true;\n    this.trigger('onBeforeShow');\n    setTimeout(function () {\n      maskEl.classList.add('modal-in');\n      _this.popupEl.classList.add('modal-in');\n    }, 100);\n    return true;\n  };\n  /**\n   * close - 关闭一个popup\n   * @return boolean\n   */\n  Popup.prototype.close = function () {\n    var _this = this;\n    if (!maskEl) {\n      this.createMask();\n    }\n    this.isShow = false;\n    var promise = this.trigger('onBeforeClose');\n    if (promise) {\n      promise.then(function () {\n        _this.popupEl.classList.remove('modal-in');\n        maskEl.classList.remove('modal-in');\n      });\n    } else {\n      this.popupEl.classList.remove('modal-in');\n      maskEl.classList.remove('modal-in');\n    }\n    return true;\n  };\n  /**\n   * destroy - 销毁一个popup\n   */\n  Popup.prototype.destroy = function () {\n    var _a, _b;\n    try {\n      this.vm.unmount();\n    } catch (err) {\n      (_b = (_a = this.popupEl) === null || _a === void 0 ? void 0 : _a.parentNode) === null || _b === void 0 ? void 0 : _b.removeChild(this.popupEl);\n    }\n    this.popupEl = null;\n    this.trigger('onDestroy');\n    return true;\n  };\n  /**\n   * isDestroy - 是否已经销毁\n   * @return {boolean}\n   */\n  Popup.prototype.isDestroy = function () {\n    return !this.popupEl;\n  };\n  /**\n   * getId\n   * @return {string} - id\n   */\n  Popup.prototype.getId = function () {\n    return this.id;\n  };\n  /**\n   * onInnerElTransitionend\n   */\n  Popup.prototype.onInnerElTransitionend = function () {\n    if (!this.isShow) {\n      prePopup = null;\n      this.popupEl.style.display = 'none';\n      maskEl.style.display = 'none';\n      this.trigger('onAfterClose');\n    } else {\n      prePopup = this;\n      this.trigger('onAfterShow');\n    }\n  };\n  return Popup;\n}();\nexports.Popup = Popup;\nvar globalConfig = null;\n/**\n * PopupFactory\n */\nvar PopupFactory = {\n  /**\n   * create\n   * @param config\n   * @return Popup\n   */\n  create: function create(config) {\n    var ins = new Popup(config);\n    popups.push(ins);\n    return ins;\n  },\n  /**\n   * show - 显示一个popup\n   * @param popup\n   * @return boolean\n   */\n  show: function show(popup) {\n    if (!popup) return false;\n    if (popup.isDestroy()) return false;\n    if (popup === prePopup) return false;\n    if (prePopup && popup.getId() === prePopup.getId()) return false;\n    return popup.show();\n  },\n  /**\n   * showClosePrePopup\n   * @description 关闭之前的显示\n   * @param popup\n   * @return boolean\n   */\n  showClosePrePopup: function showClosePrePopup(popup) {\n    if (!popup) return false;\n    if (popup.isDestroy()) return false;\n    if (popup === prePopup) return false;\n    if (prePopup && popup.getId() === prePopup.getId()) return false;\n    if (prePopup) {\n      prePopup.close();\n    }\n    return popup.show();\n  },\n  /**\n   * close - 关闭一个popup\n   * @param {Popup} popup\n   * @return boolean\n   */\n  close: function close(popup) {\n    if (!popup) return false;\n    if (popup.isDestroy()) return false;\n    return popup.close();\n  },\n  /**\n   * closeAll - 关闭所有\n   * @return boolean\n   */\n  closeAll: function closeAll() {\n    var _this = this;\n    var flags = [];\n    popups.forEach(function (p) {\n      var flag = _this.close(p);\n      flags.push(flag);\n    });\n    return flags.every(function (flag) {\n      return flag;\n    });\n  },\n  /**\n   * destroy - 销毁一个popup\n   * @param {Popup} popup\n   * @return bool\n   */\n  destroy: function destroy(popup) {\n    if (!popup) return false;\n    if (popup.isDestroy()) return false;\n    var res = popup.destroy();\n    if (res) {\n      var index = popups.findIndex(function (p) {\n        return p === popup;\n      });\n      if (index !== -1) {\n        popups.splice(index, 1);\n      }\n    }\n    return res;\n  },\n  /**\n   * getEl\n   * @return {HTMLElement}\n   */\n  getEl: function getEl() {\n    return el || document.body;\n  },\n  /**\n   * setEl\n   * @param tel\n   */\n  setEl: function setEl(tel) {\n    el = tel;\n  },\n  setConfig: function setConfig(config) {\n    globalConfig = config;\n  }\n};\nexports.default = PopupFactory;"],"names":["require","Object","defineProperty","exports","value","Popup","maskEl","uuid_1","vue_1","selectorPrefix","prePopup","popups","el","config","this","id","isShow","popupEl","popupInnerEl","PopupFactory","getEl","v1","onInnerElTransitionend","bind","render","prototype","createMask","zIndex","document","createElement","className","concat","style","String","_a","appendChild","_b","children","self","addEventListener","vm","createApp","mounted","trigger","h","globalConfig","beforeMount","call","mount","hookName","show","_this","display","setTimeout","classList","add","showClosePrePopup","close","promise","then","remove","destroy","unmount","err","parentNode","removeChild","isDestroy","getId","create","ins","push","popup","closeAll","flags","forEach","p","flag","every","res","index","findIndex","splice","body","setEl","tel","setConfig","default"],"mappings":"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"}