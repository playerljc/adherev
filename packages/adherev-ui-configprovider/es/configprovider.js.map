{"version":3,"file":"configprovider.js","sources":["configprovider.js"],"sourcesContent":["import { defineComponent, onMounted, ref, watch, nextTick } from 'vue';\nimport { object } from 'vue-types';\nimport debounce from 'lodash.debounce';\nimport Hooks from '@baifendian/adherev-ui-hooks';\nimport Intl from '@baifendian/adherev-util-intl';\nimport Mixins from '@baifendian/adherev-util-mixins';\nimport Resource from '@baifendian/adherev-util-resource';\nexport var configProviderProps = {\n  intl: object().def(function () {\n    return {\n      lang: 'zh_CN',\n      locales: {},\n      prefix: 'local',\n      mainLanguage: 'zh_CN'\n    };\n  })\n};\nvar forceUpdate = Mixins.forceUpdate;\nvar useForceUpdate = Hooks.useForceUpdate;\nvar ConfigProvider = defineComponent({\n  name: 'adv-configprovider',\n  mixins: [forceUpdate],\n  props: configProviderProps,\n  emits: ['intlInit', 'propsChange'],\n  setup: function setup(props, _a) {\n    var slots = _a.slots,\n      emit = _a.emit;\n    var isIntlInit = ref(false);\n    var $forceUpdate = useForceUpdate();\n    var propsChangeHandler = debounce(function () {\n      emit('propsChange');\n    }, 200);\n    var init = function init() {\n      return Intl.init({\n        prefix: props.intl.prefix || 'local',\n        currentLocale: props.intl.lang,\n        locales: props.intl.locales || {},\n        mainLanguage: props.intl.mainLanguage || 'zh_CN'\n      }, Intl.isInit()).then(function () {\n        Resource.Dict.value.LocalsMoment.value[props.intl.lang]();\n        if (!isIntlInit.value) {\n          isIntlInit.value = true;\n          nextTick(function () {\n            emit('intlInit');\n          });\n        } else {\n          $forceUpdate();\n          nextTick(propsChangeHandler);\n        }\n      });\n    };\n    watch([function () {\n      return props.intl.lang;\n    }, function () {\n      return props.intl.locales;\n    }, function () {\n      return props.intl.prefix;\n    }, function () {\n      return props.intl.mainLanguage;\n    }], function () {\n      return init();\n    });\n    onMounted(function () {\n      return init();\n    });\n    return function () {\n      var _a;\n      return isIntlInit.value ? (_a = slots === null || slots === void 0 ? void 0 : slots.default) === null || _a === void 0 ? void 0 : _a.call(slots) : null;\n    };\n  }\n});\nexport default ConfigProvider;"],"names":["defineComponent","onMounted","ref","watch","nextTick","object","debounce","Hooks","Intl","Mixins","Resource","configProviderProps","intl","def","lang","locales","prefix","mainLanguage","forceUpdate","useForceUpdate","ConfigProvider","name","mixins","props","emits","setup","_a","init","currentLocale","isInit","then","Dict","value","LocalsMoment","isIntlInit","$forceUpdate","propsChangeHandler","emit","slots","default","call"],"mappings":"OAASA,gBAAiBC,UAAWC,IAAKC,MAAOC,QAAqB,KAAL,aACxDC,MAAyB,KAAX,mBAChBC,aAAc,yBACdC,UAAW,sCACXC,SAAU,uCACVC,WAAY,yCACZC,aAAc,oCACd,IAAIC,oBAAsB,CAC/BC,KAAMP,OAAO,EAAEQ,IAAI,WACjB,MAAO,CACLC,KAAM,QACNC,QAAS,GACTC,OAAQ,QACRC,aAAc,OAChB,CACF,CAAC,CACH,EACIC,YAAcT,OAAOS,YACrBC,eAAiBZ,MAAMY,eACvBC,eAAiBpB,gBAAgB,CACnCqB,KAAM,qBACNC,OAAQ,CAACJ,aACTK,MAAOZ,oBACPa,MAAO,CAAC,WAAY,eACpBC,MAAO,SAAeF,EAAOG,GAQhB,SAAPC,IACF,OAAOnB,KAAKmB,KAAK,CACfX,OAAQO,EAAMX,KAAKI,QAAU,QAC7BY,cAAeL,EAAMX,KAAKE,KAC1BC,QAASQ,EAAMX,KAAKG,SAAW,GAC/BE,aAAcM,EAAMX,KAAKK,cAAgB,OAC3C,EAAGT,KAAKqB,OAAO,CAAC,EAAEC,KAAK,WACrBpB,SAASqB,KAAKC,MAAMC,aAAaD,MAAMT,EAAMX,KAAKE,MAAM,EACnDoB,EAAWF,OAMdG,EAAa,EACb/B,SAASgC,CAAkB,IAN3BF,EAAWF,MAAQ,CAAA,EACnB5B,SAAS,WACPiC,EAAK,UAAU,CACjB,CAAC,EAKL,CAAC,CACH,CAzBA,IAAIC,EAAQZ,EAAGY,MACbD,EAAOX,EAAGW,KACRH,EAAahC,IAAI,CAAA,CAAK,EACtBiC,EAAehB,eAAe,EAC9BiB,EAAqB9B,SAAS,WAChC+B,EAAK,aAAa,CACpB,EAAG,GAAG,EAkCN,OAdAlC,MAAM,CAAC,WACL,OAAOoB,EAAMX,KAAKE,IACpB,EAAG,WACD,OAAOS,EAAMX,KAAKG,OACpB,EAAG,WACD,OAAOQ,EAAMX,KAAKI,MACpB,EAAG,WACD,OAAOO,EAAMX,KAAKK,YACpB,GACSU,CACR,EACD1B,UACS0B,CACR,EACM,WACL,IAAID,EACJ,OAAOQ,EAAWF,MAAQ,OAACN,EAAKY,MAAAA,EAAqC,KAAA,EAASA,EAAMC,SAAqC,KAAA,EAASb,EAAGc,KAAKF,CAAK,EAAI,IACrJ,CACF,CACF,CAAC,iBACclB,sBAhEJT,mBAgEkB"}