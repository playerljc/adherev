{"version":3,"file":"bmap.js","sources":["bmap.js"],"sourcesContent":["\"use strict\";\n\nrequire(\"core-js/modules/es.object.define-property.js\");\n\nrequire(\"core-js/modules/es.number.constructor.js\");\n\nrequire(\"core-js/modules/es.object.to-string.js\");\n\nrequire(\"core-js/modules/es.promise.js\");\n\nrequire(\"core-js/modules/es.array.index-of.js\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar tslib_1 = require(\"tslib\");\n\nvar adherev_ui_conditionalrender_1 = tslib_1.__importDefault(require(\"@baifendian/adherev-ui-conditionalrender\"));\n\nvar selectorPrefix = 'adhere-ui-bmap';\nvar loadGridIcon = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAYAAADDPmHLAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAUdJREFUeNrs2sENwyAQRcE4ckf0RBv04Z7ck30wFXBi/4wU5bScXhQk9hhj9B+xzu/7WjijvZ/b/Jbz/e83kE0AAkAACAABIAAEgAAQAAJAAAgAAVDYfA5ui+eY33R+BuA9PXO++QtwB0AACAABIAAEgAAQAAJAAAgAASAAqrIPED5vH8A+AO4ACAABIAAEgAAQAAJAAAgAASAABEBJ9gHC5+0D2AfAHQABIAAEgAAQAAJAAAgAASAABIAAKMk+QPi8fQD7ALgDIAAEgAAQAAJAAAgAASAABIAAEAAl2QcIn7cPYB8AdwAEgAAQAAJAAAgAASAABIAAEAACoCT7AOHz9gHsA+AOgAAQAAJAAAgAASAABIAAEAACQACUZB8gfN4+gH0A3AEQAAJAAAgAASAABIAAEAACQABUNV8D++I5nmM3nX8EGADa0U/2xPbBVwAAAABJRU5ErkJggg==';\nexports.default = {\n  name: 'adv-bmap',\n  props: {\n    ak: {\n      type: String,\n      default: 'bxFuXXDt1oKdlgu6mXCCnK51cDgDGBLp'\n    },\n    zoom: {\n      type: Number,\n      default: 5\n    },\n    center: {\n      type: Object,\n      default: function _default() {\n        return {\n          lon: 116.404,\n          lat: 39.915\n        };\n      }\n    },\n    config: {\n      type: Object,\n      default: function _default() {\n        return {\n          minZoom: 2,\n          maxZoom: 20,\n          enableHighResolution: true,\n          enableAutoResize: true,\n          enableMapClick: false\n        };\n      }\n    },\n    // onBMapInitReady: {\n    //   type: Function,\n    // },\n    // onBMapScriptReady: {\n    //   type: Function,\n    // },\n    externalImportBMapScript: {\n      type: Boolean,\n      default: false\n    }\n  },\n  data: function data() {\n    return {\n      isReady: false,\n      $BMap: null,\n      $map: null,\n      $isLoad: false\n    };\n  },\n  methods: {\n    importBMapJS: function importBMapJS() {\n      var _this = this;\n\n      function importReal(src) {\n        return new Promise(function (resolve) {\n          var _a;\n\n          var script = document.createElement('script');\n\n          script.onload = function () {\n            // @ts-ignore\n            resolve(window.BMap);\n          };\n\n          script.src = src;\n          (_a = document.querySelector('head')) === null || _a === void 0 ? void 0 : _a.appendChild(script);\n        });\n      }\n\n      return new Promise(function (resolve) {\n        var _a;\n\n        var preWrite = document.write;\n\n        document.write = function (html) {\n          var _a;\n\n          var el = document.createElement('div');\n          el.innerHTML = html;\n          var first = el.firstElementChild;\n\n          if ((first === null || first === void 0 ? void 0 : first.tagName.toLowerCase()) === 'script' && ((_a = first === null || first === void 0 ? void 0 : first.getAttribute('src')) === null || _a === void 0 ? void 0 : _a.indexOf('http://api.map.baidu.com')) !== -1) {\n            importReal(first.getAttribute('src')).then(function (res) {\n              resolve(res);\n            });\n          } else {\n            preWrite(html);\n          }\n        };\n\n        var script = document.createElement('script');\n        script.src = \"http://api.map.baidu.com/api?v=3.0&ak=\" + _this.props.ak;\n        (_a = document === null || document === void 0 ? void 0 : document.querySelector('head')) === null || _a === void 0 ? void 0 : _a.appendChild(script);\n      });\n    },\n    initMap: function initMap() {\n      var _this = this;\n\n      var $BMap = this.$data.$BMap;\n\n      var _a = this,\n          config = _a.config,\n          zoom = _a.zoom,\n          center = _a.center;\n\n      this.$data.$map = new $BMap.Map(this.$refs.ref, tslib_1.__assign({\n        enableMapClick: false\n      }, config));\n      this.initMapControl();\n      this.$data.$map.centerAndZoom(new $BMap.Point(center === null || center === void 0 ? void 0 : center.lon, center === null || center === void 0 ? void 0 : center.lat), zoom);\n      this.$data.$map.addEventListener('tilesloaded', function () {\n        var _a;\n\n        if (_this.$data.$isLoad) return;\n        _this.$data.$isLoad = true;\n        var logoEl = document.querySelector('.anchorBL');\n        logoEl && ((_a = logoEl === null || logoEl === void 0 ? void 0 : logoEl.parentElement) === null || _a === void 0 ? void 0 : _a.removeChild(logoEl));\n        setTimeout(function () {\n          var _a, _b, _c; // @ts-ignore\n\n\n          (_c = (_b = (_a = _this === null || _this === void 0 ? void 0 : _this.$refs) === null || _a === void 0 ? void 0 : _a.ref) === null || _b === void 0 ? void 0 : _b.style) === null || _c === void 0 ? void 0 : _c.background = \"url(\\\"\" + loadGridIcon + \"\\\") repeat #fff;\";\n        }, 2000);\n      });\n      this.$emit('onBMapInitReady');\n    },\n    initMapControl: function initMapControl() {\n      var _a = this.$data,\n          $BMap = _a.$BMap,\n          $map = _a.$map; // 添加比例尺控件\n\n      $map.addControl(new $BMap.NavigationControl()); //开启鼠标滚轮缩放\n\n      $map.enableScrollWheelZoom(true); // this.map.disableScrollWheelZoom();\n      // this.map.disableDoubleClickZoom();\n      // this.map.disableKeyboard();\n      // this.map.disableContinuousZoom();\n      // this.map.disableAutoResize();\n    },\n    getMap: function getMap() {\n      return this.$data.$map;\n    }\n  },\n  mounted: function mounted() {\n    var _this = this;\n\n    var externalImportBMapScript = this.externalImportBMapScript; // 外部载入bmap.js\n\n    if (externalImportBMapScript) {\n      // @ts-ignore\n      this.$data.$BMap = window.BMap;\n      this.isReady = true;\n      this.$nextTick(function () {\n        _this.initMap();\n      });\n    } // 内部引入bmap.js\n    else {\n      this.importBMapJS().then(function (BMap) {\n        _this.$data.$BMap = BMap; // @ts-ignore\n\n        window.BMap = BMap;\n\n        _this.$emit('onBMapScriptReady');\n\n        _this.isReady = true;\n\n        _this.$nextTick(function () {\n          _this.initMap();\n        });\n      });\n    }\n  },\n  render: function render(h) {\n    var isReady = this.isReady;\n    return h(adherev_ui_conditionalrender_1.default, {\n      \"attrs\": {\n        \"conditional\": isReady\n      }\n    }, [h(\"div\", {\n      \"class\": selectorPrefix,\n      \"ref\": \"ref\"\n    }), h(\"div\", {\n      \"slot\": \"noMatch\"\n    }, [\"loading\"])]);\n  }\n};"],"names":["require","Object","defineProperty","exports","value","tslib_1","adherev_ui_conditionalrender_1","__importDefault","selectorPrefix","loadGridIcon","default","name","props","ak","type","String","zoom","Number","center","lon","lat","config","minZoom","maxZoom","enableHighResolution","enableAutoResize","enableMapClick","externalImportBMapScript","Boolean","data","isReady","$BMap","$map","$isLoad","methods","importBMapJS","_this","this","Promise","resolve","_a","preWrite","document","write","html","el","createElement","innerHTML","src","first","firstElementChild","tagName","toLowerCase","getAttribute","indexOf","script","onload","window","BMap","querySelector","appendChild","then","res","initMap","$data","Map","$refs","ref","__assign","initMapControl","centerAndZoom","Point","addEventListener","logoEl","parentElement","removeChild","setTimeout","_c","_b","style","background","$emit","addControl","NavigationControl","enableScrollWheelZoom","getMap","mounted","$nextTick","render","h","attrs","conditional","class","slot"],"mappings":"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"}