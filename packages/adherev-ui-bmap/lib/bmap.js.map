{"version":3,"file":"bmap.js","sources":["bmap.js"],"sourcesContent":["\"use strict\";\n\nvar _vue = require(\"vue\");\nrequire(\"core-js/modules/es.object.define-property.js\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nvar tslib_1 = require(\"tslib\");\nvar vue_1 = require(\"vue\");\nvar vue_types_1 = require(\"vue-types\");\nvar adherev_ui_conditionalrender_1 = tslib_1.__importDefault(require(\"@baifendian/adherev-ui-conditionalrender\"));\nvar selectorPrefix = 'adhere-ui-bmap';\nvar loadGridIcon = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAYAAADDPmHLAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAUdJREFUeNrs2sENwyAQRcE4ckf0RBv04Z7ck30wFXBi/4wU5bScXhQk9hhj9B+xzu/7WjijvZ/b/Jbz/e83kE0AAkAACAABIAAEgAAQAAJAAAgAAVDYfA5ui+eY33R+BuA9PXO++QtwB0AACAABIAAEgAAQAAJAAAgAASAAqrIPED5vH8A+AO4ACAABIAAEgAAQAAJAAAgAASAABEBJ9gHC5+0D2AfAHQABIAAEgAAQAAJAAAgAASAABIAAKMk+QPi8fQD7ALgDIAAEgAAQAAJAAAgAASAABIAAEAAl2QcIn7cPYB8AdwAEgAAQAAJAAAgAASAABIAAEAACoCT7AOHz9gHsA+AOgAAQAAJAAAgAASAABIAAEAACQACUZB8gfN4+gH0A3AEQAAJAAAgAASAABIAAEAACQABUNV8D++I5nmM3nX8EGADa0U/2xPbBVwAAAABJRU5ErkJggg==';\nvar props = {\n  ak: (0, vue_types_1.string)().def('bxFuXXDt1oKdlgu6mXCCnK51cDgDGBLp'),\n  zoom: (0, vue_types_1.number)().def(5),\n  center: (0, vue_types_1.object)().def(function () {\n    return {\n      lon: 116.404,\n      lat: 39.915\n    };\n  }).isRequired,\n  config: (0, vue_types_1.object)().def(function () {\n    return {\n      minZoom: 2,\n      maxZoom: 20,\n      enableHighResolution: true,\n      enableAutoResize: true,\n      enableMapClick: false\n    };\n  }),\n  externalImportBMapScript: (0, vue_types_1.bool)().def(false)\n};\nexports.default = (0, vue_1.defineComponent)({\n  name: 'adv-bmap',\n  props: props,\n  emits: ['bMapInitReady'],\n  setup: function setup(props, _a) {\n    var emit = _a.emit,\n      expose = _a.expose;\n    var root = (0, vue_1.ref)(null);\n    var isReady = false;\n    var BMap;\n    var map;\n    var isLoad = false;\n    // const importBMapJS = () => {\n    //   function importReal(src: string | null) {\n    //     return new Promise<any>((resolve) => {\n    //       const script = document.createElement('script');\n    //\n    //       script.onload = () => {\n    //         resolve((window as any).BMap);\n    //       };\n    //       if (typeof src === 'string') {\n    //         script.src = src;\n    //       }\n    //\n    //       if (document) {\n    //         document.querySelector('head')?.appendChild(script);\n    //       }\n    //     });\n    //   }\n    //\n    //   return new Promise((resolve) => {\n    //     const preWrite = document.write;\n    //\n    //     document.write = (html) => {\n    //       const el = document.createElement('div');\n    //       el.innerHTML = html;\n    //       const first = el.firstElementChild;\n    //\n    //       if (\n    //         first?.tagName.toLowerCase() === 'script' &&\n    //         first?.getAttribute('src')?.indexOf('http://api.map.baidu.com') !== -1\n    //       ) {\n    //         importReal(first.getAttribute('src')).then((res) => {\n    //           resolve(res);\n    //         });\n    //       } else {\n    //         preWrite(html);\n    //       }\n    //     };\n    //\n    //     const script = document.createElement('script');\n    //     script.src = `http://api.map.baidu.com/api?v=3.0&ak=${props.ak}`;\n    //     document?.querySelector('head')?.appendChild(script);\n    //   });\n    // };\n    var initMap = function initMap() {\n      var _a, _b;\n      map = new BMap.Map(root.value, tslib_1.__assign(tslib_1.__assign({}, props.config), {\n        enableMapClick: false\n      }));\n      initMapControl();\n      map.centerAndZoom(new BMap.Point((_a = props.center) === null || _a === void 0 ? void 0 : _a.lon, (_b = props.center) === null || _b === void 0 ? void 0 : _b.lat), props.zoom);\n      map.addEventListener('tilesloaded', function () {\n        var _a;\n        if (isLoad) return;\n        isLoad = true;\n        var logoEl = document.querySelector('.anchorBL');\n        logoEl && ((_a = logoEl === null || logoEl === void 0 ? void 0 : logoEl.parentElement) === null || _a === void 0 ? void 0 : _a.removeChild(logoEl));\n        setTimeout(function () {\n          root.value.style.background = \"url(\\\"\".concat(loadGridIcon, \"\\\") repeat #fff;\");\n        }, 2000);\n      });\n      emit('bMapInitReady');\n    };\n    var initMapControl = function initMapControl() {\n      // 添加比例尺控件\n      map.addControl(new BMap.NavigationControl());\n      //开启鼠标滚轮缩放\n      map.enableScrollWheelZoom(true);\n      // this.map.disableScrollWheelZoom();\n      // this.map.disableDoubleClickZoom();\n      // this.map.disableKeyboard();\n      // this.map.disableContinuousZoom();\n      // this.map.disableAutoResize();\n    };\n\n    var getMap = function getMap() {\n      return map;\n    };\n    expose({\n      getMap: getMap\n    });\n    (0, vue_1.onMounted)(function () {\n      // 外部载入bmap.js\n      // if (props.externalImportBMapScript) {\n      //   BMap = (window as any).BMap;\n      //\n      //   isReady = true;\n      //\n      //   nextTick(() => {\n      //     initMap();\n      //   });\n      // }\n      // // 内部引入bmap.js\n      // else {\n      //   importBMapJS().then((BMap) => {\n      //     BMap = BMap;\n      //\n      //     (window as any).BMap = BMap;\n      //\n      //     emit('onBMapScriptReady');\n      //\n      //     isReady = true;\n      //\n      //     nextTick(() => {\n      //       initMap();\n      //     });\n      //   });\n      // }\n      // @ts-ignore\n      BMap = window.BMap;\n      isReady = true;\n      (0, vue_1.nextTick)(function () {\n        initMap();\n      });\n    });\n    return function () {\n      return (// @ts-ignore\n        (0, _vue.createVNode)(adherev_ui_conditionalrender_1.default, {\n          \"conditional\": isReady\n        }, {\n          default: function _default() {\n            return (0, _vue.createVNode)(\"div\", {\n              \"class\": selectorPrefix,\n              \"ref\": root\n            }, null);\n          },\n          noMatch: function noMatch() {\n            return (0, _vue.createVNode)(\"div\", null, [(0, _vue.createTextVNode)(\"loading\")]);\n          }\n        })\n      );\n    };\n  }\n});"],"names":["_vue","require","tslib_1","Object","defineProperty","exports","value","vue_1","vue_types_1","adherev_ui_conditionalrender_1","__importDefault","selectorPrefix","loadGridIcon","props","ak","string","def","zoom","number","center","object","lon","lat","isRequired","config","minZoom","maxZoom","enableHighResolution","enableAutoResize","enableMapClick","externalImportBMapScript","bool","default","defineComponent","name","emits","setup","_a","initMapControl","map","addControl","BMap","NavigationControl","enableScrollWheelZoom","emit","expose","root","ref","isReady","isLoad","getMap","onMounted","window","nextTick","_b","Map","__assign","centerAndZoom","Point","addEventListener","logoEl","document","querySelector","parentElement","removeChild","setTimeout","style","background","concat","createVNode","conditional","class","noMatch","createTextVNode"],"mappings":"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"}