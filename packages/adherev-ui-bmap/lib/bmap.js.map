{"version":3,"file":"bmap.js","sources":["bmap.js"],"sourcesContent":["\"use strict\";\n\nrequire(\"core-js/modules/es.object.define-property.js\");\n\nrequire(\"core-js/modules/es.number.constructor.js\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar tslib_1 = require(\"tslib\");\n\nvar adherev_ui_conditionalrender_1 = tslib_1.__importDefault(require(\"@baifendian/adherev-ui-conditionalrender\"));\n\nvar selectorPrefix = 'adhere-ui-bmap';\nvar loadGridIcon = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAYAAADDPmHLAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAUdJREFUeNrs2sENwyAQRcE4ckf0RBv04Z7ck30wFXBi/4wU5bScXhQk9hhj9B+xzu/7WjijvZ/b/Jbz/e83kE0AAkAACAABIAAEgAAQAAJAAAgAAVDYfA5ui+eY33R+BuA9PXO++QtwB0AACAABIAAEgAAQAAJAAAgAASAAqrIPED5vH8A+AO4ACAABIAAEgAAQAAJAAAgAASAABEBJ9gHC5+0D2AfAHQABIAAEgAAQAAJAAAgAASAABIAAKMk+QPi8fQD7ALgDIAAEgAAQAAJAAAgAASAABIAAEAAl2QcIn7cPYB8AdwAEgAAQAAJAAAgAASAABIAAEAACoCT7AOHz9gHsA+AOgAAQAAJAAAgAASAABIAAEAACQACUZB8gfN4+gH0A3AEQAAJAAAgAASAABIAAEAACQABUNV8D++I5nmM3nX8EGADa0U/2xPbBVwAAAABJRU5ErkJggg==';\nexports.default = {\n  name: 'adv-bmap',\n  props: {\n    ak: {\n      type: String,\n      default: 'bxFuXXDt1oKdlgu6mXCCnK51cDgDGBLp'\n    },\n    zoom: {\n      type: Number,\n      default: 5\n    },\n    center: {\n      type: Object,\n      default: function _default() {\n        return {\n          lon: 116.404,\n          lat: 39.915\n        };\n      }\n    },\n    config: {\n      type: Object,\n      default: function _default() {\n        return {\n          minZoom: 2,\n          maxZoom: 20,\n          enableHighResolution: true,\n          enableAutoResize: true,\n          enableMapClick: false\n        };\n      }\n    },\n    // onBMapInitReady: {\n    //   type: Function,\n    // },\n    // onBMapScriptReady: {\n    //   type: Function,\n    // },\n    externalImportBMapScript: {\n      type: Boolean,\n      default: false\n    }\n  },\n  data: function data() {\n    return {\n      isReady: false,\n      $BMap: null,\n      $map: null,\n      $isLoad: false\n    };\n  },\n  methods: {\n    // importBMapJS() {\n    //   function importReal(src) {\n    //     return new Promise((resolve) => {\n    //       const script = document.createElement('script');\n    //       script.onload = () => {\n    //         // @ts-ignore\n    //         resolve(window.BMap);\n    //       };\n    //       script.src = src;\n    //       document.querySelector('head')?.appendChild(script);\n    //     });\n    //   }\n    //\n    //   return new Promise((resolve) => {\n    //     const preWrite = document.write;\n    //\n    //     document.write = (html) => {\n    //       const el = document.createElement('div');\n    //       el.innerHTML = html;\n    //       const first = el.firstElementChild;\n    //\n    //       if (\n    //         first?.tagName.toLowerCase() === 'script' &&\n    //         first?.getAttribute('src')?.indexOf('http://api.map.baidu.com') !== -1\n    //       ) {\n    //         importReal(first.getAttribute('src')).then((res) => {\n    //           resolve(res);\n    //         });\n    //       } else {\n    //         preWrite(html);\n    //       }\n    //     };\n    //\n    //     const script = document.createElement('script');\n    //     script.src = `http://api.map.baidu.com/api?v=3.0&ak=${this.props.ak}`;\n    //     document?.querySelector('head')?.appendChild(script);\n    //   });\n    // },\n    initMap: function initMap() {\n      var _this = this;\n\n      var $BMap = this.$data.$BMap;\n\n      var _a = this,\n          config = _a.config,\n          zoom = _a.zoom,\n          center = _a.center;\n\n      this.$data.$map = new $BMap.Map(this.$refs.ref, tslib_1.__assign({\n        enableMapClick: false\n      }, config));\n      this.initMapControl();\n      this.$data.$map.centerAndZoom(new $BMap.Point(center === null || center === void 0 ? void 0 : center.lon, center === null || center === void 0 ? void 0 : center.lat), zoom);\n      this.$data.$map.addEventListener('tilesloaded', function () {\n        var _a;\n\n        if (_this.$data.$isLoad) return;\n        _this.$data.$isLoad = true;\n        var logoEl = document.querySelector('.anchorBL');\n        logoEl && ((_a = logoEl === null || logoEl === void 0 ? void 0 : logoEl.parentElement) === null || _a === void 0 ? void 0 : _a.removeChild(logoEl));\n        setTimeout(function () {\n          _this.$refs.ref.style.background = \"url(\\\"\" + loadGridIcon + \"\\\") repeat #fff;\";\n        }, 2000);\n      });\n      this.$emit('onBMapInitReady');\n    },\n    initMapControl: function initMapControl() {\n      var _a = this.$data,\n          $BMap = _a.$BMap,\n          $map = _a.$map; // 添加比例尺控件\n\n      $map.addControl(new $BMap.NavigationControl()); //开启鼠标滚轮缩放\n\n      $map.enableScrollWheelZoom(true); // this.map.disableScrollWheelZoom();\n      // this.map.disableDoubleClickZoom();\n      // this.map.disableKeyboard();\n      // this.map.disableContinuousZoom();\n      // this.map.disableAutoResize();\n    },\n    getMap: function getMap() {\n      return this.$data.$map;\n    }\n  },\n  mounted: function mounted() {\n    var _this = this; // const { externalImportBMapScript } = this;\n    //\n    // // 外部载入bmap.js\n    // if (externalImportBMapScript) {\n    // @ts-ignore\n\n\n    this.$data.$BMap = window.BMap;\n    this.isReady = true;\n    this.$nextTick(function () {\n      _this.initMap();\n    }); // }\n    // // 内部引入bmap.js\n    // else {\n    //   this.importBMapJS().then((BMap) => {\n    //     this.$data.$BMap = BMap;\n    //\n    //     // @ts-ignore\n    //     window.BMap = BMap;\n    //\n    //     this.$emit('onBMapScriptReady');\n    //\n    //     this.isReady = true;\n    //\n    //     this.$nextTick(() => {\n    //       this.initMap();\n    //     });\n    //   });\n    // }\n  },\n  render: function render(h) {\n    var isReady = this.isReady;\n    return h(adherev_ui_conditionalrender_1.default, {\n      \"attrs\": {\n        \"conditional\": isReady\n      }\n    }, [h(\"div\", {\n      \"class\": selectorPrefix,\n      \"ref\": \"ref\"\n    }), h(\"div\", {\n      \"slot\": \"noMatch\"\n    }, [\"loading\"])]);\n  }\n};"],"names":["require","Object","defineProperty","exports","value","tslib_1","adherev_ui_conditionalrender_1","__importDefault","selectorPrefix","loadGridIcon","default","name","props","ak","type","String","zoom","Number","center","lon","lat","config","minZoom","maxZoom","enableHighResolution","enableAutoResize","enableMapClick","externalImportBMapScript","Boolean","data","isReady","$BMap","$map","$isLoad","methods","initMap","_this","this","$data","_a","Map","$refs","ref","__assign","initMapControl","centerAndZoom","Point","addEventListener","logoEl","document","querySelector","parentElement","removeChild","setTimeout","style","background","$emit","addControl","NavigationControl","enableScrollWheelZoom","getMap","mounted","window","BMap","$nextTick","render","h","attrs","conditional","class","slot"],"mappings":"aAEAA,QAAQ,gDAERA,QAAQ,4CAERC,OAAOC,eAAeC,QAAS,aAAc,CAC3CC,OAAO,IAGT,IAAIC,QAAUL,QAAQ,SAElBM,+BAAiCD,QAAQE,gBAAgBP,QAAQ,6CAEjEQ,eAAiB,iBACjBC,aAAe,6kBACnBN,QAAQO,QAAU,CAChBC,KAAM,WACNC,MAAO,CACLC,GAAI,CACFC,KAAMC,OACNL,QAAS,oCAEXM,KAAM,CACJF,KAAMG,OACNP,QAAS,GAEXQ,OAAQ,CACNJ,KAAMb,OACNS,QAAS,WACP,MAAO,CACLS,IAAK,QACLC,IAAK,UAIXC,OAAQ,CACNP,KAAMb,OACNS,QAAS,WACP,MAAO,CACLY,QAAS,EACTC,QAAS,GACTC,sBAAsB,EACtBC,kBAAkB,EAClBC,gBAAgB,KAUtBC,yBAA0B,CACxBb,KAAMc,QACNlB,SAAS,IAGbmB,KAAM,WACJ,MAAO,CACLC,SAAS,EACTC,MAAO,KACPC,KAAM,KACNC,SAAS,IAGbC,QAAS,CAuCPC,QAAS,WACP,IAAIC,EAAQC,KAERN,EAAQM,KAAKC,MAAMP,MAEnBQ,EAAKF,KACLhB,EAASkB,EAAGlB,OACZL,EAAOuB,EAAGvB,KACVE,EAASqB,EAAGrB,OAEhBmB,KAAKC,MAAMN,KAAO,IAAID,EAAMS,IAAIH,KAAKI,MAAMC,IAAKrC,QAAQsC,SAAS,CAC/DjB,gBAAgB,GACfL,IACHgB,KAAKO,iBACLP,KAAKC,MAAMN,KAAKa,cAAc,IAAId,EAAMe,MAAM5B,MAAAA,OAAuC,EAASA,EAAOC,IAAKD,MAAAA,OAAuC,EAASA,EAAOE,KAAMJ,GACvKqB,KAAKC,MAAMN,KAAKe,iBAAiB,cAAe,WAC9C,IAAIR,EAIAS,EAFAZ,EAAME,MAAML,UAChBG,EAAME,MAAML,SAAU,GAClBe,EAASC,SAASC,cAAc,eACuD,QAA/EX,EAAKS,MAAAA,OAAuC,EAASA,EAAOG,qBAAkC,IAAPZ,GAAyBA,EAAGa,YAAYJ,GAC3IK,WAAW,WACTjB,EAAMK,MAAMC,IAAIY,MAAMC,WAAa,QAAW9C,aAAe,mBAC5D,QAEL4B,KAAKmB,MAAM,oBAEbZ,eAAgB,WACd,IAAIL,EAAKF,KAAKC,MACVP,EAAQQ,EAAGR,MACXC,EAAOO,EAAGP,KAEdA,EAAKyB,WAAW,IAAI1B,EAAM2B,mBAE1B1B,EAAK2B,uBAAsB,IAM7BC,OAAQ,WACN,OAAOvB,KAAKC,MAAMN,OAGtB6B,QAAS,WACP,IAAIzB,EAAQC,KAOZA,KAAKC,MAAMP,MAAQ+B,OAAOC,KAC1B1B,KAAKP,SAAU,EACfO,KAAK2B,UAAU,WACb5B,EAAMD,aAoBV8B,OAAQ,SAAgBC,GACtB,IAAIpC,EAAUO,KAAKP,QACnB,OAAOoC,EAAE5D,+BAA+BI,QAAS,CAC/CyD,MAAS,CACPC,YAAetC,IAEhB,CAACoC,EAAE,MAAO,CACXG,MAAS7D,eACTkC,IAAO,QACLwB,EAAE,MAAO,CACXI,KAAQ,WACP,CAAC"}