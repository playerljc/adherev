{"version":3,"file":"bmap.js","sources":["bmap.js"],"sourcesContent":["\"use strict\";\n\nvar _vue = require(\"vue\");\n\nrequire(\"core-js/modules/es.object.define-property.js\");\n\nrequire(\"core-js/modules/es.object.to-string.js\");\n\nrequire(\"core-js/modules/es.promise.js\");\n\nrequire(\"core-js/modules/es.array.index-of.js\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar tslib_1 = require(\"tslib\"); // @ts-ignore\n\n\nvar adherev_ui_conditionalrender_1 = (0, tslib_1.__importDefault)(require(\"@baifendian/adherev-ui-conditionalrender\"));\n\nvar vue_1 = require(\"vue\");\n\nvar vue_types_1 = require(\"vue-types\");\n\nvar selectorPrefix = 'adhere-ui-bmap';\nvar loadGridIcon = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAYAAADDPmHLAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAUdJREFUeNrs2sENwyAQRcE4ckf0RBv04Z7ck30wFXBi/4wU5bScXhQk9hhj9B+xzu/7WjijvZ/b/Jbz/e83kE0AAkAACAABIAAEgAAQAAJAAAgAAVDYfA5ui+eY33R+BuA9PXO++QtwB0AACAABIAAEgAAQAAJAAAgAASAAqrIPED5vH8A+AO4ACAABIAAEgAAQAAJAAAgAASAABEBJ9gHC5+0D2AfAHQABIAAEgAAQAAJAAAgAASAABIAAKMk+QPi8fQD7ALgDIAAEgAAQAAJAAAgAASAABIAAEAAl2QcIn7cPYB8AdwAEgAAQAAJAAAgAASAABIAAEAACoCT7AOHz9gHsA+AOgAAQAAJAAAgAASAABIAAEAACQACUZB8gfN4+gH0A3AEQAAJAAAgAASAABIAAEAACQABUNV8D++I5nmM3nX8EGADa0U/2xPbBVwAAAABJRU5ErkJggg==';\nvar props = {\n  ak: (0, vue_types_1.string)().def('bxFuXXDt1oKdlgu6mXCCnK51cDgDGBLp'),\n  zoom: (0, vue_types_1.number)().def(5),\n  center: (0, vue_types_1.object)().def(function () {\n    return {\n      lon: 116.404,\n      lat: 39.915\n    };\n  }).isRequired,\n  config: (0, vue_types_1.object)().def(function () {\n    return {\n      minZoom: 2,\n      maxZoom: 20,\n      enableHighResolution: true,\n      enableAutoResize: true,\n      enableMapClick: false\n    };\n  }),\n  externalImportBMapScript: (0, vue_types_1.bool)().def(false)\n};\nexports.default = (0, vue_1.defineComponent)({\n  name: 'adv-bmap',\n  props: props,\n  emits: ['onBMapInitReady', 'onBMapScriptReady'],\n  setup: function setup(props, _a) {\n    var emit = _a.emit,\n        expose = _a.expose;\n    var root = (0, vue_1.ref)(null);\n    var isReady = false;\n    var BMap;\n    var map;\n    var isLoad = false;\n    (0, vue_1.onMounted)(function () {\n      // 外部载入bmap.js\n      if (props.externalImportBMapScript) {\n        BMap = window.BMap;\n        isReady = true;\n        (0, vue_1.nextTick)(function () {\n          initMap();\n        });\n      } // 内部引入bmap.js\n      else {\n        importBMapJS().then(function (BMap) {\n          BMap = BMap;\n          window.BMap = BMap;\n          emit('onBMapScriptReady');\n          isReady = true;\n          (0, vue_1.nextTick)(function () {\n            initMap();\n          });\n        });\n      }\n    });\n\n    var importBMapJS = function importBMapJS() {\n      function importReal(src) {\n        return new Promise(function (resolve) {\n          var _a;\n\n          var script = document.createElement('script');\n\n          script.onload = function () {\n            resolve(window.BMap);\n          };\n\n          if (typeof src === 'string') {\n            script.src = src;\n          }\n\n          if (document) {\n            (_a = document.querySelector('head')) === null || _a === void 0 ? void 0 : _a.appendChild(script);\n          }\n        });\n      }\n\n      return new Promise(function (resolve) {\n        var _a;\n\n        var preWrite = document.write;\n\n        document.write = function (html) {\n          var _a;\n\n          var el = document.createElement('div');\n          el.innerHTML = html;\n          var first = el.firstElementChild;\n\n          if ((first === null || first === void 0 ? void 0 : first.tagName.toLowerCase()) === 'script' && ((_a = first === null || first === void 0 ? void 0 : first.getAttribute('src')) === null || _a === void 0 ? void 0 : _a.indexOf('http://api.map.baidu.com')) !== -1) {\n            importReal(first.getAttribute('src')).then(function (res) {\n              resolve(res);\n            });\n          } else {\n            preWrite(html);\n          }\n        };\n\n        var script = document.createElement('script');\n        script.src = \"http://api.map.baidu.com/api?v=3.0&ak=\".concat(props.ak);\n        (_a = document === null || document === void 0 ? void 0 : document.querySelector('head')) === null || _a === void 0 ? void 0 : _a.appendChild(script);\n      });\n    };\n\n    var initMap = function initMap() {\n      var _a, _b;\n\n      map = new BMap.Map(root.value, (0, tslib_1.__assign)((0, tslib_1.__assign)({}, props.config), {\n        enableMapClick: false\n      }));\n      initMapControl();\n      map.centerAndZoom(new BMap.Point((_a = props.center) === null || _a === void 0 ? void 0 : _a.lon, (_b = props.center) === null || _b === void 0 ? void 0 : _b.lat), props.zoom);\n      map.addEventListener('tilesloaded', function () {\n        var _a;\n\n        if (isLoad) return;\n        isLoad = true;\n        var logoEl = document.querySelector('.anchorBL');\n        logoEl && ((_a = logoEl === null || logoEl === void 0 ? void 0 : logoEl.parentElement) === null || _a === void 0 ? void 0 : _a.removeChild(logoEl));\n        setTimeout(function () {\n          root.value.style.background = \"url(\\\"\".concat(loadGridIcon, \"\\\") repeat #fff;\");\n        }, 2000);\n      });\n      emit('onBMapInitReady');\n    };\n\n    var initMapControl = function initMapControl() {\n      // 添加比例尺控件\n      map.addControl(new BMap.NavigationControl()); //开启鼠标滚轮缩放\n\n      map.enableScrollWheelZoom(true); // this.map.disableScrollWheelZoom();\n      // this.map.disableDoubleClickZoom();\n      // this.map.disableKeyboard();\n      // this.map.disableContinuousZoom();\n      // this.map.disableAutoResize();\n    };\n\n    var getMap = function getMap() {\n      return map;\n    };\n\n    expose({\n      getMap: getMap\n    });\n    return function () {\n      return (// @ts-ignore\n        (0, _vue.createVNode)(adherev_ui_conditionalrender_1.default, {\n          \"conditional\": isReady\n        }, {\n          // @ts-ignore\n          default: function _default() {\n            return (0, _vue.createVNode)(\"div\", {\n              \"class\": selectorPrefix,\n              \"ref\": root\n            }, null);\n          },\n          noMatch: function noMatch() {\n            return (0, _vue.createVNode)(\"div\", null, [(0, _vue.createTextVNode)(\"loading\")]);\n          }\n        })\n      );\n    };\n  }\n});"],"names":["_vue","require","tslib_1","Object","defineProperty","exports","value","adherev_ui_conditionalrender_1","__importDefault","vue_1","vue_types_1","selectorPrefix","loadGridIcon","props","ak","string","def","zoom","number","center","object","lon","lat","isRequired","config","minZoom","maxZoom","enableHighResolution","enableAutoResize","enableMapClick","externalImportBMapScript","bool","default","defineComponent","name","emits","setup","_a","BMap","map","emit","expose","root","ref","isReady","isLoad","importBMapJS","onMounted","window","nextTick","initMap","then","Promise","resolve","preWrite","document","write","script","html","src","el","createElement","first","innerHTML","firstElementChild","tagName","toLowerCase","getAttribute","indexOf","onload","querySelector","appendChild","res","concat","_b","Map","__assign","initMapControl","centerAndZoom","Point","addEventListener","logoEl","parentElement","removeChild","setTimeout","style","background","addControl","NavigationControl","enableScrollWheelZoom","getMap","createVNode","conditional","class","noMatch","createTextVNode"],"mappings":"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"}