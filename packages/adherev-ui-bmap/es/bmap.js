import{createTextVNode as _createTextVNode,createVNode as _createVNode}from"vue";import"core-js/modules/es.object.to-string.js";import"core-js/modules/es.promise.js";import"core-js/modules/es.array.index-of.js";import{__assign}from"tslib";import ConditionalRender from"@baifendian/adherev-ui-conditionalrender";import{defineComponent,nextTick,onMounted,ref}from"vue";import{bool,number,object,string}from"vue-types";var selectorPrefix="adhere-ui-bmap",loadGridIcon="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAYAAADDPmHLAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAUdJREFUeNrs2sENwyAQRcE4ckf0RBv04Z7ck30wFXBi/4wU5bScXhQk9hhj9B+xzu/7WjijvZ/b/Jbz/e83kE0AAkAACAABIAAEgAAQAAJAAAgAAVDYfA5ui+eY33R+BuA9PXO++QtwB0AACAABIAAEgAAQAAJAAAgAASAAqrIPED5vH8A+AO4ACAABIAAEgAAQAAJAAAgAASAABEBJ9gHC5+0D2AfAHQABIAAEgAAQAAJAAAgAASAABIAAKMk+QPi8fQD7ALgDIAAEgAAQAAJAAAgAASAABIAAEAAl2QcIn7cPYB8AdwAEgAAQAAJAAAgAASAABIAAEAACoCT7AOHz9gHsA+AOgAAQAAJAAAgAASAABIAAEAACQACUZB8gfN4+gH0A3AEQAAJAAAgAASAABIAAEAACQABUNV8D++I5nmM3nX8EGADa0U/2xPbBVwAAAABJRU5ErkJggg==",props={ak:string().def("bxFuXXDt1oKdlgu6mXCCnK51cDgDGBLp"),zoom:number().def(5),center:object().def(function(){return{lon:116.404,lat:39.915}}).isRequired,config:object().def(function(){return{minZoom:2,maxZoom:20,enableHighResolution:!0,enableAutoResize:!0,enableMapClick:!1}}),externalImportBMapScript:bool().def(!1)};export default defineComponent({name:"adv-bmap",props:props,emits:["onBMapInitReady","onBMapScriptReady"],setup:function(A,e){var n,o,t=e.emit,e=e.expose,i=ref(null),r=!1,a=!1,c=(onMounted(function(){A.externalImportBMapScript?(n=window.BMap,r=!0,nextTick(function(){d()})):c().then(function(e){window.BMap=e,t("onBMapScriptReady"),r=!0,nextTick(function(){d()})})}),function(){return new Promise(function(t){var e,i=document.write,n=(document.write=function(e){var n,o,A=document.createElement("div"),A=(A.innerHTML=e,A.firstElementChild);"script"===(null==A?void 0:A.tagName.toLowerCase())&&-1!==(null===(n=null==A?void 0:A.getAttribute("src"))||void 0===n?void 0:n.indexOf("http://api.map.baidu.com"))?(o=A.getAttribute("src"),new Promise(function(e){var n,A=document.createElement("script");A.onload=function(){e(window.BMap)},"string"==typeof o&&(A.src=o),document&&null!==(n=document.querySelector("head"))&&void 0!==n&&n.appendChild(A)}).then(function(e){t(e)})):i(e)},document.createElement("script"));n.src="http://api.map.baidu.com/api?v=3.0&ak=".concat(A.ak),null!==(e=null===document||void 0===document?void 0:document.querySelector("head"))&&void 0!==e&&e.appendChild(n)})}),d=function(){var e;o=new n.Map(i.value,__assign(__assign({},A.config),{enableMapClick:!1})),u(),o.centerAndZoom(new n.Point(null===(e=A.center)||void 0===e?void 0:e.lon,null===(e=A.center)||void 0===e?void 0:e.lat),A.zoom),o.addEventListener("tilesloaded",function(){var e,n;a||(a=!0,(n=document.querySelector(".anchorBL"))&&null!==(e=null==n?void 0:n.parentElement)&&void 0!==e&&e.removeChild(n),setTimeout(function(){i.value.style.background='url("'.concat(loadGridIcon,'") repeat #fff;')},2e3))}),t("onBMapInitReady")},u=function(){o.addControl(new n.NavigationControl),o.enableScrollWheelZoom(!0)};return e({getMap:function(){return o}}),function(){return _createVNode(ConditionalRender,{conditional:r},{default:function(){return _createVNode("div",{class:selectorPrefix,ref:i},null)},noMatch:function(){return _createVNode("div",null,[_createTextVNode("loading")])}})}}});
//# sourceMappingURL=bmap.js.map
