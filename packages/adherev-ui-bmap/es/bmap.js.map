{"version":3,"file":"bmap.js","sources":["bmap.js"],"sourcesContent":["import { createTextVNode as _createTextVNode, createVNode as _createVNode } from \"vue\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.promise.js\";\nimport \"core-js/modules/es.array.index-of.js\";\nimport { __assign } from \"tslib\"; // @ts-ignore\n\nimport ConditionalRender from '@baifendian/adherev-ui-conditionalrender';\nimport { defineComponent, nextTick, onMounted, ref } from 'vue';\nimport { bool, number, object, string } from 'vue-types';\nvar selectorPrefix = 'adhere-ui-bmap';\nvar loadGridIcon = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAYAAADDPmHLAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAUdJREFUeNrs2sENwyAQRcE4ckf0RBv04Z7ck30wFXBi/4wU5bScXhQk9hhj9B+xzu/7WjijvZ/b/Jbz/e83kE0AAkAACAABIAAEgAAQAAJAAAgAAVDYfA5ui+eY33R+BuA9PXO++QtwB0AACAABIAAEgAAQAAJAAAgAASAAqrIPED5vH8A+AO4ACAABIAAEgAAQAAJAAAgAASAABEBJ9gHC5+0D2AfAHQABIAAEgAAQAAJAAAgAASAABIAAKMk+QPi8fQD7ALgDIAAEgAAQAAJAAAgAASAABIAAEAAl2QcIn7cPYB8AdwAEgAAQAAJAAAgAASAABIAAEAACoCT7AOHz9gHsA+AOgAAQAAJAAAgAASAABIAAEAACQACUZB8gfN4+gH0A3AEQAAJAAAgAASAABIAAEAACQABUNV8D++I5nmM3nX8EGADa0U/2xPbBVwAAAABJRU5ErkJggg==';\nvar props = {\n  ak: string().def('bxFuXXDt1oKdlgu6mXCCnK51cDgDGBLp'),\n  zoom: number().def(5),\n  center: object().def(function () {\n    return {\n      lon: 116.404,\n      lat: 39.915\n    };\n  }).isRequired,\n  config: object().def(function () {\n    return {\n      minZoom: 2,\n      maxZoom: 20,\n      enableHighResolution: true,\n      enableAutoResize: true,\n      enableMapClick: false\n    };\n  }),\n  externalImportBMapScript: bool().def(false)\n};\nexport default defineComponent({\n  name: 'adv-bmap',\n  props: props,\n  emits: ['onBMapInitReady', 'onBMapScriptReady'],\n  setup: function setup(props, _a) {\n    var emit = _a.emit,\n        expose = _a.expose;\n    var root = ref(null);\n    var isReady = false;\n    var BMap;\n    var map;\n    var isLoad = false;\n    onMounted(function () {\n      // 外部载入bmap.js\n      if (props.externalImportBMapScript) {\n        BMap = window.BMap;\n        isReady = true;\n        nextTick(function () {\n          initMap();\n        });\n      } // 内部引入bmap.js\n      else {\n        importBMapJS().then(function (BMap) {\n          BMap = BMap;\n          window.BMap = BMap;\n          emit('onBMapScriptReady');\n          isReady = true;\n          nextTick(function () {\n            initMap();\n          });\n        });\n      }\n    });\n\n    var importBMapJS = function importBMapJS() {\n      function importReal(src) {\n        return new Promise(function (resolve) {\n          var _a;\n\n          var script = document.createElement('script');\n\n          script.onload = function () {\n            resolve(window.BMap);\n          };\n\n          if (typeof src === 'string') {\n            script.src = src;\n          }\n\n          if (document) {\n            (_a = document.querySelector('head')) === null || _a === void 0 ? void 0 : _a.appendChild(script);\n          }\n        });\n      }\n\n      return new Promise(function (resolve) {\n        var _a;\n\n        var preWrite = document.write;\n\n        document.write = function (html) {\n          var _a;\n\n          var el = document.createElement('div');\n          el.innerHTML = html;\n          var first = el.firstElementChild;\n\n          if ((first === null || first === void 0 ? void 0 : first.tagName.toLowerCase()) === 'script' && ((_a = first === null || first === void 0 ? void 0 : first.getAttribute('src')) === null || _a === void 0 ? void 0 : _a.indexOf('http://api.map.baidu.com')) !== -1) {\n            importReal(first.getAttribute('src')).then(function (res) {\n              resolve(res);\n            });\n          } else {\n            preWrite(html);\n          }\n        };\n\n        var script = document.createElement('script');\n        script.src = \"http://api.map.baidu.com/api?v=3.0&ak=\".concat(props.ak);\n        (_a = document === null || document === void 0 ? void 0 : document.querySelector('head')) === null || _a === void 0 ? void 0 : _a.appendChild(script);\n      });\n    };\n\n    var initMap = function initMap() {\n      var _a, _b;\n\n      map = new BMap.Map(root.value, __assign(__assign({}, props.config), {\n        enableMapClick: false\n      }));\n      initMapControl();\n      map.centerAndZoom(new BMap.Point((_a = props.center) === null || _a === void 0 ? void 0 : _a.lon, (_b = props.center) === null || _b === void 0 ? void 0 : _b.lat), props.zoom);\n      map.addEventListener('tilesloaded', function () {\n        var _a;\n\n        if (isLoad) return;\n        isLoad = true;\n        var logoEl = document.querySelector('.anchorBL');\n        logoEl && ((_a = logoEl === null || logoEl === void 0 ? void 0 : logoEl.parentElement) === null || _a === void 0 ? void 0 : _a.removeChild(logoEl));\n        setTimeout(function () {\n          root.value.style.background = \"url(\\\"\".concat(loadGridIcon, \"\\\") repeat #fff;\");\n        }, 2000);\n      });\n      emit('onBMapInitReady');\n    };\n\n    var initMapControl = function initMapControl() {\n      // 添加比例尺控件\n      map.addControl(new BMap.NavigationControl()); //开启鼠标滚轮缩放\n\n      map.enableScrollWheelZoom(true); // this.map.disableScrollWheelZoom();\n      // this.map.disableDoubleClickZoom();\n      // this.map.disableKeyboard();\n      // this.map.disableContinuousZoom();\n      // this.map.disableAutoResize();\n    };\n\n    var getMap = function getMap() {\n      return map;\n    };\n\n    expose({\n      getMap: getMap\n    });\n    return function () {\n      return (// @ts-ignore\n        _createVNode(ConditionalRender, {\n          \"conditional\": isReady\n        }, {\n          // @ts-ignore\n          default: function _default() {\n            return _createVNode(\"div\", {\n              \"class\": selectorPrefix,\n              \"ref\": root\n            }, null);\n          },\n          noMatch: function noMatch() {\n            return _createVNode(\"div\", null, [_createTextVNode(\"loading\")]);\n          }\n        })\n      );\n    };\n  }\n});"],"names":["_createTextVNode","_createVNode","__assign","ConditionalRender","defineComponent","nextTick","onMounted","ref","bool","number","object","string","selectorPrefix","loadGridIcon","props","ak","def","zoom","center","lon","lat","isRequired","config","minZoom","maxZoom","enableHighResolution","enableAutoResize","enableMapClick","externalImportBMapScript","name","emits","setup","_a","BMap","map","emit","expose","root","isReady","isLoad","importBMapJS","window","initMap","then","Promise","resolve","preWrite","document","write","script","html","src","el","createElement","first","innerHTML","firstElementChild","tagName","toLowerCase","getAttribute","indexOf","onload","querySelector","appendChild","res","concat","_b","Map","value","initMapControl","centerAndZoom","Point","addEventListener","logoEl","parentElement","removeChild","setTimeout","style","background","addControl","NavigationControl","enableScrollWheelZoom","getMap","conditional","default","class","noMatch"],"mappings":"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"}