{"version":3,"file":"bmap.js","sources":["bmap.js"],"sourcesContent":["import \"core-js/modules/es.number.constructor.js\";\nimport { __assign } from \"tslib\";\nimport ConditionalRender from '@baifendian/adherev-ui-conditionalrender';\nvar selectorPrefix = 'adhere-ui-bmap';\nvar loadGridIcon = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAYAAADDPmHLAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAUdJREFUeNrs2sENwyAQRcE4ckf0RBv04Z7ck30wFXBi/4wU5bScXhQk9hhj9B+xzu/7WjijvZ/b/Jbz/e83kE0AAkAACAABIAAEgAAQAAJAAAgAAVDYfA5ui+eY33R+BuA9PXO++QtwB0AACAABIAAEgAAQAAJAAAgAASAAqrIPED5vH8A+AO4ACAABIAAEgAAQAAJAAAgAASAABEBJ9gHC5+0D2AfAHQABIAAEgAAQAAJAAAgAASAABIAAKMk+QPi8fQD7ALgDIAAEgAAQAAJAAAgAASAABIAAEAAl2QcIn7cPYB8AdwAEgAAQAAJAAAgAASAABIAAEAACoCT7AOHz9gHsA+AOgAAQAAJAAAgAASAABIAAEAACQACUZB8gfN4+gH0A3AEQAAJAAAgAASAABIAAEAACQABUNV8D++I5nmM3nX8EGADa0U/2xPbBVwAAAABJRU5ErkJggg==';\nvar BMap = {\n  name: 'adv-bmap',\n  props: {\n    ak: {\n      type: String,\n      default: 'bxFuXXDt1oKdlgu6mXCCnK51cDgDGBLp'\n    },\n    zoom: {\n      type: Number,\n      default: 5\n    },\n    center: {\n      type: Object,\n      default: function _default() {\n        return {\n          lon: 116.404,\n          lat: 39.915\n        };\n      }\n    },\n    config: {\n      type: Object,\n      default: function _default() {\n        return {\n          minZoom: 2,\n          maxZoom: 20,\n          enableHighResolution: true,\n          enableAutoResize: true,\n          enableMapClick: false\n        };\n      }\n    },\n    // onBMapInitReady: {\n    //   type: Function,\n    // },\n    // onBMapScriptReady: {\n    //   type: Function,\n    // },\n    externalImportBMapScript: {\n      type: Boolean,\n      default: false\n    }\n  },\n  emits: ['bMapInitReady'],\n  data: function data() {\n    return {\n      isReady: false,\n      $BMap: null,\n      $map: null,\n      $isLoad: false\n    };\n  },\n  methods: {\n    // importBMapJS() {\n    //   function importReal(src) {\n    //     return new Promise((resolve) => {\n    //       const script = document.createElement('script');\n    //       script.onload = () => {\n    //         // @ts-ignore\n    //         resolve(window.BMap);\n    //       };\n    //       script.src = src;\n    //       document.querySelector('head')?.appendChild(script);\n    //     });\n    //   }\n    //\n    //   return new Promise((resolve) => {\n    //     const preWrite = document.write;\n    //\n    //     document.write = (html) => {\n    //       const el = document.createElement('div');\n    //       el.innerHTML = html;\n    //       const first = el.firstElementChild;\n    //\n    //       if (\n    //         first?.tagName.toLowerCase() === 'script' &&\n    //         first?.getAttribute('src')?.indexOf('http://api.map.baidu.com') !== -1\n    //       ) {\n    //         importReal(first.getAttribute('src')).then((res) => {\n    //           resolve(res);\n    //         });\n    //       } else {\n    //         preWrite(html);\n    //       }\n    //     };\n    //\n    //     const script = document.createElement('script');\n    //     script.src = `http://api.map.baidu.com/api?v=3.0&ak=${this.props.ak}`;\n    //     document?.querySelector('head')?.appendChild(script);\n    //   });\n    // },\n    initMap: function initMap() {\n      var _this = this;\n      var $BMap = this.$data.$BMap;\n      var _a = this,\n        config = _a.config,\n        zoom = _a.zoom,\n        center = _a.center;\n      this.$data.$map = new $BMap.Map(this.$refs.ref, __assign({\n        enableMapClick: false\n      }, config));\n      this.initMapControl();\n      this.$data.$map.centerAndZoom(new $BMap.Point(center === null || center === void 0 ? void 0 : center.lon, center === null || center === void 0 ? void 0 : center.lat), zoom);\n      this.$data.$map.addEventListener('tilesloaded', function () {\n        var _a;\n        if (_this.$data.$isLoad) return;\n        _this.$data.$isLoad = true;\n        var logoEl = document.querySelector('.anchorBL');\n        logoEl && ((_a = logoEl === null || logoEl === void 0 ? void 0 : logoEl.parentElement) === null || _a === void 0 ? void 0 : _a.removeChild(logoEl));\n        setTimeout(function () {\n          _this.$refs.ref.style.background = \"url(\\\"\".concat(loadGridIcon, \"\\\") repeat #fff;\");\n        }, 2000);\n      });\n      this.$emit('bMapInitReady');\n    },\n    initMapControl: function initMapControl() {\n      var _a = this.$data,\n        $BMap = _a.$BMap,\n        $map = _a.$map;\n      // 添加比例尺控件\n      $map.addControl(new $BMap.NavigationControl());\n      //开启鼠标滚轮缩放\n      $map.enableScrollWheelZoom(true);\n      // this.map.disableScrollWheelZoom();\n      // this.map.disableDoubleClickZoom();\n      // this.map.disableKeyboard();\n      // this.map.disableContinuousZoom();\n      // this.map.disableAutoResize();\n    },\n\n    getMap: function getMap() {\n      return this.$data.$map;\n    }\n  },\n  mounted: function mounted() {\n    var _this = this;\n    // const { externalImportBMapScript } = this;\n    //\n    // // 外部载入bmap.js\n    // if (externalImportBMapScript) {\n    // @ts-ignore\n    this.$data.$BMap = window.BMap;\n    this.isReady = true;\n    this.$nextTick(function () {\n      _this.initMap();\n    });\n    // }\n    // // 内部引入bmap.js\n    // else {\n    //   this.importBMapJS().then((BMap) => {\n    //     this.$data.$BMap = BMap;\n    //\n    //     // @ts-ignore\n    //     window.BMap = BMap;\n    //\n    //     this.$emit('onBMapScriptReady');\n    //\n    //     this.isReady = true;\n    //\n    //     this.$nextTick(() => {\n    //       this.initMap();\n    //     });\n    //   });\n    // }\n  },\n\n  render: function render(h) {\n    var isReady = this.isReady;\n    return h(ConditionalRender, {\n      \"attrs\": {\n        \"conditional\": isReady\n      }\n    }, [h(\"div\", {\n      \"class\": selectorPrefix,\n      \"ref\": \"ref\"\n    }), h(\"div\", {\n      \"slot\": \"noMatch\"\n    }, [\"loading\"])]);\n  }\n};\nexport default BMap;"],"names":["__assign","ConditionalRender","selectorPrefix","loadGridIcon","BMap","name","props","ak","type","String","default","zoom","Number","center","Object","lon","lat","config","minZoom","maxZoom","enableHighResolution","enableAutoResize","enableMapClick","externalImportBMapScript","Boolean","emits","data","isReady","$BMap","$map","$isLoad","methods","initMap","_this","this","$data","_a","Map","$refs","ref","initMapControl","centerAndZoom","Point","addEventListener","logoEl","document","querySelector","parentElement","removeChild","setTimeout","style","background","concat","$emit","addControl","NavigationControl","enableScrollWheelZoom","getMap","mounted","window","$nextTick","render","h","attrs","conditional","class","slot"],"mappings":"MAAO,kDACEA,QAAuB,KAAP,eAClBC,sBAAuB,2CAC9B,IAAIC,eAAiB,iBACjBC,aAAe,6kBACfC,KAAO,CACTC,KAAM,WACNC,MAAO,CACLC,GAAI,CACFC,KAAMC,OACNC,QAAS,kCACX,EACAC,KAAM,CACJH,KAAMI,OACNF,QAAS,CACX,EACAG,OAAQ,CACNL,KAAMM,OACNJ,QAAS,WACP,MAAO,CACLK,IAAK,QACLC,IAAK,MACP,CACF,CACF,EACAC,OAAQ,CACNT,KAAMM,OACNJ,QAAS,WACP,MAAO,CACLQ,QAAS,EACTC,QAAS,GACTC,qBAAsB,CAAA,EACtBC,iBAAkB,CAAA,EAClBC,eAAgB,CAAA,CAClB,CACF,CACF,EAOAC,yBAA0B,CACxBf,KAAMgB,QACNd,QAAS,CAAA,CACX,CACF,EACAe,MAAO,CAAC,iBACRC,KAAM,WACJ,MAAO,CACLC,QAAS,CAAA,EACTC,MAAO,KACPC,KAAM,KACNC,QAAS,CAAA,CACX,CACF,EACAC,QAAS,CAuCPC,QAAS,WACP,IAAIC,EAAQC,KACRN,EAAQM,KAAKC,MAAMP,MACnBQ,EAAKF,KACPjB,EAASmB,EAAGnB,OACZN,EAAOyB,EAAGzB,KACVE,EAASuB,EAAGvB,OACdqB,KAAKC,MAAMN,KAAO,IAAID,EAAMS,IAAIH,KAAKI,MAAMC,IAAKvC,SAAS,CACvDsB,eAAgB,CAAA,CAClB,EAAGL,CAAM,CAAC,EACViB,KAAKM,eAAe,EACpBN,KAAKC,MAAMN,KAAKY,cAAc,IAAIb,EAAMc,MAAM7B,MAAAA,EAAuC,KAAA,EAASA,EAAOE,IAAKF,MAAAA,EAAuC,KAAA,EAASA,EAAOG,GAAG,EAAGL,CAAI,EAC3KuB,KAAKC,MAAMN,KAAKc,iBAAiB,cAAe,WAC9C,IAAIP,EAGAQ,EAFAX,EAAME,MAAML,UAChBG,EAAME,MAAML,QAAU,CAAA,GAClBc,EAASC,SAASC,cAAc,WAAW,IACpC,OAACV,EAAKQ,MAAAA,EAAuC,KAAA,EAASA,EAAOG,gBAAoDX,EAAGY,YAAYJ,CAAM,EACjJK,WAAW,WACThB,EAAMK,MAAMC,IAAIW,MAAMC,WAAa,QAASC,OAAOjD,aAAc,iBAAkB,CACrF,EAAG,GAAI,EACT,CAAC,EACD+B,KAAKmB,MAAM,eAAe,CAC5B,EACAb,eAAgB,WACd,IAAIJ,EAAKF,KAAKC,MACZP,EAAQQ,EAAGR,MACXC,EAAOO,EAAGP,KAEZA,EAAKyB,WAAW,IAAI1B,EAAM2B,iBAAmB,EAE7C1B,EAAK2B,sBAAsB,CAAA,CAAI,CAMjC,EAEAC,OAAQ,WACN,OAAOvB,KAAKC,MAAMN,IACpB,CACF,EACA6B,QAAS,WACP,IAAIzB,EAAQC,KAMZA,KAAKC,MAAMP,MAAQ+B,OAAOvD,KAC1B8B,KAAKP,QAAU,CAAA,EACfO,KAAK0B,UAAU,WACb3B,EAAMD,QAAQ,CAChB,CAAC,CAmBH,EAEA6B,OAAQ,SAAgBC,GACtB,IAAInC,EAAUO,KAAKP,QACnB,OAAOmC,EAAE7D,kBAAmB,CAC1B8D,MAAS,CACPC,YAAerC,CACjB,CACF,EAAG,CAACmC,EAAE,MAAO,CACXG,MAAS/D,eACTqC,IAAO,KACT,CAAC,EAAGuB,EAAE,MAAO,CACXI,KAAQ,SACV,EAAG,CAAC,UAAU,EAAE,CAClB,CACF,iBACe9D"}