{"version":3,"file":"bmap.js","sources":["bmap.js"],"sourcesContent":["import { createTextVNode as _createTextVNode, createVNode as _createVNode } from \"vue\";\nimport { __assign } from \"tslib\";\nimport { defineComponent, nextTick, onMounted, ref } from 'vue';\nimport { bool, number, object, string } from 'vue-types';\nimport ConditionalRender from '@baifendian/adherev-ui-conditionalrender';\nvar selectorPrefix = 'adhere-ui-bmap';\nvar loadGridIcon = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAYAAADDPmHLAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAUdJREFUeNrs2sENwyAQRcE4ckf0RBv04Z7ck30wFXBi/4wU5bScXhQk9hhj9B+xzu/7WjijvZ/b/Jbz/e83kE0AAkAACAABIAAEgAAQAAJAAAgAAVDYfA5ui+eY33R+BuA9PXO++QtwB0AACAABIAAEgAAQAAJAAAgAASAAqrIPED5vH8A+AO4ACAABIAAEgAAQAAJAAAgAASAABEBJ9gHC5+0D2AfAHQABIAAEgAAQAAJAAAgAASAABIAAKMk+QPi8fQD7ALgDIAAEgAAQAAJAAAgAASAABIAAEAAl2QcIn7cPYB8AdwAEgAAQAAJAAAgAASAABIAAEAACoCT7AOHz9gHsA+AOgAAQAAJAAAgAASAABIAAEAACQACUZB8gfN4+gH0A3AEQAAJAAAgAASAABIAAEAACQABUNV8D++I5nmM3nX8EGADa0U/2xPbBVwAAAABJRU5ErkJggg==';\nvar props = {\n  ak: string().def('bxFuXXDt1oKdlgu6mXCCnK51cDgDGBLp'),\n  zoom: number().def(5),\n  center: object().def(function () {\n    return {\n      lon: 116.404,\n      lat: 39.915\n    };\n  }).isRequired,\n  config: object().def(function () {\n    return {\n      minZoom: 2,\n      maxZoom: 20,\n      enableHighResolution: true,\n      enableAutoResize: true,\n      enableMapClick: false\n    };\n  }),\n  externalImportBMapScript: bool().def(false)\n};\nexport default defineComponent({\n  name: 'adv-bmap',\n  props: props,\n  emits: ['bMapInitReady'],\n  setup: function setup(props, _a) {\n    var emit = _a.emit,\n      expose = _a.expose;\n    var root = ref(null);\n    var isReady = false;\n    var BMap;\n    var map;\n    var isLoad = false;\n    // const importBMapJS = () => {\n    //   function importReal(src: string | null) {\n    //     return new Promise<any>((resolve) => {\n    //       const script = document.createElement('script');\n    //\n    //       script.onload = () => {\n    //         resolve((window as any).BMap);\n    //       };\n    //       if (typeof src === 'string') {\n    //         script.src = src;\n    //       }\n    //\n    //       if (document) {\n    //         document.querySelector('head')?.appendChild(script);\n    //       }\n    //     });\n    //   }\n    //\n    //   return new Promise((resolve) => {\n    //     const preWrite = document.write;\n    //\n    //     document.write = (html) => {\n    //       const el = document.createElement('div');\n    //       el.innerHTML = html;\n    //       const first = el.firstElementChild;\n    //\n    //       if (\n    //         first?.tagName.toLowerCase() === 'script' &&\n    //         first?.getAttribute('src')?.indexOf('http://api.map.baidu.com') !== -1\n    //       ) {\n    //         importReal(first.getAttribute('src')).then((res) => {\n    //           resolve(res);\n    //         });\n    //       } else {\n    //         preWrite(html);\n    //       }\n    //     };\n    //\n    //     const script = document.createElement('script');\n    //     script.src = `http://api.map.baidu.com/api?v=3.0&ak=${props.ak}`;\n    //     document?.querySelector('head')?.appendChild(script);\n    //   });\n    // };\n    var initMap = function initMap() {\n      var _a, _b;\n      map = new BMap.Map(root.value, __assign(__assign({}, props.config), {\n        enableMapClick: false\n      }));\n      initMapControl();\n      map.centerAndZoom(new BMap.Point((_a = props.center) === null || _a === void 0 ? void 0 : _a.lon, (_b = props.center) === null || _b === void 0 ? void 0 : _b.lat), props.zoom);\n      map.addEventListener('tilesloaded', function () {\n        var _a;\n        if (isLoad) return;\n        isLoad = true;\n        var logoEl = document.querySelector('.anchorBL');\n        logoEl && ((_a = logoEl === null || logoEl === void 0 ? void 0 : logoEl.parentElement) === null || _a === void 0 ? void 0 : _a.removeChild(logoEl));\n        setTimeout(function () {\n          root.value.style.background = \"url(\\\"\".concat(loadGridIcon, \"\\\") repeat #fff;\");\n        }, 2000);\n      });\n      emit('bMapInitReady');\n    };\n    var initMapControl = function initMapControl() {\n      // 添加比例尺控件\n      map.addControl(new BMap.NavigationControl());\n      //开启鼠标滚轮缩放\n      map.enableScrollWheelZoom(true);\n      // this.map.disableScrollWheelZoom();\n      // this.map.disableDoubleClickZoom();\n      // this.map.disableKeyboard();\n      // this.map.disableContinuousZoom();\n      // this.map.disableAutoResize();\n    };\n\n    var getMap = function getMap() {\n      return map;\n    };\n    expose({\n      getMap: getMap\n    });\n    onMounted(function () {\n      // 外部载入bmap.js\n      // if (props.externalImportBMapScript) {\n      //   BMap = (window as any).BMap;\n      //\n      //   isReady = true;\n      //\n      //   nextTick(() => {\n      //     initMap();\n      //   });\n      // }\n      // // 内部引入bmap.js\n      // else {\n      //   importBMapJS().then((BMap) => {\n      //     BMap = BMap;\n      //\n      //     (window as any).BMap = BMap;\n      //\n      //     emit('onBMapScriptReady');\n      //\n      //     isReady = true;\n      //\n      //     nextTick(() => {\n      //       initMap();\n      //     });\n      //   });\n      // }\n      // @ts-ignore\n      BMap = window.BMap;\n      isReady = true;\n      nextTick(function () {\n        initMap();\n      });\n    });\n    return function () {\n      return (// @ts-ignore\n        _createVNode(ConditionalRender, {\n          \"conditional\": isReady\n        }, {\n          default: function _default() {\n            return _createVNode(\"div\", {\n              \"class\": selectorPrefix,\n              \"ref\": root\n            }, null);\n          },\n          noMatch: function noMatch() {\n            return _createVNode(\"div\", null, [_createTextVNode(\"loading\")]);\n          }\n        })\n      );\n    };\n  }\n});"],"names":["_createTextVNode","_createVNode","__assign","defineComponent","nextTick","onMounted","ref","bool","number","object","string","ConditionalRender","selectorPrefix","loadGridIcon","props","ak","def","zoom","center","lon","lat","isRequired","config","minZoom","maxZoom","enableHighResolution","enableAutoResize","enableMapClick","externalImportBMapScript","name","emits","setup","_a","initMapControl","map","addControl","BMap","NavigationControl","enableScrollWheelZoom","emit","expose","root","isReady","isLoad","getMap","window","_b","Map","value","centerAndZoom","Point","addEventListener","logoEl","document","querySelector","parentElement","removeChild","setTimeout","style","background","concat","conditional","default","class","noMatch"],"mappings":"OAA4BA,oCAAiCC,2BAAyB,KAAL,aACxEC,QAAuB,KAAP,eAChBC,gBAAiBC,SAAUC,UAAWC,GAAgB,KAAL,aACjDC,KAAMC,OAAQC,OAAQC,MAAyB,KAAX,mBACtCC,sBAAuB,2CAC9B,IAAIC,eAAiB,iBACjBC,aAAe,6kBACfC,MAAQ,CACVC,GAAIL,OAAO,EAAEM,IAAI,kCAAkC,EACnDC,KAAMT,OAAO,EAAEQ,IAAI,CAAC,EACpBE,OAAQT,OAAO,EAAEO,IAAI,WACnB,MAAO,CACLG,IAAK,QACLC,IAAK,MACP,CACF,CAAC,EAAEC,WACHC,OAAQb,OAAO,EAAEO,IAAI,WACnB,MAAO,CACLO,QAAS,EACTC,QAAS,GACTC,qBAAsB,CAAA,EACtBC,iBAAkB,CAAA,EAClBC,eAAgB,CAAA,CAClB,CACF,CAAC,EACDC,yBAA0BrB,KAAK,EAAES,IAAI,CAAA,CAAK,CAC5C,iBACeb,gBAAgB,CAC7B0B,KAAM,WACNf,MAAOA,MACPgB,MAAO,CAAC,iBACRC,MAAO,SAAejB,EAAOkB,GAsEN,SAAjBC,IAEFC,EAAIC,WAAW,IAAIC,EAAKC,iBAAmB,EAE3CH,EAAII,sBAAsB,CAAA,CAAI,CAMhC,CA/EA,IAIIF,EACAF,EALAK,EAAOP,EAAGO,KACZC,EAASR,EAAGQ,OACVC,EAAOnC,IAAI,IAAI,EACfoC,EAAU,CAAA,EAGVC,EAAS,CAAA,EAmHb,OArCAH,EAAO,CACLI,OAJW,WACX,OAAOV,CACT,CAGA,CAAC,EACD7B,UAAU,WA4BR+B,EAAOS,OAAOT,KACdM,EAAU,CAAA,EACVtC,SAAS,WAnEG,IACJ0C,EACRZ,EAAM,IAAIE,EAAKW,IAAIN,EAAKO,MAAO9C,SAASA,SAAS,GAAIY,EAAMQ,MAAM,EAAG,CAClEK,eAAgB,CAAA,CAClB,CAAC,CAAC,EACFM,EAAe,EACfC,EAAIe,cAAc,IAAIb,EAAKc,MAAM,OAAClB,EAAKlB,EAAMI,QAAoC,KAAA,EAASc,EAAGb,IAAK,OAAC2B,EAAKhC,EAAMI,QAAoC,KAAA,EAAS4B,EAAG1B,GAAG,EAAGN,EAAMG,IAAI,EAC9KiB,EAAIiB,iBAAiB,cAAe,WAClC,IAAInB,EAGAoB,EAFAT,IACJA,EAAS,CAAA,GACLS,EAASC,SAASC,cAAc,WAAW,IACpC,OAACtB,EAAKoB,MAAAA,EAAuC,KAAA,EAASA,EAAOG,gBAAoDvB,EAAGwB,YAAYJ,CAAM,EACjJK,WAAW,WACThB,EAAKO,MAAMU,MAAMC,WAAa,QAASC,OAAO/C,aAAc,iBAAkB,CAChF,EAAG,GAAI,EACT,CAAC,EACD0B,EAAK,eAAe,CAoDpB,CAAC,CACH,CAAC,EACM,WACL,OACEtC,aAAaU,kBAAmB,CAC9BkD,YAAenB,CACjB,EAAG,CACDoB,QAAS,WACP,OAAO7D,aAAa,MAAO,CACzB8D,MAASnD,eACTN,IAAOmC,CACT,EAAG,IAAI,CACT,EACAuB,QAAS,WACP,OAAO/D,aAAa,MAAO,KAAM,CAACD,iBAAiB,SAAS,EAAE,CAChE,CACF,CACF,CACF,CACF,CACF,CAAC"}