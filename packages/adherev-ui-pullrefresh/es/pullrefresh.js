import{createTextVNode as _createTextVNode,createVNode as _createVNode}from"vue";import"core-js/modules/es.object.to-string.js";import"core-js/modules/es.promise.js";import classNames from"classnames";import moment from"moment";import{computed,defineComponent,onMounted,ref}from"vue";import{bool,number,object,string}from"vue-types";import Intl from"@baifendian/adherev-util-intl";import Resource from"@baifendian/adherev-util-resource";var selectorPrefix="adherev-ui-pullrefresh",defaultImg="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+DQo8c3ZnIHN0eWxlPSJ3aWR0aDozMDhweDtoZWlnaHQ6MzA4cHg7IiB2ZXJzaW9uPSIxLjEiIGlkPSLlm77lvaIiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4IiB3aWR0aD0iMTAyNHB4IiBoZWlnaHQ9IjEwMjRweCIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgZW5hYmxlLWJhY2tncm91bmQ9Im5ldyAwIDAgMTAyNCAxMDI0IiB4bWw6c3BhY2U9InByZXNlcnZlIj4NCiAgPHBhdGggY2xhc3M9InN2Z3BhdGgiIGRhdGEtaW5kZXg9InBhdGhfMCIgZmlsbD0iI2VjZjBmMSIgZD0iTTc5Ny43NjQ0MiAzMjYuNTU4NDFjLTguODg0MTk5LTE1LjU2MzMyNy0yNTIuODgwMS0yODYuODE5MDE5LTI2OC4zNzk1MTItMzEzLjU2NzQ4OS0xMC4xMzA1NDQtMTcuNDQ4ODIzLTM0LjI1ODQ5NS0xNy4xOTMxNjItNDQuMzg5MDM4IDBDNDczLjY1MDkzOSAzMi4yNjEzMjQgMjMwLjk5NzI1NSAzMDQuNjM1NTMgMjE4LjM3NDAyMyAzMjcuNDIxMjY0Yy05LjIzNTczMiAxNi41NTQwMTEgMC45NTg3MjcgMzguMzgxMDE5IDIxLjk1NDgzNyAzOC4zODEwMTlsMTE5LjkwNDczMSAwIDAgMjU2LjQ5MTMwMyAwIDM2Ljc4MzE0MSAyOTEuODM2MzU0IDAgMC0yOTMuMzA2NDAyIDEyMy41Nzk4NDkgMEM3OTQuNjk2NDk1IDM2NS43NzAzMjUgODA4Ljk0OTU2MiAzNDYuMTE2NDMxIDc5Ny43NjQ0MiAzMjYuNTU4NDF6IiAvPg0KPHBhdGggY2xhc3M9InN2Z3BhdGgiIGRhdGEtaW5kZXg9InBhdGhfMSIgZmlsbD0iI2VjZjBmMSIgZD0iTTM2MC4yMDE2MzMgNjg5LjY5MjA2MWwyOTIuMzE1NzE4IDAgMCA5MC45MTkyMzItMjkyLjMxNTcxOCAwIDAtOTAuOTE5MjMyWiIgLz4NCjxwYXRoIGNsYXNzPSJzdmdwYXRoIiBkYXRhLWluZGV4PSJwYXRoXzIiIGZpbGw9IiNlY2YwZjEiIGQ9Ik0zNjAuMjAxNjMzIDg0MC45MTUxOTFsMjkyLjMxNTcxOCAwIDAgNjAuNTkxNTE2LTI5Mi4zMTU3MTggMCAwLTYwLjU5MTUxNloiIC8+DQo8cGF0aCBjbGFzcz0ic3ZncGF0aCIgZGF0YS1pbmRleD0icGF0aF8zIiBmaWxsPSIjZWNmMGYxIiBkPSJNMzYwLjIwMTYzMyA5OTIuMzkzOTgybDI5MC40MzAyMjIgMCAwIDMwLjI5NTc1OC0yOTAuNDMwMjIyIDAgMC0zMC4yOTU3NThaIiAvPg0KDQo8L3N2Zz4NCg==",pullRefreshProps={scrollClassName:string().def(""),pullHeight:number().def(200),isShowUpdateTime:bool().def(!0),updateTime:number().def(moment().valueOf()),updateTimeFormat:string().def(Resource.Dict.value.ResourceMomentFormat18.value()),loadingAnimation:string().def("la-ball-circus la-dark"),renderIcon:object(),renderCanLabel:object(),renderLabel:object(),renderLoadingAnimation:object()};export default defineComponent({name:"adv-pullrefresh",props:pullRefreshProps,slots:["icon","canLabel","label","loadingAnimation"],emits:["pull-start","pull-can-refresh","pull-bottom","pull-rebound","pull-refresh"],setup:function(l,e){function t(){null!=N&&N.removeEventListener("mousemove",x),null!=N&&N.removeEventListener("mouseup",h),null!=N&&N.removeEventListener("touchmove",x),null!=N&&N.removeEventListener("touchend",h)}function n(e){0===(null==e?void 0:e.target.scrollTop)?(M=!0,null!=N&&N.addEventListener("touchstart",D),null!=N&&N.addEventListener("mousedown",D)):M&&(M=!1,null!=N&&N.removeEventListener("touchstart",D),null!=N&&N.removeEventListener("mousedown",D))}var o=e.slots,r=e.emit,e=e.expose,a=ref(),i=ref(),c=ref(),s=ref(),u=ref(),d=ref((new Date).getTime()),m=!1,M=!0,g=null,N=null,v=0,f=!1,I=200,p=null,T=0,y=null,j=null,L=computed(function(){return classNames("".concat(selectorPrefix,"-scroll"),l.scrollClassName||"")}),D=function(e){b("pull-start"),v=(e.changedTouches?e.changedTouches[0]:e).pageY,null!=N&&N.addEventListener("touchmove",x),null!=N&&N.addEventListener("mousemove",x),null!=N&&N.addEventListener("touchend",h),null!=N&&N.addEventListener("mouseup",h)},x=function(e){var t,l;N&&(N.style.overflow="hidden",t=(e.changedTouches?e.changedTouches[0]:e).pageY-v,l=Math.abs(t),0<t?(e.preventDefault(),f=!0,l<I?(z(N,"".concat(l,"px"),0),z(p,"calc(-100% + ".concat(l,"px)"),0),T+80<=l?(A(y,0,150),m=!0,b("pull-can-refresh")):(A(y,180,150),m=!1),p.style.display="flex"):(z(N,"".concat(I,"px"),0),z(p,"calc(-100% + ".concat(I,"px)"),0),A(y,0,150),m=!0,b("pull-bottom"))):f?(e.preventDefault(),z(N,"0px",0),z(p,"calc(-100% + 0px)",0),A(y,180,0)):E())},h=function(e){var e=(e.changedTouches?e.changedTouches[0]:e).pageY-v,t=Math.abs(e);(0<e?!(t<I)||T+80<=t?w:(b("pull-rebound"),C):E)()},z=function(e,t,l){e.style.transition=e.style.webkitTransition="transform ".concat(l=void 0===l?0:l,"ms ease"),e.style.transform=e.style.webkitTransform="translate3d(0,".concat(t,",0)")},A=function(e,t,l){e.style.transition=e.style.webkitTransition="transform ".concat(l=void 0===l?0:l,"ms linear"),e.style.transform=e.style.webkitTransform="rotate(".concat(t,"deg)")},b=function(e,t){r(e,t)},E=function(){t(),M=!(f=!1),p.style.display="flex",i.value.style.display="none",j.style.display="flex",A(y,180,0),N.style.overflowY="auto",g.style.display="none"},w=function(){g.style.display="block",t(),null!=N&&N.addEventListener("transitionend",function e(){j.style.display="none",i.value.style.display="block",b("pull-refresh",C),null!=N&&N.removeEventListener("transitionend",e),d.value=moment().valueOf()}),z(N,"".concat(T,"px"),500),z(p,"calc(-100% + ".concat(T,"px)"),500),A(y,180,300)},C=function(){E(),null!=N&&N.addEventListener("transitionend",function e(){null!=N&&N.removeEventListener("transitionend",e),j.style.display="flex"}),z(N,"0px",200),z(p,"calc(-100% + 0px)",200)};return onMounted(function(){p=u.value,y=a.value,N=c.value,j=s.value,I=l.pullHeight<=0?200:l.pullHeight>(null==N?void 0:N.clientHeight)?null==N?void 0:N.clientHeight:l.pullHeight,T=p.clientHeight,null!=N&&N.addEventListener("touchstart",D),null!=N&&N.addEventListener("mousedown",D),null!=N&&N.addEventListener("scroll",n)}),e({resetUpdateTime:function(t){return new Promise(function(e){d.value=t||moment().valueOf(),e(null)})},getUpdateTime:function(){return d.value}}),(g=document.querySelector(".".concat(selectorPrefix,"-mask")))||((g=document.createElement("div")).className="".concat(selectorPrefix,"-mask"),document.body.appendChild(g)),function(){var e,t;return _createVNode("div",{class:selectorPrefix},[_createVNode("div",{class:L.value,ref:c},[null==(t=null==o?void 0:o.default)?void 0:t.call(o)]),_createVNode("div",{class:"".concat(selectorPrefix,"-trigger"),ref:u},[_createVNode("div",{class:"".concat(selectorPrefix,"-trigger-inner"),ref:s},[o.icon?_createVNode("div",{class:"".concat(selectorPrefix,"-trigger-icon")},[_createVNode("div",{class:"".concat(selectorPrefix,"-trigger-icon-inner"),ref:a},[null==(t=null==o?void 0:o.icon)?void 0:t.call(o)])]):l.renderIcon?_createVNode("div",{class:"".concat(selectorPrefix,"-trigger-icon")},[_createVNode("div",{class:"".concat(selectorPrefix,"-trigger-icon-inner"),ref:a},[l.renderIcon])]):_createVNode("div",{class:"".concat(selectorPrefix,"-trigger-icon")},[_createVNode("img",{class:"".concat(selectorPrefix,"-trigger-icon-inner"),src:defaultImg,alt:"",ref:a},null)]),_createVNode("p",{class:"".concat(selectorPrefix,"-trigger-label")},[m?(null==(e=null==o?void 0:o.canLabel)?void 0:e.call(o))||l.renderCanLabel||_createVNode("span",null,[Intl.tv("松开刷新")]):(null==(e=null==o?void 0:o.label)?void 0:e.call(o))||l.renderLabel||_createVNode("span",null,[Intl.tv("下拉刷新")])]),l.isShowUpdateTime?_createVNode("p",{class:"".concat(selectorPrefix,"-trigger-update")},[Intl.tv("更新时间"),_createTextVNode("："),_createVNode("span",{class:"".concat(selectorPrefix,"-trigger-update-label")},[moment(d.value).format(l.updateTimeFormat)])]):null]),l.loadingAnimation?_createVNode("div",{class:classNames("".concat(selectorPrefix,"-trigger-refresh"),l.loadingAnimation||""),ref:i},[_createVNode("div",null,null),_createVNode("div",null,null),_createVNode("div",null,null),_createVNode("div",null,null),_createVNode("div",null,null)]):_createVNode("div",{class:"".concat(selectorPrefix,"-trigger-refresh"),ref:i},[(null==(t=null==o?void 0:o.loadingAnimation)?void 0:t.call(o))||l.renderLoadingAnimation])])])}}});
//# sourceMappingURL=pullrefresh.js.map
