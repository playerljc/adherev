"use strict";var _vue=require("vue"),tslib_1=(require("core-js/modules/es.object.define-property.js"),require("core-js/modules/es.object.to-string.js"),require("core-js/modules/es.promise.js"),Object.defineProperty(exports,"__esModule",{value:!0}),exports.pullRefreshProps=void 0,require("tslib")),classnames_1=tslib_1.__importDefault(require("classnames")),moment_1=tslib_1.__importDefault(require("moment")),vue_1=require("vue"),vue_types_1=require("vue-types"),adherev_util_intl_1=tslib_1.__importDefault(require("@baifendian/adherev-util-intl")),adherev_util_resource_1=tslib_1.__importDefault(require("@baifendian/adherev-util-resource")),selectorPrefix="adherev-ui-pullrefresh",defaultImg="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+DQo8c3ZnIHN0eWxlPSJ3aWR0aDozMDhweDtoZWlnaHQ6MzA4cHg7IiB2ZXJzaW9uPSIxLjEiIGlkPSLlm77lvaIiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4IiB3aWR0aD0iMTAyNHB4IiBoZWlnaHQ9IjEwMjRweCIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgZW5hYmxlLWJhY2tncm91bmQ9Im5ldyAwIDAgMTAyNCAxMDI0IiB4bWw6c3BhY2U9InByZXNlcnZlIj4NCiAgPHBhdGggY2xhc3M9InN2Z3BhdGgiIGRhdGEtaW5kZXg9InBhdGhfMCIgZmlsbD0iI2VjZjBmMSIgZD0iTTc5Ny43NjQ0MiAzMjYuNTU4NDFjLTguODg0MTk5LTE1LjU2MzMyNy0yNTIuODgwMS0yODYuODE5MDE5LTI2OC4zNzk1MTItMzEzLjU2NzQ4OS0xMC4xMzA1NDQtMTcuNDQ4ODIzLTM0LjI1ODQ5NS0xNy4xOTMxNjItNDQuMzg5MDM4IDBDNDczLjY1MDkzOSAzMi4yNjEzMjQgMjMwLjk5NzI1NSAzMDQuNjM1NTMgMjE4LjM3NDAyMyAzMjcuNDIxMjY0Yy05LjIzNTczMiAxNi41NTQwMTEgMC45NTg3MjcgMzguMzgxMDE5IDIxLjk1NDgzNyAzOC4zODEwMTlsMTE5LjkwNDczMSAwIDAgMjU2LjQ5MTMwMyAwIDM2Ljc4MzE0MSAyOTEuODM2MzU0IDAgMC0yOTMuMzA2NDAyIDEyMy41Nzk4NDkgMEM3OTQuNjk2NDk1IDM2NS43NzAzMjUgODA4Ljk0OTU2MiAzNDYuMTE2NDMxIDc5Ny43NjQ0MiAzMjYuNTU4NDF6IiAvPg0KPHBhdGggY2xhc3M9InN2Z3BhdGgiIGRhdGEtaW5kZXg9InBhdGhfMSIgZmlsbD0iI2VjZjBmMSIgZD0iTTM2MC4yMDE2MzMgNjg5LjY5MjA2MWwyOTIuMzE1NzE4IDAgMCA5MC45MTkyMzItMjkyLjMxNTcxOCAwIDAtOTAuOTE5MjMyWiIgLz4NCjxwYXRoIGNsYXNzPSJzdmdwYXRoIiBkYXRhLWluZGV4PSJwYXRoXzIiIGZpbGw9IiNlY2YwZjEiIGQ9Ik0zNjAuMjAxNjMzIDg0MC45MTUxOTFsMjkyLjMxNTcxOCAwIDAgNjAuNTkxNTE2LTI5Mi4zMTU3MTggMCAwLTYwLjU5MTUxNloiIC8+DQo8cGF0aCBjbGFzcz0ic3ZncGF0aCIgZGF0YS1pbmRleD0icGF0aF8zIiBmaWxsPSIjZWNmMGYxIiBkPSJNMzYwLjIwMTYzMyA5OTIuMzkzOTgybDI5MC40MzAyMjIgMCAwIDMwLjI5NTc1OC0yOTAuNDMwMjIyIDAgMC0zMC4yOTU3NThaIiAvPg0KDQo8L3N2Zz4NCg==";exports.pullRefreshProps={scrollClassName:(0,vue_types_1.string)().def(""),pullHeight:(0,vue_types_1.number)().def(200),isShowUpdateTime:(0,vue_types_1.bool)().def(!0),updateTime:(0,vue_types_1.number)().def((0,moment_1.default)().valueOf()),updateTimeFormat:(0,vue_types_1.string)().def(adherev_util_resource_1.default.Dict.value.ResourceMomentFormat18.value()),loadingAnimation:(0,vue_types_1.string)().def("la-ball-circus la-dark"),renderIcon:(0,vue_types_1.object)(),renderCanLabel:(0,vue_types_1.object)(),renderLabel:(0,vue_types_1.object)(),renderLoadingAnimation:(0,vue_types_1.object)()},exports.default=(0,vue_1.defineComponent)({name:"adv-pullrefresh",props:exports.pullRefreshProps,slots:["icon","canLabel","label","loadingAnimation"],emits:["pull-start","pull-can-refresh","pull-bottom","pull-rebound","pull-refresh"],setup:function(l,e){function t(e){0===(null==e?void 0:e.target.scrollTop)?(g=!0,null!=f&&f.addEventListener("touchstart",x),null!=f&&f.addEventListener("mousedown",x)):g&&(g=!1,null!=f&&f.removeEventListener("touchstart",x),null!=f&&f.removeEventListener("mousedown",x))}function n(){m.style.display="block",D(),null!=f&&f.addEventListener("transitionend",function e(){j.style.display="none",o.value.style.display="block",E("pull-refresh",r),null!=f&&f.removeEventListener("transitionend",e),v.value=(0,moment_1.default)().valueOf()}),b(f,"".concat(y,"px"),500),b(I,"calc(-100% + ".concat(y,"px)"),500),A(T,180,300)}function r(){w(),null!=f&&f.addEventListener("transitionend",function e(){null!=f&&f.removeEventListener("transitionend",e),j.style.display="flex"}),b(f,"0px",200),b(I,"calc(-100% + 0px)",200)}var i=e.slots,a=e.emit,e=e.expose,u=(0,vue_1.ref)(),o=(0,vue_1.ref)(),c=(0,vue_1.ref)(),s=(0,vue_1.ref)(),d=(0,vue_1.ref)(),v=(0,vue_1.ref)((new Date).getTime()),M=!1,g=!0,m=null,f=null,N=0,p=!1,_=200,I=null,y=0,T=null,j=null,h=(0,vue_1.computed)(function(){return(0,classnames_1.default)("".concat(selectorPrefix,"-scroll"),l.scrollClassName||"")}),D=function(){null!=f&&f.removeEventListener("mousemove",L),null!=f&&f.removeEventListener("mouseup",z),null!=f&&f.removeEventListener("touchmove",L),null!=f&&f.removeEventListener("touchend",z)},x=function(e){E("pull-start"),N=(e.changedTouches?e.changedTouches[0]:e).pageY,null!=f&&f.addEventListener("touchmove",L),null!=f&&f.addEventListener("mousemove",L),null!=f&&f.addEventListener("touchend",z),null!=f&&f.addEventListener("mouseup",z)},L=function(e){var t,l;f&&(f.style.overflow="hidden",t=(e.changedTouches?e.changedTouches[0]:e).pageY-N,l=Math.abs(t),0<t?(e.preventDefault(),p=!0,l<_?(b(f,"".concat(l,"px"),0),b(I,"calc(-100% + ".concat(l,"px)"),0),y+80<=l?(A(T,0,150),M=!0,E("pull-can-refresh")):(A(T,180,150),M=!1),I.style.display="flex"):(b(f,"".concat(_,"px"),0),b(I,"calc(-100% + ".concat(_,"px)"),0),A(T,0,150),M=!0,E("pull-bottom"))):p?(e.preventDefault(),b(f,"0px",0),b(I,"calc(-100% + 0px)",0),A(T,180,0)):w())},z=function(e){var e=(e.changedTouches?e.changedTouches[0]:e).pageY-N,t=Math.abs(e);(0<e?!(t<_)||y+80<=t?n:(E("pull-rebound"),r):w)()},b=function(e,t,l){e.style.transition=e.style.webkitTransition="transform ".concat(l=void 0===l?0:l,"ms ease"),e.style.transform=e.style.webkitTransform="translate3d(0,".concat(t,",0)")},A=function(e,t,l){e.style.transition=e.style.webkitTransition="transform ".concat(l=void 0===l?0:l,"ms linear"),e.style.transform=e.style.webkitTransform="rotate(".concat(t,"deg)")},E=function(e,t){a(e,t)},w=function(){D(),g=!(p=!1),I.style.display="flex",o.value.style.display="none",j.style.display="flex",A(T,180,0),f.style.overflowY="auto",m.style.display="none"};return(0,vue_1.onMounted)(function(){I=d.value,T=u.value,f=c.value,j=s.value,_=l.pullHeight<=0?200:l.pullHeight>(null==f?void 0:f.clientHeight)?null==f?void 0:f.clientHeight:l.pullHeight,y=I.clientHeight,null!=f&&f.addEventListener("touchstart",x),null!=f&&f.addEventListener("mousedown",x),null!=f&&f.addEventListener("scroll",t)}),e({resetUpdateTime:function(t){return new Promise(function(e){v.value=t||(0,moment_1.default)().valueOf(),e(null)})},getUpdateTime:function(){return v.value},refresh:n}),(m=document.querySelector(".".concat(selectorPrefix,"-mask")))||((m=document.createElement("div")).className="".concat(selectorPrefix,"-mask"),document.body.appendChild(m)),function(){var e,t;return(0,_vue.createVNode)("div",{class:selectorPrefix},[(0,_vue.createVNode)("div",{class:h.value,ref:c},[null==(t=null==i?void 0:i.default)?void 0:t.call(i)]),(0,_vue.createVNode)("div",{class:"".concat(selectorPrefix,"-trigger"),ref:d},[(0,_vue.createVNode)("div",{class:"".concat(selectorPrefix,"-trigger-inner"),ref:s},[i.icon?(0,_vue.createVNode)("div",{class:"".concat(selectorPrefix,"-trigger-icon")},[(0,_vue.createVNode)("div",{class:"".concat(selectorPrefix,"-trigger-icon-inner"),ref:u},[null==(t=null==i?void 0:i.icon)?void 0:t.call(i)])]):l.renderIcon?(0,_vue.createVNode)("div",{class:"".concat(selectorPrefix,"-trigger-icon")},[(0,_vue.createVNode)("div",{class:"".concat(selectorPrefix,"-trigger-icon-inner"),ref:u},[l.renderIcon])]):(0,_vue.createVNode)("div",{class:"".concat(selectorPrefix,"-trigger-icon")},[(0,_vue.createVNode)("img",{class:"".concat(selectorPrefix,"-trigger-icon-inner"),src:defaultImg,alt:"",ref:u},null)]),(0,_vue.createVNode)("p",{class:"".concat(selectorPrefix,"-trigger-label")},[M?(null==(e=null==i?void 0:i.canLabel)?void 0:e.call(i))||l.renderCanLabel||(0,_vue.createVNode)("span",null,[adherev_util_intl_1.default.tv("松开刷新")]):(null==(e=null==i?void 0:i.label)?void 0:e.call(i))||l.renderLabel||(0,_vue.createVNode)("span",null,[adherev_util_intl_1.default.tv("下拉刷新")])]),l.isShowUpdateTime?(0,_vue.createVNode)("p",{class:"".concat(selectorPrefix,"-trigger-update")},[adherev_util_intl_1.default.tv("更新时间"),(0,_vue.createTextVNode)("："),(0,_vue.createVNode)("span",{class:"".concat(selectorPrefix,"-trigger-update-label")},[(0,moment_1.default)(v.value).format(l.updateTimeFormat)])]):null]),l.loadingAnimation?(0,_vue.createVNode)("div",{class:(0,classnames_1.default)("".concat(selectorPrefix,"-trigger-refresh"),l.loadingAnimation||""),ref:o},[(0,_vue.createVNode)("div",null,null),(0,_vue.createVNode)("div",null,null),(0,_vue.createVNode)("div",null,null),(0,_vue.createVNode)("div",null,null),(0,_vue.createVNode)("div",null,null)]):(0,_vue.createVNode)("div",{class:"".concat(selectorPrefix,"-trigger-refresh"),ref:o},[(null==(t=null==i?void 0:i.loadingAnimation)?void 0:t.call(i))||l.renderLoadingAnimation])])])}}});
//# sourceMappingURL=pullrefresh.js.map
