{"version":3,"file":"AnchorNavigation.js","sources":["AnchorNavigation.js"],"sourcesContent":["\"use strict\";\n\nrequire(\"core-js/modules/es.object.define-property.js\");\n\nrequire(\"core-js/modules/es.string.anchor.js\");\n\nrequire(\"core-js/modules/es.object.to-string.js\");\n\nrequire(\"core-js/modules/web.dom-collections.for-each.js\");\n\nrequire(\"core-js/modules/es.array.find.js\");\n\nrequire(\"core-js/modules/es.array.map.js\");\n\nrequire(\"core-js/modules/es.function.name.js\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.AnchorNavigationPropTypes = void 0;\n\nvar tslib_1 = require(\"tslib\");\n\nvar adherev_ui_conditionalrender_1 = tslib_1.__importDefault(require(\"@baifendian/adherev-ui-conditionalrender\"));\n\nvar adherev_util_1 = tslib_1.__importDefault(require(\"@baifendian/adherev-util\"));\n\nexports.AnchorNavigationPropTypes = {\n  defaultActiveAnchor: {\n    type: String,\n    default: ''\n  },\n  anchors: {\n    type: Array,\n    default: function _default() {\n      return [];\n    }\n  },\n  anchorPosition: {\n    type: Object,\n    default: function _default() {\n      return {\n        top: 77,\n        width: 120\n      };\n    }\n  },\n  scrollEl: {\n    type: HTMLElement,\n    default: function _default() {\n      return null;\n    }\n  }\n};\nvar selectPrefix = 'adherev-ui-playground-anchor-navigation';\nvar AnchorNavigation = {\n  name: 'adv-playground-anchor-navigation',\n  props: tslib_1.__assign({}, exports.AnchorNavigationPropTypes),\n  data: function data() {\n    return {\n      activeAnchor: this.defaultActiveAnchor,\n      $anchorDimensionIndex: []\n    };\n  },\n  watch: {\n    defaultActiveAnchor: function defaultActiveAnchor(activeAnchor) {\n      this.activeAnchor = activeAnchor;\n    },\n    scrollEl: function scrollEl(_scrollEl, oldVal) {\n      if (oldVal) {\n        oldVal.removeEventListener('scroll', this.onWrapScroll);\n      }\n\n      if (!_scrollEl) return;\n      this.createAnchorDimensionIndex();\n\n      _scrollEl.addEventListener('scroll', this.onWrapScroll);\n    }\n  },\n  mounted: function mounted() {\n    if (typeof window === 'undefined') return;\n    window.addEventListener('hashchange', this.onHashChange);\n    var scrollEl = this.scrollEl;\n\n    if (scrollEl) {\n      this.createAnchorDimensionIndex();\n      scrollEl.addEventListener('scroll', this.onWrapScroll);\n    }\n  },\n  beforeDestroy: function beforeDestroy() {\n    if (typeof window === 'undefined') return;\n    window.removeEventListener('hashchange', this.onHashChange);\n    var scrollEl = this.scrollEl;\n    if (!scrollEl) return;\n    scrollEl.removeEventListener('scroll', this.onWrapScroll);\n  },\n  methods: {\n    /**\n     * onHashChange\n     */\n    onHashChange: function onHashChange() {\n      this.activeAnchor = window.location.hash.substring(1);\n    },\n\n    /**\n     * onWrapScroll\n     */\n    onWrapScroll: function onWrapScroll() {\n      var _a = this,\n          scrollEl = _a.scrollEl,\n          anchorRef = _a.$refs.anchorRef;\n\n      if (!scrollEl) return;\n      var scrollTop = scrollEl.scrollTop;\n      var anchor = this.findAnchorByScrollVal(scrollTop);\n\n      if (anchor) {\n        this.activeAnchor = anchor.anchor;\n      }\n\n      if (scrollTop === 0) {\n        anchorRef.classList.remove(selectPrefix + \"-affix\");\n      } else {\n        anchorRef.classList.add(selectPrefix + \"-affix\");\n        anchorRef.style.top = this.anchorPosition.top + \"px\";\n      }\n    },\n\n    /**\n     * createAnchorDimensionIndex\n     */\n    createAnchorDimensionIndex: function createAnchorDimensionIndex() {\n      var _a = this,\n          scrollEl = _a.scrollEl,\n          $data = _a.$data;\n\n      if (!scrollEl) return;\n      var container = scrollEl;\n      $data.$anchorDimensionIndex = [];\n      this.anchors.forEach(function (_a, index) {\n        var anchor = _a.anchor;\n        var el = document.getElementById(anchor);\n        if (!el) return;\n        var top = adherev_util_1.default.getTopUntil({\n          el: el,\n          untilEl: container\n        });\n        var entry = {\n          anchor: anchor,\n          range: {\n            top: top,\n            bottom: undefined\n          }\n        };\n        $data.$anchorDimensionIndex.push(entry);\n\n        if (index !== 0) {\n          $data.$anchorDimensionIndex[index - 1].range.bottom = top;\n        }\n\n        if (index === $data.$anchorDimensionIndex.length - 1) {\n          // @ts-ignore\n          entry.range.bottom = top + el.offsetHeight;\n        }\n      });\n    },\n\n    /**\n     * findAnchorByScrollVal\n     * @param scrollVal\n     */\n    findAnchorByScrollVal: function findAnchorByScrollVal(scrollVal) {\n      var $data = this.$data;\n      return $data.$anchorDimensionIndex.find(function (anchorIndexItem) {\n        return scrollVal >= anchorIndexItem.range.top && scrollVal <= anchorIndexItem.range.bottom;\n      });\n    }\n  },\n  render: function render(h) {\n    var _this = this;\n\n    return h(\"div\", {\n      \"class\": selectPrefix\n    }, [h(\"div\", {\n      \"class\": selectPrefix + \"-auto\"\n    }, [h(\"div\", {\n      \"class\": selectPrefix + \"-inner\"\n    }, [this.$slots.default])]), h(adherev_ui_conditionalrender_1.default, {\n      \"attrs\": {\n        \"conditional\": !!this.anchors.length\n      }\n    }, [h(\"div\", {\n      \"class\": selectPrefix + \"-fixed\",\n      \"style\": {\n        width: this.anchorPosition.width + \"px\"\n      }\n    }, [h(\"ul\", {\n      \"class\": selectPrefix + \"-anchor\",\n      \"ref\": \"anchorRef\"\n    }, [this.anchors.map(function (anchor) {\n      return h(\"li\", {\n        \"class\": anchor.anchor === _this.activeAnchor ? selectPrefix + \"-active\" : '',\n        \"attrs\": {\n          \"title\": anchor.name\n        }\n      }, [h(\"a\", {\n        \"attrs\": {\n          \"href\": \"#\" + anchor.anchor\n        }\n      }, [anchor.name])]);\n    })])])])]);\n  }\n};\nexports.default = AnchorNavigation;"],"names":["require","Object","defineProperty","exports","value","AnchorNavigationPropTypes","tslib_1","adherev_ui_conditionalrender_1","__importDefault","adherev_util_1","defaultActiveAnchor","type","String","default","anchors","Array","anchorPosition","top","width","scrollEl","HTMLElement","selectPrefix","AnchorNavigation","name","props","__assign","data","activeAnchor","this","$anchorDimensionIndex","watch","_scrollEl","oldVal","removeEventListener","onWrapScroll","createAnchorDimensionIndex","addEventListener","mounted","window","onHashChange","beforeDestroy","methods","location","hash","substring","scrollTop","anchorRef","$refs","anchor","findAnchorByScrollVal","classList","remove","add","style","container","$data","forEach","_a","index","el","document","getElementById","getTopUntil","untilEl","push","entry","range","bottom","undefined","length","offsetHeight","scrollVal","find","anchorIndexItem","render","h","_this","class","$slots","attrs","conditional","ref","map","title","href"],"mappings":"aAEAA,QAAQ,gDAERA,QAAQ,uCAERA,QAAQ,0CAERA,QAAQ,mDAERA,QAAQ,oCAERA,QAAQ,mCAERA,QAAQ,uCAERC,OAAOC,eAAeC,QAAS,aAAc,CAC3CC,OAAO,IAETD,QAAQE,+BAA4B,EAEpC,IAAIC,QAAUN,QAAQ,SAElBO,+BAAiCD,QAAQE,gBAAgBR,QAAQ,6CAEjES,eAAiBH,QAAQE,gBAAgBR,QAAQ,6BAErDG,QAAQE,0BAA4B,CAClCK,oBAAqB,CACnBC,KAAMC,OACNC,QAAS,IAEXC,QAAS,CACPH,KAAMI,MACNF,QAAS,WACP,MAAO,KAGXG,eAAgB,CACdL,KAAMV,OACNY,QAAS,WACP,MAAO,CACLI,IAAK,GACLC,MAAO,OAIbC,SAAU,CACRR,KAAMS,YACNP,QAAS,WACP,OAAO,QAIb,IAAIQ,aAAe,0CACfC,iBAAmB,CACrBC,KAAM,mCACNC,MAAOlB,QAAQmB,SAAS,GAAItB,QAAQE,2BACpCqB,KAAM,WACJ,MAAO,CACLC,aAAcC,KAAKlB,oBACnBmB,sBAAuB,KAG3BC,MAAO,CACLpB,oBAAqB,SAA6BiB,GAChDC,KAAKD,aAAeA,GAEtBR,SAAU,SAAkBY,EAAWC,GACjCA,GACFA,EAAOC,oBAAoB,SAAUL,KAAKM,cAGvCH,IACLH,KAAKO,6BAELJ,EAAUK,iBAAiB,SAAUR,KAAKM,iBAG9CG,QAAS,WACP,IAEIlB,EAFkB,oBAAXmB,SACXA,OAAOF,iBAAiB,aAAcR,KAAKW,eACvCpB,EAAWS,KAAKT,YAGlBS,KAAKO,6BACLhB,EAASiB,iBAAiB,SAAUR,KAAKM,iBAG7CM,cAAe,WACb,IAEIrB,EAFkB,oBAAXmB,SACXA,OAAOL,oBAAoB,aAAcL,KAAKW,eAC1CpB,EAAWS,KAAKT,WAEpBA,EAASc,oBAAoB,SAAUL,KAAKM,gBAE9CO,QAAS,CAIPF,aAAc,WACZX,KAAKD,aAAeW,OAAOI,SAASC,KAAKC,UAAU,IAMrDV,aAAc,WACZ,IAKIW,EAJA1B,EADKS,KACST,SACd2B,EAFKlB,KAEUmB,MAAMD,UAEpB3B,IACD0B,EAAY1B,EAAS0B,WACrBG,EAASpB,KAAKqB,sBAAsBJ,MAGtCjB,KAAKD,aAAeqB,EAAOA,QAGX,IAAdH,EACFC,EAAUI,UAAUC,OAAO9B,aAAe,WAE1CyB,EAAUI,UAAUE,IAAI/B,aAAe,UACvCyB,EAAUO,MAAMpC,IAAMW,KAAKZ,eAAeC,IAAM,QAOpDkB,2BAA4B,WAC1B,IAKImB,EAJAnC,EADKS,KACST,SACdoC,EAFK3B,KAEM2B,MAEVpC,IACDmC,EAAYnC,EAChBoC,EAAM1B,sBAAwB,GAC9BD,KAAKd,QAAQ0C,QAAQ,SAAUC,EAAIC,GACjC,IAAIV,EAASS,EAAGT,OACZW,EAAKC,SAASC,eAAeb,GAC5BW,IACD1C,EAAMR,eAAeI,QAAQiD,YAAY,CAC3CH,GAAIA,EACJI,QAAST,IASXC,EAAM1B,sBAAsBmC,KAPxBC,EAAQ,CACVjB,OAAQA,EACRkB,MAAO,CACLjD,IAAKA,EACLkD,YAAQC,KAKE,IAAVV,IACFH,EAAM1B,sBAAsB6B,EAAQ,GAAGQ,MAAMC,OAASlD,GAGpDyC,IAAUH,EAAM1B,sBAAsBwC,OAAS,IAEjDJ,EAAMC,MAAMC,OAASlD,EAAM0C,EAAGW,mBASpCrB,sBAAuB,SAA+BsB,GAEpD,OADY3C,KAAK2B,MACJ1B,sBAAsB2C,KAAK,SAAUC,GAChD,OAAOF,GAAaE,EAAgBP,MAAMjD,KAAOsD,GAAaE,EAAgBP,MAAMC,WAI1FO,OAAQ,SAAgBC,GACtB,IAAIC,EAAQhD,KAEZ,OAAO+C,EAAE,MAAO,CACdE,MAASxD,cACR,CAACsD,EAAE,MAAO,CACXE,MAASxD,aAAe,SACvB,CAACsD,EAAE,MAAO,CACXE,MAASxD,aAAe,UACvB,CAACO,KAAKkD,OAAOjE,YAAa8D,EAAEpE,+BAA+BM,QAAS,CACrEkE,MAAS,CACPC,cAAiBpD,KAAKd,QAAQuD,SAE/B,CAACM,EAAE,MAAO,CACXE,MAASxD,aAAe,SACxBgC,MAAS,CACPnC,MAAOU,KAAKZ,eAAeE,MAAQ,OAEpC,CAACyD,EAAE,KAAM,CACVE,MAASxD,aAAe,UACxB4D,IAAO,aACN,CAACrD,KAAKd,QAAQoE,IAAI,SAAUlC,GAC7B,OAAO2B,EAAE,KAAM,CACbE,MAAS7B,EAAOA,SAAW4B,EAAMjD,aAAeN,aAAe,UAAY,GAC3E0D,MAAS,CACPI,MAASnC,EAAOzB,OAEjB,CAACoD,EAAE,IAAK,CACTI,MAAS,CACPK,KAAQ,IAAMpC,EAAOA,SAEtB,CAACA,EAAOzB,qBAIjBpB,QAAQU,QAAUS"}