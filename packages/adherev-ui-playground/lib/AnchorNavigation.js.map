{"version":3,"file":"AnchorNavigation.js","sources":["AnchorNavigation.js"],"sourcesContent":["\"use strict\";\n\nvar _vue = require(\"vue\");\n\nrequire(\"core-js/modules/es.object.define-property.js\");\n\nrequire(\"core-js/modules/es.string.anchor.js\");\n\nrequire(\"core-js/modules/es.object.to-string.js\");\n\nrequire(\"core-js/modules/web.dom-collections.for-each.js\");\n\nrequire(\"core-js/modules/es.array.find.js\");\n\nrequire(\"core-js/modules/es.array.map.js\");\n\nrequire(\"core-js/modules/es.function.name.js\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.anchorNavigationProps = void 0;\n\nvar tslib_1 = require(\"tslib\");\n\nvar adherev_ui_conditionalrender_1 = (0, tslib_1.__importDefault)(require(\"@baifendian/adherev-ui-conditionalrender\"));\nvar adherev_util_1 = (0, tslib_1.__importDefault)(require(\"@baifendian/adherev-util\"));\n\nvar vue_1 = require(\"vue\");\n\nvar vue_types_1 = require(\"vue-types\");\n\nvar selectPrefix = 'adherev-ui-playground-anchor-navigation';\nexports.anchorNavigationProps = {\n  defaultActiveAnchor: (0, vue_types_1.string)().def(''),\n  anchors: (0, vue_types_1.array)().def([]),\n  anchorPosition: (0, vue_types_1.object)().def({\n    top: 77,\n    width: 120\n  }),\n  scrollEl: (0, vue_types_1.object)()\n};\nexports.default = (0, vue_1.defineComponent)({\n  name: 'adv-playground-anchor-navigation',\n  props: exports.anchorNavigationProps,\n  setup: function setup(props, _a) {\n    var slots = _a.slots;\n    var activeAnchor = (0, vue_1.ref)(props.defaultActiveAnchor);\n    var anchorRef = (0, vue_1.ref)();\n    var anchorDimensionIndex = [];\n\n    var onHashChange = function onHashChange() {\n      activeAnchor.value = window.location.hash.substring(1);\n    };\n\n    var onWrapScroll = function onWrapScroll() {\n      var _a, _b, _c, _d, _e, _f;\n\n      if (!props.scrollEl) return;\n      var scrollTop = props.scrollEl.scrollTop;\n      var anchor = findAnchorByScrollVal(scrollTop);\n\n      if (anchor) {\n        activeAnchor.value = anchor.anchor;\n      }\n\n      if (!anchorRef.value) return;\n\n      if (scrollTop === 0) {\n        (_c = (_b = (_a = anchorRef === null || anchorRef === void 0 ? void 0 : anchorRef.value) === null || _a === void 0 ? void 0 : _a.classList) === null || _b === void 0 ? void 0 : _b.remove) === null || _c === void 0 ? void 0 : _c.call(_b, \"\".concat(selectPrefix, \"-affix\"));\n      } else {\n        (_f = (_e = (_d = anchorRef === null || anchorRef === void 0 ? void 0 : anchorRef.value) === null || _d === void 0 ? void 0 : _d.classList) === null || _e === void 0 ? void 0 : _e.add) === null || _f === void 0 ? void 0 : _f.call(_e, \"\".concat(selectPrefix, \"-affix\"));\n        anchorRef.value.style.top = \"\".concat(props.anchorPosition.top, \"px\");\n      }\n    };\n\n    var createAnchorDimensionIndex = function createAnchorDimensionIndex() {\n      if (!props.scrollEl) return;\n      var container = props.scrollEl;\n      anchorDimensionIndex = [];\n      props.anchors.forEach(function (_a, index) {\n        var _b;\n\n        var anchor = _a.anchor;\n        var el = document.getElementById(anchor);\n        if (!el) return;\n        var top = (_b = adherev_util_1.default.getTopUntil) === null || _b === void 0 ? void 0 : _b.call(adherev_util_1.default, {\n          el: el,\n          untilEl: container\n        });\n        var bottom;\n        var entry = {\n          anchor: anchor,\n          range: {\n            top: top,\n            bottom: bottom\n          }\n        };\n        anchorDimensionIndex.push(entry);\n\n        if (index !== 0) {\n          anchorDimensionIndex[index - 1].range.bottom = top;\n        }\n\n        if (index === anchorDimensionIndex.length - 1) {\n          entry.range.bottom = top + el.offsetHeight;\n        }\n      });\n    };\n\n    var findAnchorByScrollVal = function findAnchorByScrollVal(scrollVal) {\n      return anchorDimensionIndex.find(function (anchorIndexItem) {\n        // @ts-ignore\n        return scrollVal >= anchorIndexItem.range.top && scrollVal <= anchorIndexItem.range.bottom;\n      });\n    };\n\n    (0, vue_1.watch)(function () {\n      return props.defaultActiveAnchor;\n    }, function (newVal) {\n      return activeAnchor.value = newVal;\n    });\n    (0, vue_1.watch)(function () {\n      return props.scrollEl;\n    }, function (scrollEl, oldVal) {\n      var _a, _b;\n\n      (_a = oldVal === null || oldVal === void 0 ? void 0 : oldVal.removeEventListener) === null || _a === void 0 ? void 0 : _a.call(oldVal, 'scroll', onWrapScroll);\n      if (!scrollEl) return;\n      createAnchorDimensionIndex();\n      (_b = scrollEl === null || scrollEl === void 0 ? void 0 : scrollEl.addEventListener) === null || _b === void 0 ? void 0 : _b.call(scrollEl, 'scroll', onWrapScroll);\n    });\n    (0, vue_1.onMounted)(function () {\n      if (typeof window === 'undefined') return;\n      window.addEventListener('hashchange', onHashChange);\n\n      if (props.scrollEl) {\n        createAnchorDimensionIndex();\n        props.scrollEl.addEventListener('scroll', onWrapScroll);\n      }\n    });\n    (0, vue_1.onBeforeMount)(function () {\n      window.removeEventListener('hashchange', onHashChange);\n      if (!props.scrollEl) return;\n      props.scrollEl.removeEventListener('scroll', onWrapScroll);\n    });\n    return function () {\n      var _a;\n\n      return (0, _vue.createVNode)(\"div\", {\n        \"class\": selectPrefix\n      }, [(0, _vue.createVNode)(\"div\", {\n        \"class\": \"\".concat(selectPrefix, \"-auto\")\n      }, [(0, _vue.createVNode)(\"div\", {\n        \"class\": \"\".concat(selectPrefix, \"-inner\")\n      }, [(_a = slots === null || slots === void 0 ? void 0 : slots.default) === null || _a === void 0 ? void 0 : _a.call(slots)])]), (0, _vue.createVNode)(adherev_ui_conditionalrender_1.default, {\n        \"conditional\": !!props.anchors.length\n      }, {\n        default: function _default() {\n          return [(0, _vue.createVNode)(\"div\", {\n            \"class\": \"\".concat(selectPrefix, \"-fixed\"),\n            \"style\": {\n              width: \"\".concat(props.anchorPosition.width, \"px\")\n            }\n          }, [(0, _vue.createVNode)(\"ul\", {\n            \"class\": \"\".concat(selectPrefix, \"-anchor\"),\n            \"ref\": anchorRef\n          }, [props.anchors.map(function (anchor) {\n            return (0, _vue.createVNode)(\"li\", {\n              \"class\": anchor.anchor === activeAnchor.value ? \"\".concat(selectPrefix, \"-active\") : '',\n              \"title\": anchor.name\n            }, [(0, _vue.createVNode)(\"a\", {\n              \"href\": \"#\".concat(anchor.anchor)\n            }, [anchor.name])]);\n          })])])];\n        }\n      })]);\n    };\n  }\n});"],"names":["_vue","require","tslib_1","Object","defineProperty","exports","value","anchorNavigationProps","adherev_ui_conditionalrender_1","__importDefault","adherev_util_1","vue_1","vue_types_1","selectPrefix","defaultActiveAnchor","string","def","anchors","array","anchorPosition","object","top","width","scrollEl","default","defineComponent","name","props","setup","_a","onHashChange","activeAnchor","window","location","hash","substring","onWrapScroll","scrollTop","anchor","findAnchorByScrollVal","anchorRef","_c","_b","classList","remove","call","concat","_f","_e","_d","add","style","createAnchorDimensionIndex","container","anchorDimensionIndex","forEach","index","el","document","getElementById","getTopUntil","untilEl","push","entry","range","bottom","length","offsetHeight","scrollVal","find","anchorIndexItem","slots","ref","watch","newVal","oldVal","removeEventListener","addEventListener","onMounted","onBeforeMount","createVNode","class","conditional","map","title","href"],"mappings":"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"}