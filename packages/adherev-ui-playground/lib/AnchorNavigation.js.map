{"version":3,"file":"AnchorNavigation.js","sources":["AnchorNavigation.js"],"sourcesContent":["\"use strict\";\n\nrequire(\"core-js/modules/es.object.assign.js\");\n\nrequire(\"core-js/modules/es.object.define-property.js\");\n\nrequire(\"core-js/modules/es.string.anchor.js\");\n\nrequire(\"core-js/modules/es.object.to-string.js\");\n\nrequire(\"core-js/modules/web.dom-collections.for-each.js\");\n\nrequire(\"core-js/modules/es.array.find.js\");\n\nrequire(\"core-js/modules/es.array.map.js\");\n\nrequire(\"core-js/modules/es.function.name.js\");\n\nvar __assign = void 0 && (void 0).__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) {\n        if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n      }\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __importDefault = void 0 && (void 0).__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.AnchorNavigationPropTypes = void 0;\n\nvar adherev_ui_conditionalrender_1 = __importDefault(require(\"@baifendian/adherev-ui-conditionalrender\"));\n\nvar adherev_util_1 = __importDefault(require(\"@baifendian/adherev-util\"));\n\nexports.AnchorNavigationPropTypes = {\n  defaultActiveAnchor: {\n    type: String,\n    default: ''\n  },\n  anchors: {\n    type: Array,\n    default: function _default() {\n      return [];\n    }\n  },\n  anchorPosition: {\n    type: Object,\n    default: function _default() {\n      return {\n        top: 77,\n        width: 120\n      };\n    }\n  },\n  scrollEl: {\n    type: HTMLElement,\n    default: function _default() {\n      return null;\n    }\n  }\n};\nvar selectPrefix = 'adherev-ui-playground-anchor-navigation';\nexports.default = {\n  name: 'adv-playground-anchor-navigation',\n  props: __assign({}, exports.AnchorNavigationPropTypes),\n  data: function data() {\n    return {\n      activeAnchor: this.defaultActiveAnchor,\n      $anchorDimensionIndex: []\n    };\n  },\n  watch: {\n    defaultActiveAnchor: function defaultActiveAnchor(activeAnchor) {\n      this.activeAnchor = activeAnchor;\n    },\n    scrollEl: function scrollEl(_scrollEl, oldVal) {\n      if (oldVal) {\n        oldVal.removeEventListener('scroll', this.onWrapScroll);\n      }\n\n      if (!_scrollEl) return;\n      this.createAnchorDimensionIndex();\n\n      _scrollEl.addEventListener('scroll', this.onWrapScroll);\n    }\n  },\n  mounted: function mounted() {\n    if (typeof window === 'undefined') return;\n    window.addEventListener('hashchange', this.onHashChange);\n    var scrollEl = this.scrollEl;\n\n    if (scrollEl) {\n      this.createAnchorDimensionIndex();\n      scrollEl.addEventListener('scroll', this.onWrapScroll);\n    }\n  },\n  beforeDestroy: function beforeDestroy() {\n    if (typeof window === 'undefined') return;\n    window.removeEventListener('hashchange', this.onHashChange);\n    var scrollEl = this.scrollEl;\n    if (!scrollEl) return;\n    scrollEl.removeEventListener('scroll', this.onWrapScroll);\n  },\n  methods: {\n    /**\n     * onHashChange\n     */\n    onHashChange: function onHashChange() {\n      this.activeAnchor = window.location.hash.substring(1);\n    },\n\n    /**\n     * onWrapScroll\n     */\n    onWrapScroll: function onWrapScroll() {\n      var _a = this,\n          scrollEl = _a.scrollEl,\n          anchorRef = _a.$refs.anchorRef;\n\n      if (!scrollEl) return;\n      var scrollTop = scrollEl.scrollTop;\n      var anchor = this.findAnchorByScrollVal(scrollTop);\n\n      if (anchor) {\n        this.activeAnchor = anchor.anchor;\n      }\n\n      if (scrollTop === 0) {\n        anchorRef.classList.remove(selectPrefix + \"-affix\");\n      } else {\n        anchorRef.classList.add(selectPrefix + \"-affix\");\n        anchorRef.style.top = this.anchorPosition.top + \"px\";\n      }\n    },\n\n    /**\n     * createAnchorDimensionIndex\n     */\n    createAnchorDimensionIndex: function createAnchorDimensionIndex() {\n      var _a = this,\n          scrollEl = _a.scrollEl,\n          $data = _a.$data;\n\n      if (!scrollEl) return;\n      var container = scrollEl;\n      $data.$anchorDimensionIndex = [];\n      this.anchors.forEach(function (_a, index) {\n        var anchor = _a.anchor;\n        var el = document.getElementById(anchor);\n        if (!el) return;\n        var top = adherev_util_1.default.getTopUntil({\n          el: el,\n          untilEl: container\n        });\n        var entry = {\n          anchor: anchor,\n          range: {\n            top: top,\n            bottom: undefined\n          }\n        };\n        $data.$anchorDimensionIndex.push(entry);\n\n        if (index !== 0) {\n          $data.$anchorDimensionIndex[index - 1].range.bottom = top;\n        }\n\n        if (index === $data.$anchorDimensionIndex.length - 1) {\n          entry.range.bottom = top + el.offsetHeight;\n        }\n      });\n    },\n\n    /**\n     * findAnchorByScrollVal\n     * @param scrollVal\n     */\n    findAnchorByScrollVal: function findAnchorByScrollVal(scrollVal) {\n      var $data = this.$data;\n      return $data.$anchorDimensionIndex.find(function (anchorIndexItem) {\n        return scrollVal >= anchorIndexItem.range.top && scrollVal <= anchorIndexItem.range.bottom;\n      });\n    }\n  },\n  render: function render(h) {\n    var _this = this;\n\n    return h(\"div\", {\n      \"class\": selectPrefix\n    }, [h(\"div\", {\n      \"class\": selectPrefix + \"-auto\"\n    }, [h(\"div\", {\n      \"class\": selectPrefix + \"-inner\"\n    }, [this.$slots.default])]), h(adherev_ui_conditionalrender_1.default, {\n      \"attrs\": {\n        \"conditional\": !!this.anchors.length\n      }\n    }, [h(\"div\", {\n      \"class\": selectPrefix + \"-fixed\",\n      \"style\": {\n        width: this.anchorPosition.width + \"px\"\n      }\n    }, [h(\"ul\", {\n      \"class\": selectPrefix + \"-anchor\",\n      \"ref\": \"anchorRef\"\n    }, [this.anchors.map(function (anchor) {\n      return h(\"li\", {\n        \"class\": anchor.anchor === _this.activeAnchor ? selectPrefix + \"-active\" : '',\n        \"attrs\": {\n          \"title\": anchor.name\n        }\n      }, [h(\"a\", {\n        \"attrs\": {\n          \"href\": \"#\" + anchor.anchor\n        }\n      }, [anchor.name])]);\n    })])])])]);\n  }\n};"],"names":["require","__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","this","__importDefault","mod","__esModule","default","defineProperty","exports","value","AnchorNavigationPropTypes","adherev_ui_conditionalrender_1","adherev_util_1","defaultActiveAnchor","type","String","anchors","Array","anchorPosition","top","width","scrollEl","HTMLElement","selectPrefix","name","props","data","activeAnchor","$anchorDimensionIndex","watch","_scrollEl","oldVal","removeEventListener","onWrapScroll","createAnchorDimensionIndex","addEventListener","mounted","window","onHashChange","beforeDestroy","methods","location","hash","substring","scrollTop","anchorRef","$refs","anchor","findAnchorByScrollVal","classList","remove","add","style","container","$data","forEach","_a","index","el","document","getElementById","getTopUntil","untilEl","push","entry","range","bottom","undefined","offsetHeight","scrollVal","find","anchorIndexItem","render","h","_this","class","$slots","attrs","conditional","ref","map","title","href"],"mappings":"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"}