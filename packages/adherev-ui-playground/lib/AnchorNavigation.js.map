{"version":3,"file":"AnchorNavigation.js","sources":["AnchorNavigation.js"],"sourcesContent":["\"use strict\";\n\nvar _vue = require(\"vue\");\nrequire(\"core-js/modules/es.object.define-property.js\");\nrequire(\"core-js/modules/es.object.to-string.js\");\nrequire(\"core-js/modules/web.dom-collections.for-each.js\");\nrequire(\"core-js/modules/es.array.find.js\");\nrequire(\"core-js/modules/es.array.map.js\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.anchorNavigationProps = void 0;\nvar tslib_1 = require(\"tslib\");\nvar vue_1 = require(\"vue\");\nvar vue_types_1 = require(\"vue-types\");\nvar adherev_ui_conditionalrender_1 = tslib_1.__importDefault(require(\"@baifendian/adherev-ui-conditionalrender\"));\nvar adherev_util_1 = tslib_1.__importDefault(require(\"@baifendian/adherev-util\"));\nvar selectPrefix = 'adherev-ui-playground-anchor-navigation';\nexports.anchorNavigationProps = {\n  defaultActiveAnchor: (0, vue_types_1.string)().def(''),\n  anchors: (0, vue_types_1.array)().def([]),\n  anchorPosition: (0, vue_types_1.object)().def({\n    top: 77,\n    width: 120\n  }),\n  scrollEl: (0, vue_types_1.object)()\n};\nexports.default = (0, vue_1.defineComponent)({\n  name: 'adv-playground-anchor-navigation',\n  props: exports.anchorNavigationProps,\n  setup: function setup(props, _a) {\n    var slots = _a.slots;\n    var activeAnchor = (0, vue_1.ref)(props.defaultActiveAnchor);\n    var anchorRef = (0, vue_1.ref)();\n    var anchorDimensionIndex = [];\n    var onHashChange = function onHashChange() {\n      activeAnchor.value = window.location.hash.substring(1);\n    };\n    var onWrapScroll = function onWrapScroll() {\n      var _a, _b, _c, _d, _e, _f;\n      if (!props.scrollEl) return;\n      var scrollTop = props.scrollEl.scrollTop;\n      var anchor = findAnchorByScrollVal(scrollTop);\n      if (anchor) {\n        activeAnchor.value = anchor.anchor;\n      }\n      if (!anchorRef.value) return;\n      if (scrollTop === 0) {\n        (_c = (_b = (_a = anchorRef === null || anchorRef === void 0 ? void 0 : anchorRef.value) === null || _a === void 0 ? void 0 : _a.classList) === null || _b === void 0 ? void 0 : _b.remove) === null || _c === void 0 ? void 0 : _c.call(_b, \"\".concat(selectPrefix, \"-affix\"));\n      } else {\n        (_f = (_e = (_d = anchorRef === null || anchorRef === void 0 ? void 0 : anchorRef.value) === null || _d === void 0 ? void 0 : _d.classList) === null || _e === void 0 ? void 0 : _e.add) === null || _f === void 0 ? void 0 : _f.call(_e, \"\".concat(selectPrefix, \"-affix\"));\n        anchorRef.value.style.top = \"\".concat(props.anchorPosition.top, \"px\");\n      }\n    };\n    var createAnchorDimensionIndex = function createAnchorDimensionIndex() {\n      if (!props.scrollEl) return;\n      var container = props.scrollEl;\n      anchorDimensionIndex = [];\n      props.anchors.forEach(function (_a, index) {\n        var _b;\n        var anchor = _a.anchor;\n        var el = document.getElementById(anchor);\n        if (!el) return;\n        var top = (_b = adherev_util_1.default.getTopUntil) === null || _b === void 0 ? void 0 : _b.call(adherev_util_1.default, {\n          el: el,\n          untilEl: container\n        });\n        var bottom;\n        var entry = {\n          anchor: anchor,\n          range: {\n            top: top,\n            bottom: bottom\n          }\n        };\n        anchorDimensionIndex.push(entry);\n        if (index !== 0) {\n          anchorDimensionIndex[index - 1].range.bottom = top;\n        }\n        if (index === anchorDimensionIndex.length - 1) {\n          entry.range.bottom = top + el.offsetHeight;\n        }\n      });\n    };\n    var findAnchorByScrollVal = function findAnchorByScrollVal(scrollVal) {\n      return anchorDimensionIndex.find(function (anchorIndexItem) {\n        // @ts-ignore\n        return scrollVal >= anchorIndexItem.range.top && scrollVal <= anchorIndexItem.range.bottom;\n      });\n    };\n    (0, vue_1.watch)(function () {\n      return props.defaultActiveAnchor;\n    }, function (newVal) {\n      return activeAnchor.value = newVal;\n    });\n    (0, vue_1.watch)(function () {\n      return props.scrollEl;\n    }, function (scrollEl, oldVal) {\n      var _a, _b;\n      (_a = oldVal === null || oldVal === void 0 ? void 0 : oldVal.removeEventListener) === null || _a === void 0 ? void 0 : _a.call(oldVal, 'scroll', onWrapScroll);\n      if (!scrollEl) return;\n      createAnchorDimensionIndex();\n      (_b = scrollEl === null || scrollEl === void 0 ? void 0 : scrollEl.addEventListener) === null || _b === void 0 ? void 0 : _b.call(scrollEl, 'scroll', onWrapScroll);\n    });\n    (0, vue_1.onMounted)(function () {\n      if (typeof window === 'undefined') return;\n      window.addEventListener('hashchange', onHashChange);\n      if (props.scrollEl) {\n        createAnchorDimensionIndex();\n        props.scrollEl.addEventListener('scroll', onWrapScroll);\n      }\n    });\n    (0, vue_1.onBeforeMount)(function () {\n      window.removeEventListener('hashchange', onHashChange);\n      if (!props.scrollEl) return;\n      props.scrollEl.removeEventListener('scroll', onWrapScroll);\n    });\n    return function () {\n      var _a;\n      return (0, _vue.createVNode)(\"div\", {\n        \"class\": selectPrefix\n      }, [(0, _vue.createVNode)(\"div\", {\n        \"class\": \"\".concat(selectPrefix, \"-auto\")\n      }, [(0, _vue.createVNode)(\"div\", {\n        \"class\": \"\".concat(selectPrefix, \"-inner\")\n      }, [(_a = slots === null || slots === void 0 ? void 0 : slots.default) === null || _a === void 0 ? void 0 : _a.call(slots)])]), (0, _vue.createVNode)(adherev_ui_conditionalrender_1.default, {\n        \"conditional\": !!props.anchors.length\n      }, {\n        default: function _default() {\n          return [(0, _vue.createVNode)(\"div\", {\n            \"class\": \"\".concat(selectPrefix, \"-fixed\"),\n            \"style\": {\n              width: \"\".concat(props.anchorPosition.width, \"px\")\n            }\n          }, [(0, _vue.createVNode)(\"ul\", {\n            \"class\": \"\".concat(selectPrefix, \"-anchor\"),\n            \"ref\": anchorRef\n          }, [props.anchors.map(function (anchor) {\n            return (0, _vue.createVNode)(\"li\", {\n              \"class\": anchor.anchor === activeAnchor.value ? \"\".concat(selectPrefix, \"-active\") : '',\n              \"title\": anchor.name\n            }, [(0, _vue.createVNode)(\"a\", {\n              \"href\": \"#\".concat(anchor.anchor)\n            }, [anchor.name])]);\n          })])])];\n        }\n      })]);\n    };\n  }\n});"],"names":["_vue","require","tslib_1","Object","defineProperty","exports","value","anchorNavigationProps","vue_1","vue_types_1","adherev_ui_conditionalrender_1","__importDefault","adherev_util_1","selectPrefix","defaultActiveAnchor","string","def","anchors","array","anchorPosition","object","top","width","scrollEl","default","defineComponent","name","props","setup","_a","onHashChange","activeAnchor","window","location","hash","substring","onWrapScroll","scrollTop","anchor","findAnchorByScrollVal","anchorRef","_c","_b","classList","remove","call","concat","_f","_e","_d","add","style","createAnchorDimensionIndex","container","anchorDimensionIndex","forEach","index","el","document","getElementById","getTopUntil","untilEl","push","entry","range","bottom","length","offsetHeight","scrollVal","find","anchorIndexItem","slots","ref","watch","newVal","oldVal","removeEventListener","addEventListener","onMounted","onBeforeMount","createVNode","class","conditional","map","title","href"],"mappings":"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"}