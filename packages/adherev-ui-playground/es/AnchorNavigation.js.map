{"version":3,"file":"AnchorNavigation.js","sources":["AnchorNavigation.js"],"sourcesContent":["import { createVNode as _createVNode } from \"vue\";\nimport \"core-js/modules/es.string.anchor.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/web.dom-collections.for-each.js\";\nimport \"core-js/modules/es.array.find.js\";\nimport \"core-js/modules/es.array.map.js\";\nimport \"core-js/modules/es.function.name.js\";\nimport ConditionalRender from '@baifendian/adherev-ui-conditionalrender';\nimport Util from '@baifendian/adherev-util';\nimport { defineComponent, onBeforeMount, onMounted, ref, watch } from 'vue';\nimport { array, object, string } from 'vue-types';\nvar selectPrefix = 'adherev-ui-playground-anchor-navigation';\nexport var anchorNavigationProps = {\n  defaultActiveAnchor: string().def(''),\n  anchors: array().def([]),\n  anchorPosition: object().def({\n    top: 77,\n    width: 120\n  }),\n  scrollEl: object()\n};\nexport default defineComponent({\n  name: 'adv-playground-anchor-navigation',\n  props: anchorNavigationProps,\n  setup: function setup(props, _a) {\n    var slots = _a.slots;\n    var activeAnchor = ref(props.defaultActiveAnchor);\n    var anchorRef = ref();\n    var anchorDimensionIndex = [];\n\n    var onHashChange = function onHashChange() {\n      activeAnchor.value = window.location.hash.substring(1);\n    };\n\n    var onWrapScroll = function onWrapScroll() {\n      var _a, _b, _c, _d, _e, _f;\n\n      if (!props.scrollEl) return;\n      var scrollTop = props.scrollEl.scrollTop;\n      var anchor = findAnchorByScrollVal(scrollTop);\n\n      if (anchor) {\n        activeAnchor.value = anchor.anchor;\n      }\n\n      if (!anchorRef.value) return;\n\n      if (scrollTop === 0) {\n        (_c = (_b = (_a = anchorRef === null || anchorRef === void 0 ? void 0 : anchorRef.value) === null || _a === void 0 ? void 0 : _a.classList) === null || _b === void 0 ? void 0 : _b.remove) === null || _c === void 0 ? void 0 : _c.call(_b, \"\".concat(selectPrefix, \"-affix\"));\n      } else {\n        (_f = (_e = (_d = anchorRef === null || anchorRef === void 0 ? void 0 : anchorRef.value) === null || _d === void 0 ? void 0 : _d.classList) === null || _e === void 0 ? void 0 : _e.add) === null || _f === void 0 ? void 0 : _f.call(_e, \"\".concat(selectPrefix, \"-affix\"));\n        anchorRef.value.style.top = \"\".concat(props.anchorPosition.top, \"px\");\n      }\n    };\n\n    var createAnchorDimensionIndex = function createAnchorDimensionIndex() {\n      if (!props.scrollEl) return;\n      var container = props.scrollEl;\n      anchorDimensionIndex = [];\n      props.anchors.forEach(function (_a, index) {\n        var _b;\n\n        var anchor = _a.anchor;\n        var el = document.getElementById(anchor);\n        if (!el) return;\n        var top = (_b = Util.getTopUntil) === null || _b === void 0 ? void 0 : _b.call(Util, {\n          el: el,\n          untilEl: container\n        });\n        var bottom;\n        var entry = {\n          anchor: anchor,\n          range: {\n            top: top,\n            bottom: bottom\n          }\n        };\n        anchorDimensionIndex.push(entry);\n\n        if (index !== 0) {\n          anchorDimensionIndex[index - 1].range.bottom = top;\n        }\n\n        if (index === anchorDimensionIndex.length - 1) {\n          entry.range.bottom = top + el.offsetHeight;\n        }\n      });\n    };\n\n    var findAnchorByScrollVal = function findAnchorByScrollVal(scrollVal) {\n      return anchorDimensionIndex.find(function (anchorIndexItem) {\n        // @ts-ignore\n        return scrollVal >= anchorIndexItem.range.top && scrollVal <= anchorIndexItem.range.bottom;\n      });\n    };\n\n    watch(function () {\n      return props.defaultActiveAnchor;\n    }, function (newVal) {\n      return activeAnchor.value = newVal;\n    });\n    watch(function () {\n      return props.scrollEl;\n    }, function (scrollEl, oldVal) {\n      var _a, _b;\n\n      (_a = oldVal === null || oldVal === void 0 ? void 0 : oldVal.removeEventListener) === null || _a === void 0 ? void 0 : _a.call(oldVal, 'scroll', onWrapScroll);\n      if (!scrollEl) return;\n      createAnchorDimensionIndex();\n      (_b = scrollEl === null || scrollEl === void 0 ? void 0 : scrollEl.addEventListener) === null || _b === void 0 ? void 0 : _b.call(scrollEl, 'scroll', onWrapScroll);\n    });\n    onMounted(function () {\n      if (typeof window === 'undefined') return;\n      window.addEventListener('hashchange', onHashChange);\n\n      if (props.scrollEl) {\n        createAnchorDimensionIndex();\n        props.scrollEl.addEventListener('scroll', onWrapScroll);\n      }\n    });\n    onBeforeMount(function () {\n      window.removeEventListener('hashchange', onHashChange);\n      if (!props.scrollEl) return;\n      props.scrollEl.removeEventListener('scroll', onWrapScroll);\n    });\n    return function () {\n      var _a;\n\n      return _createVNode(\"div\", {\n        \"class\": selectPrefix\n      }, [_createVNode(\"div\", {\n        \"class\": \"\".concat(selectPrefix, \"-auto\")\n      }, [_createVNode(\"div\", {\n        \"class\": \"\".concat(selectPrefix, \"-inner\")\n      }, [(_a = slots === null || slots === void 0 ? void 0 : slots.default) === null || _a === void 0 ? void 0 : _a.call(slots)])]), _createVNode(ConditionalRender, {\n        \"conditional\": !!props.anchors.length\n      }, {\n        default: function _default() {\n          return [_createVNode(\"div\", {\n            \"class\": \"\".concat(selectPrefix, \"-fixed\"),\n            \"style\": {\n              width: \"\".concat(props.anchorPosition.width, \"px\")\n            }\n          }, [_createVNode(\"ul\", {\n            \"class\": \"\".concat(selectPrefix, \"-anchor\"),\n            \"ref\": anchorRef\n          }, [props.anchors.map(function (anchor) {\n            return _createVNode(\"li\", {\n              \"class\": anchor.anchor === activeAnchor.value ? \"\".concat(selectPrefix, \"-active\") : '',\n              \"title\": anchor.name\n            }, [_createVNode(\"a\", {\n              \"href\": \"#\".concat(anchor.anchor)\n            }, [anchor.name])]);\n          })])])];\n        }\n      })]);\n    };\n  }\n});"],"names":["_createVNode","ConditionalRender","Util","defineComponent","onBeforeMount","onMounted","ref","watch","array","object","string","selectPrefix","anchorNavigationProps","defaultActiveAnchor","def","anchors","anchorPosition","top","width","scrollEl","name","props","setup","_a","onHashChange","activeAnchor","value","window","location","hash","substring","onWrapScroll","scrollTop","anchor","findAnchorByScrollVal","anchorRef","_c","_b","classList","remove","call","concat","_f","_e","_d","add","style","createAnchorDimensionIndex","container","anchorDimensionIndex","forEach","index","el","document","getElementById","getTopUntil","untilEl","push","entry","range","bottom","length","offsetHeight","scrollVal","find","anchorIndexItem","slots","newVal","oldVal","removeEventListener","addEventListener","class","default","conditional","map","title","href"],"mappings":"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"}