{"version":3,"file":"AnchorNavigation.js","sources":["AnchorNavigation.js"],"sourcesContent":["import \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/web.dom-collections.for-each.js\";\nimport \"core-js/modules/es.array.find.js\";\nimport \"core-js/modules/es.array.map.js\";\nimport { __assign } from \"tslib\";\nimport ConditionalRender from '@baifendian/adherev-ui-conditionalrender';\nimport Util from '@baifendian/adherev-util';\nexport var AnchorNavigationPropTypes = {\n  defaultActiveAnchor: {\n    type: String,\n    default: ''\n  },\n  anchors: {\n    type: Array,\n    default: function _default() {\n      return [];\n    }\n  },\n  anchorPosition: {\n    type: Object,\n    default: function _default() {\n      return {\n        top: 77,\n        width: 120\n      };\n    }\n  },\n  scrollEl: {\n    type: HTMLElement,\n    default: function _default() {\n      return null;\n    }\n  }\n};\nvar selectPrefix = 'adherev-ui-playground-anchor-navigation';\nvar AnchorNavigation = {\n  name: 'adv-playground-anchor-navigation',\n  props: __assign({}, AnchorNavigationPropTypes),\n  data: function data() {\n    return {\n      activeAnchor: this.defaultActiveAnchor,\n      $anchorDimensionIndex: []\n    };\n  },\n  watch: {\n    defaultActiveAnchor: function defaultActiveAnchor(activeAnchor) {\n      this.activeAnchor = activeAnchor;\n    },\n    scrollEl: function scrollEl(_scrollEl, oldVal) {\n      if (oldVal) {\n        oldVal.removeEventListener('scroll', this.onWrapScroll);\n      }\n      if (!_scrollEl) return;\n      this.createAnchorDimensionIndex();\n      _scrollEl.addEventListener('scroll', this.onWrapScroll);\n    }\n  },\n  mounted: function mounted() {\n    if (typeof window === 'undefined') return;\n    window.addEventListener('hashchange', this.onHashChange);\n    var scrollEl = this.scrollEl;\n    if (scrollEl) {\n      this.createAnchorDimensionIndex();\n      scrollEl.addEventListener('scroll', this.onWrapScroll);\n    }\n  },\n  beforeDestroy: function beforeDestroy() {\n    if (typeof window === 'undefined') return;\n    window.removeEventListener('hashchange', this.onHashChange);\n    var scrollEl = this.scrollEl;\n    if (!scrollEl) return;\n    scrollEl.removeEventListener('scroll', this.onWrapScroll);\n  },\n  methods: {\n    /**\n     * onHashChange\n     */\n    onHashChange: function onHashChange() {\n      this.activeAnchor = window.location.hash.substring(1);\n    },\n    /**\n     * onWrapScroll\n     */\n    onWrapScroll: function onWrapScroll() {\n      var _a = this,\n        scrollEl = _a.scrollEl,\n        anchorRef = _a.$refs.anchorRef;\n      if (!scrollEl) return;\n      var scrollTop = scrollEl.scrollTop;\n      var anchor = this.findAnchorByScrollVal(scrollTop);\n      if (anchor) {\n        this.activeAnchor = anchor.anchor;\n      }\n      if (scrollTop === 0) {\n        anchorRef.classList.remove(\"\".concat(selectPrefix, \"-affix\"));\n      } else {\n        anchorRef.classList.add(\"\".concat(selectPrefix, \"-affix\"));\n        anchorRef.style.top = \"\".concat(this.anchorPosition.top, \"px\");\n      }\n    },\n    /**\n     * createAnchorDimensionIndex\n     */\n    createAnchorDimensionIndex: function createAnchorDimensionIndex() {\n      var _a = this,\n        scrollEl = _a.scrollEl,\n        $data = _a.$data;\n      if (!scrollEl) return;\n      var container = scrollEl;\n      $data.$anchorDimensionIndex = [];\n      this.anchors.forEach(function (_a, index) {\n        var anchor = _a.anchor;\n        var el = document.getElementById(anchor);\n        if (!el) return;\n        var top = Util.getTopUntil({\n          el: el,\n          untilEl: container\n        });\n        var entry = {\n          anchor: anchor,\n          range: {\n            top: top,\n            bottom: undefined\n          }\n        };\n        $data.$anchorDimensionIndex.push(entry);\n        if (index !== 0) {\n          $data.$anchorDimensionIndex[index - 1].range.bottom = top;\n        }\n        if (index === $data.$anchorDimensionIndex.length - 1) {\n          // @ts-ignore\n          entry.range.bottom = top + el.offsetHeight;\n        }\n      });\n    },\n    /**\n     * findAnchorByScrollVal\n     * @param scrollVal\n     */\n    findAnchorByScrollVal: function findAnchorByScrollVal(scrollVal) {\n      var $data = this.$data;\n      return $data.$anchorDimensionIndex.find(function (anchorIndexItem) {\n        return scrollVal >= anchorIndexItem.range.top && scrollVal <= anchorIndexItem.range.bottom;\n      });\n    }\n  },\n  render: function render(h) {\n    var _this = this;\n    return h(\"div\", {\n      \"class\": selectPrefix\n    }, [h(\"div\", {\n      \"class\": \"\".concat(selectPrefix, \"-auto\")\n    }, [h(\"div\", {\n      \"class\": \"\".concat(selectPrefix, \"-inner\")\n    }, [this.$slots.default])]), h(ConditionalRender, {\n      \"attrs\": {\n        \"conditional\": !!this.anchors.length\n      }\n    }, [h(\"div\", {\n      \"class\": \"\".concat(selectPrefix, \"-fixed\"),\n      \"style\": {\n        width: \"\".concat(this.anchorPosition.width, \"px\")\n      }\n    }, [h(\"ul\", {\n      \"class\": \"\".concat(selectPrefix, \"-anchor\"),\n      \"ref\": \"anchorRef\"\n    }, [this.anchors.map(function (anchor) {\n      return h(\"li\", {\n        \"class\": anchor.anchor === _this.activeAnchor ? \"\".concat(selectPrefix, \"-active\") : '',\n        \"attrs\": {\n          \"title\": anchor.name\n        }\n      }, [h(\"a\", {\n        \"attrs\": {\n          \"href\": \"#\".concat(anchor.anchor)\n        }\n      }, [anchor.name])]);\n    })])])])]);\n  }\n};\nexport default AnchorNavigation;"],"names":["__assign","ConditionalRender","Util","AnchorNavigationPropTypes","defaultActiveAnchor","type","String","default","anchors","Array","anchorPosition","Object","top","width","scrollEl","HTMLElement","selectPrefix","AnchorNavigation","name","props","data","activeAnchor","this","$anchorDimensionIndex","watch","_scrollEl","oldVal","removeEventListener","onWrapScroll","createAnchorDimensionIndex","addEventListener","mounted","window","onHashChange","beforeDestroy","methods","location","hash","substring","anchor","anchorRef","$refs","scrollTop","findAnchorByScrollVal","classList","remove","concat","add","style","container","$data","forEach","_a","index","el","document","getElementById","getTopUntil","untilEl","push","entry","range","bottom","undefined","length","offsetHeight","scrollVal","find","anchorIndexItem","render","h","_this","class","$slots","attrs","conditional","ref","map","title","href"],"mappings":"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"}