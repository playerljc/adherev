{"version":3,"file":"AnchorNavigation.js","sources":["AnchorNavigation.js"],"sourcesContent":["import \"core-js/modules/es.string.anchor.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/web.dom-collections.for-each.js\";\nimport \"core-js/modules/es.array.find.js\";\nimport \"core-js/modules/es.array.map.js\";\nimport \"core-js/modules/es.function.name.js\";\nimport { __assign } from \"tslib\";\nimport ConditionalRender from '@baifendian/adherev-ui-conditionalrender';\nimport Util from '@baifendian/adherev-util';\nexport var AnchorNavigationPropTypes = {\n  defaultActiveAnchor: {\n    type: String,\n    default: ''\n  },\n  anchors: {\n    type: Array,\n    default: function _default() {\n      return [];\n    }\n  },\n  anchorPosition: {\n    type: Object,\n    default: function _default() {\n      return {\n        top: 77,\n        width: 120\n      };\n    }\n  },\n  scrollEl: {\n    type: HTMLElement,\n    default: function _default() {\n      return null;\n    }\n  }\n};\nvar selectPrefix = 'adherev-ui-playground-anchor-navigation';\nexport default {\n  name: 'adv-playground-anchor-navigation',\n  props: __assign({}, AnchorNavigationPropTypes),\n  data: function data() {\n    return {\n      activeAnchor: this.defaultActiveAnchor,\n      $anchorDimensionIndex: []\n    };\n  },\n  watch: {\n    defaultActiveAnchor: function defaultActiveAnchor(activeAnchor) {\n      this.activeAnchor = activeAnchor;\n    },\n    scrollEl: function scrollEl(_scrollEl, oldVal) {\n      if (oldVal) {\n        oldVal.removeEventListener('scroll', this.onWrapScroll);\n      }\n\n      if (!_scrollEl) return;\n      this.createAnchorDimensionIndex();\n\n      _scrollEl.addEventListener('scroll', this.onWrapScroll);\n    }\n  },\n  mounted: function mounted() {\n    if (typeof window === 'undefined') return;\n    window.addEventListener('hashchange', this.onHashChange);\n    var scrollEl = this.scrollEl;\n\n    if (scrollEl) {\n      this.createAnchorDimensionIndex();\n      scrollEl.addEventListener('scroll', this.onWrapScroll);\n    }\n  },\n  beforeDestroy: function beforeDestroy() {\n    if (typeof window === 'undefined') return;\n    window.removeEventListener('hashchange', this.onHashChange);\n    var scrollEl = this.scrollEl;\n    if (!scrollEl) return;\n    scrollEl.removeEventListener('scroll', this.onWrapScroll);\n  },\n  methods: {\n    /**\n     * onHashChange\n     */\n    onHashChange: function onHashChange() {\n      this.activeAnchor = window.location.hash.substring(1);\n    },\n\n    /**\n     * onWrapScroll\n     */\n    onWrapScroll: function onWrapScroll() {\n      var _a = this,\n          scrollEl = _a.scrollEl,\n          anchorRef = _a.$refs.anchorRef;\n\n      if (!scrollEl) return;\n      var scrollTop = scrollEl.scrollTop;\n      var anchor = this.findAnchorByScrollVal(scrollTop);\n\n      if (anchor) {\n        this.activeAnchor = anchor.anchor;\n      }\n\n      if (scrollTop === 0) {\n        anchorRef.classList.remove(selectPrefix + \"-affix\");\n      } else {\n        anchorRef.classList.add(selectPrefix + \"-affix\");\n        anchorRef.style.top = this.anchorPosition.top + \"px\";\n      }\n    },\n\n    /**\n     * createAnchorDimensionIndex\n     */\n    createAnchorDimensionIndex: function createAnchorDimensionIndex() {\n      var _a = this,\n          scrollEl = _a.scrollEl,\n          $data = _a.$data;\n\n      if (!scrollEl) return;\n      var container = scrollEl;\n      $data.$anchorDimensionIndex = [];\n      this.anchors.forEach(function (_a, index) {\n        var anchor = _a.anchor;\n        var el = document.getElementById(anchor);\n        if (!el) return;\n        var top = Util.getTopUntil({\n          el: el,\n          untilEl: container\n        });\n        var entry = {\n          anchor: anchor,\n          range: {\n            top: top,\n            bottom: undefined\n          }\n        };\n        $data.$anchorDimensionIndex.push(entry);\n\n        if (index !== 0) {\n          $data.$anchorDimensionIndex[index - 1].range.bottom = top;\n        }\n\n        if (index === $data.$anchorDimensionIndex.length - 1) {\n          // @ts-ignore\n          entry.range.bottom = top + el.offsetHeight;\n        }\n      });\n    },\n\n    /**\n     * findAnchorByScrollVal\n     * @param scrollVal\n     */\n    findAnchorByScrollVal: function findAnchorByScrollVal(scrollVal) {\n      var $data = this.$data;\n      return $data.$anchorDimensionIndex.find(function (anchorIndexItem) {\n        return scrollVal >= anchorIndexItem.range.top && scrollVal <= anchorIndexItem.range.bottom;\n      });\n    }\n  },\n  render: function render(h) {\n    var _this = this;\n\n    return h(\"div\", {\n      \"class\": selectPrefix\n    }, [h(\"div\", {\n      \"class\": selectPrefix + \"-auto\"\n    }, [h(\"div\", {\n      \"class\": selectPrefix + \"-inner\"\n    }, [this.$slots.default])]), h(ConditionalRender, {\n      \"attrs\": {\n        \"conditional\": !!this.anchors.length\n      }\n    }, [h(\"div\", {\n      \"class\": selectPrefix + \"-fixed\",\n      \"style\": {\n        width: this.anchorPosition.width + \"px\"\n      }\n    }, [h(\"ul\", {\n      \"class\": selectPrefix + \"-anchor\",\n      \"ref\": \"anchorRef\"\n    }, [this.anchors.map(function (anchor) {\n      return h(\"li\", {\n        \"class\": anchor.anchor === _this.activeAnchor ? selectPrefix + \"-active\" : '',\n        \"attrs\": {\n          \"title\": anchor.name\n        }\n      }, [h(\"a\", {\n        \"attrs\": {\n          \"href\": \"#\" + anchor.anchor\n        }\n      }, [anchor.name])]);\n    })])])])]);\n  }\n};"],"names":["__assign","ConditionalRender","Util","AnchorNavigationPropTypes","defaultActiveAnchor","type","String","default","anchors","Array","anchorPosition","Object","top","width","scrollEl","HTMLElement","selectPrefix","name","props","data","activeAnchor","this","$anchorDimensionIndex","watch","_scrollEl","oldVal","removeEventListener","onWrapScroll","createAnchorDimensionIndex","addEventListener","mounted","window","onHashChange","beforeDestroy","methods","location","hash","substring","scrollTop","anchorRef","$refs","anchor","findAnchorByScrollVal","classList","remove","add","style","container","$data","forEach","_a","index","el","document","getElementById","getTopUntil","untilEl","push","entry","range","bottom","undefined","length","offsetHeight","scrollVal","find","anchorIndexItem","render","h","_this","class","$slots","attrs","conditional","ref","map","title","href"],"mappings":"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"}