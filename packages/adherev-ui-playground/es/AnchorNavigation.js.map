{"version":3,"file":"AnchorNavigation.js","sources":["AnchorNavigation.js"],"sourcesContent":["import { createVNode as _createVNode } from \"vue\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/web.dom-collections.for-each.js\";\nimport \"core-js/modules/es.array.find.js\";\nimport \"core-js/modules/es.array.map.js\";\nimport { defineComponent, onBeforeMount, onMounted, ref, watch } from 'vue';\nimport { array, object, string } from 'vue-types';\nimport ConditionalRender from '@baifendian/adherev-ui-conditionalrender';\nimport Util from '@baifendian/adherev-util';\nvar selectPrefix = 'adherev-ui-playground-anchor-navigation';\nexport var anchorNavigationProps = {\n  defaultActiveAnchor: string().def(''),\n  anchors: array().def([]),\n  anchorPosition: object().def({\n    top: 77,\n    width: 120\n  }),\n  scrollEl: object()\n};\nexport default defineComponent({\n  name: 'adv-playground-anchor-navigation',\n  props: anchorNavigationProps,\n  setup: function setup(props, _a) {\n    var slots = _a.slots;\n    var activeAnchor = ref(props.defaultActiveAnchor);\n    var anchorRef = ref();\n    var anchorDimensionIndex = [];\n    var onHashChange = function onHashChange() {\n      activeAnchor.value = window.location.hash.substring(1);\n    };\n    var onWrapScroll = function onWrapScroll() {\n      var _a, _b, _c, _d, _e, _f;\n      if (!props.scrollEl) return;\n      var scrollTop = props.scrollEl.scrollTop;\n      var anchor = findAnchorByScrollVal(scrollTop);\n      if (anchor) {\n        activeAnchor.value = anchor.anchor;\n      }\n      if (!anchorRef.value) return;\n      if (scrollTop === 0) {\n        (_c = (_b = (_a = anchorRef === null || anchorRef === void 0 ? void 0 : anchorRef.value) === null || _a === void 0 ? void 0 : _a.classList) === null || _b === void 0 ? void 0 : _b.remove) === null || _c === void 0 ? void 0 : _c.call(_b, \"\".concat(selectPrefix, \"-affix\"));\n      } else {\n        (_f = (_e = (_d = anchorRef === null || anchorRef === void 0 ? void 0 : anchorRef.value) === null || _d === void 0 ? void 0 : _d.classList) === null || _e === void 0 ? void 0 : _e.add) === null || _f === void 0 ? void 0 : _f.call(_e, \"\".concat(selectPrefix, \"-affix\"));\n        anchorRef.value.style.top = \"\".concat(props.anchorPosition.top, \"px\");\n      }\n    };\n    var createAnchorDimensionIndex = function createAnchorDimensionIndex() {\n      if (!props.scrollEl) return;\n      var container = props.scrollEl;\n      anchorDimensionIndex = [];\n      props.anchors.forEach(function (_a, index) {\n        var _b;\n        var anchor = _a.anchor;\n        var el = document.getElementById(anchor);\n        if (!el) return;\n        var top = (_b = Util.getTopUntil) === null || _b === void 0 ? void 0 : _b.call(Util, {\n          el: el,\n          untilEl: container\n        });\n        var bottom;\n        var entry = {\n          anchor: anchor,\n          range: {\n            top: top,\n            bottom: bottom\n          }\n        };\n        anchorDimensionIndex.push(entry);\n        if (index !== 0) {\n          anchorDimensionIndex[index - 1].range.bottom = top;\n        }\n        if (index === anchorDimensionIndex.length - 1) {\n          entry.range.bottom = top + el.offsetHeight;\n        }\n      });\n    };\n    var findAnchorByScrollVal = function findAnchorByScrollVal(scrollVal) {\n      return anchorDimensionIndex.find(function (anchorIndexItem) {\n        // @ts-ignore\n        return scrollVal >= anchorIndexItem.range.top && scrollVal <= anchorIndexItem.range.bottom;\n      });\n    };\n    watch(function () {\n      return props.defaultActiveAnchor;\n    }, function (newVal) {\n      return activeAnchor.value = newVal;\n    });\n    watch(function () {\n      return props.scrollEl;\n    }, function (scrollEl, oldVal) {\n      var _a, _b;\n      (_a = oldVal === null || oldVal === void 0 ? void 0 : oldVal.removeEventListener) === null || _a === void 0 ? void 0 : _a.call(oldVal, 'scroll', onWrapScroll);\n      if (!scrollEl) return;\n      createAnchorDimensionIndex();\n      (_b = scrollEl === null || scrollEl === void 0 ? void 0 : scrollEl.addEventListener) === null || _b === void 0 ? void 0 : _b.call(scrollEl, 'scroll', onWrapScroll);\n    });\n    onMounted(function () {\n      if (typeof window === 'undefined') return;\n      window.addEventListener('hashchange', onHashChange);\n      if (props.scrollEl) {\n        createAnchorDimensionIndex();\n        props.scrollEl.addEventListener('scroll', onWrapScroll);\n      }\n    });\n    onBeforeMount(function () {\n      window.removeEventListener('hashchange', onHashChange);\n      if (!props.scrollEl) return;\n      props.scrollEl.removeEventListener('scroll', onWrapScroll);\n    });\n    return function () {\n      var _a;\n      return _createVNode(\"div\", {\n        \"class\": selectPrefix\n      }, [_createVNode(\"div\", {\n        \"class\": \"\".concat(selectPrefix, \"-auto\")\n      }, [_createVNode(\"div\", {\n        \"class\": \"\".concat(selectPrefix, \"-inner\")\n      }, [(_a = slots === null || slots === void 0 ? void 0 : slots.default) === null || _a === void 0 ? void 0 : _a.call(slots)])]), _createVNode(ConditionalRender, {\n        \"conditional\": !!props.anchors.length\n      }, {\n        default: function _default() {\n          return [_createVNode(\"div\", {\n            \"class\": \"\".concat(selectPrefix, \"-fixed\"),\n            \"style\": {\n              width: \"\".concat(props.anchorPosition.width, \"px\")\n            }\n          }, [_createVNode(\"ul\", {\n            \"class\": \"\".concat(selectPrefix, \"-anchor\"),\n            \"ref\": anchorRef\n          }, [props.anchors.map(function (anchor) {\n            return _createVNode(\"li\", {\n              \"class\": anchor.anchor === activeAnchor.value ? \"\".concat(selectPrefix, \"-active\") : '',\n              \"title\": anchor.name\n            }, [_createVNode(\"a\", {\n              \"href\": \"#\".concat(anchor.anchor)\n            }, [anchor.name])]);\n          })])])];\n        }\n      })]);\n    };\n  }\n});"],"names":["_createVNode","defineComponent","onBeforeMount","onMounted","ref","watch","array","object","string","ConditionalRender","Util","selectPrefix","anchorNavigationProps","defaultActiveAnchor","def","anchors","anchorPosition","top","width","scrollEl","name","props","setup","_a","onHashChange","activeAnchor","value","window","location","hash","substring","onWrapScroll","scrollTop","anchor","findAnchorByScrollVal","anchorRef","_c","_b","classList","remove","call","concat","_f","_e","_d","add","style","createAnchorDimensionIndex","container","anchorDimensionIndex","forEach","index","el","document","getElementById","getTopUntil","untilEl","push","entry","range","bottom","length","offsetHeight","scrollVal","find","anchorIndexItem","slots","newVal","oldVal","removeEventListener","addEventListener","class","default","conditional","map","title","href"],"mappings":"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"}