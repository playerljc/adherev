{"version":3,"file":"scrollload.js","sources":["scrollload.js"],"sourcesContent":["import \"core-js/modules/es.number.constructor.js\";\nimport classNames from 'classnames';\nimport Intl from '@baifendian/adherev-util-intl';\nvar selectorPrefix = 'adherev-ui-scrollload';\nexport var EMPTY = 'empty';\nexport var ERROR = 'error';\nexport var NORMAL = 'normal';\nvar ScrollLoad = {\n  name: 'adv-scrollload',\n  props: {\n    loadClassName: {\n      type: String,\n      default: ''\n    },\n    emptyClassName: {\n      type: String,\n      default: ''\n    },\n    errorClassName: {\n      type: String,\n      default: ''\n    },\n    distance: {\n      type: Number,\n      default: 50\n    },\n    getScrollContainer: {\n      type: Function,\n      default: function _default() {\n        return null;\n      }\n    },\n    renderLoading: {\n      type: Object,\n      default: function _default() {\n        return null;\n      }\n    },\n    renderEmpty: {\n      type: Object,\n      default: function _default() {\n        return null;\n      }\n    },\n    renderError: {\n      type: Object,\n      default: function _default() {\n        return null;\n      }\n    }\n    // onScrollBottom: {\n    //   type: Function,\n    // },\n    // onEmptyClick: {\n    //   type: Function,\n    // },\n    // onErrorClick: {\n    //   type: Function,\n    // },\n  },\n\n  slots: ['loading', 'empty', 'error'],\n  emits: ['scrollBottom', 'emptyClick', 'errorClick'],\n  data: function data() {\n    return {\n      $lock: false\n    };\n  },\n  mounted: function mounted() {\n    this.initEvents();\n  },\n  beforeDestroy: function beforeDestroy() {\n    this.removeEvents();\n  },\n  computed: {\n    scrollContainer: function scrollContainer() {\n      return this.getScrollContainer ? this.getScrollContainer() || this.$refs.el : this.$refs.el;\n    },\n    wrapStyle: function wrapStyle() {\n      return \"overflow-y: \".concat(this.getScrollContainer() === this.$refs.el ? 'auto' : 'initial');\n    }\n  },\n  methods: {\n    $renderLoading: function $renderLoading(h) {\n      var _a = this,\n        $slots = _a.$slots,\n        loadClassName = _a.loadClassName;\n      if ($slots.loading || this.renderLoading) {\n        return h(\"div\", {\n          \"class\": classNames(\"\".concat(selectorPrefix, \"-load\"), loadClassName || ''),\n          \"ref\": \"loadEl\"\n        }, [$slots.loading || this.renderLoading]);\n      }\n      return h(\"div\", {\n        \"class\": classNames(\"\".concat(selectorPrefix, \"-load\"), 'standard', loadClassName || ''),\n        \"ref\": \"loadEl\"\n      }, [Intl.tv('数据加载中')]);\n    },\n    $renderEmpty: function $renderEmpty(h) {\n      var _a = this,\n        $slots = _a.$slots,\n        emptyClassName = _a.emptyClassName;\n      if ($slots.empty || this.renderEmpty) {\n        return h(\"div\", {\n          \"class\": classNames(\"\".concat(selectorPrefix, \"-empty\"), emptyClassName || ''),\n          \"ref\": \"emptyEl\"\n        }, [$slots.empty || this.renderEmpty]);\n      }\n      return h(\"div\", {\n        \"class\": classNames(\"\".concat(selectorPrefix, \"-empty\"), emptyClassName || ''),\n        \"ref\": \"emptyEl\"\n      }, [\"~\", Intl.tv('没有更多')]);\n    },\n    $renderError: function $renderError(h) {\n      var _a = this,\n        $slots = _a.$slots,\n        errorClassName = _a.errorClassName;\n      if ($slots.error || this.renderError) {\n        return h(\"div\", {\n          \"class\": classNames(\"\".concat(selectorPrefix, \"-error\"), errorClassName || ''),\n          \"ref\": \"errorEl\"\n        }, [$slots.error || this.renderError]);\n      }\n      return h(\"div\", {\n        \"class\": classNames(\"\".concat(selectorPrefix, \"-error\"), errorClassName || ''),\n        \"ref\": \"errorEl\"\n      }, [Intl.tv('出现错误')]);\n    },\n    initEvents: function initEvents() {\n      var $refs = this.$refs;\n      this.scrollContainer.addEventListener('scroll', this.onScroll);\n      $refs.emptyEl.addEventListener('click', this.onEmptyClick);\n      $refs.errorEl.addEventListener('click', this.onErrorClick);\n    },\n    removeEvents: function removeEvents() {\n      var $refs = this.$refs;\n      this.scrollContainer.removeEventListener('scroll', this.onScroll);\n      $refs.emptyEl.removeEventListener('click', this.onEmptyClick);\n      $refs.errorEl.removeEventListener('click', this.onErrorClick);\n    },\n    onScroll: function onScroll() {\n      var _a = this,\n        _b = _a.$refs,\n        loadEl = _b.loadEl,\n        errorEl = _b.errorEl,\n        emptyEl = _b.emptyEl,\n        $data = _a.$data,\n        distance = _a.distance;\n      var el = this.scrollContainer;\n      var bottomHeight = el.scrollHeight - el.offsetHeight;\n      var scrollTop = el.scrollTop;\n      /**\n       * 条件完全相等或误差值在1之间\n       */\n      if (Math.abs(scrollTop - bottomHeight) <= distance) {\n        if ($data.$lock) return;\n        $data.$lock = true;\n        // 先显示loading\n        loadEl.style.display = 'flex';\n        /**\n         * 完成\n         * @param {string} status [empty(没有数据) | error(有错误) | normal(正常)]\n         */\n        this.$emit('scrollBottom', function (status) {\n          loadEl.style.display = 'none';\n          if (status === EMPTY) {\n            emptyEl.style.display = 'block';\n          } else if (status === ERROR) {\n            errorEl.style.display = 'block';\n          }\n          $data.$lock = false;\n        });\n      }\n    },\n    onEmptyClick: function onEmptyClick() {\n      this.$emit('emptyClick');\n    },\n    onErrorClick: function onErrorClick() {\n      this.$emit('errorClick');\n    },\n    /**\n     * hideAll\n     */\n    hideAll: function hideAll() {\n      var _a = this.$refs,\n        loadEl = _a.loadEl,\n        errorEl = _a.errorEl,\n        emptyEl = _a.emptyEl;\n      loadEl.style.display = 'none';\n      errorEl.style.display = 'none';\n      emptyEl.style.display = 'none';\n    }\n  },\n  render: function render(h) {\n    var $slots = this.$slots;\n    return h(\"div\", {\n      \"class\": selectorPrefix,\n      \"style\": this.wrapStyle,\n      \"ref\": \"el\"\n    }, [$slots.default, this.$renderLoading(h), this.$renderEmpty(h), this.$renderError(h)]);\n  }\n};\nexport default ScrollLoad;"],"names":["classNames","Intl","selectorPrefix","EMPTY","ERROR","NORMAL","ScrollLoad","name","props","loadClassName","type","String","default","emptyClassName","errorClassName","distance","Number","getScrollContainer","Function","renderLoading","Object","renderEmpty","renderError","slots","emits","data","$lock","mounted","this","initEvents","beforeDestroy","removeEvents","computed","scrollContainer","$refs","el","wrapStyle","concat","methods","$renderLoading","h","$slots","loading","class","ref","tv","$renderEmpty","empty","$renderError","error","addEventListener","onScroll","emptyEl","onEmptyClick","errorEl","onErrorClick","removeEventListener","_a","_b","loadEl","$data","bottomHeight","scrollHeight","offsetHeight","scrollTop","Math","abs","style","display","$emit","status","hideAll","render"],"mappings":"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"}