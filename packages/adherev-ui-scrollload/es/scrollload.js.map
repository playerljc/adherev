{"version":3,"file":"scrollload.js","sources":["scrollload.js"],"sourcesContent":["import { createTextVNode as _createTextVNode, createVNode as _createVNode } from \"vue\";\nimport \"core-js/modules/es.regexp.exec.js\";\nimport \"core-js/modules/es.string.split.js\";\nimport Intl from '@baifendian/adherev-util-intl';\nimport classNames from 'classnames';\nimport { defineComponent, onMounted, ref } from 'vue';\nimport { number, object, string } from 'vue-types';\nvar selectorPrefix = 'adherev-ui-scrollload';\nexport var EMPTY = 'empty';\nexport var ERROR = 'error';\nexport var NORMAL = 'normal';\nvar scrollLoadProps = {\n  loadClassName: string().def(''),\n  loadStyle: object().def({}),\n  emptyClassName: string().def(''),\n  emptyStyle: object().def({}),\n  errorClassName: string().def(''),\n  errorStyle: object().def({}),\n  distance: number().def(50)\n};\nexport default defineComponent({\n  name: 'adv-scrollload',\n  props: scrollLoadProps,\n  emits: ['scroll-bottom', 'empty-click', 'error-click'],\n  setup: function setup(props, _a) {\n    var emit = _a.emit,\n        slots = _a.slots,\n        expose = _a.expose;\n    var el = ref();\n    var emptyEl = ref();\n    var errorEl = ref();\n    var loadEl = ref();\n    var lock = false;\n    onMounted(function () {\n      return initEvents();\n    });\n\n    var initEvents = function initEvents() {\n      var _a, _b, _c;\n\n      (_a = el === null || el === void 0 ? void 0 : el.value) === null || _a === void 0 ? void 0 : _a.addEventListener('scroll', onScroll);\n      (_b = emptyEl === null || emptyEl === void 0 ? void 0 : emptyEl.value) === null || _b === void 0 ? void 0 : _b.addEventListener('click', onEmptyClick);\n      (_c = errorEl === null || errorEl === void 0 ? void 0 : errorEl.value) === null || _c === void 0 ? void 0 : _c.addEventListener('click', onErrorClick);\n    };\n\n    var onScroll = function onScroll() {\n      var $el = el.value;\n      var $loadEl = loadEl.value;\n      var $emptyEl = emptyEl.value;\n      var $errorEl = errorEl.value;\n      var bottomHeight = $el.scrollHeight - $el.offsetHeight;\n      var scrollTop = $el.scrollTop;\n      /**\n       * 条件完全相等或误差值在1之间\n       */\n\n      if (Math.abs(scrollTop - bottomHeight) <= props.distance) {\n        if (lock) return;\n        lock = true; // 先显示loading\n\n        $loadEl.style.display = 'flex';\n        /**\n         * 完成\n         * @param {string} status [empty(没有数据) | error(有错误) | normal(正常)]\n         */\n\n        emit('scroll-bottom', function (status) {\n          $loadEl.style.display = 'none';\n\n          if (status === EMPTY) {\n            $emptyEl.style.display = 'block';\n          } else if (status === ERROR) {\n            $errorEl.style.display = 'block';\n          }\n\n          lock = false;\n        });\n      }\n    };\n\n    var onEmptyClick = function onEmptyClick() {\n      emit('empty-click');\n    };\n\n    var onErrorClick = function onErrorClick() {\n      emit('error-click');\n    };\n\n    var renderLoading = function renderLoading() {\n      var _a;\n\n      if (slots.loading) {\n        return _createVNode(\"div\", {\n          \"class\": classNames(\"\".concat(selectorPrefix, \"-load\"), (props.loadClassName || '').split(/\\s+/)),\n          \"style\": props.loadStyle,\n          \"ref\": loadEl\n        }, [(_a = slots === null || slots === void 0 ? void 0 : slots.loading) === null || _a === void 0 ? void 0 : _a.call(slots)]);\n      }\n\n      return _createVNode(\"div\", {\n        \"class\": classNames(\"\".concat(selectorPrefix, \"-load\"), 'standard', (props.loadClassName || '').split(/\\s+/)),\n        \"style\": props.loadStyle,\n        \"ref\": loadEl\n      }, [Intl.tv('数据加载中')]);\n    };\n\n    var renderEmpty = function renderEmpty() {\n      var _a;\n\n      if (slots.empty) {\n        return _createVNode(\"div\", {\n          \"class\": classNames(\"\".concat(selectorPrefix, \"-empty\"), (props.emptyClassName || '').split(/\\s+/)),\n          \"style\": props.emptyStyle,\n          \"ref\": emptyEl\n        }, [(_a = slots === null || slots === void 0 ? void 0 : slots.empty) === null || _a === void 0 ? void 0 : _a.call(slots)]);\n      }\n\n      return _createVNode(\"div\", {\n        \"class\": classNames(\"\".concat(selectorPrefix, \"-empty\"), (props.emptyClassName || '').split(/\\s+/)),\n        \"style\": props.emptyStyle,\n        \"ref\": emptyEl\n      }, [_createTextVNode(\"~\"), Intl.tv('没有更多')]);\n    };\n\n    var renderError = function renderError() {\n      var _a;\n\n      if (slots.error) {\n        return _createVNode(\"div\", {\n          \"class\": classNames(\"\".concat(selectorPrefix, \"-error\"), (props.errorClassName || '').split(/\\s+/)),\n          \"style\": props.errorStyle,\n          \"ref\": errorEl\n        }, [(_a = slots === null || slots === void 0 ? void 0 : slots.error) === null || _a === void 0 ? void 0 : _a.call(slots)]);\n      }\n\n      return _createVNode(\"div\", {\n        \"class\": classNames(\"\".concat(selectorPrefix, \"-error\"), (props.errorClassName || '').split(/\\s+/)),\n        \"style\": props.errorStyle,\n        \"ref\": errorEl\n      }, [Intl.tv('出现错误')]);\n    };\n\n    var hideAll = function hideAll() {\n      var $loadEl = loadEl.value;\n      var $emptyEl = emptyEl.value;\n      var $errorEl = errorEl.value;\n      $loadEl.style.display = 'none';\n      $errorEl.style.display = 'none';\n      $emptyEl.style.display = 'none';\n    };\n\n    expose({\n      hideAll: hideAll\n    });\n    return function () {\n      var _a;\n\n      return _createVNode(\"div\", {\n        \"class\": selectorPrefix,\n        \"ref\": el\n      }, [(_a = slots === null || slots === void 0 ? void 0 : slots.default) === null || _a === void 0 ? void 0 : _a.call(slots), renderLoading(), renderEmpty(), renderError()]);\n    };\n  }\n});"],"names":["_createTextVNode","_createVNode","Intl","classNames","defineComponent","onMounted","ref","number","object","string","selectorPrefix","EMPTY","ERROR","NORMAL","scrollLoadProps","loadClassName","def","loadStyle","emptyClassName","emptyStyle","errorClassName","errorStyle","distance","name","props","emits","setup","_a","emit","slots","expose","el","emptyEl","errorEl","loadEl","lock","initEvents","_c","value","addEventListener","onScroll","_b","onEmptyClick","onErrorClick","$el","$loadEl","$emptyEl","$errorEl","bottomHeight","scrollHeight","offsetHeight","scrollTop","Math","abs","style","display","status","hideAll","class","default","call","loading","concat","split","tv","empty","error"],"mappings":"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"}