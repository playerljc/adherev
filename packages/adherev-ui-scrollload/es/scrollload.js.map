{"version":3,"file":"scrollload.js","sources":["scrollload.js"],"sourcesContent":["import { createTextVNode as _createTextVNode, createVNode as _createVNode } from \"vue\";\nimport classNames from 'classnames';\nimport { computed, defineComponent, onBeforeUnmount, onMounted, ref } from 'vue';\nimport { func, number, object, string } from 'vue-types';\nimport Intl from '@baifendian/adherev-util-intl';\nvar selectorPrefix = 'adherev-ui-scrollload';\nexport var EMPTY = 'empty';\nexport var ERROR = 'error';\nexport var NORMAL = 'normal';\nexport var scrollLoadProps = {\n  loadClassName: string().def(''),\n  loadStyle: object().def({}),\n  emptyClassName: string().def(''),\n  emptyStyle: object().def({}),\n  errorClassName: string().def(''),\n  errorStyle: object().def({}),\n  distance: number().def(50),\n  getScrollContainer: func(),\n  renderLoading: object(),\n  renderEmpty: object(),\n  renderError: object()\n};\nexport default defineComponent({\n  name: 'adv-scrollload',\n  props: scrollLoadProps,\n  slots: ['loading', 'empty', 'error'],\n  emits: ['scrollBottom', 'emptyClick', 'errorClick'],\n  setup: function setup(props, _a) {\n    var emit = _a.emit,\n      slots = _a.slots,\n      expose = _a.expose;\n    var el = ref();\n    var emptyEl = ref();\n    var errorEl = ref();\n    var loadEl = ref();\n    var lock = false;\n    var scrollContainer = computed(function () {\n      return props.getScrollContainer ? props.getScrollContainer() || el.value : el.value;\n    });\n    var wrapStyle = computed(function () {\n      var _a;\n      return \"overflow-y: \".concat(((_a = props === null || props === void 0 ? void 0 : props.getScrollContainer) === null || _a === void 0 ? void 0 : _a.call(props)) === el.value ? 'auto' : 'initial');\n    });\n    var initEvents = function initEvents() {\n      var _a, _b, _c;\n      (_a = scrollContainer === null || scrollContainer === void 0 ? void 0 : scrollContainer.value) === null || _a === void 0 ? void 0 : _a.addEventListener('scroll', onScroll);\n      (_b = emptyEl === null || emptyEl === void 0 ? void 0 : emptyEl.value) === null || _b === void 0 ? void 0 : _b.addEventListener('click', onEmptyClick);\n      (_c = errorEl === null || errorEl === void 0 ? void 0 : errorEl.value) === null || _c === void 0 ? void 0 : _c.addEventListener('click', onErrorClick);\n    };\n    var removeEvents = function removeEvents() {\n      var _a, _b, _c;\n      (_a = scrollContainer === null || scrollContainer === void 0 ? void 0 : scrollContainer.value) === null || _a === void 0 ? void 0 : _a.removeEventListener('scroll', onScroll);\n      (_b = emptyEl === null || emptyEl === void 0 ? void 0 : emptyEl.value) === null || _b === void 0 ? void 0 : _b.removeEventListener('click', onEmptyClick);\n      (_c = errorEl === null || errorEl === void 0 ? void 0 : errorEl.value) === null || _c === void 0 ? void 0 : _c.removeEventListener('click', onErrorClick);\n    };\n    var onScroll = function onScroll() {\n      var $el = scrollContainer.value;\n      var $loadEl = loadEl.value;\n      var $emptyEl = emptyEl.value;\n      var $errorEl = errorEl.value;\n      var bottomHeight = $el.scrollHeight - $el.offsetHeight;\n      var scrollTop = $el.scrollTop;\n      /**\n       * 条件完全相等或误差值在1之间\n       */\n      if (Math.abs(scrollTop - bottomHeight) <= props.distance) {\n        if (lock) return;\n        lock = true;\n        // 先显示loading\n        $loadEl.style.display = 'flex';\n        /**\n         * 完成\n         * @param {string} status [empty(没有数据) | error(有错误) | normal(正常)]\n         */\n        emit('scrollBottom', function (status) {\n          $loadEl.style.display = 'none';\n          if (status === EMPTY) {\n            $emptyEl.style.display = 'block';\n          } else if (status === ERROR) {\n            $errorEl.style.display = 'block';\n          }\n          lock = false;\n        });\n      }\n    };\n    var onEmptyClick = function onEmptyClick() {\n      return emit('emptyClick');\n    };\n    var onErrorClick = function onErrorClick() {\n      return emit('errorClick');\n    };\n    var renderLoading = function renderLoading() {\n      var _a;\n      if (slots.loading || props.renderLoading) {\n        return _createVNode(\"div\", {\n          \"class\": classNames(\"\".concat(selectorPrefix, \"-load\"), props.loadClassName || ''),\n          \"style\": props.loadStyle,\n          \"ref\": loadEl\n        }, [((_a = slots === null || slots === void 0 ? void 0 : slots.loading) === null || _a === void 0 ? void 0 : _a.call(slots)) || props.renderLoading]);\n      }\n      return _createVNode(\"div\", {\n        \"class\": classNames(\"\".concat(selectorPrefix, \"-load\"), 'standard', props.loadClassName || ''),\n        \"style\": props.loadStyle,\n        \"ref\": loadEl\n      }, [Intl.tv('数据加载中')]);\n    };\n    var renderEmpty = function renderEmpty() {\n      var _a;\n      if (slots.empty || props.renderEmpty) {\n        return _createVNode(\"div\", {\n          \"class\": classNames(\"\".concat(selectorPrefix, \"-empty\"), props.emptyClassName || ''),\n          \"style\": props.emptyStyle,\n          \"ref\": emptyEl\n        }, [((_a = slots === null || slots === void 0 ? void 0 : slots.empty) === null || _a === void 0 ? void 0 : _a.call(slots)) || props.renderEmpty]);\n      }\n      return _createVNode(\"div\", {\n        \"class\": classNames(\"\".concat(selectorPrefix, \"-empty\"), props.emptyClassName || ''),\n        \"style\": props.emptyStyle,\n        \"ref\": emptyEl\n      }, [_createTextVNode(\"~\"), Intl.tv('没有更多')]);\n    };\n    var renderError = function renderError() {\n      var _a;\n      if (slots.error || props.renderError) {\n        return _createVNode(\"div\", {\n          \"class\": classNames(\"\".concat(selectorPrefix, \"-error\"), props.errorClassName || ''),\n          \"style\": props.errorStyle,\n          \"ref\": errorEl\n        }, [((_a = slots === null || slots === void 0 ? void 0 : slots.error) === null || _a === void 0 ? void 0 : _a.call(slots)) || props.renderError]);\n      }\n      return _createVNode(\"div\", {\n        \"class\": classNames(\"\".concat(selectorPrefix, \"-error\"), props.errorClassName || ''),\n        \"style\": props.errorStyle,\n        \"ref\": errorEl\n      }, [Intl.tv('出现错误')]);\n    };\n    var hideAll = function hideAll() {\n      var $loadEl = loadEl.value;\n      var $emptyEl = emptyEl.value;\n      var $errorEl = errorEl.value;\n      $loadEl.style.display = 'none';\n      $errorEl.style.display = 'none';\n      $emptyEl.style.display = 'none';\n    };\n    expose({\n      hideAll: hideAll\n    });\n    onBeforeUnmount(function () {\n      return removeEvents();\n    });\n    onMounted(function () {\n      return initEvents();\n    });\n    return function () {\n      var _a;\n      return _createVNode(\"div\", {\n        \"class\": selectorPrefix,\n        \"style\": wrapStyle.value,\n        \"ref\": el\n      }, [(_a = slots === null || slots === void 0 ? void 0 : slots.default) === null || _a === void 0 ? void 0 : _a.call(slots), renderLoading(), renderEmpty(), renderError()]);\n    };\n  }\n});"],"names":["_createTextVNode","_createVNode","classNames","computed","defineComponent","onBeforeUnmount","onMounted","ref","func","number","object","string","Intl","selectorPrefix","EMPTY","ERROR","NORMAL","scrollLoadProps","loadClassName","def","loadStyle","emptyClassName","emptyStyle","errorClassName","errorStyle","distance","getScrollContainer","renderLoading","renderEmpty","renderError","name","props","slots","emits","setup","_a","onScroll","$el","scrollContainer","value","$loadEl","loadEl","$emptyEl","emptyEl","$errorEl","errorEl","bottomHeight","scrollHeight","offsetHeight","scrollTop","Math","abs","lock","style","display","emit","status","onEmptyClick","onErrorClick","expose","el","wrapStyle","concat","call","hideAll","_c","removeEventListener","_b","addEventListener","class","default","loading","tv","empty","error"],"mappings":"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"}