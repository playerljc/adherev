{"version":3,"file":"scrollload.js","sources":["scrollload.js"],"sourcesContent":["\"use strict\";\n\nvar _vue = require(\"vue\");\nrequire(\"core-js/modules/es.object.define-property.js\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.scrollLoadProps = exports.NORMAL = exports.ERROR = exports.EMPTY = void 0;\nvar tslib_1 = require(\"tslib\");\nvar classnames_1 = tslib_1.__importDefault(require(\"classnames\"));\nvar vue_1 = require(\"vue\");\nvar vue_types_1 = require(\"vue-types\");\nvar adherev_util_intl_1 = tslib_1.__importDefault(require(\"@baifendian/adherev-util-intl\"));\nvar selectorPrefix = 'adherev-ui-scrollload';\nexports.EMPTY = 'empty';\nexports.ERROR = 'error';\nexports.NORMAL = 'normal';\nexports.scrollLoadProps = {\n  loadClassName: (0, vue_types_1.string)().def(''),\n  loadStyle: (0, vue_types_1.object)().def({}),\n  emptyClassName: (0, vue_types_1.string)().def(''),\n  emptyStyle: (0, vue_types_1.object)().def({}),\n  errorClassName: (0, vue_types_1.string)().def(''),\n  errorStyle: (0, vue_types_1.object)().def({}),\n  distance: (0, vue_types_1.number)().def(50),\n  getScrollContainer: (0, vue_types_1.func)(),\n  renderLoading: (0, vue_types_1.object)(),\n  renderEmpty: (0, vue_types_1.object)(),\n  renderError: (0, vue_types_1.object)()\n};\nexports.default = (0, vue_1.defineComponent)({\n  name: 'adv-scrollload',\n  props: exports.scrollLoadProps,\n  slots: ['loading', 'empty', 'error'],\n  emits: ['scrollBottom', 'emptyClick', 'errorClick'],\n  setup: function setup(props, _a) {\n    var emit = _a.emit,\n      slots = _a.slots,\n      expose = _a.expose;\n    var el = (0, vue_1.ref)();\n    var emptyEl = (0, vue_1.ref)();\n    var errorEl = (0, vue_1.ref)();\n    var loadEl = (0, vue_1.ref)();\n    var lock = false;\n    var scrollContainer = (0, vue_1.computed)(function () {\n      return props.getScrollContainer ? props.getScrollContainer() || el.value : el.value;\n    });\n    var wrapStyle = (0, vue_1.computed)(function () {\n      var _a;\n      return \"overflow-y: \".concat(((_a = props === null || props === void 0 ? void 0 : props.getScrollContainer) === null || _a === void 0 ? void 0 : _a.call(props)) === el.value ? 'auto' : 'initial');\n    });\n    var initEvents = function initEvents() {\n      var _a, _b, _c;\n      (_a = scrollContainer === null || scrollContainer === void 0 ? void 0 : scrollContainer.value) === null || _a === void 0 ? void 0 : _a.addEventListener('scroll', onScroll);\n      (_b = emptyEl === null || emptyEl === void 0 ? void 0 : emptyEl.value) === null || _b === void 0 ? void 0 : _b.addEventListener('click', onEmptyClick);\n      (_c = errorEl === null || errorEl === void 0 ? void 0 : errorEl.value) === null || _c === void 0 ? void 0 : _c.addEventListener('click', onErrorClick);\n    };\n    var removeEvents = function removeEvents() {\n      var _a, _b, _c;\n      (_a = scrollContainer === null || scrollContainer === void 0 ? void 0 : scrollContainer.value) === null || _a === void 0 ? void 0 : _a.removeEventListener('scroll', onScroll);\n      (_b = emptyEl === null || emptyEl === void 0 ? void 0 : emptyEl.value) === null || _b === void 0 ? void 0 : _b.removeEventListener('click', onEmptyClick);\n      (_c = errorEl === null || errorEl === void 0 ? void 0 : errorEl.value) === null || _c === void 0 ? void 0 : _c.removeEventListener('click', onErrorClick);\n    };\n    var onScroll = function onScroll() {\n      var $el = scrollContainer.value;\n      var $loadEl = loadEl.value;\n      var $emptyEl = emptyEl.value;\n      var $errorEl = errorEl.value;\n      var bottomHeight = $el.scrollHeight - $el.offsetHeight;\n      var scrollTop = $el.scrollTop;\n      /**\n       * 条件完全相等或误差值在1之间\n       */\n      if (Math.abs(scrollTop - bottomHeight) <= props.distance) {\n        if (lock) return;\n        lock = true;\n        // 先显示loading\n        $loadEl.style.display = 'flex';\n        /**\n         * 完成\n         * @param {string} status [empty(没有数据) | error(有错误) | normal(正常)]\n         */\n        emit('scrollBottom', function (status) {\n          $loadEl.style.display = 'none';\n          if (status === exports.EMPTY) {\n            $emptyEl.style.display = 'block';\n          } else if (status === exports.ERROR) {\n            $errorEl.style.display = 'block';\n          }\n          lock = false;\n        });\n      }\n    };\n    var onEmptyClick = function onEmptyClick() {\n      return emit('emptyClick');\n    };\n    var onErrorClick = function onErrorClick() {\n      return emit('errorClick');\n    };\n    var renderLoading = function renderLoading() {\n      var _a;\n      if (slots.loading || props.renderLoading) {\n        return (0, _vue.createVNode)(\"div\", {\n          \"class\": (0, classnames_1.default)(\"\".concat(selectorPrefix, \"-load\"), props.loadClassName || ''),\n          \"style\": props.loadStyle,\n          \"ref\": loadEl\n        }, [((_a = slots === null || slots === void 0 ? void 0 : slots.loading) === null || _a === void 0 ? void 0 : _a.call(slots)) || props.renderLoading]);\n      }\n      return (0, _vue.createVNode)(\"div\", {\n        \"class\": (0, classnames_1.default)(\"\".concat(selectorPrefix, \"-load\"), 'standard', props.loadClassName || ''),\n        \"style\": props.loadStyle,\n        \"ref\": loadEl\n      }, [adherev_util_intl_1.default.tv('数据加载中')]);\n    };\n    var renderEmpty = function renderEmpty() {\n      var _a;\n      if (slots.empty || props.renderEmpty) {\n        return (0, _vue.createVNode)(\"div\", {\n          \"class\": (0, classnames_1.default)(\"\".concat(selectorPrefix, \"-empty\"), props.emptyClassName || ''),\n          \"style\": props.emptyStyle,\n          \"ref\": emptyEl\n        }, [((_a = slots === null || slots === void 0 ? void 0 : slots.empty) === null || _a === void 0 ? void 0 : _a.call(slots)) || props.renderEmpty]);\n      }\n      return (0, _vue.createVNode)(\"div\", {\n        \"class\": (0, classnames_1.default)(\"\".concat(selectorPrefix, \"-empty\"), props.emptyClassName || ''),\n        \"style\": props.emptyStyle,\n        \"ref\": emptyEl\n      }, [(0, _vue.createTextVNode)(\"~\"), adherev_util_intl_1.default.tv('没有更多')]);\n    };\n    var renderError = function renderError() {\n      var _a;\n      if (slots.error || props.renderError) {\n        return (0, _vue.createVNode)(\"div\", {\n          \"class\": (0, classnames_1.default)(\"\".concat(selectorPrefix, \"-error\"), props.errorClassName || ''),\n          \"style\": props.errorStyle,\n          \"ref\": errorEl\n        }, [((_a = slots === null || slots === void 0 ? void 0 : slots.error) === null || _a === void 0 ? void 0 : _a.call(slots)) || props.renderError]);\n      }\n      return (0, _vue.createVNode)(\"div\", {\n        \"class\": (0, classnames_1.default)(\"\".concat(selectorPrefix, \"-error\"), props.errorClassName || ''),\n        \"style\": props.errorStyle,\n        \"ref\": errorEl\n      }, [adherev_util_intl_1.default.tv('出现错误')]);\n    };\n    var hideAll = function hideAll() {\n      var $loadEl = loadEl.value;\n      var $emptyEl = emptyEl.value;\n      var $errorEl = errorEl.value;\n      $loadEl.style.display = 'none';\n      $errorEl.style.display = 'none';\n      $emptyEl.style.display = 'none';\n    };\n    expose({\n      hideAll: hideAll\n    });\n    (0, vue_1.onBeforeUnmount)(function () {\n      return removeEvents();\n    });\n    (0, vue_1.onMounted)(function () {\n      return initEvents();\n    });\n    return function () {\n      var _a;\n      return (0, _vue.createVNode)(\"div\", {\n        \"class\": selectorPrefix,\n        \"style\": wrapStyle.value,\n        \"ref\": el\n      }, [(_a = slots === null || slots === void 0 ? void 0 : slots.default) === null || _a === void 0 ? void 0 : _a.call(slots), renderLoading(), renderEmpty(), renderError()]);\n    };\n  }\n});"],"names":["_vue","require","tslib_1","Object","defineProperty","exports","value","scrollLoadProps","NORMAL","ERROR","EMPTY","classnames_1","__importDefault","vue_1","vue_types_1","adherev_util_intl_1","selectorPrefix","loadClassName","string","def","loadStyle","object","emptyClassName","emptyStyle","errorClassName","errorStyle","distance","number","getScrollContainer","func","renderLoading","renderEmpty","renderError","default","defineComponent","name","props","slots","emits","setup","_a","onScroll","$el","scrollContainer","$loadEl","loadEl","$emptyEl","emptyEl","$errorEl","errorEl","bottomHeight","scrollHeight","offsetHeight","scrollTop","Math","abs","lock","style","display","emit","status","onEmptyClick","onErrorClick","expose","el","ref","computed","wrapStyle","concat","call","hideAll","onBeforeUnmount","_c","removeEventListener","_b","onMounted","addEventListener","createVNode","class","loading","tv","empty","createTextVNode","error"],"mappings":"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"}