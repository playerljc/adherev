{"version":3,"file":"scrollload.js","sources":["scrollload.js"],"sourcesContent":["\"use strict\";\n\nvar _vue = require(\"vue\");\n\nrequire(\"core-js/modules/es.object.define-property.js\");\n\nrequire(\"core-js/modules/es.regexp.exec.js\");\n\nrequire(\"core-js/modules/es.string.split.js\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.NORMAL = exports.ERROR = exports.EMPTY = void 0;\n\nvar tslib_1 = require(\"tslib\");\n\nvar adherev_util_intl_1 = (0, tslib_1.__importDefault)(require(\"@baifendian/adherev-util-intl\"));\nvar classnames_1 = (0, tslib_1.__importDefault)(require(\"classnames\"));\n\nvar vue_1 = require(\"vue\");\n\nvar vue_types_1 = require(\"vue-types\");\n\nvar selectorPrefix = 'adherev-ui-scrollload';\nexports.EMPTY = 'empty';\nexports.ERROR = 'error';\nexports.NORMAL = 'normal';\nvar scrollLoadProps = {\n  loadClassName: (0, vue_types_1.string)().def(''),\n  loadStyle: (0, vue_types_1.object)().def({}),\n  emptyClassName: (0, vue_types_1.string)().def(''),\n  emptyStyle: (0, vue_types_1.object)().def({}),\n  errorClassName: (0, vue_types_1.string)().def(''),\n  errorStyle: (0, vue_types_1.object)().def({}),\n  distance: (0, vue_types_1.number)().def(50)\n};\nexports.default = (0, vue_1.defineComponent)({\n  name: 'adv-scrollload',\n  props: scrollLoadProps,\n  emits: ['scroll-bottom', 'empty-click', 'error-click'],\n  setup: function setup(props, _a) {\n    var emit = _a.emit,\n        slots = _a.slots,\n        expose = _a.expose;\n    var el = (0, vue_1.ref)();\n    var emptyEl = (0, vue_1.ref)();\n    var errorEl = (0, vue_1.ref)();\n    var loadEl = (0, vue_1.ref)();\n    var lock = false;\n    (0, vue_1.onMounted)(function () {\n      return initEvents();\n    });\n\n    var initEvents = function initEvents() {\n      var _a, _b, _c;\n\n      (_a = el === null || el === void 0 ? void 0 : el.value) === null || _a === void 0 ? void 0 : _a.addEventListener('scroll', onScroll);\n      (_b = emptyEl === null || emptyEl === void 0 ? void 0 : emptyEl.value) === null || _b === void 0 ? void 0 : _b.addEventListener('click', onEmptyClick);\n      (_c = errorEl === null || errorEl === void 0 ? void 0 : errorEl.value) === null || _c === void 0 ? void 0 : _c.addEventListener('click', onErrorClick);\n    };\n\n    var onScroll = function onScroll() {\n      var $el = el.value;\n      var $loadEl = loadEl.value;\n      var $emptyEl = emptyEl.value;\n      var $errorEl = errorEl.value;\n      var bottomHeight = $el.scrollHeight - $el.offsetHeight;\n      var scrollTop = $el.scrollTop;\n      /**\n       * 条件完全相等或误差值在1之间\n       */\n\n      if (Math.abs(scrollTop - bottomHeight) <= props.distance) {\n        if (lock) return;\n        lock = true; // 先显示loading\n\n        $loadEl.style.display = 'flex';\n        /**\n         * 完成\n         * @param {string} status [empty(没有数据) | error(有错误) | normal(正常)]\n         */\n\n        emit('scroll-bottom', function (status) {\n          $loadEl.style.display = 'none';\n\n          if (status === exports.EMPTY) {\n            $emptyEl.style.display = 'block';\n          } else if (status === exports.ERROR) {\n            $errorEl.style.display = 'block';\n          }\n\n          lock = false;\n        });\n      }\n    };\n\n    var onEmptyClick = function onEmptyClick() {\n      emit('empty-click');\n    };\n\n    var onErrorClick = function onErrorClick() {\n      emit('error-click');\n    };\n\n    var renderLoading = function renderLoading() {\n      var _a;\n\n      if (slots.loading) {\n        return (0, _vue.createVNode)(\"div\", {\n          \"class\": (0, classnames_1.default)(\"\".concat(selectorPrefix, \"-load\"), (props.loadClassName || '').split(/\\s+/)),\n          \"style\": props.loadStyle,\n          \"ref\": loadEl\n        }, [(_a = slots === null || slots === void 0 ? void 0 : slots.loading) === null || _a === void 0 ? void 0 : _a.call(slots)]);\n      }\n\n      return (0, _vue.createVNode)(\"div\", {\n        \"class\": (0, classnames_1.default)(\"\".concat(selectorPrefix, \"-load\"), 'standard', (props.loadClassName || '').split(/\\s+/)),\n        \"style\": props.loadStyle,\n        \"ref\": loadEl\n      }, [adherev_util_intl_1.default.tv('数据加载中')]);\n    };\n\n    var renderEmpty = function renderEmpty() {\n      var _a;\n\n      if (slots.empty) {\n        return (0, _vue.createVNode)(\"div\", {\n          \"class\": (0, classnames_1.default)(\"\".concat(selectorPrefix, \"-empty\"), (props.emptyClassName || '').split(/\\s+/)),\n          \"style\": props.emptyStyle,\n          \"ref\": emptyEl\n        }, [(_a = slots === null || slots === void 0 ? void 0 : slots.empty) === null || _a === void 0 ? void 0 : _a.call(slots)]);\n      }\n\n      return (0, _vue.createVNode)(\"div\", {\n        \"class\": (0, classnames_1.default)(\"\".concat(selectorPrefix, \"-empty\"), (props.emptyClassName || '').split(/\\s+/)),\n        \"style\": props.emptyStyle,\n        \"ref\": emptyEl\n      }, [(0, _vue.createTextVNode)(\"~\"), adherev_util_intl_1.default.tv('没有更多')]);\n    };\n\n    var renderError = function renderError() {\n      var _a;\n\n      if (slots.error) {\n        return (0, _vue.createVNode)(\"div\", {\n          \"class\": (0, classnames_1.default)(\"\".concat(selectorPrefix, \"-error\"), (props.errorClassName || '').split(/\\s+/)),\n          \"style\": props.errorStyle,\n          \"ref\": errorEl\n        }, [(_a = slots === null || slots === void 0 ? void 0 : slots.error) === null || _a === void 0 ? void 0 : _a.call(slots)]);\n      }\n\n      return (0, _vue.createVNode)(\"div\", {\n        \"class\": (0, classnames_1.default)(\"\".concat(selectorPrefix, \"-error\"), (props.errorClassName || '').split(/\\s+/)),\n        \"style\": props.errorStyle,\n        \"ref\": errorEl\n      }, [adherev_util_intl_1.default.tv('出现错误')]);\n    };\n\n    var hideAll = function hideAll() {\n      var $loadEl = loadEl.value;\n      var $emptyEl = emptyEl.value;\n      var $errorEl = errorEl.value;\n      $loadEl.style.display = 'none';\n      $errorEl.style.display = 'none';\n      $emptyEl.style.display = 'none';\n    };\n\n    expose({\n      hideAll: hideAll\n    });\n    return function () {\n      var _a;\n\n      return (0, _vue.createVNode)(\"div\", {\n        \"class\": selectorPrefix,\n        \"ref\": el\n      }, [(_a = slots === null || slots === void 0 ? void 0 : slots.default) === null || _a === void 0 ? void 0 : _a.call(slots), renderLoading(), renderEmpty(), renderError()]);\n    };\n  }\n});"],"names":["_vue","require","tslib_1","Object","defineProperty","exports","value","NORMAL","ERROR","EMPTY","adherev_util_intl_1","__importDefault","classnames_1","vue_1","vue_types_1","selectorPrefix","scrollLoadProps","loadClassName","string","def","loadStyle","object","emptyClassName","emptyStyle","errorClassName","errorStyle","distance","number","default","defineComponent","name","props","emits","setup","_a","emit","slots","expose","el","ref","emptyEl","errorEl","loadEl","lock","initEvents","onMounted","_c","addEventListener","onScroll","_b","onEmptyClick","onErrorClick","$el","$loadEl","$emptyEl","$errorEl","bottomHeight","scrollHeight","offsetHeight","scrollTop","Math","abs","style","display","status","hideAll","createVNode","class","call","loading","concat","split","tv","empty","createTextVNode","error"],"mappings":"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"}