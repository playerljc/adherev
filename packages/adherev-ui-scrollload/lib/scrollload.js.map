{"version":3,"file":"scrollload.js","sources":["scrollload.js"],"sourcesContent":["\"use strict\";\n\nrequire(\"core-js/modules/es.object.define-property.js\");\n\nrequire(\"core-js/modules/es.number.constructor.js\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.NORMAL = exports.ERROR = exports.EMPTY = void 0;\n\nvar tslib_1 = require(\"tslib\");\n\nvar classnames_1 = tslib_1.__importDefault(require(\"classnames\"));\n\nvar adherev_util_intl_1 = tslib_1.__importDefault(require(\"@baifendian/adherev-util-intl\"));\n\nvar selectorPrefix = 'adherev-ui-scrollload';\nexports.EMPTY = 'empty';\nexports.ERROR = 'error';\nexports.NORMAL = 'normal';\nvar ScrollLoad = {\n  name: 'adv-scrollload',\n  props: {\n    loadClassName: {\n      type: String,\n      default: ''\n    },\n    emptyClassName: {\n      type: String,\n      default: ''\n    },\n    errorClassName: {\n      type: String,\n      default: ''\n    },\n    distance: {\n      type: Number,\n      default: 50\n    },\n    getScrollContainer: {\n      type: Function,\n      default: function _default() {\n        return null;\n      }\n    },\n    renderLoading: {\n      type: Object,\n      default: function _default() {\n        return null;\n      }\n    },\n    renderEmpty: {\n      type: Object,\n      default: function _default() {\n        return null;\n      }\n    },\n    renderError: {\n      type: Object,\n      default: function _default() {\n        return null;\n      }\n    }\n  },\n  slots: ['loading', 'empty', 'error'],\n  emits: ['scrollBottom', 'emptyClick', 'errorClick'],\n  data: function data() {\n    return {\n      $lock: false\n    };\n  },\n  mounted: function mounted() {\n    this.initEvents();\n  },\n  beforeDestroy: function beforeDestroy() {\n    this.removeEvents();\n  },\n  computed: {\n    scrollContainer: function scrollContainer() {\n      return this.getScrollContainer ? this.getScrollContainer() || this.$refs.el : this.$refs.el;\n    },\n    wrapStyle: function wrapStyle() {\n      return \"overflow-y: \" + (this.getScrollContainer() === this.$refs.el ? 'auto' : 'initial');\n    }\n  },\n  methods: {\n    $renderLoading: function $renderLoading(h) {\n      var _a = this,\n          $slots = _a.$slots,\n          loadClassName = _a.loadClassName;\n\n      if ($slots.loading || this.renderLoading) {\n        return h(\"div\", {\n          \"class\": classnames_1.default(selectorPrefix + \"-load\", loadClassName || ''),\n          \"ref\": \"loadEl\"\n        }, [$slots.loading || this.renderLoading]);\n      }\n\n      return h(\"div\", {\n        \"class\": classnames_1.default(selectorPrefix + \"-load\", 'standard', loadClassName || ''),\n        \"ref\": \"loadEl\"\n      }, [adherev_util_intl_1.default.tv('数据加载中')]);\n    },\n    $renderEmpty: function $renderEmpty(h) {\n      var _a = this,\n          $slots = _a.$slots,\n          emptyClassName = _a.emptyClassName;\n\n      if ($slots.empty || this.renderEmpty) {\n        return h(\"div\", {\n          \"class\": classnames_1.default(selectorPrefix + \"-empty\", emptyClassName || ''),\n          \"ref\": \"emptyEl\"\n        }, [$slots.empty || this.renderEmpty]);\n      }\n\n      return h(\"div\", {\n        \"class\": classnames_1.default(selectorPrefix + \"-empty\", emptyClassName || ''),\n        \"ref\": \"emptyEl\"\n      }, [\"~\", adherev_util_intl_1.default.tv('没有更多')]);\n    },\n    $renderError: function $renderError(h) {\n      var _a = this,\n          $slots = _a.$slots,\n          errorClassName = _a.errorClassName;\n\n      if ($slots.error || this.renderError) {\n        return h(\"div\", {\n          \"class\": classnames_1.default(selectorPrefix + \"-error\", errorClassName || ''),\n          \"ref\": \"errorEl\"\n        }, [$slots.error || this.renderError]);\n      }\n\n      return h(\"div\", {\n        \"class\": classnames_1.default(selectorPrefix + \"-error\", errorClassName || ''),\n        \"ref\": \"errorEl\"\n      }, [adherev_util_intl_1.default.tv('出现错误')]);\n    },\n    initEvents: function initEvents() {\n      var $refs = this.$refs;\n      this.scrollContainer.addEventListener('scroll', this.onScroll);\n      $refs.emptyEl.addEventListener('click', this.onEmptyClick);\n      $refs.errorEl.addEventListener('click', this.onErrorClick);\n    },\n    removeEvents: function removeEvents() {\n      var $refs = this.$refs;\n      this.scrollContainer.removeEventListener('scroll', this.onScroll);\n      $refs.emptyEl.removeEventListener('click', this.onEmptyClick);\n      $refs.errorEl.removeEventListener('click', this.onErrorClick);\n    },\n    onScroll: function onScroll() {\n      var _a = this,\n          _b = _a.$refs,\n          loadEl = _b.loadEl,\n          errorEl = _b.errorEl,\n          emptyEl = _b.emptyEl,\n          $data = _a.$data,\n          distance = _a.distance;\n\n      var el = this.scrollContainer;\n      var bottomHeight = el.scrollHeight - el.offsetHeight;\n      var scrollTop = el.scrollTop;\n      /**\n       * 条件完全相等或误差值在1之间\n       */\n\n      if (Math.abs(scrollTop - bottomHeight) <= distance) {\n        if ($data.$lock) return;\n        $data.$lock = true; // 先显示loading\n\n        loadEl.style.display = 'flex';\n        /**\n         * 完成\n         * @param {string} status [empty(没有数据) | error(有错误) | normal(正常)]\n         */\n\n        this.$emit('scrollBottom', function (status) {\n          loadEl.style.display = 'none';\n\n          if (status === exports.EMPTY) {\n            emptyEl.style.display = 'block';\n          } else if (status === exports.ERROR) {\n            errorEl.style.display = 'block';\n          }\n\n          $data.$lock = false;\n        });\n      }\n    },\n    onEmptyClick: function onEmptyClick() {\n      this.$emit('emptyClick');\n    },\n    onErrorClick: function onErrorClick() {\n      this.$emit('errorClick');\n    },\n\n    /**\n     * hideAll\n     */\n    hideAll: function hideAll() {\n      var _a = this.$refs,\n          loadEl = _a.loadEl,\n          errorEl = _a.errorEl,\n          emptyEl = _a.emptyEl;\n      loadEl.style.display = 'none';\n      errorEl.style.display = 'none';\n      emptyEl.style.display = 'none';\n    }\n  },\n  render: function render(h) {\n    var $slots = this.$slots;\n    return h(\"div\", {\n      \"class\": selectorPrefix,\n      \"style\": this.wrapStyle,\n      \"ref\": \"el\"\n    }, [$slots.default, this.$renderLoading(h), this.$renderEmpty(h), this.$renderError(h)]);\n  }\n};\nexports.default = ScrollLoad;"],"names":["require","Object","defineProperty","exports","value","NORMAL","ERROR","EMPTY","tslib_1","classnames_1","__importDefault","adherev_util_intl_1","selectorPrefix","ScrollLoad","name","props","loadClassName","type","String","default","emptyClassName","errorClassName","distance","Number","getScrollContainer","Function","renderLoading","renderEmpty","renderError","slots","emits","data","$lock","mounted","this","initEvents","beforeDestroy","removeEvents","computed","scrollContainer","$refs","el","wrapStyle","methods","$renderLoading","h","$slots","loading","class","ref","tv","$renderEmpty","empty","$renderError","error","addEventListener","onScroll","emptyEl","onEmptyClick","errorEl","onErrorClick","removeEventListener","_a","_b","loadEl","$data","bottomHeight","scrollHeight","offsetHeight","scrollTop","Math","abs","style","display","$emit","status","hideAll","render"],"mappings":"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"}