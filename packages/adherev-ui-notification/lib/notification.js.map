{"version":3,"file":"notification.js","sources":["notification.js"],"sourcesContent":["\"use strict\";\n\nrequire(\"core-js/modules/es.object.define-property.js\");\n\nrequire(\"core-js/modules/es.object.assign.js\");\n\nrequire(\"core-js/modules/es.array.join.js\");\n\nrequire(\"core-js/modules/es.array.concat.js\");\n\nrequire(\"core-js/modules/es.object.to-string.js\");\n\nrequire(\"core-js/modules/es.promise.js\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar tslib_1 = require(\"tslib\");\n\nvar uuid_1 = require(\"uuid\");\n\nvar vue_1 = tslib_1.__importDefault(require(\"vue\"));\n\nvar vue_fragment_1 = require(\"vue-fragment\");\n\nvar adherev_util_1 = tslib_1.__importDefault(require(\"@baifendian/adherev-util\"));\n\nvar selectorPrefix = 'adherev-ui-notification';\n/**\n * Notification\n * @class Notification\n * @classdesc Notification\n */\n\nvar Notification =\n/** @class */\nfunction () {\n  function Notification(container, config) {\n    this.config = {\n      style: 'material',\n      type: 'top'\n    }; // 存放所有的notification\n\n    this.notifications = {};\n    this.key = false;\n    this.container = container;\n    this.config = Object.assign(this.config, config);\n    this.createInnerContainer();\n    this.init();\n    this.initEvents();\n  }\n  /**\n   * createInnerContainer\n   * @private\n   */\n\n\n  Notification.prototype.createInnerContainer = function () {\n    var _a;\n\n    var innerContainer = this.container.querySelector(\".\" + selectorPrefix);\n\n    if (innerContainer) {\n      (_a = innerContainer === null || innerContainer === void 0 ? void 0 : innerContainer.parentElement) === null || _a === void 0 ? void 0 : _a.removeChild(innerContainer);\n    }\n\n    this.innerContainer = document.createElement('div');\n    this.innerContainer.className = selectorPrefix;\n    this.notificationContainer = document.createElement('ul');\n    this.innerContainer.appendChild(this.notificationContainer);\n    this.container.appendChild(this.innerContainer);\n  };\n  /**\n   * init\n   * @private\n   */\n\n\n  Notification.prototype.init = function () {\n    var _a, _b;\n\n    var config = this.config;\n    (_a = this === null || this === void 0 ? void 0 : this.innerContainer) === null || _a === void 0 ? void 0 : _a.classList.remove([selectorPrefix].concat([config.type === 'top' ? 'bottom' : 'top', config.style]).join('-'));\n    (_b = this === null || this === void 0 ? void 0 : this.innerContainer) === null || _b === void 0 ? void 0 : _b.classList.add([selectorPrefix].concat([config.type, config.style]).join('-'));\n  };\n  /**\n   * initEvents\n   * @private\n   */\n\n\n  Notification.prototype.initEvents = function () {\n    var _a;\n\n    var self = this;\n    (_a = this === null || this === void 0 ? void 0 : this.notificationContainer) === null || _a === void 0 ? void 0 : _a.addEventListener('click', function (e) {\n      var _a, _b, _c;\n\n      if ((_c = (_b = (_a = e.target) === null || _a === void 0 ? void 0 : _a.classList) === null || _b === void 0 ? void 0 : _b.contains) === null || _c === void 0 ? void 0 : _c.call(_b, 'closeBtn')) {\n        var topDom = adherev_util_1.default.getTopDom(e.target, selectorPrefix + \"-item\");\n        self.closeNotification.call(self, topDom.dataset.id);\n      }\n    });\n  };\n  /**\n   * closeNotification - 点击删除通知\n   * closeNotification\n   * @param {string} id\n   * @access private\n   */\n\n\n  Notification.prototype.closeNotification = function (id) {\n    var self = this;\n    if (self.key) return;\n    self.key = true;\n    var n = self.notifications[id];\n\n    function transitionendAction() {\n      var _a;\n\n      n.removeEventListener('transitionend', transitionendAction);\n      (_a = self === null || self === void 0 ? void 0 : self.notificationContainer) === null || _a === void 0 ? void 0 : _a.removeChild(n);\n      self.key = false; // closeAfter\n\n      self.trigger('onCloseAfter', n);\n    } // closeBefore\n\n\n    self.trigger('onCloseBefore', n);\n    n.addEventListener('transitionend', transitionendAction);\n    n.style.overflow = 'hidden';\n    n.querySelector('.info').style.opacity = '0';\n    n.style.height = '0';\n  };\n  /**\n   * buildCustom\n   * @param config\n   * @return Promise<String>\n   * @private\n   */\n\n\n  Notification.prototype.buildCustom = function (config) {\n    var _this = this;\n\n    return new Promise(function (resolve) {\n      var closed = config.closed,\n          children = config.children;\n      var id = uuid_1.v1();\n      var n = document.createElement('li');\n      n.className = selectorPrefix + \"-item\";\n      n.dataset.id = id;\n      var div = document.createElement('div');\n      n.appendChild(div);\n      var self = _this;\n      new vue_1.default({\n        mounted: function mounted() {\n          resolve(self.build(id, n));\n        },\n        render: function render(h) {\n          return (// @ts-ignore\n            h(vue_fragment_1.Fragment, [h(\"div\", {\n              \"class\": \"info\"\n            }, [adherev_util_1.default.isObject(children) ? h(children) : adherev_util_1.default.isFunction(children) ? children(h) : children || '']), closed ? h(\"span\", {\n              \"class\": \"closeBtn\"\n            }) : null])\n          );\n        }\n      }).$mount(div);\n    });\n  };\n  /**\n   * buildStandard\n   * @param config\n   * @return Promise<string>\n   * @private\n   */\n\n\n  Notification.prototype.buildStandard = function (config) {\n    var _this = this;\n\n    return new Promise(function (resolve) {\n      var _a = config.headerLabel,\n          headerLabel = _a === void 0 ? '' : _a,\n          _b = config.headerIcon,\n          headerIcon = _b === void 0 ? '' : _b,\n          _c = config.title,\n          title = _c === void 0 ? '' : _c,\n          _d = config.text,\n          text = _d === void 0 ? '' : _d,\n          _e = config.icon,\n          icon = _e === void 0 ? '' : _e,\n          _f = config.closed,\n          closed = _f === void 0 ? true : _f,\n          _g = config.datetime,\n          datetime = _g === void 0 ? '' : _g;\n      var id = uuid_1.v1();\n      var n = document.createElement('li');\n      n.className = selectorPrefix + \"-item\";\n      n.dataset.id = id;\n      var div = document.createElement('div');\n      n.appendChild(div);\n      var self = _this;\n      new vue_1.default({\n        mounted: function mounted() {\n          // @ts-ignore\n          resolve(self.build(id, n));\n        },\n        render: function render(h) {\n          return (// @ts-ignore\n            h(vue_fragment_1.Fragment, [h(\"div\", {\n              \"class\": \"info\"\n            }, [h(\"div\", {\n              \"class\": selectorPrefix + \"-standard-header\"\n            }, [h(\"div\", {\n              \"class\": selectorPrefix + \"-standard-header-icon\"\n            }, [headerIcon ? h(\"img\", {\n              \"attrs\": {\n                \"src\": headerIcon,\n                \"alt\": \"\"\n              }\n            }) : null]), h(\"div\", {\n              \"class\": selectorPrefix + \"-standard-header-label\"\n            }, [adherev_util_1.default.isObject(headerLabel) ? h(headerLabel) : adherev_util_1.default.isFunction(headerLabel) ? headerLabel(h) : headerLabel || ''])]), h(\"div\", {\n              \"class\": selectorPrefix + \"-standard-content\"\n            }, [h(\"div\", {\n              \"class\": selectorPrefix + \"-standard-content-media-l\"\n            }, [icon ? h(\"img\", {\n              \"attrs\": {\n                \"src\": icon,\n                \"alt\": \"\"\n              }\n            }) : null]), h(\"div\", {\n              \"class\": selectorPrefix + \"-standard-content-row\"\n            }, [h(\"div\", {\n              \"class\": selectorPrefix + \"-standard-content-row-title\"\n            }, [adherev_util_1.default.isObject(title) ? h(title) : adherev_util_1.default.isFunction(title) ? title(h) : title || '']), h(\"div\", {\n              \"class\": selectorPrefix + \"-standard-content-row-text\"\n            }, [adherev_util_1.default.isObject(text) ? h(text) : adherev_util_1.default.isFunction(text) ? text(h) : text || ''])]), h(\"div\", {\n              \"class\": selectorPrefix + \"-standard-content-media-r\"\n            }, [adherev_util_1.default.isObject(datetime) ? h(datetime) : adherev_util_1.default.isFunction(datetime) ? datetime(h) : datetime || ''])])]), closed ? h(\"span\", {\n              \"class\": \"closeBtn\"\n            }) : null])\n          );\n        }\n      }).$mount(div);\n    });\n  };\n  /**\n   * build\n   * @param id\n   * @param n\n   * @return string\n   * @private\n   */\n\n\n  Notification.prototype.build = function (id, n) {\n    var _a;\n\n    var self = this;\n    this.notifications[id] = n;\n    (_a = this === null || this === void 0 ? void 0 : this.notificationContainer) === null || _a === void 0 ? void 0 : _a.appendChild(n); // onCreate\n\n    self.trigger('onCreate', n);\n    n.style.height = 'auto';\n    var targetHeight = n.clientHeight; // 会有最小高度的限制\n\n    if (self.config.style === 'material') {\n      if (targetHeight < 40) {\n        targetHeight = 40;\n      }\n    } else if (self.config.style === 'ios') {\n      if (targetHeight < 70) {\n        targetHeight = 70;\n      }\n    }\n\n    n.style.height = '0';\n    setTimeout(function () {\n      n.style.height = targetHeight + \"px\";\n      n.querySelector('.info').style.opacity = '1';\n      self.trigger('onShow', n);\n    }, 100);\n    return id;\n  };\n  /**\n   * trigger\n   * @param action\n   * @param params\n   * @private\n   */\n\n\n  Notification.prototype.trigger = function (action, params) {\n    if (this.config[action]) {\n      this.config[action](params);\n    }\n  };\n  /**\n   * show\n   * @param {Object} config\n   * @return Promise<string>\n   */\n\n\n  Notification.prototype.show = function (config) {\n    return this.buildCustom(config);\n  };\n  /**\n   * showStandard\n   * @param {Object} config\n   * @return Promise<string>\n   */\n\n\n  Notification.prototype.showStandard = function (config) {\n    return this.buildStandard(config);\n  };\n  /**\n   * close\n   * @param {string} id\n   */\n\n\n  Notification.prototype.close = function (id) {\n    this.closeNotification(id);\n  };\n\n  return Notification;\n}();\n\nvar NotificationFactory = {\n  /**\n   * build\n   * @param container\n   * @param config\n   * @return Notification\n   */\n  build: function build(container, config) {\n    return new Notification(container, config);\n  }\n};\n/**\n * NotificationFactory\n */\n\nexports.default = NotificationFactory;"],"names":["require","Object","defineProperty","exports","value","tslib_1","uuid_1","vue_1","__importDefault","vue_fragment_1","adherev_util_1","selectorPrefix","Notification","container","config","this","style","type","notifications","key","assign","createInnerContainer","init","initEvents","prototype","_a","innerContainer","querySelector","parentElement","removeChild","document","createElement","className","notificationContainer","appendChild","_b","classList","remove","concat","join","add","self","addEventListener","e","_c","target","contains","call","topDom","default","getTopDom","closeNotification","dataset","id","n","trigger","transitionendAction","removeEventListener","overflow","opacity","height","buildCustom","_this","Promise","resolve","closed","children","v1","div","mounted","build","render","h","Fragment","class","isObject","isFunction","$mount","buildStandard","headerLabel","headerIcon","title","_d","text","_e","icon","_f","_g","datetime","attrs","src","alt","targetHeight","clientHeight","setTimeout","action","params","show","showStandard","close","NotificationFactory"],"mappings":"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"}