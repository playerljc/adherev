{"version":3,"file":"notification.js","sources":["notification.js"],"sourcesContent":["import \"core-js/modules/es.object.assign.js\";\nimport \"core-js/modules/es.array.join.js\";\nimport \"core-js/modules/es.array.concat.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.promise.js\";\nimport { __assign } from \"tslib\";\nimport { v1 } from 'uuid';\nimport Vue from 'vue';\nimport { Fragment } from 'vue-fragment';\nimport Util from '@baifendian/adherev-util';\nvar selectorPrefix = 'adherev-ui-notification'; // MessageDialog的配置\n\nvar globalConfig;\n/**\n * Notification\n * @class Notification\n * @classdesc Notification\n */\n\nvar Notification =\n/** @class */\nfunction () {\n  function Notification(container, config) {\n    this.config = {\n      style: 'material',\n      type: 'top'\n    }; // 存放所有的notification\n\n    this.notifications = {};\n    this.key = false;\n    this.container = container;\n    this.config = Object.assign(this.config, config);\n    this.createInnerContainer();\n    this.init();\n    this.initEvents();\n  }\n  /**\n   * createInnerContainer\n   * @private\n   */\n\n\n  Notification.prototype.createInnerContainer = function () {\n    var _a;\n\n    var innerContainer = this.container.querySelector(\".\" + selectorPrefix);\n\n    if (innerContainer) {\n      (_a = innerContainer === null || innerContainer === void 0 ? void 0 : innerContainer.parentElement) === null || _a === void 0 ? void 0 : _a.removeChild(innerContainer);\n    }\n\n    this.innerContainer = document.createElement('div');\n    this.innerContainer.className = selectorPrefix;\n    this.notificationContainer = document.createElement('ul');\n    this.innerContainer.appendChild(this.notificationContainer);\n    this.container.appendChild(this.innerContainer);\n  };\n  /**\n   * init\n   * @private\n   */\n\n\n  Notification.prototype.init = function () {\n    var _a, _b;\n\n    var config = this.config;\n    (_a = this === null || this === void 0 ? void 0 : this.innerContainer) === null || _a === void 0 ? void 0 : _a.classList.remove([selectorPrefix].concat([config.type === 'top' ? 'bottom' : 'top', config.style]).join('-'));\n    (_b = this === null || this === void 0 ? void 0 : this.innerContainer) === null || _b === void 0 ? void 0 : _b.classList.add([selectorPrefix].concat([config.type, config.style]).join('-'));\n  };\n  /**\n   * initEvents\n   * @private\n   */\n\n\n  Notification.prototype.initEvents = function () {\n    var _a;\n\n    var self = this;\n    (_a = this === null || this === void 0 ? void 0 : this.notificationContainer) === null || _a === void 0 ? void 0 : _a.addEventListener('click', function (e) {\n      var _a, _b, _c;\n\n      if ((_c = (_b = (_a = e.target) === null || _a === void 0 ? void 0 : _a.classList) === null || _b === void 0 ? void 0 : _b.contains) === null || _c === void 0 ? void 0 : _c.call(_b, 'closeBtn')) {\n        var topDom = Util.getTopDom(e.target, selectorPrefix + \"-item\");\n        self.closeNotification.call(self, topDom.dataset.id);\n      }\n    });\n  };\n  /**\n   * closeNotification - 点击删除通知\n   * closeNotification\n   * @param {string} id\n   * @access private\n   */\n\n\n  Notification.prototype.closeNotification = function (id) {\n    var self = this;\n    if (self.key) return;\n    self.key = true;\n    var n = self.notifications[id];\n\n    function transitionendAction() {\n      var _a;\n\n      n.removeEventListener('transitionend', transitionendAction);\n      (_a = self === null || self === void 0 ? void 0 : self.notificationContainer) === null || _a === void 0 ? void 0 : _a.removeChild(n);\n      self.key = false; // closeAfter\n\n      self.trigger('onCloseAfter', n);\n    } // closeBefore\n\n\n    self.trigger('onCloseBefore', n);\n    n.addEventListener('transitionend', transitionendAction);\n    n.style.overflow = 'hidden';\n    n.querySelector('.info').style.opacity = '0';\n    n.style.height = '0';\n  };\n  /**\n   * buildCustom\n   * @param config\n   * @return Promise<String>\n   * @private\n   */\n\n\n  Notification.prototype.buildCustom = function (config) {\n    var _this = this;\n\n    return new Promise(function (resolve) {\n      var closed = config.closed,\n          children = config.children;\n      var id = v1();\n      var n = document.createElement('li');\n      n.className = selectorPrefix + \"-item\";\n      n.dataset.id = id;\n      var div = document.createElement('div');\n      n.appendChild(div);\n      var self = _this;\n      new Vue(__assign(__assign({}, globalConfig || {}), {\n        mounted: function mounted() {\n          resolve(self.build(id, n));\n        },\n        render: function render(h) {\n          return (// @ts-ignore\n            h(Fragment, [h(\"div\", {\n              \"class\": \"info\"\n            }, [Util.isObject(children) ? h(children) : Util.isFunction(children) ? children(h) : children || '']), closed ? h(\"span\", {\n              \"class\": \"closeBtn\"\n            }) : null])\n          );\n        }\n      })).$mount(div);\n    });\n  };\n  /**\n   * buildStandard\n   * @param config\n   * @return Promise<string>\n   * @private\n   */\n\n\n  Notification.prototype.buildStandard = function (config) {\n    var _this = this;\n\n    return new Promise(function (resolve) {\n      var _a = config.headerLabel,\n          headerLabel = _a === void 0 ? '' : _a,\n          _b = config.headerIcon,\n          headerIcon = _b === void 0 ? '' : _b,\n          _c = config.title,\n          title = _c === void 0 ? '' : _c,\n          _d = config.text,\n          text = _d === void 0 ? '' : _d,\n          _e = config.icon,\n          icon = _e === void 0 ? '' : _e,\n          _f = config.closed,\n          closed = _f === void 0 ? true : _f,\n          _g = config.datetime,\n          datetime = _g === void 0 ? '' : _g;\n      var id = v1();\n      var n = document.createElement('li');\n      n.className = selectorPrefix + \"-item\";\n      n.dataset.id = id;\n      var div = document.createElement('div');\n      n.appendChild(div);\n      var self = _this;\n      new Vue({\n        mounted: function mounted() {\n          // @ts-ignore\n          resolve(self.build(id, n));\n        },\n        render: function render(h) {\n          return (// @ts-ignore\n            h(Fragment, [h(\"div\", {\n              \"class\": \"info\"\n            }, [h(\"div\", {\n              \"class\": selectorPrefix + \"-standard-header\"\n            }, [h(\"div\", {\n              \"class\": selectorPrefix + \"-standard-header-icon\"\n            }, [headerIcon ? h(\"img\", {\n              \"attrs\": {\n                \"src\": headerIcon,\n                \"alt\": \"\"\n              }\n            }) : null]), h(\"div\", {\n              \"class\": selectorPrefix + \"-standard-header-label\"\n            }, [Util.isObject(headerLabel) ? h(headerLabel) : Util.isFunction(headerLabel) ? headerLabel(h) : headerLabel || ''])]), h(\"div\", {\n              \"class\": selectorPrefix + \"-standard-content\"\n            }, [h(\"div\", {\n              \"class\": selectorPrefix + \"-standard-content-media-l\"\n            }, [icon ? h(\"img\", {\n              \"attrs\": {\n                \"src\": icon,\n                \"alt\": \"\"\n              }\n            }) : null]), h(\"div\", {\n              \"class\": selectorPrefix + \"-standard-content-row\"\n            }, [h(\"div\", {\n              \"class\": selectorPrefix + \"-standard-content-row-title\"\n            }, [Util.isObject(title) ? h(title) : Util.isFunction(title) ? title(h) : title || '']), h(\"div\", {\n              \"class\": selectorPrefix + \"-standard-content-row-text\"\n            }, [Util.isObject(text) ? h(text) : Util.isFunction(text) ? text(h) : text || ''])]), h(\"div\", {\n              \"class\": selectorPrefix + \"-standard-content-media-r\"\n            }, [Util.isObject(datetime) ? h(datetime) : Util.isFunction(datetime) ? datetime(h) : datetime || ''])])]), closed ? h(\"span\", {\n              \"class\": \"closeBtn\"\n            }) : null])\n          );\n        }\n      }).$mount(div);\n    });\n  };\n  /**\n   * build\n   * @param id\n   * @param n\n   * @return string\n   * @private\n   */\n\n\n  Notification.prototype.build = function (id, n) {\n    var _a;\n\n    var self = this;\n    this.notifications[id] = n;\n    (_a = this === null || this === void 0 ? void 0 : this.notificationContainer) === null || _a === void 0 ? void 0 : _a.appendChild(n); // onCreate\n\n    self.trigger('onCreate', n);\n    n.style.height = 'auto';\n    var targetHeight = n.clientHeight; // 会有最小高度的限制\n\n    if (self.config.style === 'material') {\n      if (targetHeight < 40) {\n        targetHeight = 40;\n      }\n    } else if (self.config.style === 'ios') {\n      if (targetHeight < 70) {\n        targetHeight = 70;\n      }\n    }\n\n    n.style.height = '0';\n    setTimeout(function () {\n      n.style.height = targetHeight + \"px\";\n      n.querySelector('.info').style.opacity = '1';\n      self.trigger('onShow', n);\n    }, 100);\n    return id;\n  };\n  /**\n   * trigger\n   * @param action\n   * @param params\n   * @private\n   */\n\n\n  Notification.prototype.trigger = function (action, params) {\n    if (this.config[action]) {\n      this.config[action](params);\n    }\n  };\n  /**\n   * show\n   * @param {Object} config\n   * @return Promise<string>\n   */\n\n\n  Notification.prototype.show = function (config) {\n    return this.buildCustom(config);\n  };\n  /**\n   * showStandard\n   * @param {Object} config\n   * @return Promise<string>\n   */\n\n\n  Notification.prototype.showStandard = function (config) {\n    return this.buildStandard(config);\n  };\n  /**\n   * close\n   * @param {string} id\n   */\n\n\n  Notification.prototype.close = function (id) {\n    this.closeNotification(id);\n  };\n\n  return Notification;\n}();\n\nvar NotificationFactory = {\n  /**\n   * build\n   * @param container\n   * @param config\n   * @return Notification\n   */\n  build: function build(container, config) {\n    return new Notification(container, config);\n  },\n\n  /**\n   * setConfig\n   * @param gc\n   */\n  setConfig: function setConfig(gc) {\n    globalConfig = gc;\n  }\n};\n/**\n * NotificationFactory\n */\n\nexport default NotificationFactory;"],"names":["__assign","v1","Vue","Fragment","Util","globalConfig","selectorPrefix","Notification","container","config","this","style","type","notifications","key","Object","assign","createInnerContainer","init","initEvents","prototype","_a","innerContainer","querySelector","parentElement","removeChild","document","createElement","className","notificationContainer","appendChild","_b","classList","remove","concat","join","add","self","addEventListener","e","_c","target","contains","call","topDom","getTopDom","closeNotification","dataset","id","n","trigger","transitionendAction","removeEventListener","overflow","opacity","height","buildCustom","_this","Promise","resolve","closed","children","div","mounted","build","render","h","class","isObject","isFunction","$mount","buildStandard","headerLabel","headerIcon","title","_d","text","_e","icon","_f","_g","datetime","attrs","src","alt","targetHeight","clientHeight","setTimeout","action","params","show","showStandard","close","NotificationFactory","setConfig","gc"],"mappings":"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"}