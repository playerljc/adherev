{"version":3,"file":"stickuplayout.js","sources":["stickuplayout.js"],"sourcesContent":["import { createVNode as _createVNode } from \"vue\";\nimport classNames from 'classnames';\nimport { defineComponent, onBeforeMount, onMounted, onUpdated, ref } from 'vue';\nimport { object, string } from 'vue-types';\nvar selectorPrefix = 'adherev-ui-stickuplayout';\nexport var stickupLayoutProps = {\n  fixedClassName: string().def(''),\n  fixedStyle: object().def({}),\n  innerClassName: string().def(''),\n  innerStyle: object().def({})\n};\nexport default defineComponent({\n  name: 'adv-stickuplayout',\n  props: stickupLayoutProps,\n  emits: ['change'],\n  setup: function setup(props, _a) {\n    var slots = _a.slots,\n      emit = _a.emit,\n      expose = _a.expose;\n    var root = ref();\n    var fixedEl = ref();\n    var innerEl = ref();\n    var key = false;\n    var maskEl = null;\n    var index = [];\n    var headerEls;\n    var preScrollObj = null;\n    var initial = function initial() {\n      var _a, _b, _c;\n      key = false;\n      index = [];\n      headerEls = (_a = root.value) === null || _a === void 0 ? void 0 : _a.querySelectorAll(\".\".concat(selectorPrefix, \"-item-header\"));\n      createIndex();\n      position();\n      (_b = innerEl.value) === null || _b === void 0 ? void 0 : _b.removeEventListener('scroll', onScroll);\n      (_c = innerEl.value) === null || _c === void 0 ? void 0 : _c.addEventListener('scroll', onScroll);\n    };\n    var createIndex = function createIndex() {\n      var _a, _b, _c;\n      var pre = 0;\n      index = [];\n      preScrollObj = null;\n      for (var i = 0, len = headerEls.length; i < len; i++) {\n        var header = headerEls[i];\n        var rangeStart = pre;\n        var rangeEnd = void 0;\n        if (i !== len - 1) {\n          rangeEnd = headerEls[i + 1].offsetTop - header.offsetHeight;\n        } else {\n          rangeEnd = (_a = innerEl.value) === null || _a === void 0 ? void 0 : _a.scrollHeight;\n        }\n        index.push({\n          start: rangeStart,\n          end: rangeEnd,\n          dom: header,\n          index: i\n        });\n        pre = rangeEnd;\n        if (pre > ((_b = innerEl.value) === null || _b === void 0 ? void 0 : _b.scrollHeight) - ((_c = innerEl.value) === null || _c === void 0 ? void 0 : _c.offsetHeight)) {\n          break;\n        }\n      }\n    };\n    var position = function position() {\n      var _a;\n      var val = (_a = innerEl.value) === null || _a === void 0 ? void 0 : _a.scrollTop;\n      var low = 0,\n        high = index.length - 1,\n        middle,\n        target;\n      while (low <= high && low <= index.length - 1 && high <= index.length - 1) {\n        middle = high + low >> 1;\n        var targetVal = index[middle];\n        if (val >= targetVal.start && val < targetVal.end) {\n          target = targetVal;\n          break;\n        } else if (val < targetVal.start) {\n          high = middle - 1;\n        } else {\n          low = middle + 1;\n        }\n      }\n      if (target) {\n        if (preScrollObj && preScrollObj.index === target.index) {\n          return false;\n        } else {\n          preScrollObj = target;\n          fixedEl.value.innerHTML = target.dom.outerHTML;\n          emit('change', target.index);\n        }\n      }\n    };\n    var onScroll = function onScroll() {\n      return position();\n    };\n    var scrollAnimationTo = function scrollAnimationTo(targetTop, duration) {\n      var _a, _b, _c, _d;\n      if (targetTop === void 0) {\n        targetTop = 0;\n      }\n      if (duration === void 0) {\n        duration = 300;\n      }\n      if (key) return;\n      initMask();\n      key = true;\n      maskEl.style.display = 'block';\n      var srcTop = (_a = innerEl.value) === null || _a === void 0 ? void 0 : _a.scrollTop;\n      var scrollVal = srcTop;\n      /**\n       * 一次滚动的步进\n       * @type {number}\n       */\n      var setp = ((_b = innerEl.value) === null || _b === void 0 ? void 0 : _b.scrollHeight) / (\n      // @ts-ignore\n      duration / (((_c = window.screen) === null || _c === void 0 ? void 0 : _c.updateInterval) || 16.7) + (\n      // @ts-ignore\n      duration % (((_d = window.screen) === null || _d === void 0 ? void 0 : _d.updateInterval) || 16.7) !== 0 ? 1 : 0));\n      /** *\n       * 动画的滚动\n       */\n      function scrollAnimation() {\n        if (srcTop < targetTop) {\n          if (scrollVal + setp > targetTop) {\n            scrollVal = targetTop;\n          } else {\n            scrollVal += setp;\n          }\n        } else if (scrollVal - setp < targetTop) {\n          scrollVal = targetTop;\n        } else {\n          scrollVal -= setp;\n        }\n        innerEl.value.scrollTop = scrollVal;\n        if (srcTop < targetTop) {\n          if (scrollVal >= targetTop) {\n            clear();\n          } else {\n            if (typeof window !== 'undefined') window.requestAnimationFrame(scrollAnimation);\n          }\n        } else if (scrollVal <= targetTop) {\n          clear();\n        } else {\n          if (typeof window !== 'undefined') window.requestAnimationFrame(scrollAnimation);\n        }\n        function clear() {\n          key = false;\n          maskEl.style.display = 'none';\n        }\n      }\n      /** *\n       * 滚动core\n       */\n      window.requestAnimationFrame(scrollAnimation);\n    };\n    var scrollTo = function scrollTo(item, duration) {\n      if (duration === void 0) {\n        duration = 300;\n      }\n      var targetTop = item.start + headerEls[item.index].offsetHeight;\n      if (duration === 0) {\n        innerEl.value.scrollTop = targetTop;\n      } else {\n        scrollAnimationTo(targetTop, duration);\n      }\n    };\n    var initMask = function initMask() {\n      if (!maskEl) {\n        maskEl = document.createElement('div');\n        maskEl.className = \"\".concat(selectorPrefix, \"-mask\");\n        window.document.body.appendChild(maskEl);\n      }\n    };\n    var refresh = function refresh() {\n      return initial();\n    };\n    /**\n     * scrollToByIndex\n     * @param {number} _index\n     * @param {number} duration\n     * @return {boolean}\n     */\n    var scrollToByIndex = function scrollToByIndex(_index, duration) {\n      if (duration === void 0) {\n        duration = 300;\n      }\n      var i = 0,\n        item;\n      for (; i < index.length; i++) {\n        if (index[i].index === _index) {\n          item = index[i];\n          break;\n        }\n      }\n      if (!item) {\n        item = index[index.length - 1];\n      }\n      scrollTo(item, duration);\n    };\n    /**\n     * scrollToByHeaderEl\n     * @param {HtmlElement} headerEl\n     * @param {number} duration\n     * @return {boolean}\n     */\n    var scrollToByHeaderEl = function scrollToByHeaderEl(headerEl, duration) {\n      if (duration === void 0) {\n        duration = 300;\n      }\n      var i = 0,\n        item,\n        _index = -1;\n      for (; i < index.length; i++) {\n        if (index[i].dom === headerEl) {\n          item = index[i];\n          _index = i;\n          break;\n        }\n      }\n      if (!item) {\n        item = index[index.length - 1];\n      }\n      scrollTo(item, duration);\n    };\n    expose({\n      refresh: refresh,\n      scrollToByIndex: scrollToByIndex,\n      scrollToByHeaderEl: scrollToByHeaderEl\n    });\n    onMounted(function () {\n      initial();\n    });\n    onUpdated(function () {\n      initial();\n    });\n    onBeforeMount(function () {\n      var _a, _b;\n      if (maskEl) {\n        (_b = (_a = maskEl === null || maskEl === void 0 ? void 0 : maskEl.parentElement) === null || _a === void 0 ? void 0 : _a.removeChild) === null || _b === void 0 ? void 0 : _b.call(_a, maskEl);\n      }\n    });\n    return function () {\n      var _a;\n      return _createVNode(\"div\", {\n        \"class\": selectorPrefix,\n        \"ref\": root\n      }, [_createVNode(\"div\", {\n        \"class\": classNames(\"\".concat(selectorPrefix, \"-fixed\"), props.fixedClassName || ''),\n        \"style\": props.fixedStyle,\n        \"ref\": fixedEl\n      }, null), _createVNode(\"div\", {\n        \"class\": classNames(\"\".concat(selectorPrefix, \"-inner\"), props.innerClassName || ''),\n        \"style\": props.innerStyle,\n        \"ref\": innerEl\n      }, [(_a = slots === null || slots === void 0 ? void 0 : slots.default) === null || _a === void 0 ? void 0 : _a.call(slots)])]);\n    };\n  }\n});"],"names":["_createVNode","classNames","defineComponent","onBeforeMount","onMounted","onUpdated","ref","object","string","selectorPrefix","stickupLayoutProps","fixedClassName","def","fixedStyle","innerClassName","innerStyle","name","props","emits","setup","_a","initial","_c","key","index","headerEls","root","value","querySelectorAll","concat","createIndex","position","_b","innerEl","removeEventListener","onScroll","addEventListener","scrollTo","item","duration","targetTop","start","offsetHeight","scrollTop","scrollAnimationTo","initMask","maskEl","document","createElement","className","window","body","appendChild","slots","emit","expose","fixedEl","preScrollObj","pre","i","len","length","header","rangeStart","rangeEnd","offsetTop","scrollHeight","push","end","dom","target","val","low","high","middle","targetVal","innerHTML","outerHTML","_d","srcTop","scrollVal","setp","style","display","screen","updateInterval","requestAnimationFrame","scrollAnimation","clear","refresh","scrollToByIndex","_index","scrollToByHeaderEl","headerEl","parentElement","removeChild","call","class","default"],"mappings":"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"}