{"version":3,"file":"stickuplayout.js","sources":["stickuplayout.js"],"sourcesContent":["import { createVNode as _createVNode } from \"vue\";\nimport \"core-js/modules/es.regexp.exec.js\";\nimport \"core-js/modules/es.string.split.js\";\nimport classNames from 'classnames';\nimport { defineComponent, onBeforeMount, onMounted, onUpdated, ref } from 'vue';\nimport { object, string } from 'vue-types';\nvar selectorPrefix = 'adherev-ui-stickuplayout';\nvar stickupLayoutProps = {\n  fixedClassName: string().def(''),\n  fixedStyle: object().def({}),\n  innerClassName: string().def(''),\n  innerStyle: object().def({})\n};\nexport default defineComponent({\n  name: 'adv-stickuplayout',\n  props: stickupLayoutProps,\n  setup: function setup(props, _a) {\n    var slots = _a.slots,\n        emit = _a.emit,\n        expose = _a.expose;\n    var root = ref();\n    var fixedEl = ref();\n    var innerEl = ref();\n    var key = false;\n    var maskEl = null;\n    var index = [];\n    var headerEls;\n    var preScrollObj = null;\n\n    var initial = function initial() {\n      var _a, _b, _c;\n\n      key = false;\n      index = [];\n      headerEls = (_a = root.value) === null || _a === void 0 ? void 0 : _a.querySelectorAll(\".\".concat(selectorPrefix, \"-item-header\"));\n      createIndex();\n      position();\n      (_b = innerEl.value) === null || _b === void 0 ? void 0 : _b.removeEventListener('scroll', onScroll);\n      (_c = innerEl.value) === null || _c === void 0 ? void 0 : _c.addEventListener('scroll', onScroll);\n    };\n\n    var createIndex = function createIndex() {\n      var _a, _b, _c;\n\n      var pre = 0;\n      index = [];\n      preScrollObj = null;\n\n      for (var i = 0, len = headerEls.length; i < len; i++) {\n        var header = headerEls[i];\n        var rangeStart = pre;\n        var rangeEnd = void 0;\n\n        if (i !== len - 1) {\n          rangeEnd = headerEls[i + 1].offsetTop - header.offsetHeight;\n        } else {\n          rangeEnd = (_a = innerEl.value) === null || _a === void 0 ? void 0 : _a.scrollHeight;\n        }\n\n        index.push({\n          start: rangeStart,\n          end: rangeEnd,\n          dom: header,\n          index: i\n        });\n        pre = rangeEnd;\n\n        if (pre > ((_b = innerEl.value) === null || _b === void 0 ? void 0 : _b.scrollHeight) - ((_c = innerEl.value) === null || _c === void 0 ? void 0 : _c.offsetHeight)) {\n          break;\n        }\n      }\n    };\n\n    var position = function position() {\n      var _a;\n\n      var val = (_a = innerEl.value) === null || _a === void 0 ? void 0 : _a.scrollTop;\n      var low = 0,\n          high = index.length - 1,\n          middle,\n          target;\n\n      while (low <= high && low <= index.length - 1 && high <= index.length - 1) {\n        middle = high + low >> 1;\n        var targetVal = index[middle];\n\n        if (val >= targetVal.start && val < targetVal.end) {\n          target = targetVal;\n          break;\n        } else if (val < targetVal.start) {\n          high = middle - 1;\n        } else {\n          low = middle + 1;\n        }\n      }\n\n      if (target) {\n        if (preScrollObj && preScrollObj.index === target.index) {\n          return false;\n        } else {\n          preScrollObj = target;\n          fixedEl.value.innerHTML = target.dom.outerHTML;\n          emit('change', target.index);\n        }\n      }\n    };\n\n    var onScroll = function onScroll() {\n      return position();\n    };\n\n    var scrollAnimationTo = function scrollAnimationTo(targetTop, duration) {\n      var _a, _b, _c, _d;\n\n      if (targetTop === void 0) {\n        targetTop = 0;\n      }\n\n      if (duration === void 0) {\n        duration = 300;\n      }\n\n      if (key) return;\n      initMask();\n      key = true;\n      maskEl.style.display = 'block';\n      var srcTop = (_a = innerEl.value) === null || _a === void 0 ? void 0 : _a.scrollTop;\n      var scrollVal = srcTop;\n      /**\n       * 一次滚动的步进\n       * @type {number}\n       */\n\n      var setp = ((_b = innerEl.value) === null || _b === void 0 ? void 0 : _b.scrollHeight) / ( // @ts-ignore\n      duration / (((_c = window.screen) === null || _c === void 0 ? void 0 : _c.updateInterval) || 16.7) + ( // @ts-ignore\n      duration % (((_d = window.screen) === null || _d === void 0 ? void 0 : _d.updateInterval) || 16.7) !== 0 ? 1 : 0));\n      /** *\n       * 动画的滚动\n       */\n\n      function scrollAnimation() {\n        if (srcTop < targetTop) {\n          if (scrollVal + setp > targetTop) {\n            scrollVal = targetTop;\n          } else {\n            scrollVal += setp;\n          }\n        } else if (scrollVal - setp < targetTop) {\n          scrollVal = targetTop;\n        } else {\n          scrollVal -= setp;\n        }\n\n        innerEl.value.scrollTop = scrollVal;\n\n        if (srcTop < targetTop) {\n          if (scrollVal >= targetTop) {\n            clear();\n          } else {\n            if (typeof window !== 'undefined') window.requestAnimationFrame(scrollAnimation);\n          }\n        } else if (scrollVal <= targetTop) {\n          clear();\n        } else {\n          if (typeof window !== 'undefined') window.requestAnimationFrame(scrollAnimation);\n        }\n\n        function clear() {\n          key = false;\n          maskEl.style.display = 'none';\n        }\n      }\n      /** *\n       * 滚动core\n       */\n\n\n      window.requestAnimationFrame(scrollAnimation);\n    };\n\n    var scrollTo = function scrollTo(item, duration) {\n      if (duration === void 0) {\n        duration = 300;\n      }\n\n      var targetTop = item.start + headerEls[item.index].offsetHeight;\n\n      if (duration === 0) {\n        innerEl.value.scrollTop = targetTop;\n      } else {\n        scrollAnimationTo(targetTop, duration);\n      }\n    };\n\n    var initMask = function initMask() {\n      if (!maskEl) {\n        maskEl = document.createElement('div');\n        maskEl.className = \"\".concat(selectorPrefix, \"-mask\");\n        window.document.body.appendChild(maskEl);\n      }\n    };\n\n    var refresh = function refresh() {\n      return initial();\n    };\n    /**\n     * scrollToByIndex\n     * @param {number} _index\n     * @param {number} duration\n     * @return {boolean}\n     */\n\n\n    var scrollToByIndex = function scrollToByIndex(_index, duration) {\n      if (duration === void 0) {\n        duration = 300;\n      }\n\n      var i = 0,\n          item;\n\n      for (; i < index.length; i++) {\n        if (index[i].index === _index) {\n          item = index[i];\n          break;\n        }\n      }\n\n      if (!item) return false;\n      scrollTo(item, duration);\n    };\n    /**\n     * scrollToByHeaderEl\n     * @param {HtmlElement} headerEl\n     * @param {number} duration\n     * @return {boolean}\n     */\n\n\n    var scrollToByHeaderEl = function scrollToByHeaderEl(headerEl, duration) {\n      if (duration === void 0) {\n        duration = 300;\n      }\n\n      var i = 0,\n          item,\n          _index = -1;\n\n      for (; i < index.length; i++) {\n        if (index[i].dom === headerEl) {\n          item = index[i];\n          _index = i;\n          break;\n        }\n      }\n\n      if (!item) return false;\n      scrollTo(item, duration);\n    };\n\n    expose({\n      refresh: refresh,\n      scrollToByIndex: scrollToByIndex,\n      scrollToByHeaderEl: scrollToByHeaderEl\n    });\n    onMounted(function () {\n      initial();\n    });\n    onUpdated(function () {\n      initial();\n    });\n    onBeforeMount(function () {\n      var _a, _b;\n\n      if (maskEl) {\n        (_b = (_a = maskEl === null || maskEl === void 0 ? void 0 : maskEl.parentElement) === null || _a === void 0 ? void 0 : _a.removeChild) === null || _b === void 0 ? void 0 : _b.call(_a, maskEl);\n      }\n    });\n    return function () {\n      var _a;\n\n      return _createVNode(\"div\", {\n        \"class\": selectorPrefix,\n        \"ref\": root\n      }, [_createVNode(\"div\", {\n        \"class\": classNames(\"\".concat(selectorPrefix, \"-fixed\"), props.fixedClassName.split(/\\s+/)),\n        \"style\": props.fixedStyle,\n        \"ref\": fixedEl\n      }, null), _createVNode(\"div\", {\n        \"class\": classNames(\"\".concat(selectorPrefix, \"-inner\"), props.innerClassName.split(/\\s+/)),\n        \"style\": props.innerStyle,\n        \"ref\": innerEl\n      }, [(_a = slots === null || slots === void 0 ? void 0 : slots.default) === null || _a === void 0 ? void 0 : _a.call(slots)])]);\n    };\n  }\n});"],"names":["_createVNode","classNames","defineComponent","onBeforeMount","onMounted","onUpdated","ref","object","string","selectorPrefix","stickupLayoutProps","fixedClassName","def","fixedStyle","innerClassName","innerStyle","name","props","setup","_a","initial","_c","key","index","headerEls","root","value","querySelectorAll","concat","createIndex","position","_b","innerEl","removeEventListener","onScroll","addEventListener","scrollTo","item","duration","targetTop","start","offsetHeight","scrollTop","scrollAnimationTo","initMask","maskEl","document","createElement","className","window","body","appendChild","slots","emit","expose","fixedEl","preScrollObj","pre","i","len","length","header","rangeStart","rangeEnd","offsetTop","scrollHeight","push","end","dom","target","val","low","high","middle","targetVal","innerHTML","outerHTML","_d","srcTop","scrollVal","setp","style","display","screen","updateInterval","requestAnimationFrame","scrollAnimation","clear","refresh","scrollToByIndex","_index","scrollToByHeaderEl","headerEl","parentElement","removeChild","call","class","split","default"],"mappings":"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"}