{"version":3,"file":"stickuplayout.js","sources":["stickuplayout.js"],"sourcesContent":["import classNames from 'classnames';\nvar selectorPrefix = 'adherev-ui-stickuplayout';\nvar StickUpLayout = {\n  name: 'adv-stickuplayout',\n  props: {\n    fixedClassName: {\n      type: String,\n      default: ''\n    },\n    fixedStyle: {\n      type: String,\n      default: ''\n    },\n    innerClassName: {\n      type: String,\n      default: ''\n    },\n    innerStyle: {\n      type: String,\n      default: ''\n    }\n  },\n  emits: ['change'],\n  data: function data() {\n    return {\n      $key: false,\n      $maskEl: null,\n      $index: [],\n      $headerEls: null,\n      $preScrollObj: null\n    };\n  },\n  mounted: function mounted() {\n    this.initial();\n  },\n  updated: function updated() {\n    this.initial();\n  },\n  beforeDestroy: function beforeDestroy() {\n    var $maskEl = this.$data.$maskEl;\n    if ($maskEl) {\n      $maskEl.parentElement.removeChild($maskEl);\n    }\n  },\n  methods: {\n    initial: function initial() {\n      var _a = this,\n        $refs = _a.$refs,\n        $data = _a.$data;\n      $data.$key = false;\n      $data.$index = [];\n      $data.$headerEls = $refs.el.querySelectorAll(\".\".concat(selectorPrefix, \"-item-header\"));\n      this.createIndex();\n      this.position();\n      $refs.innerEl.removeEventListener('scroll', this.onScroll);\n      $refs.innerEl.addEventListener('scroll', this.onScroll);\n    },\n    createIndex: function createIndex() {\n      var _a = this,\n        $refs = _a.$refs,\n        $data = _a.$data;\n      var pre = 0;\n      $data.$index = [];\n      $data.$preScrollObj = null;\n      for (var i = 0, len = $data.$headerEls.length; i < len; i++) {\n        var header = $data.$headerEls[i];\n        var rangeStart = pre;\n        var rangeEnd = void 0;\n        if (i !== len - 1) {\n          rangeEnd = $data.$headerEls[i + 1].offsetTop - header.offsetHeight;\n        } else {\n          rangeEnd = $refs.innerEl.scrollHeight;\n        }\n        $data.$index.push({\n          start: rangeStart,\n          end: rangeEnd,\n          dom: header,\n          index: i\n        });\n        pre = rangeEnd;\n        if (pre > $refs.innerEl.scrollHeight - $refs.innerEl.offsetHeight) {\n          break;\n        }\n      }\n    },\n    position: function position() {\n      var _a = this,\n        $refs = _a.$refs,\n        $data = _a.$data;\n      var val = $refs.innerEl.scrollTop;\n      var low = 0,\n        high = $data.$index.length - 1,\n        middle,\n        target;\n      while (low <= high && low <= $data.$index.length - 1 && high <= $data.$index.length - 1) {\n        middle = high + low >> 1;\n        var targetVal = $data.$index[middle];\n        if (val >= targetVal.start && val < targetVal.end) {\n          target = targetVal;\n          break;\n        } else if (val < targetVal.start) {\n          high = middle - 1;\n        } else {\n          low = middle + 1;\n        }\n      }\n      if (target) {\n        if ($data.$preScrollObj && $data.$preScrollObj.index === target.index) {\n          return false;\n        } else {\n          $data.$preScrollObj = target;\n          // @ts-ignore\n          $refs.fixedEl.innerHTML = target.dom.outerHTML;\n          this.$emit('change', target.index);\n        }\n      }\n    },\n    onScroll: function onScroll() {\n      this.position();\n    },\n    scrollAnimationTo: function scrollAnimationTo(targetTop, duration) {\n      if (targetTop === void 0) {\n        targetTop = 0;\n      }\n      if (duration === void 0) {\n        duration = 300;\n      }\n      var _a = this,\n        $refs = _a.$refs,\n        $data = _a.$data;\n      if ($data.$key) return;\n      this.initMask();\n      $data.$key = true;\n      $data.$maskEl.style.display = 'block';\n      var srcTop = $refs.innerEl.scrollTop,\n        scrollVal = srcTop,\n        /**\n         * 一次滚动的步进\n         * @type {number}\n         */\n        setp = $refs.innerEl.scrollHeight / (\n        // @ts-ignore\n        duration / (screen.updateInterval || 16.7) + (\n        // @ts-ignore\n        duration % (screen.updateInterval || 16.7) !== 0 ? 1 : 0));\n      /** *\n       * 动画的滚动\n       */\n      function scrollAnimation() {\n        if (srcTop < targetTop) {\n          if (scrollVal + setp > targetTop) {\n            scrollVal = targetTop;\n          } else {\n            scrollVal += setp;\n          }\n        } else if (scrollVal - setp < targetTop) {\n          scrollVal = targetTop;\n        } else {\n          scrollVal -= setp;\n        }\n        $refs.innerEl.scrollTop = scrollVal;\n        if (srcTop < targetTop) {\n          if (scrollVal >= targetTop) {\n            clear();\n          } else {\n            if (typeof window !== 'undefined') window.requestAnimationFrame(scrollAnimation);\n          }\n        } else if (scrollVal <= targetTop) {\n          clear();\n        } else {\n          if (typeof window !== 'undefined') window.requestAnimationFrame(scrollAnimation);\n        }\n        function clear() {\n          $data.$key = false;\n          $data.$maskEl.style.display = 'none';\n        }\n      }\n      /** *\n       * 滚动core\n       */\n      window.requestAnimationFrame(scrollAnimation);\n    },\n    scrollTo: function scrollTo(item, duration) {\n      if (duration === void 0) {\n        duration = 300;\n      }\n      var _a = this,\n        $refs = _a.$refs,\n        $headerEls = _a.$data.$headerEls;\n      var targetTop = item.start + $headerEls[item.index].offsetHeight;\n      if (duration === 0) {\n        $refs.innerEl.scrollTop = targetTop;\n      } else {\n        this.scrollAnimationTo(targetTop, duration);\n      }\n    },\n    initMask: function initMask() {\n      if (!this.$data.$maskEl) {\n        this.$data.$maskEl = document.createElement('div');\n        this.$data.$maskEl.className = \"\".concat(selectorPrefix, \"-mask\");\n        window.document.body.appendChild(this.$data.$maskEl);\n      }\n    },\n    refresh: function refresh() {\n      this.initial();\n    },\n    /**\n     * scrollToByIndex\n     * @param {number} index\n     * @param {number} duration\n     * @return {boolean}\n     */\n    scrollToByIndex: function scrollToByIndex(index, duration) {\n      if (duration === void 0) {\n        duration = 300;\n      }\n      var $index = this.$data.$index;\n      var i = 0,\n        item;\n      for (; i < $index.length; i++) {\n        if ($index[i].index === index) {\n          item = $index[i];\n          break;\n        }\n      }\n      if (!item) {\n        item = $index[$index.length - 1];\n      }\n      this.scrollTo(item, duration);\n    },\n    /**\n     * scrollToByHeaderEl\n     * @param {HtmlElement} headerEl\n     * @param {number} duration\n     * @return {boolean}\n     */\n    scrollToByHeaderEl: function scrollToByHeaderEl(headerEl, duration) {\n      if (duration === void 0) {\n        duration = 300;\n      }\n      var $index = this.$data.$index;\n      var i = 0,\n        item,\n        index = -1;\n      for (; i < $index.length; i++) {\n        if ($index[i].dom === headerEl) {\n          item = $index[i];\n          index = i;\n          break;\n        }\n      }\n      if (!item) {\n        item = $index[$index.length - 1];\n      }\n      this.scrollTo(item, duration);\n    }\n  },\n  render: function render(h) {\n    var _a = this,\n      $slots = _a.$slots,\n      fixedClassName = _a.fixedClassName,\n      fixedStyle = _a.fixedStyle,\n      innerClassName = _a.innerClassName,\n      innerStyle = _a.innerStyle;\n    return h(\"div\", {\n      \"class\": selectorPrefix,\n      \"ref\": \"el\"\n    }, [h(\"div\", {\n      \"class\": classNames(\"\".concat(selectorPrefix, \"-fixed\"), fixedClassName || ''),\n      \"style\": fixedStyle,\n      \"ref\": \"fixedEl\"\n    }), h(\"div\", {\n      \"class\": classNames(\"\".concat(selectorPrefix, \"-inner\"), innerClassName || ''),\n      \"style\": innerStyle,\n      \"ref\": \"innerEl\"\n    }, [$slots.default])]);\n  }\n};\nexport default StickUpLayout;"],"names":["classNames","selectorPrefix","StickUpLayout","name","props","fixedClassName","type","String","default","fixedStyle","innerClassName","innerStyle","emits","data","$key","$maskEl","$index","$headerEls","$preScrollObj","mounted","this","initial","updated","beforeDestroy","$data","parentElement","removeChild","methods","$refs","el","querySelectorAll","concat","createIndex","position","innerEl","removeEventListener","onScroll","addEventListener","pre","i","len","length","header","rangeStart","rangeEnd","offsetTop","offsetHeight","scrollHeight","push","start","end","dom","index","target","val","scrollTop","low","high","middle","targetVal","fixedEl","innerHTML","outerHTML","$emit","scrollAnimationTo","targetTop","duration","srcTop","scrollVal","setp","initMask","style","display","screen","updateInterval","window","requestAnimationFrame","scrollAnimation","clear","scrollTo","item","document","createElement","className","body","appendChild","refresh","scrollToByIndex","scrollToByHeaderEl","headerEl","render","h","_a","$slots","class","ref"],"mappings":"OAAOA,eAAgB,aACvB,IAAIC,eAAiB,2BACjBC,cAAgB,CAClBC,KAAM,oBACNC,MAAO,CACLC,eAAgB,CACdC,KAAMC,OACNC,QAAS,EACX,EACAC,WAAY,CACVH,KAAMC,OACNC,QAAS,EACX,EACAE,eAAgB,CACdJ,KAAMC,OACNC,QAAS,EACX,EACAG,WAAY,CACVL,KAAMC,OACNC,QAAS,EACX,CACF,EACAI,MAAO,CAAC,UACRC,KAAM,WACJ,MAAO,CACLC,KAAM,CAAA,EACNC,QAAS,KACTC,OAAQ,GACRC,WAAY,KACZC,cAAe,IACjB,CACF,EACAC,QAAS,WACPC,KAAKC,QAAQ,CACf,EACAC,QAAS,WACPF,KAAKC,QAAQ,CACf,EACAE,cAAe,WACb,IAAIR,EAAUK,KAAKI,MAAMT,QACrBA,GACFA,EAAQU,cAAcC,YAAYX,CAAO,CAE7C,EACAY,QAAS,CACPN,QAAS,WACP,IACEO,EADOR,KACIQ,MACXJ,EAFOJ,KAEII,MACbA,EAAMV,KAAO,CAAA,EACbU,EAAMR,OAAS,GACfQ,EAAMP,WAAaW,EAAMC,GAAGC,iBAAiB,IAAIC,OAAO9B,eAAgB,cAAc,CAAC,EACvFmB,KAAKY,YAAY,EACjBZ,KAAKa,SAAS,EACdL,EAAMM,QAAQC,oBAAoB,SAAUf,KAAKgB,QAAQ,EACzDR,EAAMM,QAAQG,iBAAiB,SAAUjB,KAAKgB,QAAQ,CACxD,EACAJ,YAAa,WACX,IACEJ,EADOR,KACIQ,MACXJ,EAFOJ,KAEII,MACTc,EAAM,EACVd,EAAMR,OAAS,GACfQ,EAAMN,cAAgB,KACtB,IAAK,IAAIqB,EAAI,EAAGC,EAAMhB,EAAMP,WAAWwB,OAAQF,EAAIC,EAAKD,CAAC,GAAI,CAC3D,IAAIG,EAASlB,EAAMP,WAAWsB,GAC1BI,EAAaL,EACbM,EAAW,KAAA,EAEbA,EADEL,IAAMC,EAAM,EACHhB,EAAMP,WAAWsB,EAAI,GAAGM,UAAYH,EAAOI,aAE3ClB,EAAMM,QAAQa,aAS3B,GAPAvB,EAAMR,OAAOgC,KAAK,CAChBC,MAAON,EACPO,IAAKN,EACLO,IAAKT,EACLU,MAAOb,CACT,CAAC,GACDD,EAAMM,GACIhB,EAAMM,QAAQa,aAAenB,EAAMM,QAAQY,aACnD,KAEJ,CACF,EACAb,SAAU,WASR,IARA,IAOEoB,EANAzB,EADOR,KACIQ,MACXJ,EAFOJ,KAEII,MACT8B,EAAM1B,EAAMM,QAAQqB,UACpBC,EAAM,EACRC,EAAOjC,EAAMR,OAAOyB,OAAS,EAGxBe,GAAOC,GAAQD,GAAOhC,EAAMR,OAAOyB,OAAS,GAAKgB,GAAQjC,EAAMR,OAAOyB,OAAS,GAAG,CAEvF,IADAiB,EACIC,EAAYnC,EAAMR,OAAO0C,EADpBD,EAAOD,GAAO,GAEvB,GAAIF,GAAOK,EAAUV,OAASK,EAAMK,EAAUT,IAAK,CACjDG,EAASM,EACT,KACF,CAAWL,EAAMK,EAAUV,MACzBQ,EAAOC,EAAS,EAEhBF,EAAe,EAATE,CAEV,CACA,GAAIL,EAAQ,CACV,GAAI7B,EAAMN,eAAiBM,EAAMN,cAAckC,QAAUC,EAAOD,MAC9D,MAAO,CAAA,EAEP5B,EAAMN,cAAgBmC,EAEtBzB,EAAMgC,QAAQC,UAAYR,EAAOF,IAAIW,UACrC1C,KAAK2C,MAAM,SAAUV,EAAOD,KAAK,CAErC,CACF,EACAhB,SAAU,WACRhB,KAAKa,SAAS,CAChB,EACA+B,kBAAmB,SAA2BC,EAAWC,GACrC,KAAA,IAAdD,IACFA,EAAY,GAEG,KAAA,IAAbC,IACFA,EAAW,KAEb,IAOIC,EACFC,EAKAC,EAZAzC,EADOR,KACIQ,MACXJ,EAFOJ,KAEII,MACTA,EAAMV,OACVM,KAAKkD,SAAS,EACd9C,EAAMV,KAAO,CAAA,EACbU,EAAMT,QAAQwD,MAAMC,QAAU,QAC1BL,EAASvC,EAAMM,QAAQqB,UACzBa,EAAYD,EAKZE,EAAOzC,EAAMM,QAAQa,cAErBmB,GAAYO,OAAOC,gBAAkB,OAErCR,GAAYO,OAAOC,gBAAkB,OAAU,EAAI,EAAI,IAoCzDC,OAAOC,sBAhCP,SAASC,IAwBP,SAASC,IACPtD,EAAMV,KAAO,CAAA,EACbU,EAAMT,QAAQwD,MAAMC,QAAU,MAChC,CA1BIL,EAASF,EACYA,EAAnBG,EAAYC,EACdD,EAAYH,EAEZG,GAAaC,EAEND,EAAYC,EAAOJ,EAC5BG,EAAYH,EAEZG,GAAaC,EAEfzC,EAAMM,QAAQqB,UAAYa,EACtBD,EAASF,EACMA,GAAbG,EACFU,EAAM,EAEgB,aAAlB,OAAOH,QAAwBA,OAAOC,sBAAsBC,CAAe,EAExET,GAAaH,EACtBa,EAAM,EAEgB,aAAlB,OAAOH,QAAwBA,OAAOC,sBAAsBC,CAAe,CAMnF,CAI4C,EAC9C,EACAE,SAAU,SAAkBC,EAAMd,GAIhC,IACEtC,EADOR,KACIQ,MACXX,EAFOG,KAESI,MAAMP,WACpBgD,EAAYe,EAAK/B,MAAQhC,EAAW+D,EAAK5B,OAAON,aACnC,KANfoB,EADe,KAAA,IAAbA,EACS,IAMTA,GACFtC,EAAMM,QAAQqB,UAAYU,EAE1B7C,KAAK4C,kBAAkBC,EAAWC,CAAQ,CAE9C,EACAI,SAAU,WACHlD,KAAKI,MAAMT,UACdK,KAAKI,MAAMT,QAAUkE,SAASC,cAAc,KAAK,EACjD9D,KAAKI,MAAMT,QAAQoE,UAAY,GAAGpD,OAAO9B,eAAgB,OAAO,EAChE0E,OAAOM,SAASG,KAAKC,YAAYjE,KAAKI,MAAMT,OAAO,EAEvD,EACAuE,QAAS,WACPlE,KAAKC,QAAQ,CACf,EAOAkE,gBAAiB,SAAyBnC,EAAOc,GAC9B,KAAA,IAAbA,IACFA,EAAW,KAKb,IAHA,IAEEc,EAFEhE,EAASI,KAAKI,MAAMR,OACpBuB,EAAI,EAEDA,EAAIvB,EAAOyB,OAAQF,CAAC,GACzB,GAAIvB,EAAOuB,GAAGa,QAAUA,EAAO,CAC7B4B,EAAOhE,EAAOuB,GACd,KACF,CAEGyC,EAAAA,GACIhE,EAAOA,EAAOyB,OAAS,GAEhCrB,KAAK2D,SAASC,EAAMd,CAAQ,CAC9B,EAOAsB,mBAAoB,SAA4BC,EAAUvB,GACvC,KAAA,IAAbA,IACFA,EAAW,KAMb,IAJA,IAEEc,EAFEhE,EAASI,KAAKI,MAAMR,OACpBuB,EAAI,EAGDA,EAAIvB,EAAOyB,OAAQF,CAAC,GACzB,GAAIvB,EAAOuB,GAAGY,MAAQsC,EAAU,CAC9BT,EAAOhE,EAAOuB,GACda,EACA,KACF,CAEG4B,EAAAA,GACIhE,EAAOA,EAAOyB,OAAS,GAEhCrB,KAAK2D,SAASC,EAAMd,CAAQ,CAC9B,CACF,EACAwB,OAAQ,SAAgBC,GACtB,IAAIC,EAAKxE,KACPyE,EAASD,EAAGC,OACZxF,EAAiBuF,EAAGvF,eACpBI,EAAamF,EAAGnF,WAChBC,EAAiBkF,EAAGlF,eACpBC,EAAaiF,EAAGjF,WAClB,OAAOgF,EAAE,MAAO,CACdG,MAAS7F,eACT8F,IAAO,IACT,EAAG,CAACJ,EAAE,MAAO,CACXG,MAAS9F,WAAW,GAAG+B,OAAO9B,eAAgB,QAAQ,EAAGI,GAAkB,EAAE,EAC7EkE,MAAS9D,EACTsF,IAAO,SACT,CAAC,EAAGJ,EAAE,MAAO,CACXG,MAAS9F,WAAW,GAAG+B,OAAO9B,eAAgB,QAAQ,EAAGS,GAAkB,EAAE,EAC7E6D,MAAS5D,EACToF,IAAO,SACT,EAAG,CAACF,EAAOrF,QAAQ,EAAE,CACvB,CACF,iBACeN"}