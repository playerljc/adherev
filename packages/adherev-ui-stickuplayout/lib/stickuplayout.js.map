{"version":3,"file":"stickuplayout.js","sources":["stickuplayout.js"],"sourcesContent":["\"use strict\";\n\nvar _vue = require(\"vue\");\n\nrequire(\"core-js/modules/es.object.define-property.js\");\n\nrequire(\"core-js/modules/es.regexp.exec.js\");\n\nrequire(\"core-js/modules/es.string.split.js\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar tslib_1 = require(\"tslib\");\n\nvar classnames_1 = (0, tslib_1.__importDefault)(require(\"classnames\"));\n\nvar vue_1 = require(\"vue\");\n\nvar vue_types_1 = require(\"vue-types\");\n\nvar selectorPrefix = 'adherev-ui-stickuplayout';\nvar stickupLayoutProps = {\n  fixedClassName: (0, vue_types_1.string)().def(''),\n  fixedStyle: (0, vue_types_1.object)().def({}),\n  innerClassName: (0, vue_types_1.string)().def(''),\n  innerStyle: (0, vue_types_1.object)().def({})\n};\nexports.default = (0, vue_1.defineComponent)({\n  name: 'adv-stickuplayout',\n  props: stickupLayoutProps,\n  setup: function setup(props, _a) {\n    var slots = _a.slots,\n        emit = _a.emit,\n        expose = _a.expose;\n    var root = (0, vue_1.ref)();\n    var fixedEl = (0, vue_1.ref)();\n    var innerEl = (0, vue_1.ref)();\n    var key = false;\n    var maskEl = null;\n    var index = [];\n    var headerEls;\n    var preScrollObj = null;\n\n    var initial = function initial() {\n      var _a, _b, _c;\n\n      key = false;\n      index = [];\n      headerEls = (_a = root.value) === null || _a === void 0 ? void 0 : _a.querySelectorAll(\".\".concat(selectorPrefix, \"-item-header\"));\n      createIndex();\n      position();\n      (_b = innerEl.value) === null || _b === void 0 ? void 0 : _b.removeEventListener('scroll', onScroll);\n      (_c = innerEl.value) === null || _c === void 0 ? void 0 : _c.addEventListener('scroll', onScroll);\n    };\n\n    var createIndex = function createIndex() {\n      var _a, _b, _c;\n\n      var pre = 0;\n      index = [];\n      preScrollObj = null;\n\n      for (var i = 0, len = headerEls.length; i < len; i++) {\n        var header = headerEls[i];\n        var rangeStart = pre;\n        var rangeEnd = void 0;\n\n        if (i !== len - 1) {\n          rangeEnd = headerEls[i + 1].offsetTop - header.offsetHeight;\n        } else {\n          rangeEnd = (_a = innerEl.value) === null || _a === void 0 ? void 0 : _a.scrollHeight;\n        }\n\n        index.push({\n          start: rangeStart,\n          end: rangeEnd,\n          dom: header,\n          index: i\n        });\n        pre = rangeEnd;\n\n        if (pre > ((_b = innerEl.value) === null || _b === void 0 ? void 0 : _b.scrollHeight) - ((_c = innerEl.value) === null || _c === void 0 ? void 0 : _c.offsetHeight)) {\n          break;\n        }\n      }\n    };\n\n    var position = function position() {\n      var _a;\n\n      var val = (_a = innerEl.value) === null || _a === void 0 ? void 0 : _a.scrollTop;\n      var low = 0,\n          high = index.length - 1,\n          middle,\n          target;\n\n      while (low <= high && low <= index.length - 1 && high <= index.length - 1) {\n        middle = high + low >> 1;\n        var targetVal = index[middle];\n\n        if (val >= targetVal.start && val < targetVal.end) {\n          target = targetVal;\n          break;\n        } else if (val < targetVal.start) {\n          high = middle - 1;\n        } else {\n          low = middle + 1;\n        }\n      }\n\n      if (target) {\n        if (preScrollObj && preScrollObj.index === target.index) {\n          return false;\n        } else {\n          preScrollObj = target;\n          fixedEl.value.innerHTML = target.dom.outerHTML;\n          emit('change', target.index);\n        }\n      }\n    };\n\n    var onScroll = function onScroll() {\n      return position();\n    };\n\n    var scrollAnimationTo = function scrollAnimationTo(targetTop, duration) {\n      var _a, _b, _c, _d;\n\n      if (targetTop === void 0) {\n        targetTop = 0;\n      }\n\n      if (duration === void 0) {\n        duration = 300;\n      }\n\n      if (key) return;\n      initMask();\n      key = true;\n      maskEl.style.display = 'block';\n      var srcTop = (_a = innerEl.value) === null || _a === void 0 ? void 0 : _a.scrollTop;\n      var scrollVal = srcTop;\n      /**\n       * 一次滚动的步进\n       * @type {number}\n       */\n\n      var setp = ((_b = innerEl.value) === null || _b === void 0 ? void 0 : _b.scrollHeight) / ( // @ts-ignore\n      duration / (((_c = window.screen) === null || _c === void 0 ? void 0 : _c.updateInterval) || 16.7) + ( // @ts-ignore\n      duration % (((_d = window.screen) === null || _d === void 0 ? void 0 : _d.updateInterval) || 16.7) !== 0 ? 1 : 0));\n      /** *\n       * 动画的滚动\n       */\n\n      function scrollAnimation() {\n        if (srcTop < targetTop) {\n          if (scrollVal + setp > targetTop) {\n            scrollVal = targetTop;\n          } else {\n            scrollVal += setp;\n          }\n        } else if (scrollVal - setp < targetTop) {\n          scrollVal = targetTop;\n        } else {\n          scrollVal -= setp;\n        }\n\n        innerEl.value.scrollTop = scrollVal;\n\n        if (srcTop < targetTop) {\n          if (scrollVal >= targetTop) {\n            clear();\n          } else {\n            if (typeof window !== 'undefined') window.requestAnimationFrame(scrollAnimation);\n          }\n        } else if (scrollVal <= targetTop) {\n          clear();\n        } else {\n          if (typeof window !== 'undefined') window.requestAnimationFrame(scrollAnimation);\n        }\n\n        function clear() {\n          key = false;\n          maskEl.style.display = 'none';\n        }\n      }\n      /** *\n       * 滚动core\n       */\n\n\n      window.requestAnimationFrame(scrollAnimation);\n    };\n\n    var scrollTo = function scrollTo(item, duration) {\n      if (duration === void 0) {\n        duration = 300;\n      }\n\n      var targetTop = item.start + headerEls[item.index].offsetHeight;\n\n      if (duration === 0) {\n        innerEl.value.scrollTop = targetTop;\n      } else {\n        scrollAnimationTo(targetTop, duration);\n      }\n    };\n\n    var initMask = function initMask() {\n      if (!maskEl) {\n        maskEl = document.createElement('div');\n        maskEl.className = \"\".concat(selectorPrefix, \"-mask\");\n        window.document.body.appendChild(maskEl);\n      }\n    };\n\n    var refresh = function refresh() {\n      return initial();\n    };\n    /**\n     * scrollToByIndex\n     * @param {number} _index\n     * @param {number} duration\n     * @return {boolean}\n     */\n\n\n    var scrollToByIndex = function scrollToByIndex(_index, duration) {\n      if (duration === void 0) {\n        duration = 300;\n      }\n\n      var i = 0,\n          item;\n\n      for (; i < index.length; i++) {\n        if (index[i].index === _index) {\n          item = index[i];\n          break;\n        }\n      }\n\n      if (!item) return false;\n      scrollTo(item, duration);\n    };\n    /**\n     * scrollToByHeaderEl\n     * @param {HtmlElement} headerEl\n     * @param {number} duration\n     * @return {boolean}\n     */\n\n\n    var scrollToByHeaderEl = function scrollToByHeaderEl(headerEl, duration) {\n      if (duration === void 0) {\n        duration = 300;\n      }\n\n      var i = 0,\n          item,\n          _index = -1;\n\n      for (; i < index.length; i++) {\n        if (index[i].dom === headerEl) {\n          item = index[i];\n          _index = i;\n          break;\n        }\n      }\n\n      if (!item) return false;\n      scrollTo(item, duration);\n    };\n\n    expose({\n      refresh: refresh,\n      scrollToByIndex: scrollToByIndex,\n      scrollToByHeaderEl: scrollToByHeaderEl\n    });\n    (0, vue_1.onMounted)(function () {\n      initial();\n    });\n    (0, vue_1.onUpdated)(function () {\n      initial();\n    });\n    (0, vue_1.onBeforeMount)(function () {\n      var _a, _b;\n\n      if (maskEl) {\n        (_b = (_a = maskEl === null || maskEl === void 0 ? void 0 : maskEl.parentElement) === null || _a === void 0 ? void 0 : _a.removeChild) === null || _b === void 0 ? void 0 : _b.call(_a, maskEl);\n      }\n    });\n    return function () {\n      var _a;\n\n      return (0, _vue.createVNode)(\"div\", {\n        \"class\": selectorPrefix,\n        \"ref\": root\n      }, [(0, _vue.createVNode)(\"div\", {\n        \"class\": (0, classnames_1.default)(\"\".concat(selectorPrefix, \"-fixed\"), props.fixedClassName.split(/\\s+/)),\n        \"style\": props.fixedStyle,\n        \"ref\": fixedEl\n      }, null), (0, _vue.createVNode)(\"div\", {\n        \"class\": (0, classnames_1.default)(\"\".concat(selectorPrefix, \"-inner\"), props.innerClassName.split(/\\s+/)),\n        \"style\": props.innerStyle,\n        \"ref\": innerEl\n      }, [(_a = slots === null || slots === void 0 ? void 0 : slots.default) === null || _a === void 0 ? void 0 : _a.call(slots)])]);\n    };\n  }\n});"],"names":["_vue","require","tslib_1","Object","defineProperty","exports","value","classnames_1","__importDefault","vue_1","vue_types_1","selectorPrefix","stickupLayoutProps","fixedClassName","string","def","fixedStyle","object","innerClassName","innerStyle","default","defineComponent","name","props","setup","_a","initial","_c","key","index","headerEls","root","querySelectorAll","concat","createIndex","position","_b","innerEl","removeEventListener","onScroll","addEventListener","scrollTo","item","duration","targetTop","start","offsetHeight","scrollTop","scrollAnimationTo","initMask","maskEl","document","createElement","className","window","body","appendChild","slots","emit","expose","ref","fixedEl","preScrollObj","pre","i","len","length","header","rangeStart","rangeEnd","offsetTop","scrollHeight","push","end","dom","target","val","low","high","middle","targetVal","innerHTML","outerHTML","_d","srcTop","scrollVal","setp","style","display","screen","updateInterval","requestAnimationFrame","scrollAnimation","clear","refresh","scrollToByIndex","_index","scrollToByHeaderEl","headerEl","onMounted","onUpdated","onBeforeMount","parentElement","removeChild","call","createVNode","class","split"],"mappings":"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"}