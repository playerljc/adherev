{"version":3,"file":"stickuplayout.js","sources":["stickuplayout.js"],"sourcesContent":["\"use strict\";\n\nrequire(\"core-js/modules/es.object.define-property.js\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar tslib_1 = require(\"tslib\");\n\nvar classnames_1 = tslib_1.__importDefault(require(\"classnames\"));\n\nvar selectorPrefix = 'adherev-ui-stickuplayout';\nvar StickUpLayout = {\n  name: 'adv-stickuplayout',\n  props: {\n    fixedClassName: {\n      type: String,\n      default: ''\n    },\n    fixedStyle: {\n      type: String,\n      default: ''\n    },\n    innerClassName: {\n      type: String,\n      default: ''\n    },\n    innerStyle: {\n      type: String,\n      default: ''\n    }\n  },\n  emits: ['change'],\n  data: function data() {\n    return {\n      $key: false,\n      $maskEl: null,\n      $index: [],\n      $headerEls: null,\n      $preScrollObj: null\n    };\n  },\n  mounted: function mounted() {\n    this.initial();\n  },\n  updated: function updated() {\n    this.initial();\n  },\n  beforeDestroy: function beforeDestroy() {\n    var $maskEl = this.$data.$maskEl;\n\n    if ($maskEl) {\n      $maskEl.parentElement.removeChild($maskEl);\n    }\n  },\n  methods: {\n    initial: function initial() {\n      var _a = this,\n          $refs = _a.$refs,\n          $data = _a.$data;\n\n      $data.$key = false;\n      $data.$index = [];\n      $data.$headerEls = $refs.el.querySelectorAll(\".\" + selectorPrefix + \"-item-header\");\n      this.createIndex();\n      this.position();\n      $refs.innerEl.removeEventListener('scroll', this.onScroll);\n      $refs.innerEl.addEventListener('scroll', this.onScroll);\n    },\n    createIndex: function createIndex() {\n      var _a = this,\n          $refs = _a.$refs,\n          $data = _a.$data;\n\n      var pre = 0;\n      $data.$index = [];\n      $data.$preScrollObj = null;\n\n      for (var i = 0, len = $data.$headerEls.length; i < len; i++) {\n        var header = $data.$headerEls[i];\n        var rangeStart = pre;\n        var rangeEnd = void 0;\n\n        if (i !== len - 1) {\n          rangeEnd = $data.$headerEls[i + 1].offsetTop - header.offsetHeight;\n        } else {\n          rangeEnd = $refs.innerEl.scrollHeight;\n        }\n\n        $data.$index.push({\n          start: rangeStart,\n          end: rangeEnd,\n          dom: header,\n          index: i\n        });\n        pre = rangeEnd;\n\n        if (pre > $refs.innerEl.scrollHeight - $refs.innerEl.offsetHeight) {\n          break;\n        }\n      }\n    },\n    position: function position() {\n      var _a = this,\n          $refs = _a.$refs,\n          $data = _a.$data;\n\n      var val = $refs.innerEl.scrollTop;\n      var low = 0,\n          high = $data.$index.length - 1,\n          middle,\n          target;\n\n      while (low <= high && low <= $data.$index.length - 1 && high <= $data.$index.length - 1) {\n        middle = high + low >> 1;\n        var targetVal = $data.$index[middle];\n\n        if (val >= targetVal.start && val < targetVal.end) {\n          target = targetVal;\n          break;\n        } else if (val < targetVal.start) {\n          high = middle - 1;\n        } else {\n          low = middle + 1;\n        }\n      }\n\n      if (target) {\n        if ($data.$preScrollObj && $data.$preScrollObj.index === target.index) {\n          return false;\n        } else {\n          $data.$preScrollObj = target; // @ts-ignore\n\n          $refs.fixedEl.innerHTML = target.dom.outerHTML;\n          this.$emit('change', target.index);\n        }\n      }\n    },\n    onScroll: function onScroll() {\n      this.position();\n    },\n    scrollAnimationTo: function scrollAnimationTo(targetTop, duration) {\n      if (targetTop === void 0) {\n        targetTop = 0;\n      }\n\n      if (duration === void 0) {\n        duration = 300;\n      }\n\n      var _a = this,\n          $refs = _a.$refs,\n          $data = _a.$data;\n\n      if ($data.$key) return;\n      this.initMask();\n      $data.$key = true;\n      $data.$maskEl.style.display = 'block';\n      var srcTop = $refs.innerEl.scrollTop,\n          scrollVal = srcTop,\n\n      /**\n       * 一次滚动的步进\n       * @type {number}\n       */\n      setp = $refs.innerEl.scrollHeight / ( // @ts-ignore\n      duration / (screen.updateInterval || 16.7) + ( // @ts-ignore\n      duration % (screen.updateInterval || 16.7) !== 0 ? 1 : 0));\n      /** *\n       * 动画的滚动\n       */\n\n      function scrollAnimation() {\n        if (srcTop < targetTop) {\n          if (scrollVal + setp > targetTop) {\n            scrollVal = targetTop;\n          } else {\n            scrollVal += setp;\n          }\n        } else if (scrollVal - setp < targetTop) {\n          scrollVal = targetTop;\n        } else {\n          scrollVal -= setp;\n        }\n\n        $refs.innerEl.scrollTop = scrollVal;\n\n        if (srcTop < targetTop) {\n          if (scrollVal >= targetTop) {\n            clear();\n          } else {\n            if (typeof window !== 'undefined') window.requestAnimationFrame(scrollAnimation);\n          }\n        } else if (scrollVal <= targetTop) {\n          clear();\n        } else {\n          if (typeof window !== 'undefined') window.requestAnimationFrame(scrollAnimation);\n        }\n\n        function clear() {\n          $data.$key = false;\n          $data.$maskEl.style.display = 'none';\n        }\n      }\n      /** *\n       * 滚动core\n       */\n\n\n      window.requestAnimationFrame(scrollAnimation);\n    },\n    scrollTo: function scrollTo(item, duration) {\n      if (duration === void 0) {\n        duration = 300;\n      }\n\n      var _a = this,\n          $refs = _a.$refs,\n          $headerEls = _a.$data.$headerEls;\n\n      var targetTop = item.start + $headerEls[item.index].offsetHeight;\n\n      if (duration === 0) {\n        $refs.innerEl.scrollTop = targetTop;\n      } else {\n        this.scrollAnimationTo(targetTop, duration);\n      }\n    },\n    initMask: function initMask() {\n      if (!this.$data.$maskEl) {\n        this.$data.$maskEl = document.createElement('div');\n        this.$data.$maskEl.className = selectorPrefix + \"-mask\";\n        window.document.body.appendChild(this.$data.$maskEl);\n      }\n    },\n    refresh: function refresh() {\n      this.initial();\n    },\n\n    /**\n     * scrollToByIndex\n     * @param {number} index\n     * @param {number} duration\n     * @return {boolean}\n     */\n    scrollToByIndex: function scrollToByIndex(index, duration) {\n      if (duration === void 0) {\n        duration = 300;\n      }\n\n      var $index = this.$data.$index;\n      var i = 0,\n          item;\n\n      for (; i < $index.length; i++) {\n        if ($index[i].index === index) {\n          item = $index[i];\n          break;\n        }\n      }\n\n      if (!item) {\n        item = $index[$index.length - 1];\n      }\n\n      this.scrollTo(item, duration);\n    },\n\n    /**\n     * scrollToByHeaderEl\n     * @param {HtmlElement} headerEl\n     * @param {number} duration\n     * @return {boolean}\n     */\n    scrollToByHeaderEl: function scrollToByHeaderEl(headerEl, duration) {\n      if (duration === void 0) {\n        duration = 300;\n      }\n\n      var $index = this.$data.$index;\n      var i = 0,\n          item,\n          index = -1;\n\n      for (; i < $index.length; i++) {\n        if ($index[i].dom === headerEl) {\n          item = $index[i];\n          index = i;\n          break;\n        }\n      }\n\n      if (!item) {\n        item = $index[$index.length - 1];\n      }\n\n      this.scrollTo(item, duration);\n    }\n  },\n  render: function render(h) {\n    var _a = this,\n        $slots = _a.$slots,\n        fixedClassName = _a.fixedClassName,\n        fixedStyle = _a.fixedStyle,\n        innerClassName = _a.innerClassName,\n        innerStyle = _a.innerStyle;\n\n    return h(\"div\", {\n      \"class\": selectorPrefix,\n      \"ref\": \"el\"\n    }, [h(\"div\", {\n      \"class\": classnames_1.default(selectorPrefix + \"-fixed\", fixedClassName || ''),\n      \"style\": fixedStyle,\n      \"ref\": \"fixedEl\"\n    }), h(\"div\", {\n      \"class\": classnames_1.default(selectorPrefix + \"-inner\", innerClassName || ''),\n      \"style\": innerStyle,\n      \"ref\": \"innerEl\"\n    }, [$slots.default])]);\n  }\n};\nexports.default = StickUpLayout;"],"names":["require","Object","defineProperty","exports","value","tslib_1","classnames_1","__importDefault","selectorPrefix","StickUpLayout","name","props","fixedClassName","type","String","default","fixedStyle","innerClassName","innerStyle","emits","data","$key","$maskEl","$index","$headerEls","$preScrollObj","mounted","this","initial","updated","beforeDestroy","$data","parentElement","removeChild","methods","$refs","el","querySelectorAll","createIndex","position","innerEl","removeEventListener","onScroll","addEventListener","pre","i","len","length","header","rangeStart","rangeEnd","offsetTop","offsetHeight","scrollHeight","push","start","end","dom","index","target","val","scrollTop","low","high","middle","targetVal","fixedEl","innerHTML","outerHTML","$emit","scrollAnimationTo","targetTop","duration","srcTop","scrollVal","setp","initMask","style","display","screen","updateInterval","window","requestAnimationFrame","scrollAnimation","clear","scrollTo","item","document","createElement","className","body","appendChild","refresh","scrollToByIndex","scrollToByHeaderEl","headerEl","render","h","_a","$slots","class","ref"],"mappings":"aAEAA,QAAQ,gDAERC,OAAOC,eAAeC,QAAS,aAAc,CAC3CC,OAAO,IAGT,IAAIC,QAAUL,QAAQ,SAElBM,aAAeD,QAAQE,gBAAgBP,QAAQ,eAE/CQ,eAAiB,2BACjBC,cAAgB,CAClBC,KAAM,oBACNC,MAAO,CACLC,eAAgB,CACdC,KAAMC,OACNC,QAAS,IAEXC,WAAY,CACVH,KAAMC,OACNC,QAAS,IAEXE,eAAgB,CACdJ,KAAMC,OACNC,QAAS,IAEXG,WAAY,CACVL,KAAMC,OACNC,QAAS,KAGbI,MAAO,CAAC,UACRC,KAAM,WACJ,MAAO,CACLC,MAAM,EACNC,QAAS,KACTC,OAAQ,GACRC,WAAY,KACZC,cAAe,OAGnBC,QAAS,WACPC,KAAKC,WAEPC,QAAS,WACPF,KAAKC,WAEPE,cAAe,WACb,IAAIR,EAAUK,KAAKI,MAAMT,QAErBA,GACFA,EAAQU,cAAcC,YAAYX,IAGtCY,QAAS,CACPN,QAAS,WACP,IACIO,EADKR,KACMQ,MACXJ,EAFKJ,KAEMI,MAEfA,EAAMV,MAAO,EACbU,EAAMR,OAAS,GACfQ,EAAMP,WAAaW,EAAMC,GAAGC,iBAAiB,IAAM7B,eAAiB,gBACpEmB,KAAKW,cACLX,KAAKY,WACLJ,EAAMK,QAAQC,oBAAoB,SAAUd,KAAKe,UACjDP,EAAMK,QAAQG,iBAAiB,SAAUhB,KAAKe,WAEhDJ,YAAa,WACX,IACIH,EADKR,KACMQ,MACXJ,EAFKJ,KAEMI,MAEXa,EAAM,EACVb,EAAMR,OAAS,GACfQ,EAAMN,cAAgB,KAEtB,IAAK,IAAIoB,EAAI,EAAGC,EAAMf,EAAMP,WAAWuB,OAAQF,EAAIC,EAAKD,IAAK,CAC3D,IAAIG,EAASjB,EAAMP,WAAWqB,GAC1BI,EAAaL,EACbM,OAAW,EAGbA,EADEL,IAAMC,EAAM,EACHf,EAAMP,WAAWqB,EAAI,GAAGM,UAAYH,EAAOI,aAE3CjB,EAAMK,QAAQa,aAW3B,GARAtB,EAAMR,OAAO+B,KAAK,CAChBC,MAAON,EACPO,IAAKN,EACLO,IAAKT,EACLU,MAAOb,KAETD,EAAMM,GAEIf,EAAMK,QAAQa,aAAelB,EAAMK,QAAQY,aACnD,QAINb,SAAU,WAWR,IAVA,IAQIoB,EAPAxB,EADKR,KACMQ,MACXJ,EAFKJ,KAEMI,MAEX6B,EAAMzB,EAAMK,QAAQqB,UACpBC,EAAM,EACNC,EAAOhC,EAAMR,OAAOwB,OAAS,EAI1Be,GAAOC,GAAQD,GAAO/B,EAAMR,OAAOwB,OAAS,GAAKgB,GAAQhC,EAAMR,OAAOwB,OAAS,GAAG,CAEvF,IADAiB,EACIC,EAAYlC,EAAMR,OADtByC,EAASD,EAAOD,GAAO,GAGvB,GAAIF,GAAOK,EAAUV,OAASK,EAAMK,EAAUT,IAAK,CACjDG,EAASM,EACT,MACSL,EAAMK,EAAUV,MACzBQ,EAAOC,EAAS,EAEhBF,EAAe,EAATE,EAIV,GAAIL,EAAQ,CACV,GAAI5B,EAAMN,eAAiBM,EAAMN,cAAciC,QAAUC,EAAOD,MAC9D,OAAO,EAEP3B,EAAMN,cAAgBkC,EAEtBxB,EAAM+B,QAAQC,UAAYR,EAAOF,IAAIW,UACrCzC,KAAK0C,MAAM,SAAUV,EAAOD,SAIlChB,SAAU,WACRf,KAAKY,YAEP+B,kBAAmB,SAA2BC,EAAWC,QACrC,IAAdD,IACFA,EAAY,QAGG,IAAbC,IACFA,EAAW,KAGb,IAQIC,EACAC,EAMJC,EAdIxC,EADKR,KACMQ,MACXJ,EAFKJ,KAEMI,MAEXA,EAAMV,OACVM,KAAKiD,WACL7C,EAAMV,MAAO,EACbU,EAAMT,QAAQuD,MAAMC,QAAU,QAC1BL,EAAStC,EAAMK,QAAQqB,UACvBa,EAAYD,EAMhBE,EAAOxC,EAAMK,QAAQa,cACrBmB,GAAYO,OAAOC,gBAAkB,OACrCR,GAAYO,OAAOC,gBAAkB,OAAU,EAAI,EAAI,IA0CvDC,OAAOC,sBArCP,SAASC,IA2BP,SAASC,IACPrD,EAAMV,MAAO,EACbU,EAAMT,QAAQuD,MAAMC,QAAU,OA5B5BL,EAASF,EACYA,EAAnBG,EAAYC,EACdD,EAAYH,EAEZG,GAAaC,EAEND,EAAYC,EAAOJ,EAC5BG,EAAYH,EAEZG,GAAaC,EAGfxC,EAAMK,QAAQqB,UAAYa,EAEtBD,EAASF,EACMA,GAAbG,EACFU,IAEsB,oBAAXH,QAAwBA,OAAOC,sBAAsBC,GAEzDT,GAAaH,EACtBa,IAEsB,oBAAXH,QAAwBA,OAAOC,sBAAsBC,OAetEE,SAAU,SAAkBC,EAAMd,GAKhC,IACIrC,EADKR,KACMQ,MACXX,EAFKG,KAEWI,MAAMP,WAEtB+C,EAAYe,EAAK/B,MAAQ/B,EAAW8D,EAAK5B,OAAON,aAEnC,KATfoB,OADe,IAAbA,EACS,IASTA,GACFrC,EAAMK,QAAQqB,UAAYU,EAE1B5C,KAAK2C,kBAAkBC,EAAWC,IAGtCI,SAAU,WACHjD,KAAKI,MAAMT,UACdK,KAAKI,MAAMT,QAAUiE,SAASC,cAAc,OAC5C7D,KAAKI,MAAMT,QAAQmE,UAAYjF,eAAiB,QAChDyE,OAAOM,SAASG,KAAKC,YAAYhE,KAAKI,MAAMT,WAGhDsE,QAAS,WACPjE,KAAKC,WASPiE,gBAAiB,SAAyBnC,EAAOc,QAC9B,IAAbA,IACFA,EAAW,KAOb,IAJA,IAEIc,EAFA/D,EAASI,KAAKI,MAAMR,OACpBsB,EAAI,EAGDA,EAAItB,EAAOwB,OAAQF,IACxB,GAAItB,EAAOsB,GAAGa,QAAUA,EAAO,CAC7B4B,EAAO/D,EAAOsB,GACd,MAKFyC,EADGA,GACI/D,EAAOA,EAAOwB,OAAS,GAGhCpB,KAAK0D,SAASC,EAAMd,IAStBsB,mBAAoB,SAA4BC,EAAUvB,QACvC,IAAbA,IACFA,EAAW,KAQb,IALA,IAEIc,EAFA/D,EAASI,KAAKI,MAAMR,OACpBsB,EAAI,EAIDA,EAAItB,EAAOwB,OAAQF,IACxB,GAAItB,EAAOsB,GAAGY,MAAQsC,EAAU,CAC9BT,EAAO/D,EAAOsB,GACda,EACA,MAKF4B,EADGA,GACI/D,EAAOA,EAAOwB,OAAS,GAGhCpB,KAAK0D,SAASC,EAAMd,KAGxBwB,OAAQ,SAAgBC,GACtB,IAAIC,EAAKvE,KACLwE,EAASD,EAAGC,OACZvF,EAAiBsF,EAAGtF,eACpBI,EAAakF,EAAGlF,WAChBC,EAAiBiF,EAAGjF,eACpBC,EAAagF,EAAGhF,WAEpB,OAAO+E,EAAE,MAAO,CACdG,MAAS5F,eACT6F,IAAO,MACN,CAACJ,EAAE,MAAO,CACXG,MAAS9F,aAAaS,QAAQP,eAAiB,SAAUI,GAAkB,IAC3EiE,MAAS7D,EACTqF,IAAO,YACLJ,EAAE,MAAO,CACXG,MAAS9F,aAAaS,QAAQP,eAAiB,SAAUS,GAAkB,IAC3E4D,MAAS3D,EACTmF,IAAO,WACN,CAACF,EAAOpF,cAGfZ,QAAQY,QAAUN"}