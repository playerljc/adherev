{"version":3,"file":"stickuplayout.js","sources":["stickuplayout.js"],"sourcesContent":["\"use strict\";\n\nvar _vue = require(\"vue\");\nrequire(\"core-js/modules/es.object.define-property.js\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nvar tslib_1 = require(\"tslib\");\nvar classnames_1 = tslib_1.__importDefault(require(\"classnames\"));\nvar vue_1 = require(\"vue\");\nvar vue_types_1 = require(\"vue-types\");\nvar selectorPrefix = 'adherev-ui-stickuplayout';\nvar stickupLayoutProps = {\n  fixedClassName: (0, vue_types_1.string)().def(''),\n  fixedStyle: (0, vue_types_1.object)().def({}),\n  innerClassName: (0, vue_types_1.string)().def(''),\n  innerStyle: (0, vue_types_1.object)().def({})\n};\nexports.default = (0, vue_1.defineComponent)({\n  name: 'adv-stickuplayout',\n  props: stickupLayoutProps,\n  emits: ['change'],\n  setup: function setup(props, _a) {\n    var slots = _a.slots,\n      emit = _a.emit,\n      expose = _a.expose;\n    var root = (0, vue_1.ref)();\n    var fixedEl = (0, vue_1.ref)();\n    var innerEl = (0, vue_1.ref)();\n    var key = false;\n    var maskEl = null;\n    var index = [];\n    var headerEls;\n    var preScrollObj = null;\n    var initial = function initial() {\n      var _a, _b, _c;\n      key = false;\n      index = [];\n      headerEls = (_a = root.value) === null || _a === void 0 ? void 0 : _a.querySelectorAll(\".\".concat(selectorPrefix, \"-item-header\"));\n      createIndex();\n      position();\n      (_b = innerEl.value) === null || _b === void 0 ? void 0 : _b.removeEventListener('scroll', onScroll);\n      (_c = innerEl.value) === null || _c === void 0 ? void 0 : _c.addEventListener('scroll', onScroll);\n    };\n    var createIndex = function createIndex() {\n      var _a, _b, _c;\n      var pre = 0;\n      index = [];\n      preScrollObj = null;\n      for (var i = 0, len = headerEls.length; i < len; i++) {\n        var header = headerEls[i];\n        var rangeStart = pre;\n        var rangeEnd = void 0;\n        if (i !== len - 1) {\n          rangeEnd = headerEls[i + 1].offsetTop - header.offsetHeight;\n        } else {\n          rangeEnd = (_a = innerEl.value) === null || _a === void 0 ? void 0 : _a.scrollHeight;\n        }\n        index.push({\n          start: rangeStart,\n          end: rangeEnd,\n          dom: header,\n          index: i\n        });\n        pre = rangeEnd;\n        if (pre > ((_b = innerEl.value) === null || _b === void 0 ? void 0 : _b.scrollHeight) - ((_c = innerEl.value) === null || _c === void 0 ? void 0 : _c.offsetHeight)) {\n          break;\n        }\n      }\n    };\n    var position = function position() {\n      var _a;\n      var val = (_a = innerEl.value) === null || _a === void 0 ? void 0 : _a.scrollTop;\n      var low = 0,\n        high = index.length - 1,\n        middle,\n        target;\n      while (low <= high && low <= index.length - 1 && high <= index.length - 1) {\n        middle = high + low >> 1;\n        var targetVal = index[middle];\n        if (val >= targetVal.start && val < targetVal.end) {\n          target = targetVal;\n          break;\n        } else if (val < targetVal.start) {\n          high = middle - 1;\n        } else {\n          low = middle + 1;\n        }\n      }\n      if (target) {\n        if (preScrollObj && preScrollObj.index === target.index) {\n          return false;\n        } else {\n          preScrollObj = target;\n          fixedEl.value.innerHTML = target.dom.outerHTML;\n          emit('change', target.index);\n        }\n      }\n    };\n    var onScroll = function onScroll() {\n      return position();\n    };\n    var scrollAnimationTo = function scrollAnimationTo(targetTop, duration) {\n      var _a, _b, _c, _d;\n      if (targetTop === void 0) {\n        targetTop = 0;\n      }\n      if (duration === void 0) {\n        duration = 300;\n      }\n      if (key) return;\n      initMask();\n      key = true;\n      maskEl.style.display = 'block';\n      var srcTop = (_a = innerEl.value) === null || _a === void 0 ? void 0 : _a.scrollTop;\n      var scrollVal = srcTop;\n      /**\n       * 一次滚动的步进\n       * @type {number}\n       */\n      var setp = ((_b = innerEl.value) === null || _b === void 0 ? void 0 : _b.scrollHeight) / (\n      // @ts-ignore\n      duration / (((_c = window.screen) === null || _c === void 0 ? void 0 : _c.updateInterval) || 16.7) + (\n      // @ts-ignore\n      duration % (((_d = window.screen) === null || _d === void 0 ? void 0 : _d.updateInterval) || 16.7) !== 0 ? 1 : 0));\n      /** *\n       * 动画的滚动\n       */\n      function scrollAnimation() {\n        if (srcTop < targetTop) {\n          if (scrollVal + setp > targetTop) {\n            scrollVal = targetTop;\n          } else {\n            scrollVal += setp;\n          }\n        } else if (scrollVal - setp < targetTop) {\n          scrollVal = targetTop;\n        } else {\n          scrollVal -= setp;\n        }\n        innerEl.value.scrollTop = scrollVal;\n        if (srcTop < targetTop) {\n          if (scrollVal >= targetTop) {\n            clear();\n          } else {\n            if (typeof window !== 'undefined') window.requestAnimationFrame(scrollAnimation);\n          }\n        } else if (scrollVal <= targetTop) {\n          clear();\n        } else {\n          if (typeof window !== 'undefined') window.requestAnimationFrame(scrollAnimation);\n        }\n        function clear() {\n          key = false;\n          maskEl.style.display = 'none';\n        }\n      }\n      /** *\n       * 滚动core\n       */\n      window.requestAnimationFrame(scrollAnimation);\n    };\n    var scrollTo = function scrollTo(item, duration) {\n      if (duration === void 0) {\n        duration = 300;\n      }\n      var targetTop = item.start + headerEls[item.index].offsetHeight;\n      if (duration === 0) {\n        innerEl.value.scrollTop = targetTop;\n      } else {\n        scrollAnimationTo(targetTop, duration);\n      }\n    };\n    var initMask = function initMask() {\n      if (!maskEl) {\n        maskEl = document.createElement('div');\n        maskEl.className = \"\".concat(selectorPrefix, \"-mask\");\n        window.document.body.appendChild(maskEl);\n      }\n    };\n    var refresh = function refresh() {\n      return initial();\n    };\n    /**\n     * scrollToByIndex\n     * @param {number} _index\n     * @param {number} duration\n     * @return {boolean}\n     */\n    var scrollToByIndex = function scrollToByIndex(_index, duration) {\n      if (duration === void 0) {\n        duration = 300;\n      }\n      var i = 0,\n        item;\n      for (; i < index.length; i++) {\n        if (index[i].index === _index) {\n          item = index[i];\n          break;\n        }\n      }\n      if (!item) {\n        item = index[index.length - 1];\n      }\n      scrollTo(item, duration);\n    };\n    /**\n     * scrollToByHeaderEl\n     * @param {HtmlElement} headerEl\n     * @param {number} duration\n     * @return {boolean}\n     */\n    var scrollToByHeaderEl = function scrollToByHeaderEl(headerEl, duration) {\n      if (duration === void 0) {\n        duration = 300;\n      }\n      var i = 0,\n        item,\n        _index = -1;\n      for (; i < index.length; i++) {\n        if (index[i].dom === headerEl) {\n          item = index[i];\n          _index = i;\n          break;\n        }\n      }\n      if (!item) {\n        item = index[index.length - 1];\n      }\n      scrollTo(item, duration);\n    };\n    expose({\n      refresh: refresh,\n      scrollToByIndex: scrollToByIndex,\n      scrollToByHeaderEl: scrollToByHeaderEl\n    });\n    (0, vue_1.onMounted)(function () {\n      initial();\n    });\n    (0, vue_1.onUpdated)(function () {\n      initial();\n    });\n    (0, vue_1.onBeforeMount)(function () {\n      var _a, _b;\n      if (maskEl) {\n        (_b = (_a = maskEl === null || maskEl === void 0 ? void 0 : maskEl.parentElement) === null || _a === void 0 ? void 0 : _a.removeChild) === null || _b === void 0 ? void 0 : _b.call(_a, maskEl);\n      }\n    });\n    return function () {\n      var _a;\n      return (0, _vue.createVNode)(\"div\", {\n        \"class\": selectorPrefix,\n        \"ref\": root\n      }, [(0, _vue.createVNode)(\"div\", {\n        \"class\": (0, classnames_1.default)(\"\".concat(selectorPrefix, \"-fixed\"), props.fixedClassName || ''),\n        \"style\": props.fixedStyle,\n        \"ref\": fixedEl\n      }, null), (0, _vue.createVNode)(\"div\", {\n        \"class\": (0, classnames_1.default)(\"\".concat(selectorPrefix, \"-inner\"), props.innerClassName || ''),\n        \"style\": props.innerStyle,\n        \"ref\": innerEl\n      }, [(_a = slots === null || slots === void 0 ? void 0 : slots.default) === null || _a === void 0 ? void 0 : _a.call(slots)])]);\n    };\n  }\n});"],"names":["_vue","require","tslib_1","Object","defineProperty","exports","value","classnames_1","__importDefault","vue_1","vue_types_1","selectorPrefix","stickupLayoutProps","fixedClassName","string","def","fixedStyle","object","innerClassName","innerStyle","default","defineComponent","name","props","emits","setup","_a","initial","_c","key","index","headerEls","root","querySelectorAll","concat","createIndex","position","_b","innerEl","removeEventListener","onScroll","addEventListener","scrollTo","item","duration","targetTop","start","offsetHeight","scrollTop","scrollAnimationTo","initMask","maskEl","document","createElement","className","window","body","appendChild","slots","emit","expose","ref","fixedEl","preScrollObj","pre","i","len","length","header","rangeStart","rangeEnd","offsetTop","scrollHeight","push","end","dom","target","val","low","high","middle","targetVal","innerHTML","outerHTML","_d","srcTop","scrollVal","setp","style","display","screen","updateInterval","requestAnimationFrame","scrollAnimation","clear","refresh","scrollToByIndex","_index","scrollToByHeaderEl","headerEl","onMounted","onUpdated","onBeforeMount","parentElement","removeChild","call","createVNode","class"],"mappings":"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"}