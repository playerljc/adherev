{"version":3,"file":"stickuplayout.js","sources":["stickuplayout.js"],"sourcesContent":["\"use strict\";\n\nrequire(\"core-js/modules/es.object.define-property.js\");\n\nrequire(\"core-js/modules/es.regexp.exec.js\");\n\nrequire(\"core-js/modules/es.string.split.js\");\n\nvar __importDefault = void 0 && (void 0).__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar classnames_1 = __importDefault(require(\"classnames\"));\n\nvar selectorPrefix = 'adherev-ui-stickuplayout';\nexports.default = {\n  name: 'adv-stickuplayout',\n  props: {\n    className: {\n      type: String,\n      default: ''\n    },\n    fixedClassName: {\n      type: String,\n      default: ''\n    },\n    fixedStyle: {\n      type: String,\n      default: ''\n    },\n    innerClassName: {\n      type: String,\n      default: ''\n    },\n    innerStyle: {\n      type: String,\n      default: ''\n    }\n  },\n  data: function data() {\n    return {};\n  },\n  mounted: function mounted() {\n    this.initial();\n  },\n  updated: function updated() {\n    this.initial();\n  },\n  beforeDestroy: function beforeDestroy() {\n    var $maskEl = this.$data.$maskEl;\n\n    if ($maskEl) {\n      $maskEl.parentElement.removeChild($maskEl);\n    }\n  },\n  methods: {\n    initial: function initial() {\n      var _a = this,\n          $refs = _a.$refs,\n          $data = _a.$data;\n\n      $data.$key = false;\n      $data.$index = [];\n      $data.$headerEls = $refs.el.querySelectorAll(\".\" + selectorPrefix + \"-item-header\");\n      this.createIndex();\n      this.position();\n      $refs.innerEl.removeEventListener('scroll', this.onScroll);\n      $refs.innerEl.addEventListener('scroll', this.onScroll);\n    },\n    createIndex: function createIndex() {\n      var _a = this,\n          $refs = _a.$refs,\n          $data = _a.$data;\n\n      var pre = 0;\n      $data.$index = [];\n      $data.$preScrollObj = null;\n\n      for (var i = 0, len = $data.$headerEls.length; i < len; i++) {\n        var header = $data.$headerEls[i];\n        var rangeStart = pre;\n        var rangeEnd = void 0;\n\n        if (i !== len - 1) {\n          rangeEnd = $data.$headerEls[i + 1].offsetTop - header.offsetHeight;\n        } else {\n          rangeEnd = $refs.innerEl.scrollHeight;\n        }\n\n        $data.$index.push({\n          start: rangeStart,\n          end: rangeEnd,\n          dom: header,\n          index: i\n        });\n        pre = rangeEnd;\n\n        if (pre > $refs.innerEl.scrollHeight - $refs.innerEl.offsetHeight) {\n          break;\n        }\n      }\n    },\n    position: function position() {\n      var _a = this,\n          $refs = _a.$refs,\n          $data = _a.$data;\n\n      var val = $refs.innerEl.scrollTop;\n      var low = 0,\n          high = $data.$index.length - 1,\n          middle,\n          target;\n\n      while (low <= high && low <= $data.$index.length - 1 && high <= $data.$index.length - 1) {\n        middle = high + low >> 1;\n        var targetVal = $data.$index[middle];\n\n        if (val >= targetVal.start && val < targetVal.end) {\n          target = targetVal;\n          break;\n        } else if (val < targetVal.start) {\n          high = middle - 1;\n        } else {\n          low = middle + 1;\n        }\n      }\n\n      if (target) {\n        if ($data.$preScrollObj && $data.$preScrollObj.index === target.index) {\n          return false;\n        } else {\n          $data.$preScrollObj = target; // @ts-ignore\n\n          $refs.fixedEl.innerHTML = target.dom.outerHTML;\n          this.$emit('change', target.index);\n        }\n      }\n    },\n    onScroll: function onScroll() {\n      this.position();\n    },\n    scrollAnimationTo: function scrollAnimationTo(targetTop, duration) {\n      if (targetTop === void 0) {\n        targetTop = 0;\n      }\n\n      if (duration === void 0) {\n        duration = 300;\n      }\n\n      var _a = this,\n          $refs = _a.$refs,\n          $data = _a.$data;\n\n      if ($data.$key) return;\n      this.initMask();\n      $data.$key = true;\n      $data.$maskEl.style.display = 'block';\n      var srcTop = $refs.innerEl.scrollTop,\n          scrollVal = srcTop,\n\n      /**\n       * 一次滚动的步进\n       * @type {number}\n       */\n      setp = $refs.innerEl.scrollHeight / (duration / (screen.updateInterval || 16.7) + (duration % (screen.updateInterval || 16.7) !== 0 ? 1 : 0));\n      /** *\n       * 动画的滚动\n       */\n\n      function scrollAnimation() {\n        if (srcTop < targetTop) {\n          if (scrollVal + setp > targetTop) {\n            scrollVal = targetTop;\n          } else {\n            scrollVal += setp;\n          }\n        } else if (scrollVal - setp < targetTop) {\n          scrollVal = targetTop;\n        } else {\n          scrollVal -= setp;\n        }\n\n        $refs.innerEl.scrollTop = scrollVal;\n\n        if (srcTop < targetTop) {\n          if (scrollVal >= targetTop) {\n            clear();\n          } else {\n            window.requestAnimationFrame(scrollAnimation);\n          }\n        } else if (scrollVal <= targetTop) {\n          clear();\n        } else {\n          window.requestAnimationFrame(scrollAnimation);\n        }\n\n        function clear() {\n          $data.$key = false;\n          $data.$maskEl.style.display = 'none';\n        }\n      }\n      /** *\n       * 滚动core\n       */\n\n\n      window.requestAnimationFrame(scrollAnimation);\n    },\n    scrollTo: function scrollTo(item, duration) {\n      if (duration === void 0) {\n        duration = 300;\n      }\n\n      var _a = this,\n          $refs = _a.$refs,\n          $headerEls = _a.$data.$headerEls;\n\n      var targetTop = item.start + $headerEls[item.index].offsetHeight;\n\n      if (duration === 0) {\n        $refs.innerEl.scrollTop = targetTop;\n      } else {\n        this.scrollAnimationTo(targetTop, duration);\n      }\n    },\n    initMask: function initMask() {\n      if (!this.$data.$maskEl) {\n        this.$data.$maskEl = document.createElement('div');\n        this.$data.$maskEl.className = selectorPrefix + \"-mask\";\n        window.document.body.appendChild(this.$data.$maskEl);\n      }\n    },\n    refresh: function refresh() {\n      this.initial();\n    },\n\n    /**\n     * scrollToByIndex\n     * @param {number} index\n     * @param {number} duration\n     * @return {boolean}\n     */\n    scrollToByIndex: function scrollToByIndex(index, duration) {\n      if (duration === void 0) {\n        duration = 300;\n      }\n\n      var $index = this.$data.$index;\n      var i = 0,\n          item;\n\n      for (; i < $index.length; i++) {\n        if ($index[i].index === index) {\n          item = $index[i];\n          break;\n        }\n      }\n\n      if (!item) return false;\n      this.scrollTo(item, duration);\n    },\n\n    /**\n     * scrollToByHeaderEl\n     * @param {HtmlElement} headerEl\n     * @param {number} duration\n     * @return {boolean}\n     */\n    scrollToByHeaderEl: function scrollToByHeaderEl(headerEl, duration) {\n      if (duration === void 0) {\n        duration = 300;\n      }\n\n      var $index = this.$data.$index;\n      var i = 0,\n          item,\n          index = -1;\n\n      for (; i < $index.length; i++) {\n        if ($index[i].dom === headerEl) {\n          item = $index[i];\n          index = i;\n          break;\n        }\n      }\n\n      if (!item) return false;\n      this.scrollTo(item, duration);\n    }\n  },\n  render: function render(h) {\n    var _a = this,\n        $slots = _a.$slots,\n        className = _a.className,\n        fixedClassName = _a.fixedClassName,\n        fixedStyle = _a.fixedStyle,\n        innerClassName = _a.innerClassName,\n        innerStyle = _a.innerStyle;\n\n    return h(\"div\", {\n      \"class\": classnames_1.default(selectorPrefix, className.split(' ')),\n      \"ref\": \"el\"\n    }, [h(\"div\", {\n      \"class\": classnames_1.default(selectorPrefix + \"-fixed\", fixedClassName.split(' ')),\n      \"style\": fixedStyle,\n      \"ref\": \"fixedEl\"\n    }), h(\"div\", {\n      \"class\": classnames_1.default(selectorPrefix + \"-inner\", innerClassName.split(' ')),\n      \"style\": innerStyle,\n      \"ref\": \"innerEl\"\n    }, [$slots.default])]);\n  }\n};"],"names":["require","__importDefault","mod","__esModule","default","Object","defineProperty","exports","value","classnames_1","selectorPrefix","name","props","className","type","String","fixedClassName","fixedStyle","innerClassName","innerStyle","data","mounted","this","initial","updated","beforeDestroy","$maskEl","$data","parentElement","removeChild","methods","$refs","$key","$index","$headerEls","el","querySelectorAll","createIndex","position","innerEl","removeEventListener","onScroll","addEventListener","pre","$preScrollObj","i","len","length","header","rangeStart","rangeEnd","offsetTop","offsetHeight","scrollHeight","push","start","end","dom","index","target","val","scrollTop","low","high","middle","targetVal","fixedEl","innerHTML","outerHTML","$emit","scrollAnimationTo","targetTop","duration","srcTop","scrollVal","setp","initMask","style","display","screen","updateInterval","window","requestAnimationFrame","scrollAnimation","clear","scrollTo","item","document","createElement","body","appendChild","refresh","scrollToByIndex","scrollToByHeaderEl","headerEl","render","h","_a","$slots","class","split","ref"],"mappings":"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"}