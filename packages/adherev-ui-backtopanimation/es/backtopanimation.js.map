{"version":3,"file":"backtopanimation.js","sources":["backtopanimation.js"],"sourcesContent":["import { createVNode as _createVNode } from \"vue\";\nimport { defineComponent, onBeforeUnmount, onMounted, ref } from 'vue';\nimport { integer, number, oneOfType, string } from 'vue-types';\nimport Resource from '@baifendian/adherev-util-resource';\nvar selectorPrefix = 'adherev-ui-backtopanimation';\nvar props = {\n  className: string().def(''),\n  zIndex: oneOfType([string(), number()]).def(Resource.Dict.value.ResourceNormalMaxZIndex.value),\n  duration: integer().def(300)\n};\nexport default defineComponent({\n  name: 'adv-backtopanimation',\n  props: props,\n  emits: ['trigger', 'scrollTop', 'target'],\n  setup: function setup(props, _a) {\n    var emit = _a.emit;\n    var root = ref();\n    var scrollEl = null;\n    var maskEl = null;\n    var key = false;\n    onMounted(function () {\n      renderMask();\n      initScrollEvent();\n    });\n    onBeforeUnmount(function () {\n      var _a;\n      if (maskEl) {\n        try {\n          (_a = maskEl === null || maskEl === void 0 ? void 0 : maskEl.parentElement) === null || _a === void 0 ? void 0 : _a.removeChild(maskEl);\n        } catch (e) {}\n      }\n    });\n    var initScrollEvent = function initScrollEvent() {\n      emit('target', function (target) {\n        scrollEl = target;\n        if (!maskEl || !scrollEl) return;\n        scrollEl.addEventListener('scroll', function () {\n          if (!maskEl || !scrollEl || !root.value) return;\n          if (scrollEl.scrollTop !== 0) {\n            root.value && (root.value.style.display = 'block');\n          } else {\n            root.value && (root.value.style.display = 'none');\n          }\n        }, false);\n      });\n    };\n    var renderMask = function renderMask() {\n      maskEl = document.body.querySelector(\".\".concat(selectorPrefix, \"-mask\"));\n      if (!maskEl) {\n        maskEl = document.createElement('div');\n        maskEl.className = \"\".concat(selectorPrefix, \"-mask\");\n        document.body.appendChild(maskEl);\n      }\n    };\n    var trigger = function trigger() {\n      if (key) return;\n      emit('trigger', function () {\n        if (!maskEl || !scrollEl) return;\n        key = true;\n        maskEl.style.display = 'block';\n        var scrollVal = scrollEl.scrollTop;\n        var targetTop = 0;\n        // 一次滚动的步进\n        var step = scrollEl.scrollHeight / (props.duration / (screen.updateInterval || 16.7) + (props.duration % (screen.updateInterval || 16.7) !== 0 ? 1 : 0));\n        /**\n         * 动画的滚动\n         */\n        function scrollAnimation() {\n          if (!maskEl || !scrollEl) return;\n          if (scrollEl && scrollEl.scrollTop < targetTop) {\n            if (scrollVal + step > targetTop) {\n              scrollVal = targetTop;\n            } else {\n              scrollVal += step;\n            }\n          } else if (scrollVal - step < targetTop) {\n            scrollVal = targetTop;\n          } else {\n            scrollVal -= step;\n          }\n          if (scrollEl) {\n            scrollEl.scrollTop = scrollVal;\n          }\n          emit('scrollTop', scrollVal);\n          if (scrollEl.scrollTop < targetTop) {\n            if (scrollVal >= targetTop) {\n              clear();\n            } else {\n              window.requestAnimationFrame(scrollAnimation);\n            }\n          } else if (scrollVal <= targetTop) {\n            clear();\n          } else {\n            window.requestAnimationFrame(scrollAnimation);\n          }\n          function clear() {\n            if (!maskEl || !scrollEl) return;\n            maskEl.style.display = 'none';\n            key = false;\n          }\n        }\n        window.requestAnimationFrame(scrollAnimation);\n      });\n    };\n    return function () {\n      return _createVNode(\"div\", {\n        \"ref\": root,\n        \"class\": selectorPrefix,\n        \"onClick\": function onClick() {\n          trigger();\n        }\n      }, null);\n    };\n  }\n});"],"names":["_createVNode","defineComponent","onBeforeUnmount","onMounted","ref","integer","number","oneOfType","string","Resource","selectorPrefix","props","className","def","zIndex","Dict","value","ResourceNormalMaxZIndex","duration","name","emits","setup","_a","trigger","key","emit","scrollVal","targetTop","step","maskEl","scrollEl","style","display","scrollTop","scrollHeight","screen","updateInterval","window","requestAnimationFrame","scrollAnimation","clear","root","initScrollEvent","renderMask","parentElement","removeChild","e","target","addEventListener","document","body","querySelector","concat","createElement","appendChild","class","onClick"],"mappings":"OAAwBA,2BAAyB,KAAL,aACnCC,gBAAiBC,gBAAiBC,UAAWC,GAAgB,KAAL,aACxDC,QAASC,OAAQC,UAAWC,MAAyB,KAAX,mBAC5CC,aAAc,oCACrB,IAAIC,eAAiB,8BACjBC,MAAQ,CACVC,UAAWJ,OAAO,EAAEK,IAAI,EAAE,EAC1BC,OAAQP,UAAU,CAACC,OAAO,EAAGF,OAAO,EAAE,EAAEO,IAAIJ,SAASM,KAAKC,MAAMC,wBAAwBD,KAAK,EAC7FE,SAAUb,QAAQ,EAAEQ,IAAI,GAAG,CAC7B,iBACeZ,gBAAgB,CAC7BkB,KAAM,uBACNR,MAAOA,MACPS,MAAO,CAAC,UAAW,YAAa,UAChCC,MAAO,SAAeV,EAAOW,GAwCb,SAAVC,IACEC,GACJC,EAAK,UAAW,WACd,IAGIC,EACAC,EAEAC,EANCC,GAAWC,IAChBN,EAAM,CAAA,EACNK,EAAOE,MAAMC,QAAU,QACnBN,EAAYI,EAASG,UACrBN,EAAY,EAEZC,EAAOE,EAASI,cAAgBvB,EAAMO,UAAYiB,OAAOC,gBAAkB,OAASzB,EAAMO,UAAYiB,OAAOC,gBAAkB,OAAU,EAAI,EAAI,IAsCrJC,OAAOC,sBAlCP,SAASC,IA4BP,SAASC,IACFX,GAAWC,IAChBD,EAAOE,MAAMC,QAAU,OACvBR,EAAM,CAAA,EACR,CA/BKK,GAAWC,IACZA,GAAYA,EAASG,UAAYN,EACZA,EAAnBD,EAAYE,EACdF,EAAYC,EAEZD,GAAaE,EAENF,EAAYE,EAAOD,EAC5BD,EAAYC,EAEZD,GAAaE,EAEXE,IACFA,EAASG,UAAYP,GAEvBD,EAAK,YAAaC,CAAS,EACvBI,EAASG,UAAYN,EACNA,GAAbD,EACFc,EAAM,EAENH,OAAOC,sBAAsBC,CAAe,EAErCb,GAAaC,EACtBa,EAAM,EAENH,OAAOC,sBAAsBC,CAAe,EAOhD,CAC4C,EAC9C,CAAC,CACH,CAxFA,IAAId,EAAOH,EAAGG,KACVgB,EAAOrC,IAAI,EACX0B,EAAW,KACXD,EAAS,KACTL,EAAM,CAAA,EAaNkB,GAZJvC,UAAU,WACRwC,EAAW,EACXD,EAAgB,CAClB,CAAC,EACDxC,gBAAgB,WACd,IAAIoB,EACJ,GAAIO,EACF,IACE,OAACP,EAAKO,MAAAA,EAAuC,KAAA,EAASA,EAAOe,gBAAoDtB,EAAGuB,YAAYhB,CAAM,CAC3H,CAAX,MAAOiB,IAEb,CAAC,EACqB,WACpBrB,EAAK,SAAU,SAAUsB,GACvBjB,EAAWiB,EACNlB,GAAWC,GAChBA,EAASkB,iBAAiB,SAAU,WAC7BnB,GAAWC,GAAaW,EAAKzB,QACP,IAAvBc,EAASG,UACXQ,EAAKzB,QAAUyB,EAAKzB,MAAMe,MAAMC,QAAU,SAE1CS,EAAKzB,QAAUyB,EAAKzB,MAAMe,MAAMC,QAAU,QAE9C,EAAG,CAAA,CAAK,CACV,CAAC,CACH,GACIW,EAAa,YACfd,EAASoB,SAASC,KAAKC,cAAc,IAAIC,OAAO1C,eAAgB,OAAO,CAAC,MAEtEmB,EAASoB,SAASI,cAAc,KAAK,GAC9BzC,UAAY,GAAGwC,OAAO1C,eAAgB,OAAO,EACpDuC,SAASC,KAAKI,YAAYzB,CAAM,EAEpC,EAmDA,OAAO,WACL,OAAO7B,aAAa,MAAO,CACzBI,IAAOqC,EACPc,MAAS7C,eACT8C,QAAW,WACTjC,EAAQ,CACV,CACF,EAAG,IAAI,CACT,CACF,CACF,CAAC"}