{"version":3,"file":"backtopanimation.js","sources":["backtopanimation.js"],"sourcesContent":["import { createVNode as _createVNode } from \"vue\";\nimport Resource from '@baifendian/adherev-util-resource';\nimport { defineComponent, onBeforeUnmount, onMounted, ref } from 'vue';\nimport { integer, number, oneOfType, string } from 'vue-types';\nvar selectorPrefix = 'adherev-ui-backtopanimation';\nvar props = {\n  className: string().def(''),\n  zIndex: oneOfType([string, number]).def(Resource.Dict.value.ResourceNormalMaxZIndex.value),\n  duration: integer().def(300)\n};\nexport default defineComponent({\n  name: 'adv-backtopanimation',\n  props: props,\n  emits: ['trigger', 'scrollTop', 'target'],\n  setup: function setup(props, _a) {\n    var emit = _a.emit;\n    var root = ref();\n    var scrollEl = null;\n    var maskEl = null;\n    var key = false;\n    onMounted(function () {\n      renderMask();\n      initScrollEvent();\n    });\n    onBeforeUnmount(function () {\n      var _a;\n\n      if (maskEl) {\n        (_a = maskEl === null || maskEl === void 0 ? void 0 : maskEl.parentElement) === null || _a === void 0 ? void 0 : _a.removeChild(maskEl);\n      }\n    });\n\n    var initScrollEvent = function initScrollEvent() {\n      emit('target', function (target) {\n        scrollEl = target;\n        if (!maskEl || !scrollEl) return;\n        scrollEl.addEventListener('scroll', function () {\n          if (!maskEl || !scrollEl || !root.value) return;\n\n          if (scrollEl.scrollTop !== 0) {\n            root.value && (root.value.style.display = 'block');\n          } else {\n            root.value && (root.value.style.display = 'none');\n          }\n        }, false);\n      });\n    };\n\n    var renderMask = function renderMask() {\n      maskEl = document.body.querySelector(\".\".concat(selectorPrefix, \"-mask\"));\n\n      if (!maskEl) {\n        maskEl = document.createElement('div');\n        maskEl.className = \"\".concat(selectorPrefix, \"-mask\");\n        document.body.appendChild(maskEl);\n      }\n    };\n\n    var trigger = function trigger() {\n      if (key) return;\n      emit('trigger', function () {\n        if (!maskEl || !scrollEl) return;\n        key = true;\n        maskEl.style.display = 'block';\n        var scrollVal = scrollEl.scrollTop;\n        var targetTop = 0; // 一次滚动的步进\n\n        var step = scrollEl.scrollHeight / (props.duration / (screen.updateInterval || 16.7) + (props.duration % (screen.updateInterval || 16.7) !== 0 ? 1 : 0));\n        /**\n         * 动画的滚动\n         */\n\n        function scrollAnimation() {\n          if (!maskEl || !scrollEl) return;\n\n          if (scrollEl && scrollEl.scrollTop < targetTop) {\n            if (scrollVal + step > targetTop) {\n              scrollVal = targetTop;\n            } else {\n              scrollVal += step;\n            }\n          } else if (scrollVal - step < targetTop) {\n            scrollVal = targetTop;\n          } else {\n            scrollVal -= step;\n          }\n\n          if (scrollEl) {\n            scrollEl.scrollTop = scrollVal;\n          }\n\n          emit('scrollTop', scrollVal);\n\n          if (scrollEl.scrollTop < targetTop) {\n            if (scrollVal >= targetTop) {\n              clear();\n            } else {\n              window.requestAnimationFrame(scrollAnimation);\n            }\n          } else if (scrollVal <= targetTop) {\n            clear();\n          } else {\n            window.requestAnimationFrame(scrollAnimation);\n          }\n\n          function clear() {\n            if (!maskEl || !scrollEl) return;\n            maskEl.style.display = 'none';\n            key = false;\n          }\n        }\n\n        window.requestAnimationFrame(scrollAnimation);\n      });\n    };\n\n    return function () {\n      return _createVNode(\"div\", {\n        \"ref\": root,\n        \"class\": selectorPrefix,\n        \"onClick\": function onClick() {\n          trigger();\n        }\n      }, null);\n    };\n  }\n});"],"names":["_createVNode","Resource","defineComponent","onBeforeUnmount","onMounted","ref","integer","number","oneOfType","string","selectorPrefix","props","className","def","zIndex","Dict","value","ResourceNormalMaxZIndex","duration","name","emits","setup","_a","trigger","key","emit","scrollVal","targetTop","step","maskEl","scrollEl","style","display","scrollTop","scrollHeight","screen","updateInterval","window","requestAnimationFrame","scrollAnimation","clear","root","initScrollEvent","renderMask","parentElement","removeChild","target","addEventListener","document","body","querySelector","concat","createElement","appendChild","class","onClick"],"mappings":"OAAwBA,6CACjBC,wDACEC,gBAAiBC,gBAAiBC,UAAWC,qBAC7CC,QAASC,OAAQC,UAAWC,uBACrC,IAAIC,eAAiB,8BACjBC,MAAQ,CACVC,UAAWH,SAASI,IAAI,IACxBC,OAAQN,UAAU,CAACC,OAAQF,SAASM,IAAIZ,SAASc,KAAKC,MAAMC,wBAAwBD,OACpFE,SAAUZ,UAAUO,IAAI,qBAEXX,gBAAgB,CAC7BiB,KAAM,uBACNR,MAAOA,MACPS,MAAO,CAAC,UAAW,YAAa,UAChCC,MAAO,SAAeV,EAAOW,GA4Cb,SAAVC,IACEC,GACJC,EAAK,UAAW,WACd,IAGIC,EACAC,EAEAC,EANCC,GAAWC,IAChBN,GAAM,EACNK,EAAOE,MAAMC,QAAU,QACnBN,EAAYI,EAASG,UACrBN,EAAY,EAEZC,EAAOE,EAASI,cAAgBvB,EAAMO,UAAYiB,OAAOC,gBAAkB,OAASzB,EAAMO,UAAYiB,OAAOC,gBAAkB,OAAU,EAAI,EAAI,IA6CrJC,OAAOC,sBAxCP,SAASC,IAiCP,SAASC,IACFX,GAAWC,IAChBD,EAAOE,MAAMC,QAAU,OACvBR,GAAM,GAnCHK,GAAWC,IAEZA,GAAYA,EAASG,UAAYN,EACZA,EAAnBD,EAAYE,EACdF,EAAYC,EAEZD,GAAaE,EAENF,EAAYE,EAAOD,EAC5BD,EAAYC,EAEZD,GAAaE,EAGXE,IACFA,EAASG,UAAYP,GAGvBD,EAAK,YAAaC,GAEdI,EAASG,UAAYN,EACNA,GAAbD,EACFc,IAEAH,OAAOC,sBAAsBC,GAEtBb,GAAaC,EACtBa,IAEAH,OAAOC,sBAAsBC,SAvFrC,IAAId,EAAOH,EAAGG,KACVgB,EAAOpC,MACPyB,EAAW,KACXD,EAAS,KACTL,GAAM,EAaNkB,GAZJtC,UAAU,WACRuC,IACAD,MAEFvC,gBAAgB,WACd,IAAImB,EAEAO,GAC8E,QAA/EP,EAAKO,MAAAA,OAAuC,EAASA,EAAOe,qBAAkC,IAAPtB,GAAyBA,EAAGuB,YAAYhB,KAI9G,WACpBJ,EAAK,SAAU,SAAUqB,GACvBhB,EAAWgB,EACNjB,GAAWC,GAChBA,EAASiB,iBAAiB,SAAU,WAC7BlB,GAAWC,GAAaW,EAAKzB,QAEP,IAAvBc,EAASG,UACXQ,EAAKzB,QAAUyB,EAAKzB,MAAMe,MAAMC,QAAU,SAE1CS,EAAKzB,QAAUyB,EAAKzB,MAAMe,MAAMC,QAAU,WAE3C,OAIHW,EAAa,YACfd,EAASmB,SAASC,KAAKC,cAAc,IAAIC,OAAOzC,eAAgB,cAG9DmB,EAASmB,SAASI,cAAc,QACzBxC,UAAY,GAAGuC,OAAOzC,eAAgB,SAC7CsC,SAASC,KAAKI,YAAYxB,KA8D9B,OAAO,WACL,OAAO7B,aAAa,MAAO,CACzBK,IAAOoC,EACPa,MAAS5C,eACT6C,QAAW,WACThC,MAED"}