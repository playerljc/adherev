{"version":3,"file":"backtopanimation.js","sources":["backtopanimation.js"],"sourcesContent":["import \"core-js/modules/es.number.constructor.js\";\nimport Resource from '@baifendian/adherev-util-resource';\nvar selectorPrefix = 'adherev-ui-backtopanimation';\nvar BackTopAnimation = {\n  name: 'adv-backtopanimation',\n  props: {\n    zIndex: {\n      type: [String, Number],\n      default: Resource.Dict.value.ResourceNormalMaxZIndex.value\n    },\n    duration: {\n      type: Number,\n      default: 300\n    }\n  },\n  emits: ['target', 'trigger', 'scrollTop'],\n  data: function data() {\n    return {\n      $maskEl: null,\n      $scrollEl: null,\n      $key: false\n    };\n  },\n  mounted: function mounted() {\n    this.initScrollEvent();\n    this.renderMask();\n  },\n  beforeDestroy: function beforeDestroy() {\n    var $data = this.$data;\n\n    if ($data.$maskEl) {\n      try {\n        $data.$maskEl.parentElement.removeChild($data.$maskEl);\n      } catch (e) {}\n    }\n  },\n  methods: {\n    trigger: function trigger() {\n      if (this.$data.$key) return;\n      var self = this;\n      this.$emit('trigger', function () {\n        var $data = self.$data,\n            duration = self.duration;\n        $data.$key = true;\n        $data.$maskEl.style.display = 'block';\n        var scrollVal = $data.$scrollEl.scrollTop;\n        var targetTop = 0; // 一次滚动的步进\n\n        var step = $data.$scrollEl.scrollHeight / ( //@ts-ignore\n        duration / (screen.updateInterval || 16.7) + ( //@ts-ignore\n        duration % (screen.updateInterval || 16.7) !== 0 ? 1 : 0));\n        /**\n         * 动画的滚动\n         */\n\n        function scrollAnimation() {\n          if ($data.$scrollEl.scrollTop < targetTop) {\n            if (scrollVal + step > targetTop) {\n              scrollVal = targetTop;\n            } else {\n              scrollVal += step;\n            }\n          } else if (scrollVal - step < targetTop) {\n            scrollVal = targetTop;\n          } else {\n            scrollVal -= step;\n          }\n\n          $data.$scrollEl.scrollTop = scrollVal;\n          self.$emit('scrollTop', scrollVal);\n\n          if ($data.$scrollEl.scrollTop < targetTop) {\n            if (scrollVal >= targetTop) {\n              clear();\n            } else {\n              window.requestAnimationFrame(scrollAnimation);\n            }\n          } else if (scrollVal <= targetTop) {\n            clear();\n          } else {\n            window.requestAnimationFrame(scrollAnimation);\n          }\n\n          function clear() {\n            $data.$maskEl.style.display = 'none';\n            $data.$key = false;\n          }\n        }\n\n        window.requestAnimationFrame(scrollAnimation);\n      });\n    },\n    initScrollEvent: function initScrollEvent() {\n      var self = this;\n      this.$emit('target', function (target) {\n        var $data = self.$data,\n            $refs = self.$refs;\n        $data.$scrollEl = target;\n        $data.$scrollEl.addEventListener('scroll', function () {\n          if ($data.$scrollEl.scrollTop !== 0) {\n            window.requestAnimationFrame(function () {\n              $refs.ref.style.display = 'block';\n            });\n          } else {\n            window.requestAnimationFrame(function () {\n              $refs.ref.style.display = 'none';\n            });\n          }\n        }, false);\n      });\n    },\n    renderMask: function renderMask() {\n      var $data = this.$data;\n      $data.$maskEl = document.body.querySelector(\".\" + selectorPrefix + \"-mask\");\n\n      if (!$data.$maskEl) {\n        $data.$maskEl = document.createElement('div');\n        $data.$maskEl.className = selectorPrefix + \"-mask\";\n        document.body.appendChild($data.$maskEl);\n      }\n    }\n  },\n  render: function render(h) {\n    var _this = this;\n\n    return h(\"div\", {\n      \"class\": selectorPrefix,\n      \"ref\": \"ref\",\n      \"on\": {\n        \"click\": function click() {\n          _this.trigger();\n        }\n      }\n    });\n  }\n};\nexport default BackTopAnimation;"],"names":["Resource","selectorPrefix","BackTopAnimation","name","props","zIndex","type","String","Number","default","Dict","value","ResourceNormalMaxZIndex","duration","emits","data","$maskEl","$scrollEl","$key","mounted","this","initScrollEvent","renderMask","beforeDestroy","$data","parentElement","removeChild","e","methods","trigger","self","$emit","style","display","scrollVal","scrollTop","step","scrollHeight","screen","updateInterval","window","requestAnimationFrame","scrollAnimation","clear","target","$refs","addEventListener","ref","document","body","querySelector","createElement","className","appendChild","render","h","_this","class","on","click"],"mappings":"wDACOA,iDACP,IAAIC,eAAiB,8BACjBC,iBAAmB,CACrBC,KAAM,uBACNC,MAAO,CACLC,OAAQ,CACNC,KAAM,CAACC,OAAQC,QACfC,QAAST,SAASU,KAAKC,MAAMC,wBAAwBD,OAEvDE,SAAU,CACRP,KAAME,OACNC,QAAS,MAGbK,MAAO,CAAC,SAAU,UAAW,aAC7BC,KAAM,WACJ,MAAO,CACLC,QAAS,KACTC,UAAW,KACXC,MAAM,IAGVC,QAAS,WACPC,KAAKC,kBACLD,KAAKE,cAEPC,cAAe,WACb,IAAIC,EAAQJ,KAAKI,MAEjB,GAAIA,EAAMR,QACR,IACEQ,EAAMR,QAAQS,cAAcC,YAAYF,EAAMR,SAC9C,MAAOW,MAGbC,QAAS,CACPC,QAAS,WACP,IACIC,EADAV,KAAKI,MAAMN,OACXY,EAAOV,MACNW,MAAM,UAAW,WACpB,IAAIP,EAAQM,EAAKN,MACbX,EAAWiB,EAAKjB,SACpBW,EAAMN,MAAO,EACbM,EAAMR,QAAQgB,MAAMC,QAAU,QAC9B,IAAIC,EAAYV,EAAMP,UAAUkB,UAG5BC,EAAOZ,EAAMP,UAAUoB,cAC3BxB,GAAYyB,OAAOC,gBAAkB,OACrC1B,GAAYyB,OAAOC,gBAAkB,OAAU,EAAI,EAAI,IAuCvDC,OAAOC,sBAlCP,SAASC,IA4BP,SAASC,IACPnB,EAAMR,QAAQgB,MAAMC,QAAU,OAC9BT,EAAMN,MAAO,EA7BXM,EAAMP,UAAUkB,UAVN,EAAA,EAWRD,EAAYE,EACdF,EAZU,EAcVA,GAAaE,EAENF,EAAYE,EAhBT,EAiBZF,EAjBY,EAmBZA,GAAaE,EAGfZ,EAAMP,UAAUkB,UAAYD,EAC5BJ,EAAKC,MAAM,YAAaG,GAEpBV,EAAMP,UAAUkB,UAzBN,EAAA,GA0BRD,EACFS,IAEAH,OAAOC,sBAAsBC,GAEtBR,GA/BG,EAgCZS,IAEAH,OAAOC,sBAAsBC,QAYrCrB,gBAAiB,WACf,IAAIS,EAAOV,KACXA,KAAKW,MAAM,SAAU,SAAUa,GAC7B,IAAIpB,EAAQM,EAAKN,MACbqB,EAAQf,EAAKe,MACjBrB,EAAMP,UAAY2B,EAClBpB,EAAMP,UAAU6B,iBAAiB,SAAU,WACP,IAA9BtB,EAAMP,UAAUkB,UAClBK,OAAOC,sBAAsB,WAC3BI,EAAME,IAAIf,MAAMC,QAAU,UAG5BO,OAAOC,sBAAsB,WAC3BI,EAAME,IAAIf,MAAMC,QAAU,WAG7B,MAGPX,WAAY,WACV,IAAIE,EAAQJ,KAAKI,MACjBA,EAAMR,QAAUgC,SAASC,KAAKC,cAAc,IAAMjD,eAAiB,SAE9DuB,EAAMR,UACTQ,EAAMR,QAAUgC,SAASG,cAAc,OACvC3B,EAAMR,QAAQoC,UAAYnD,eAAiB,QAC3C+C,SAASC,KAAKI,YAAY7B,EAAMR,YAItCsC,OAAQ,SAAgBC,GACtB,IAAIC,EAAQpC,KAEZ,OAAOmC,EAAE,MAAO,CACdE,MAASxD,eACT8C,IAAO,MACPW,GAAM,CACJC,MAAS,WACPH,EAAM3B,+BAMD3B"}