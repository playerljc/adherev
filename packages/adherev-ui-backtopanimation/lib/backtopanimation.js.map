{"version":3,"file":"backtopanimation.js","sources":["backtopanimation.js"],"sourcesContent":["\"use strict\";\n\nvar _vue = require(\"vue\");\n\nrequire(\"core-js/modules/es.object.define-property.js\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar tslib_1 = require(\"tslib\");\n\nvar adherev_util_resource_1 = (0, tslib_1.__importDefault)(require(\"@baifendian/adherev-util-resource\"));\n\nvar vue_1 = require(\"vue\");\n\nvar vue_types_1 = require(\"vue-types\");\n\nvar selectorPrefix = 'adherev-ui-backtopanimation';\nvar props = {\n  className: (0, vue_types_1.string)().def(''),\n  zIndex: (0, vue_types_1.oneOfType)([vue_types_1.string, vue_types_1.number]).def(adherev_util_resource_1.default.Dict.value.ResourceNormalMaxZIndex.value),\n  duration: (0, vue_types_1.integer)().def(300)\n};\nexports.default = (0, vue_1.defineComponent)({\n  name: 'adv-backtopanimation',\n  props: props,\n  emits: ['trigger', 'scrollTop', 'target'],\n  setup: function setup(props, _a) {\n    var emit = _a.emit;\n    var root = (0, vue_1.ref)();\n    var scrollEl = null;\n    var maskEl = null;\n    var key = false;\n    (0, vue_1.onMounted)(function () {\n      renderMask();\n      initScrollEvent();\n    });\n    (0, vue_1.onBeforeUnmount)(function () {\n      var _a;\n\n      if (maskEl) {\n        try {\n          (_a = maskEl === null || maskEl === void 0 ? void 0 : maskEl.parentElement) === null || _a === void 0 ? void 0 : _a.removeChild(maskEl);\n        } catch (e) {}\n      }\n    });\n\n    var initScrollEvent = function initScrollEvent() {\n      emit('target', function (target) {\n        scrollEl = target;\n        if (!maskEl || !scrollEl) return;\n        scrollEl.addEventListener('scroll', function () {\n          if (!maskEl || !scrollEl || !root.value) return;\n\n          if (scrollEl.scrollTop !== 0) {\n            root.value && (root.value.style.display = 'block');\n          } else {\n            root.value && (root.value.style.display = 'none');\n          }\n        }, false);\n      });\n    };\n\n    var renderMask = function renderMask() {\n      maskEl = document.body.querySelector(\".\".concat(selectorPrefix, \"-mask\"));\n\n      if (!maskEl) {\n        maskEl = document.createElement('div');\n        maskEl.className = \"\".concat(selectorPrefix, \"-mask\");\n        document.body.appendChild(maskEl);\n      }\n    };\n\n    var trigger = function trigger() {\n      if (key) return;\n      emit('trigger', function () {\n        if (!maskEl || !scrollEl) return;\n        key = true;\n        maskEl.style.display = 'block';\n        var scrollVal = scrollEl.scrollTop;\n        var targetTop = 0; // 一次滚动的步进\n\n        var step = scrollEl.scrollHeight / (props.duration / (screen.updateInterval || 16.7) + (props.duration % (screen.updateInterval || 16.7) !== 0 ? 1 : 0));\n        /**\n         * 动画的滚动\n         */\n\n        function scrollAnimation() {\n          if (!maskEl || !scrollEl) return;\n\n          if (scrollEl && scrollEl.scrollTop < targetTop) {\n            if (scrollVal + step > targetTop) {\n              scrollVal = targetTop;\n            } else {\n              scrollVal += step;\n            }\n          } else if (scrollVal - step < targetTop) {\n            scrollVal = targetTop;\n          } else {\n            scrollVal -= step;\n          }\n\n          if (scrollEl) {\n            scrollEl.scrollTop = scrollVal;\n          }\n\n          emit('scrollTop', scrollVal);\n\n          if (scrollEl.scrollTop < targetTop) {\n            if (scrollVal >= targetTop) {\n              clear();\n            } else {\n              window.requestAnimationFrame(scrollAnimation);\n            }\n          } else if (scrollVal <= targetTop) {\n            clear();\n          } else {\n            window.requestAnimationFrame(scrollAnimation);\n          }\n\n          function clear() {\n            if (!maskEl || !scrollEl) return;\n            maskEl.style.display = 'none';\n            key = false;\n          }\n        }\n\n        window.requestAnimationFrame(scrollAnimation);\n      });\n    };\n\n    return function () {\n      return (0, _vue.createVNode)(\"div\", {\n        \"ref\": root,\n        \"class\": selectorPrefix,\n        \"onClick\": function onClick() {\n          trigger();\n        }\n      }, null);\n    };\n  }\n});"],"names":["_vue","require","tslib_1","Object","defineProperty","exports","value","adherev_util_resource_1","__importDefault","vue_1","vue_types_1","selectorPrefix","props","className","string","def","zIndex","oneOfType","number","default","Dict","ResourceNormalMaxZIndex","duration","integer","defineComponent","name","emits","setup","_a","trigger","key","emit","scrollVal","targetTop","step","maskEl","scrollEl","style","display","scrollTop","scrollHeight","screen","updateInterval","window","requestAnimationFrame","scrollAnimation","clear","root","ref","initScrollEvent","onMounted","renderMask","onBeforeUnmount","parentElement","removeChild","e","target","addEventListener","document","body","querySelector","concat","createElement","appendChild","createVNode","class","onClick"],"mappings":"aAEA,IAAIA,KAAOC,QAAQ,OAQfC,SANJD,QAAQ,gDAERE,OAAOC,eAAeC,QAAS,aAAc,CAC3CC,OAAO,IAGKL,QAAQ,UAElBM,yBAA0B,EAAIL,QAAQM,iBAAiBP,QAAQ,sCAE/DQ,MAAQR,QAAQ,OAEhBS,YAAcT,QAAQ,aAEtBU,eAAiB,8BACjBC,MAAQ,CACVC,WAAW,EAAIH,YAAYI,UAAUC,IAAI,IACzCC,QAAQ,EAAIN,YAAYO,WAAW,CAACP,YAAYI,OAAQJ,YAAYQ,SAASH,IAAIR,wBAAwBY,QAAQC,KAAKd,MAAMe,wBAAwBf,OACpJgB,UAAU,EAAIZ,YAAYa,WAAWR,IAAI,MAE3CV,QAAQc,SAAU,EAAIV,MAAMe,iBAAiB,CAC3CC,KAAM,uBACNb,MAAOA,MACPc,MAAO,CAAC,UAAW,YAAa,UAChCC,MAAO,SAAef,EAAOgB,GA8Cb,SAAVC,IACEC,GACJC,EAAK,UAAW,WACd,IAGIC,EACAC,EAEAC,EANCC,GAAWC,IAChBN,GAAM,EACNK,EAAOE,MAAMC,QAAU,QACnBN,EAAYI,EAASG,UACrBN,EAAY,EAEZC,EAAOE,EAASI,cAAgB5B,EAAMU,UAAYmB,OAAOC,gBAAkB,OAAS9B,EAAMU,UAAYmB,OAAOC,gBAAkB,OAAU,EAAI,EAAI,IA6CrJC,OAAOC,sBAxCP,SAASC,IAiCP,SAASC,IACFX,GAAWC,IAChBD,EAAOE,MAAMC,QAAU,OACvBR,GAAM,GAnCHK,GAAWC,IAEZA,GAAYA,EAASG,UAAYN,EACZA,EAAnBD,EAAYE,EACdF,EAAYC,EAEZD,GAAaE,EAENF,EAAYE,EAAOD,EAC5BD,EAAYC,EAEZD,GAAaE,EAGXE,IACFA,EAASG,UAAYP,GAGvBD,EAAK,YAAaC,GAEdI,EAASG,UAAYN,EACNA,GAAbD,EACFc,IAEAH,OAAOC,sBAAsBC,GAEtBb,GAAaC,EACtBa,IAEAH,OAAOC,sBAAsBC,SAzFrC,IAAId,EAAOH,EAAGG,KACVgB,GAAO,EAAItC,MAAMuC,OACjBZ,EAAW,KACXD,EAAS,KACTL,GAAM,EAeNmB,IAdJ,EAAIxC,MAAMyC,WAAW,WACnBC,IACAF,OAEF,EAAIxC,MAAM2C,iBAAiB,WACzB,IAAIxB,EAEJ,GAAIO,EACF,IACkF,QAA/EP,EAAKO,MAAAA,OAAuC,EAASA,EAAOkB,qBAAkC,IAAPzB,GAAyBA,EAAG0B,YAAYnB,GAChI,MAAOoB,OAIS,WACpBxB,EAAK,SAAU,SAAUyB,GACvBpB,EAAWoB,EACNrB,GAAWC,GAChBA,EAASqB,iBAAiB,SAAU,WAC7BtB,GAAWC,GAAaW,EAAKzC,QAEP,IAAvB8B,EAASG,UACXQ,EAAKzC,QAAUyC,EAAKzC,MAAM+B,MAAMC,QAAU,SAE1CS,EAAKzC,QAAUyC,EAAKzC,MAAM+B,MAAMC,QAAU,WAE3C,OAIHa,EAAa,YACfhB,EAASuB,SAASC,KAAKC,cAAc,IAAIC,OAAOlD,eAAgB,cAG9DwB,EAASuB,SAASI,cAAc,QACzBjD,UAAY,GAAGgD,OAAOlD,eAAgB,SAC7C+C,SAASC,KAAKI,YAAY5B,KA8D9B,OAAO,WACL,OAAO,EAAInC,KAAKgE,aAAa,MAAO,CAClChB,IAAOD,EACPkB,MAAStD,eACTuD,QAAW,WACTrC,MAED"}