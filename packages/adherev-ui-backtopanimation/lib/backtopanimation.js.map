{"version":3,"file":"backtopanimation.js","sources":["backtopanimation.js"],"sourcesContent":["\"use strict\";\n\nrequire(\"core-js/modules/es.object.define-property.js\");\nrequire(\"core-js/modules/es.number.constructor.js\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nvar tslib_1 = require(\"tslib\");\nvar adherev_util_resource_1 = tslib_1.__importDefault(require(\"@baifendian/adherev-util-resource\"));\nvar selectorPrefix = 'adherev-ui-backtopanimation';\nvar BackTopAnimation = {\n  name: 'adv-backtopanimation',\n  props: {\n    zIndex: {\n      type: [String, Number],\n      default: adherev_util_resource_1.default.Dict.value.ResourceNormalMaxZIndex.value\n    },\n    duration: {\n      type: Number,\n      default: 300\n    }\n  },\n  emits: ['target', 'trigger', 'scrollTop'],\n  data: function data() {\n    return {\n      $maskEl: null,\n      $scrollEl: null,\n      $key: false\n    };\n  },\n  mounted: function mounted() {\n    this.initScrollEvent();\n    this.renderMask();\n  },\n  beforeDestroy: function beforeDestroy() {\n    var $data = this.$data;\n    if ($data.$maskEl) {\n      try {\n        $data.$maskEl.parentElement.removeChild($data.$maskEl);\n      } catch (e) {}\n    }\n  },\n  methods: {\n    trigger: function trigger() {\n      if (this.$data.$key) return;\n      var self = this;\n      this.$emit('trigger', function () {\n        var $data = self.$data,\n          duration = self.duration;\n        $data.$key = true;\n        $data.$maskEl.style.display = 'block';\n        var scrollVal = $data.$scrollEl.scrollTop;\n        var targetTop = 0;\n        // 一次滚动的步进\n        var step = $data.$scrollEl.scrollHeight / (\n        //@ts-ignore\n        duration / (screen.updateInterval || 16.7) + (\n        //@ts-ignore\n        duration % (screen.updateInterval || 16.7) !== 0 ? 1 : 0));\n        /**\n         * 动画的滚动\n         */\n        function scrollAnimation() {\n          if ($data.$scrollEl.scrollTop < targetTop) {\n            if (scrollVal + step > targetTop) {\n              scrollVal = targetTop;\n            } else {\n              scrollVal += step;\n            }\n          } else if (scrollVal - step < targetTop) {\n            scrollVal = targetTop;\n          } else {\n            scrollVal -= step;\n          }\n          $data.$scrollEl.scrollTop = scrollVal;\n          self.$emit('scrollTop', scrollVal);\n          if ($data.$scrollEl.scrollTop < targetTop) {\n            if (scrollVal >= targetTop) {\n              clear();\n            } else {\n              window.requestAnimationFrame(scrollAnimation);\n            }\n          } else if (scrollVal <= targetTop) {\n            clear();\n          } else {\n            window.requestAnimationFrame(scrollAnimation);\n          }\n          function clear() {\n            $data.$maskEl.style.display = 'none';\n            $data.$key = false;\n          }\n        }\n        window.requestAnimationFrame(scrollAnimation);\n      });\n    },\n    initScrollEvent: function initScrollEvent() {\n      var self = this;\n      this.$emit('target', function (target) {\n        var $data = self.$data,\n          $refs = self.$refs;\n        $data.$scrollEl = target;\n        $data.$scrollEl.addEventListener('scroll', function () {\n          if ($data.$scrollEl.scrollTop !== 0) {\n            window.requestAnimationFrame(function () {\n              $refs.ref.style.display = 'block';\n            });\n          } else {\n            window.requestAnimationFrame(function () {\n              $refs.ref.style.display = 'none';\n            });\n          }\n        }, false);\n      });\n    },\n    renderMask: function renderMask() {\n      var $data = this.$data;\n      $data.$maskEl = document.body.querySelector(\".\".concat(selectorPrefix, \"-mask\"));\n      if (!$data.$maskEl) {\n        $data.$maskEl = document.createElement('div');\n        $data.$maskEl.className = \"\".concat(selectorPrefix, \"-mask\");\n        document.body.appendChild($data.$maskEl);\n      }\n    }\n  },\n  render: function render(h) {\n    var _this = this;\n    return h(\"div\", {\n      \"class\": selectorPrefix,\n      \"ref\": \"ref\",\n      \"on\": {\n        \"click\": function click() {\n          _this.trigger();\n        }\n      }\n    });\n  }\n};\nexports.default = BackTopAnimation;"],"names":["require","Object","defineProperty","exports","value","tslib_1","adherev_util_resource_1","__importDefault","selectorPrefix","BackTopAnimation","name","props","zIndex","type","String","Number","default","Dict","ResourceNormalMaxZIndex","duration","emits","data","$maskEl","$scrollEl","$key","mounted","this","initScrollEvent","renderMask","beforeDestroy","$data","parentElement","removeChild","e","methods","trigger","self","$emit","scrollVal","style","display","scrollTop","step","scrollHeight","screen","updateInterval","window","requestAnimationFrame","scrollAnimation","clear","target","$refs","addEventListener","ref","document","body","querySelector","concat","createElement","className","appendChild","render","h","_this","class","on","click"],"mappings":"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"}