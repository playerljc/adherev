{"version":3,"file":"backtopanimation.js","sources":["backtopanimation.js"],"sourcesContent":["\"use strict\";\n\nrequire(\"core-js/modules/es.object.define-property.js\");\n\nrequire(\"core-js/modules/es.number.constructor.js\");\n\nrequire(\"core-js/modules/es.regexp.exec.js\");\n\nrequire(\"core-js/modules/es.string.split.js\");\n\nvar __importDefault = void 0 && (void 0).__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar classnames_1 = __importDefault(require(\"classnames\"));\n\nvar adherev_util_resource_1 = __importDefault(require(\"@baifendian/adherev-util-resource\"));\n\nvar selectorPrefix = 'adherev-ui-backtopanimation';\nexports.default = {\n  name: 'adv-backtopanimation',\n  props: {\n    className: {\n      type: String,\n      default: ''\n    },\n    zIndex: {\n      type: [String, Number],\n      default: adherev_util_resource_1.default.Dict.value.ResourceNormalMaxZIndex.value\n    },\n    duration: {\n      type: Number,\n      default: 300\n    },\n    onTarget: {\n      type: Function,\n      default: function _default() {\n        return window;\n      }\n    },\n    onTrigger: {\n      type: Function\n    },\n    onScrollTop: {\n      type: Function\n    }\n  },\n  data: function data() {\n    return {\n      $maskEl: null,\n      $scrollEl: null,\n      $key: false\n    };\n  },\n  mounted: function mounted() {\n    this.initScrollEvent();\n    this.renderMask();\n  },\n  beforeDestroy: function beforeDestroy() {\n    var $data = this.$data;\n\n    if ($data.$maskEl) {\n      $data.$maskEl.parentElement.removeChild($data.$maskEl);\n    }\n  },\n  methods: {\n    trigger: function trigger() {\n      if (this.$data.$key) return;\n      var self = this;\n      this.$emit('trigger', function () {\n        var $data = self.$data,\n            duration = self.duration;\n        $data.$key = true;\n        $data.$maskEl.style.display = 'block';\n        var scrollVal = $data.$scrollEl.scrollTop;\n        var targetTop = 0; // 一次滚动的步进\n\n        var step = $data.$scrollEl.scrollHeight / (duration / (screen.updateInterval || 16.7) + (duration % (screen.updateInterval || 16.7) !== 0 ? 1 : 0));\n        /**\n         * 动画的滚动\n         */\n\n        function scrollAnimation() {\n          if ($data.$scrollEl.scrollTop < targetTop) {\n            if (scrollVal + step > targetTop) {\n              scrollVal = targetTop;\n            } else {\n              scrollVal += step;\n            }\n          } else if (scrollVal - step < targetTop) {\n            scrollVal = targetTop;\n          } else {\n            scrollVal -= step;\n          }\n\n          $data.$scrollEl.scrollTop = scrollVal;\n          self.$emit('scrollTop', scrollVal);\n\n          if ($data.$scrollEl.scrollTop < targetTop) {\n            if (scrollVal >= targetTop) {\n              clear();\n            } else {\n              window.requestAnimationFrame(scrollAnimation);\n            }\n          } else if (scrollVal <= targetTop) {\n            clear();\n          } else {\n            window.requestAnimationFrame(scrollAnimation);\n          }\n\n          function clear() {\n            $data.$maskEl.style.display = 'none';\n            $data.$key = false;\n          }\n        }\n\n        window.requestAnimationFrame(scrollAnimation);\n      });\n    },\n    initScrollEvent: function initScrollEvent() {\n      var self = this;\n      this.$emit('target', function (target) {\n        var $data = self.$data,\n            $refs = self.$refs;\n        $data.$scrollEl = target;\n        $data.$scrollEl.addEventListener('scroll', function () {\n          if ($data.$scrollEl.scrollTop !== 0) {\n            window.requestAnimationFrame(function () {\n              $refs.ref.style.display = 'block';\n            });\n          } else {\n            window.requestAnimationFrame(function () {\n              $refs.ref.style.display = 'none';\n            });\n          }\n        }, false);\n      });\n    },\n    renderMask: function renderMask() {\n      var $data = this.$data;\n      $data.$maskEl = document.body.querySelector(\".\" + selectorPrefix + \"-mask\");\n\n      if (!$data.$maskEl) {\n        $data.$maskEl = document.createElement('div');\n        $data.$maskEl.className = selectorPrefix + \"-mask\";\n        document.body.appendChild($data.$maskEl);\n      }\n    }\n  },\n  render: function render(h) {\n    var _this = this;\n\n    var className = this.className;\n    return h(\"div\", {\n      \"class\": classnames_1.default(selectorPrefix, className.split(' ')),\n      \"ref\": \"ref\",\n      \"on\": {\n        \"click\": function click() {\n          _this.trigger();\n        }\n      }\n    });\n  }\n};"],"names":["require","__importDefault","mod","__esModule","default","Object","defineProperty","exports","value","classnames_1","adherev_util_resource_1","selectorPrefix","name","props","className","type","String","zIndex","Number","Dict","ResourceNormalMaxZIndex","duration","onTarget","Function","window","onTrigger","onScrollTop","data","$maskEl","$scrollEl","$key","mounted","this","initScrollEvent","renderMask","beforeDestroy","$data","parentElement","removeChild","methods","trigger","self","$emit","style","display","scrollVal","scrollTop","step","scrollHeight","screen","updateInterval","requestAnimationFrame","scrollAnimation","clear","target","$refs","addEventListener","ref","document","body","querySelector","createElement","appendChild","render","h","_this","class","split","on","click"],"mappings":"aAEAA,QAAQ,gDAERA,QAAQ,4CAERA,QAAQ,qCAERA,QAAQ,sCAER,IAAIC,gBAAwD,SAAUC,GACpE,OAAOA,GAAOA,EAAIC,WAAaD,EAAM,CACnCE,QAAWF,IAIfG,OAAOC,eAAeC,QAAS,aAAc,CAC3CC,OAAO,IAGT,IAAIC,aAAeR,gBAAgBD,QAAQ,eAEvCU,wBAA0BT,gBAAgBD,QAAQ,sCAElDW,eAAiB,8BACrBJ,QAAQH,QAAU,CAChBQ,KAAM,uBACNC,MAAO,CACLC,UAAW,CACTC,KAAMC,OACNZ,QAAS,IAEXa,OAAQ,CACNF,KAAM,CAACC,OAAQE,QACfd,QAASM,wBAAwBN,QAAQe,KAAKX,MAAMY,wBAAwBZ,OAE9Ea,SAAU,CACRN,KAAMG,OACNd,QAAS,KAEXkB,SAAU,CACRP,KAAMQ,SACNnB,QAAS,WACP,OAAOoB,SAGXC,UAAW,CACTV,KAAMQ,UAERG,YAAa,CACXX,KAAMQ,WAGVI,KAAM,WACJ,MAAO,CACLC,QAAS,KACTC,UAAW,KACXC,MAAM,IAGVC,QAAS,WACPC,KAAKC,kBACLD,KAAKE,cAEPC,cAAe,WACb,IAAIC,EAAQJ,KAAKI,MAEbA,EAAMR,SACRQ,EAAMR,QAAQS,cAAcC,YAAYF,EAAMR,UAGlDW,QAAS,CACPC,QAAS,WACP,IACIC,EADAT,KAAKI,MAAMN,OACXW,EAAOT,MACNU,MAAM,UAAW,WACpB,IAAIN,EAAQK,EAAKL,MACbf,EAAWoB,EAAKpB,SACpBe,EAAMN,MAAO,EACbM,EAAMR,QAAQe,MAAMC,QAAU,QAC9B,IAAIC,EAAYT,EAAMP,UAAUiB,UAG5BC,EAAOX,EAAMP,UAAUmB,cAAgB3B,GAAY4B,OAAOC,gBAAkB,OAAS7B,GAAY4B,OAAOC,gBAAkB,OAAU,EAAI,EAAI,IAuChJ1B,OAAO2B,sBAlCP,SAASC,IA4BP,SAASC,IACPjB,EAAMR,QAAQe,MAAMC,QAAU,OAC9BR,EAAMN,MAAO,EA7BXM,EAAMP,UAAUiB,UARN,EAAA,EASRD,EAAYE,EACdF,EAVU,EAYVA,GAAaE,EAENF,EAAYE,EAdT,EAeZF,EAfY,EAiBZA,GAAaE,EAGfX,EAAMP,UAAUiB,UAAYD,EAC5BJ,EAAKC,MAAM,YAAaG,GAEpBT,EAAMP,UAAUiB,UAvBN,EAAA,GAwBRD,EACFQ,IAEA7B,OAAO2B,sBAAsBC,GAEtBP,GA7BG,EA8BZQ,IAEA7B,OAAO2B,sBAAsBC,QAYrCnB,gBAAiB,WACf,IAAIQ,EAAOT,KACXA,KAAKU,MAAM,SAAU,SAAUY,GAC7B,IAAIlB,EAAQK,EAAKL,MACbmB,EAAQd,EAAKc,MACjBnB,EAAMP,UAAYyB,EAClBlB,EAAMP,UAAU2B,iBAAiB,SAAU,WACP,IAA9BpB,EAAMP,UAAUiB,UAClBtB,OAAO2B,sBAAsB,WAC3BI,EAAME,IAAId,MAAMC,QAAU,UAG5BpB,OAAO2B,sBAAsB,WAC3BI,EAAME,IAAId,MAAMC,QAAU,WAG7B,MAGPV,WAAY,WACV,IAAIE,EAAQJ,KAAKI,MACjBA,EAAMR,QAAU8B,SAASC,KAAKC,cAAc,IAAMjD,eAAiB,SAE9DyB,EAAMR,UACTQ,EAAMR,QAAU8B,SAASG,cAAc,OACvCzB,EAAMR,QAAQd,UAAYH,eAAiB,QAC3C+C,SAASC,KAAKG,YAAY1B,EAAMR,YAItCmC,OAAQ,SAAgBC,GACtB,IAAIC,EAAQjC,KAERlB,EAAYkB,KAAKlB,UACrB,OAAOkD,EAAE,MAAO,CACdE,MAASzD,aAAaL,QAAQO,eAAgBG,EAAUqD,MAAM,MAC9DV,IAAO,MACPW,GAAM,CACJC,MAAS,WACPJ,EAAMzB"}