{"version":3,"file":"backtopanimation.js","sources":["backtopanimation.js"],"sourcesContent":["\"use strict\";\n\nrequire(\"core-js/modules/es.object.define-property.js\");\n\nrequire(\"core-js/modules/es.number.constructor.js\");\n\nvar __importDefault = void 0 && (void 0).__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar adherev_util_resource_1 = __importDefault(require(\"@baifendian/adherev-util-resource\"));\n\nvar selectorPrefix = 'adherev-ui-backtopanimation';\nexports.default = {\n  name: 'adv-backtopanimation',\n  props: {\n    className: {\n      type: String,\n      default: ''\n    },\n    zIndex: {\n      type: [String, Number],\n      default: adherev_util_resource_1.default.Dict.value.ResourceNormalMaxZIndex.value\n    },\n    duration: {\n      type: Number,\n      default: 300\n    }\n  },\n  data: function data() {\n    return {\n      $maskEl: null,\n      $scrollEl: null,\n      $key: false\n    };\n  },\n  mounted: function mounted() {\n    this.initScrollEvent();\n    this.renderMask();\n  },\n  beforeDestroy: function beforeDestroy() {\n    var $data = this.$data;\n\n    if ($data.$maskEl) {\n      $data.$maskEl.parentElement.removeChild($data.$maskEl);\n    }\n  },\n  methods: {\n    trigger: function trigger() {\n      if (this.$data.$key) return;\n      var self = this;\n      this.$emit('trigger', function () {\n        var $data = self.$data,\n            duration = self.duration;\n        $data.$key = true;\n        $data.$maskEl.style.display = 'block';\n        var scrollVal = $data.$scrollEl.scrollTop;\n        var targetTop = 0; // 一次滚动的步进\n\n        var step = $data.$scrollEl.scrollHeight / (duration / (screen.updateInterval || 16.7) + (duration % (screen.updateInterval || 16.7) !== 0 ? 1 : 0));\n        /**\n         * 动画的滚动\n         */\n\n        function scrollAnimation() {\n          if ($data.$scrollEl.scrollTop < targetTop) {\n            if (scrollVal + step > targetTop) {\n              scrollVal = targetTop;\n            } else {\n              scrollVal += step;\n            }\n          } else if (scrollVal - step < targetTop) {\n            scrollVal = targetTop;\n          } else {\n            scrollVal -= step;\n          }\n\n          $data.$scrollEl.scrollTop = scrollVal;\n          self.$emit('scrollTop', scrollVal);\n\n          if ($data.$scrollEl.scrollTop < targetTop) {\n            if (scrollVal >= targetTop) {\n              clear();\n            } else {\n              window.requestAnimationFrame(scrollAnimation);\n            }\n          } else if (scrollVal <= targetTop) {\n            clear();\n          } else {\n            window.requestAnimationFrame(scrollAnimation);\n          }\n\n          function clear() {\n            $data.$maskEl.style.display = 'none';\n            $data.$key = false;\n          }\n        }\n\n        window.requestAnimationFrame(scrollAnimation);\n      });\n    },\n    initScrollEvent: function initScrollEvent() {\n      var self = this;\n      this.$emit('target', function (target) {\n        var $data = self.$data,\n            $refs = self.$refs;\n        $data.$scrollEl = target;\n        $data.$scrollEl.addEventListener('scroll', function () {\n          if ($data.$scrollEl.scrollTop !== 0) {\n            window.requestAnimationFrame(function () {\n              $refs.ref.style.display = 'block';\n            });\n          } else {\n            window.requestAnimationFrame(function () {\n              $refs.ref.style.display = 'none';\n            });\n          }\n        }, false);\n      });\n    },\n    renderMask: function renderMask() {\n      var $data = this.$data;\n      $data.$maskEl = document.body.querySelector(\".\" + selectorPrefix + \"-mask\");\n\n      if (!$data.$maskEl) {\n        $data.$maskEl = document.createElement('div');\n        $data.$maskEl.className = selectorPrefix + \"-mask\";\n        document.body.appendChild($data.$maskEl);\n      }\n    }\n  },\n  render: function render(h) {\n    var _this = this; // @ts-ignore\n\n\n    return h(\"div\", {\n      \"class\": selectorPrefix,\n      \"ref\": \"ref\",\n      \"on\": {\n        \"click\": function click() {\n          _this.trigger();\n        }\n      }\n    });\n  }\n};"],"names":["require","__importDefault","mod","__esModule","default","Object","defineProperty","exports","value","adherev_util_resource_1","selectorPrefix","name","props","className","type","String","zIndex","Number","Dict","ResourceNormalMaxZIndex","duration","data","$maskEl","$scrollEl","$key","mounted","this","initScrollEvent","renderMask","beforeDestroy","$data","parentElement","removeChild","methods","trigger","self","$emit","style","display","scrollVal","scrollTop","step","scrollHeight","screen","updateInterval","window","requestAnimationFrame","scrollAnimation","clear","target","$refs","addEventListener","ref","document","body","querySelector","createElement","appendChild","render","h","_this","class","on","click"],"mappings":"aAEAA,QAAQ,gDAERA,QAAQ,4CAER,IAAIC,gBAAwD,SAAUC,GACpE,OAAOA,GAAOA,EAAIC,WAAaD,EAAM,CACnCE,QAAWF,IAIfG,OAAOC,eAAeC,QAAS,aAAc,CAC3CC,OAAO,IAGT,IAAIC,wBAA0BR,gBAAgBD,QAAQ,sCAElDU,eAAiB,8BACrBH,QAAQH,QAAU,CAChBO,KAAM,uBACNC,MAAO,CACLC,UAAW,CACTC,KAAMC,OACNX,QAAS,IAEXY,OAAQ,CACNF,KAAM,CAACC,OAAQE,QACfb,QAASK,wBAAwBL,QAAQc,KAAKV,MAAMW,wBAAwBX,OAE9EY,SAAU,CACRN,KAAMG,OACNb,QAAS,MAGbiB,KAAM,WACJ,MAAO,CACLC,QAAS,KACTC,UAAW,KACXC,MAAM,IAGVC,QAAS,WACPC,KAAKC,kBACLD,KAAKE,cAEPC,cAAe,WACb,IAAIC,EAAQJ,KAAKI,MAEbA,EAAMR,SACRQ,EAAMR,QAAQS,cAAcC,YAAYF,EAAMR,UAGlDW,QAAS,CACPC,QAAS,WACP,IACIC,EADAT,KAAKI,MAAMN,OACXW,EAAOT,MACNU,MAAM,UAAW,WACpB,IAAIN,EAAQK,EAAKL,MACbV,EAAWe,EAAKf,SACpBU,EAAMN,MAAO,EACbM,EAAMR,QAAQe,MAAMC,QAAU,QAC9B,IAAIC,EAAYT,EAAMP,UAAUiB,UAG5BC,EAAOX,EAAMP,UAAUmB,cAAgBtB,GAAYuB,OAAOC,gBAAkB,OAASxB,GAAYuB,OAAOC,gBAAkB,OAAU,EAAI,EAAI,IAuChJC,OAAOC,sBAlCP,SAASC,IA4BP,SAASC,IACPlB,EAAMR,QAAQe,MAAMC,QAAU,OAC9BR,EAAMN,MAAO,EA7BXM,EAAMP,UAAUiB,UARN,EAAA,EASRD,EAAYE,EACdF,EAVU,EAYVA,GAAaE,EAENF,EAAYE,EAdT,EAeZF,EAfY,EAiBZA,GAAaE,EAGfX,EAAMP,UAAUiB,UAAYD,EAC5BJ,EAAKC,MAAM,YAAaG,GAEpBT,EAAMP,UAAUiB,UAvBN,EAAA,GAwBRD,EACFS,IAEAH,OAAOC,sBAAsBC,GAEtBR,GA7BG,EA8BZS,IAEAH,OAAOC,sBAAsBC,QAYrCpB,gBAAiB,WACf,IAAIQ,EAAOT,KACXA,KAAKU,MAAM,SAAU,SAAUa,GAC7B,IAAInB,EAAQK,EAAKL,MACboB,EAAQf,EAAKe,MACjBpB,EAAMP,UAAY0B,EAClBnB,EAAMP,UAAU4B,iBAAiB,SAAU,WACP,IAA9BrB,EAAMP,UAAUiB,UAClBK,OAAOC,sBAAsB,WAC3BI,EAAME,IAAIf,MAAMC,QAAU,UAG5BO,OAAOC,sBAAsB,WAC3BI,EAAME,IAAIf,MAAMC,QAAU,WAG7B,MAGPV,WAAY,WACV,IAAIE,EAAQJ,KAAKI,MACjBA,EAAMR,QAAU+B,SAASC,KAAKC,cAAc,IAAM7C,eAAiB,SAE9DoB,EAAMR,UACTQ,EAAMR,QAAU+B,SAASG,cAAc,OACvC1B,EAAMR,QAAQT,UAAYH,eAAiB,QAC3C2C,SAASC,KAAKG,YAAY3B,EAAMR,YAItCoC,OAAQ,SAAgBC,GACtB,IAAIC,EAAQlC,KAGZ,OAAOiC,EAAE,MAAO,CACdE,MAASnD,eACT0C,IAAO,MACPU,GAAM,CACJC,MAAS,WACPH,EAAM1B"}