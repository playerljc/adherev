{"version":3,"file":"backtopanimation.js","sources":["backtopanimation.js"],"sourcesContent":["\"use strict\";\n\nvar _vue = require(\"vue\");\nrequire(\"core-js/modules/es.object.define-property.js\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.backTopAnimationProps = void 0;\nvar tslib_1 = require(\"tslib\");\nvar vue_1 = require(\"vue\");\nvar vue_types_1 = require(\"vue-types\");\nvar adherev_util_resource_1 = tslib_1.__importDefault(require(\"@baifendian/adherev-util-resource\"));\nvar selectorPrefix = 'adherev-ui-backtopanimation';\nexports.backTopAnimationProps = {\n  className: (0, vue_types_1.string)().def(''),\n  zIndex: (0, vue_types_1.oneOfType)([(0, vue_types_1.string)(), (0, vue_types_1.number)()]).def(adherev_util_resource_1.default.Dict.value.ResourceNormalMaxZIndex.value),\n  duration: (0, vue_types_1.integer)().def(300)\n};\nexports.default = (0, vue_1.defineComponent)({\n  name: 'adv-backtopanimation',\n  props: exports.backTopAnimationProps,\n  emits: ['trigger', 'scrollTop', 'target'],\n  setup: function setup(props, _a) {\n    var emit = _a.emit;\n    var root = (0, vue_1.ref)();\n    var scrollEl = null;\n    var maskEl = null;\n    var key = false;\n    (0, vue_1.onMounted)(function () {\n      renderMask();\n      initScrollEvent();\n    });\n    (0, vue_1.onBeforeUnmount)(function () {\n      var _a;\n      if (maskEl) {\n        try {\n          (_a = maskEl === null || maskEl === void 0 ? void 0 : maskEl.parentElement) === null || _a === void 0 ? void 0 : _a.removeChild(maskEl);\n        } catch (e) {}\n      }\n    });\n    var initScrollEvent = function initScrollEvent() {\n      emit('target', function (target) {\n        scrollEl = target;\n        if (!maskEl || !scrollEl) return;\n        scrollEl.addEventListener('scroll', function () {\n          if (!maskEl || !scrollEl || !root.value) return;\n          if (scrollEl.scrollTop !== 0) {\n            root.value && (root.value.style.display = 'block');\n          } else {\n            root.value && (root.value.style.display = 'none');\n          }\n        }, false);\n      });\n    };\n    var renderMask = function renderMask() {\n      maskEl = document.body.querySelector(\".\".concat(selectorPrefix, \"-mask\"));\n      if (!maskEl) {\n        maskEl = document.createElement('div');\n        maskEl.className = \"\".concat(selectorPrefix, \"-mask\");\n        document.body.appendChild(maskEl);\n      }\n    };\n    var trigger = function trigger() {\n      if (key) return;\n      emit('trigger', function () {\n        if (!maskEl || !scrollEl) return;\n        key = true;\n        maskEl.style.display = 'block';\n        var scrollVal = scrollEl.scrollTop;\n        var targetTop = 0;\n        // 一次滚动的步进\n        var step = scrollEl.scrollHeight / (props.duration / (screen.updateInterval || 16.7) + (props.duration % (screen.updateInterval || 16.7) !== 0 ? 1 : 0));\n        /**\n         * 动画的滚动\n         */\n        function scrollAnimation() {\n          if (!maskEl || !scrollEl) return;\n          if (scrollEl && scrollEl.scrollTop < targetTop) {\n            if (scrollVal + step > targetTop) {\n              scrollVal = targetTop;\n            } else {\n              scrollVal += step;\n            }\n          } else if (scrollVal - step < targetTop) {\n            scrollVal = targetTop;\n          } else {\n            scrollVal -= step;\n          }\n          if (scrollEl) {\n            scrollEl.scrollTop = scrollVal;\n          }\n          emit('scrollTop', scrollVal);\n          if (scrollEl.scrollTop < targetTop) {\n            if (scrollVal >= targetTop) {\n              clear();\n            } else {\n              window.requestAnimationFrame(scrollAnimation);\n            }\n          } else if (scrollVal <= targetTop) {\n            clear();\n          } else {\n            window.requestAnimationFrame(scrollAnimation);\n          }\n          function clear() {\n            if (!maskEl || !scrollEl) return;\n            maskEl.style.display = 'none';\n            key = false;\n          }\n        }\n        window.requestAnimationFrame(scrollAnimation);\n      });\n    };\n    return function () {\n      return (0, _vue.createVNode)(\"div\", {\n        \"ref\": root,\n        \"class\": selectorPrefix,\n        \"onClick\": function onClick() {\n          trigger();\n        }\n      }, null);\n    };\n  }\n});"],"names":["_vue","require","tslib_1","Object","defineProperty","exports","value","backTopAnimationProps","vue_1","vue_types_1","adherev_util_resource_1","__importDefault","selectorPrefix","className","string","def","zIndex","oneOfType","number","default","Dict","ResourceNormalMaxZIndex","duration","integer","defineComponent","name","props","emits","setup","_a","trigger","key","emit","scrollVal","targetTop","step","maskEl","scrollEl","style","display","scrollTop","scrollHeight","screen","updateInterval","window","requestAnimationFrame","scrollAnimation","clear","root","ref","initScrollEvent","onMounted","renderMask","onBeforeUnmount","parentElement","removeChild","e","target","addEventListener","document","body","querySelector","concat","createElement","appendChild","createVNode","class","onClick"],"mappings":"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"}