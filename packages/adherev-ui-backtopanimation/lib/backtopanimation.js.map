{"version":3,"file":"backtopanimation.js","sources":["backtopanimation.js"],"sourcesContent":["\"use strict\";\n\nrequire(\"core-js/modules/es.object.define-property.js\");\n\nrequire(\"core-js/modules/es.number.constructor.js\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar tslib_1 = require(\"tslib\");\n\nvar adherev_util_resource_1 = tslib_1.__importDefault(require(\"@baifendian/adherev-util-resource\"));\n\nvar selectorPrefix = 'adherev-ui-backtopanimation';\nvar BackTopAnimation = {\n  name: 'adv-backtopanimation',\n  props: {\n    className: {\n      type: String,\n      default: ''\n    },\n    zIndex: {\n      type: [String, Number],\n      default: adherev_util_resource_1.default.Dict.value.ResourceNormalMaxZIndex.value\n    },\n    duration: {\n      type: Number,\n      default: 300\n    }\n  },\n  data: function data() {\n    return {\n      $maskEl: null,\n      $scrollEl: null,\n      $key: false\n    };\n  },\n  mounted: function mounted() {\n    this.initScrollEvent();\n    this.renderMask();\n  },\n  beforeDestroy: function beforeDestroy() {\n    var $data = this.$data;\n\n    if ($data.$maskEl) {\n      try {\n        $data.$maskEl.parentElement.removeChild($data.$maskEl);\n      } catch (e) {}\n    }\n  },\n  methods: {\n    trigger: function trigger() {\n      if (this.$data.$key) return;\n      var self = this;\n      this.$emit('trigger', function () {\n        var $data = self.$data,\n            duration = self.duration;\n        $data.$key = true;\n        $data.$maskEl.style.display = 'block';\n        var scrollVal = $data.$scrollEl.scrollTop;\n        var targetTop = 0; // 一次滚动的步进\n\n        var step = $data.$scrollEl.scrollHeight / ( //@ts-ignore\n        duration / (screen.updateInterval || 16.7) + ( //@ts-ignore\n        duration % (screen.updateInterval || 16.7) !== 0 ? 1 : 0));\n        /**\n         * 动画的滚动\n         */\n\n        function scrollAnimation() {\n          if ($data.$scrollEl.scrollTop < targetTop) {\n            if (scrollVal + step > targetTop) {\n              scrollVal = targetTop;\n            } else {\n              scrollVal += step;\n            }\n          } else if (scrollVal - step < targetTop) {\n            scrollVal = targetTop;\n          } else {\n            scrollVal -= step;\n          }\n\n          $data.$scrollEl.scrollTop = scrollVal;\n          self.$emit('scrollTop', scrollVal);\n\n          if ($data.$scrollEl.scrollTop < targetTop) {\n            if (scrollVal >= targetTop) {\n              clear();\n            } else {\n              window.requestAnimationFrame(scrollAnimation);\n            }\n          } else if (scrollVal <= targetTop) {\n            clear();\n          } else {\n            window.requestAnimationFrame(scrollAnimation);\n          }\n\n          function clear() {\n            $data.$maskEl.style.display = 'none';\n            $data.$key = false;\n          }\n        }\n\n        window.requestAnimationFrame(scrollAnimation);\n      });\n    },\n    initScrollEvent: function initScrollEvent() {\n      var self = this;\n      this.$emit('target', function (target) {\n        var $data = self.$data,\n            $refs = self.$refs;\n        $data.$scrollEl = target;\n        $data.$scrollEl.addEventListener('scroll', function () {\n          if ($data.$scrollEl.scrollTop !== 0) {\n            window.requestAnimationFrame(function () {\n              $refs.ref.style.display = 'block';\n            });\n          } else {\n            window.requestAnimationFrame(function () {\n              $refs.ref.style.display = 'none';\n            });\n          }\n        }, false);\n      });\n    },\n    renderMask: function renderMask() {\n      var $data = this.$data;\n      $data.$maskEl = document.body.querySelector(\".\" + selectorPrefix + \"-mask\");\n\n      if (!$data.$maskEl) {\n        $data.$maskEl = document.createElement('div');\n        $data.$maskEl.className = selectorPrefix + \"-mask\";\n        document.body.appendChild($data.$maskEl);\n      }\n    }\n  },\n  render: function render(h) {\n    var _this = this;\n\n    return h(\"div\", {\n      \"class\": selectorPrefix,\n      \"ref\": \"ref\",\n      \"on\": {\n        \"click\": function click() {\n          _this.trigger();\n        }\n      }\n    });\n  }\n};\nexports.default = BackTopAnimation;"],"names":["require","Object","defineProperty","exports","value","tslib_1","adherev_util_resource_1","__importDefault","selectorPrefix","BackTopAnimation","name","props","className","type","String","default","zIndex","Number","Dict","ResourceNormalMaxZIndex","duration","data","$maskEl","$scrollEl","$key","mounted","this","initScrollEvent","renderMask","beforeDestroy","$data","parentElement","removeChild","e","methods","trigger","self","$emit","style","display","scrollVal","scrollTop","step","scrollHeight","screen","updateInterval","window","requestAnimationFrame","scrollAnimation","clear","target","$refs","addEventListener","ref","document","body","querySelector","createElement","appendChild","render","h","_this","class","on","click"],"mappings":"aAEAA,QAAQ,gDAERA,QAAQ,4CAERC,OAAOC,eAAeC,QAAS,aAAc,CAC3CC,OAAO,IAGT,IAAIC,QAAUL,QAAQ,SAElBM,wBAA0BD,QAAQE,gBAAgBP,QAAQ,sCAE1DQ,eAAiB,8BACjBC,iBAAmB,CACrBC,KAAM,uBACNC,MAAO,CACLC,UAAW,CACTC,KAAMC,OACNC,QAAS,IAEXC,OAAQ,CACNH,KAAM,CAACC,OAAQG,QACfF,QAAST,wBAAwBS,QAAQG,KAAKd,MAAMe,wBAAwBf,OAE9EgB,SAAU,CACRP,KAAMI,OACNF,QAAS,MAGbM,KAAM,WACJ,MAAO,CACLC,QAAS,KACTC,UAAW,KACXC,MAAM,IAGVC,QAAS,WACPC,KAAKC,kBACLD,KAAKE,cAEPC,cAAe,WACb,IAAIC,EAAQJ,KAAKI,MAEjB,GAAIA,EAAMR,QACR,IACEQ,EAAMR,QAAQS,cAAcC,YAAYF,EAAMR,SAC9C,MAAOW,MAGbC,QAAS,CACPC,QAAS,WACP,IACIC,EADAV,KAAKI,MAAMN,OACXY,EAAOV,MACNW,MAAM,UAAW,WACpB,IAAIP,EAAQM,EAAKN,MACbV,EAAWgB,EAAKhB,SACpBU,EAAMN,MAAO,EACbM,EAAMR,QAAQgB,MAAMC,QAAU,QAC9B,IAAIC,EAAYV,EAAMP,UAAUkB,UAG5BC,EAAOZ,EAAMP,UAAUoB,cAC3BvB,GAAYwB,OAAOC,gBAAkB,OACrCzB,GAAYwB,OAAOC,gBAAkB,OAAU,EAAI,EAAI,IAuCvDC,OAAOC,sBAlCP,SAASC,IA4BP,SAASC,IACPnB,EAAMR,QAAQgB,MAAMC,QAAU,OAC9BT,EAAMN,MAAO,EA7BXM,EAAMP,UAAUkB,UAVN,EAAA,EAWRD,EAAYE,EACdF,EAZU,EAcVA,GAAaE,EAENF,EAAYE,EAhBT,EAiBZF,EAjBY,EAmBZA,GAAaE,EAGfZ,EAAMP,UAAUkB,UAAYD,EAC5BJ,EAAKC,MAAM,YAAaG,GAEpBV,EAAMP,UAAUkB,UAzBN,EAAA,GA0BRD,EACFS,IAEAH,OAAOC,sBAAsBC,GAEtBR,GA/BG,EAgCZS,IAEAH,OAAOC,sBAAsBC,QAYrCrB,gBAAiB,WACf,IAAIS,EAAOV,KACXA,KAAKW,MAAM,SAAU,SAAUa,GAC7B,IAAIpB,EAAQM,EAAKN,MACbqB,EAAQf,EAAKe,MACjBrB,EAAMP,UAAY2B,EAClBpB,EAAMP,UAAU6B,iBAAiB,SAAU,WACP,IAA9BtB,EAAMP,UAAUkB,UAClBK,OAAOC,sBAAsB,WAC3BI,EAAME,IAAIf,MAAMC,QAAU,UAG5BO,OAAOC,sBAAsB,WAC3BI,EAAME,IAAIf,MAAMC,QAAU,WAG7B,MAGPX,WAAY,WACV,IAAIE,EAAQJ,KAAKI,MACjBA,EAAMR,QAAUgC,SAASC,KAAKC,cAAc,IAAMhD,eAAiB,SAE9DsB,EAAMR,UACTQ,EAAMR,QAAUgC,SAASG,cAAc,OACvC3B,EAAMR,QAAQV,UAAYJ,eAAiB,QAC3C8C,SAASC,KAAKG,YAAY5B,EAAMR,YAItCqC,OAAQ,SAAgBC,GACtB,IAAIC,EAAQnC,KAEZ,OAAOkC,EAAE,MAAO,CACdE,MAAStD,eACT6C,IAAO,MACPU,GAAM,CACJC,MAAS,WACPH,EAAM1B,gBAMhBhC,QAAQY,QAAUN"}