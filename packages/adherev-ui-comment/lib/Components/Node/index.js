"use strict";var _vue=require("vue");function _isSlot(e){return"function"==typeof e||"[object Object]"===Object.prototype.toString.call(e)&&!(0,_vue.isVNode)(e)}require("core-js/modules/es.object.define-property.js"),require("core-js/modules/es.array.map.js"),require("core-js/modules/es.string.ends-with.js"),require("core-js/modules/es.array.find.js"),require("core-js/modules/es.object.to-string.js"),Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib"),classnames_1=tslib_1.__importDefault(require("classnames")),vue_1=require("vue"),vue_types_1=require("vue-types"),adherev_ui_conditionalrender_1=tslib_1.__importDefault(require("@baifendian/adherev-ui-conditionalrender")),adherev_ui_flexlayout_1=tslib_1.__importDefault(require("@baifendian/adherev-ui-flexlayout")),adherev_util_intl_1=tslib_1.__importDefault(require("@baifendian/adherev-util-intl")),Info_1=tslib_1.__importDefault(require("../../Reply/Info")),Submit_1=tslib_1.__importDefault(require("../../Reply/Submit")),selectorPrefix="adherev-ui-comment-node",props={isReply:(0,vue_types_1.bool)().def(!1),defaultData:(0,vue_types_1.object)().def({}),dataKeys:(0,vue_types_1.object)().def({current:"current",totalPage:"totalPage",list:"list",totalCount:"totalCount"}),limit:(0,vue_types_1.number)().def(10),fetchData:(0,vue_types_1.func)(),fetchReply:(0,vue_types_1.func)(),keyProp:(0,vue_types_1.string)().def(""),isMoreProp:(0,vue_types_1.string)().def(""),local:(0,vue_types_1.string)().def("zh"),emojiPickerProps:(0,vue_types_1.object)().def({}),comId:(0,vue_types_1.oneOfType)([(0,vue_types_1.string)(),(0,vue_types_1.number)()]).def(""),renderLoading:(0,vue_types_1.object)(),loadMoreCollapseTextIcon:(0,vue_types_1.object)(),loadMoreReplyText:(0,vue_types_1.object)(),showReplyTextIcon:(0,vue_types_1.object)(),showReplyText:(0,vue_types_1.object)(),hideReplyTextIcon:(0,vue_types_1.object)(),hideReplyText:(0,vue_types_1.object)(),renderActions:(0,vue_types_1.func)(),renderAuthor:(0,vue_types_1.func)(),renderAvatar:(0,vue_types_1.func)(),renderContent:(0,vue_types_1.func)(),renderDateTime:(0,vue_types_1.func)()};exports.default=(0,vue_1.defineComponent)({name:"adv-comment-reply-node",slots:["renderLoading","loadMoreCollapseTextIcon","loadMoreReplyText","showReplyTextIcon","showReplyText","hideReplyTextIcon","hideReplyText","renderActions","renderAuthor","renderAvatar","renderContent","renderDateTime"],props:props,setup:function(u,e){function i(){var e;return f.value=!0,l={page:1,limit:u.limit},null==(e=null==t?void 0:t())?void 0:e.then(function(e){s.value=e})}function d(){var e;return f.value=!0,l.page=l.page+1,null==(e=null==t?void 0:t())?void 0:e.then(function(e){var l;s.value=tslib_1.__assign(tslib_1.__assign({},e),((l={})[u.dataKeys.list]=tslib_1.__spreadArray(tslib_1.__spreadArray([],s.value[u.dataKeys.list],!0),e[u.dataKeys.list],!0),l))})}var c=e.slots,s=(0,vue_1.ref)(((e={})[u.dataKeys.current]=1,e[u.dataKeys.list]=[],e[u.dataKeys.totalCount]=0,e[u.dataKeys.totalPage]=0,e)),v=(0,vue_1.ref)(u.defaultData),_=(0,vue_1.ref)(!1),f=(0,vue_1.ref)(!1),p=(0,vue_1.ref)(!1),l={page:1,limit:u.limit},t=function(){var e;return null==(e=null==(e=null==(e=null==u?void 0:u.fetchData)?void 0:e.call(u,tslib_1.__assign(tslib_1.__assign({},l),{record:tslib_1.__assign({},v.value)})))?void 0:e.then(function(e){return f.value=!1,e}))?void 0:e.catch(function(e){return f.value=!1,e})},y=(0,vue_1.computed)(function(){return s.value[u.dataKeys.list].length<=s.value[u.dataKeys.totalCount]});return(0,vue_1.watch)(function(){return u.defaultData},function(e){return v.value=e}),function(){var r,o,e,l,t,n,a;return(0,_vue.createVNode)(adherev_ui_flexlayout_1.default,{direction:"horizontal",class:(0,classnames_1.default)(selectorPrefix,u.isReply?"".concat(selectorPrefix,"-reply"):"")},{default:function(){return[(0,_vue.createVNode)(adherev_ui_flexlayout_1.default.Fixed,{class:"".concat(selectorPrefix,"-avatar-wrap")},{default:function(){return[null==(e=(null==c?void 0:c.renderAvatar)||(null==u?void 0:u.renderAvatar))?void 0:e(tslib_1.__assign({},v.value))]}}),(0,_vue.createVNode)(adherev_ui_flexlayout_1.default.Auto,{autoFixed:!0,fit:!0},{default:function(){return[(0,_vue.createVNode)(adherev_ui_flexlayout_1.default,{direction:"vertical"},{default:function(){return[(0,_vue.createVNode)(adherev_ui_flexlayout_1.default.Fixed,{class:"".concat(selectorPrefix,"-title-row"),fit:!1},{default:function(){return[(0,_vue.createVNode)("div",{class:"".concat(selectorPrefix,"-title-row-author")},[null==(l=(null==c?void 0:c.renderAuthor)||(null==u?void 0:u.renderAuthor))?void 0:l(tslib_1.__assign({},v.value))]),(0,_vue.createVNode)("div",{class:"".concat(selectorPrefix,"-title-row-date-time")},[null==(l=(null==c?void 0:c.renderDateTime)||(null==u?void 0:u.renderDateTime))?void 0:l(tslib_1.__assign({},v.value))])]}}),(0,_vue.createVNode)(adherev_ui_flexlayout_1.default.Auto,{class:"".concat(selectorPrefix,"-content-wrap")},{default:function(){return[null==(t=(null==c?void 0:c.renderContent)||(null==u?void 0:u.renderContent))?void 0:t(tslib_1.__assign({},v.value))]}}),(0,_vue.createVNode)(adherev_ui_flexlayout_1.default.Fixed,null,{default:function(){return[(0,_vue.createVNode)("ul",{class:"".concat(selectorPrefix,"-actions")},[((l=(null==(l=null==(e=null==(e=(null==c?void 0:c.renderActions)||u.renderActions)?void 0:e({record:tslib_1.__assign({},v.value),callback:function(e){v.value=e}}))?void 0:e.map)?void 0:l.call(e,function(e,l){var t,n;return adherev_ui_conditionalrender_1.default.conditionalRender({conditional:!(null!=(n=null==(t=null==(t=null==e?void 0:e.props)?void 0:t.class)?void 0:t.endsWith)&&n.call(t,"-actions-action")),noMatch:e,match:(0,_vue.createVNode)("li",{key:l,class:"".concat(selectorPrefix,"-actions-action")},[e])})}))||[]).find(function(e){return"reply"===(null==e?void 0:e.key)})||l.push((0,_vue.createVNode)("li",{key:"reply",class:(0,classnames_1.default)("".concat(selectorPrefix,"-actions-action"),"".concat(selectorPrefix,"-actions-action-reply-btn")),onClick:function(){return p.value=!0}},[adherev_util_intl_1.default.tv("回复")])),l)])];var e,l}}),(0,_vue.createVNode)(adherev_ui_conditionalrender_1.default,{conditional:p.value},{default:function(){return[(0,_vue.createVNode)(adherev_ui_flexlayout_1.default.Fixed,{style:"margin-top:15px;"},{default:function(){return[(0,_vue.createVNode)(Submit_1.default,{onCancel:function(){return p.value=!1},onResult:function(e){var l;null!=(l=null==(l=u.fetchReply)?void 0:l.call(u,{id:null==(l=v.value)?void 0:l[u.keyProp],record:tslib_1.__assign({},v.value),reply:e}))&&l.then(function(){p.value=!1,i()})},local:u.local,emojiPickerProps:u.emojiPickerProps},null)]}})]}}),(0,_vue.createVNode)(adherev_ui_conditionalrender_1.default,{conditional:null==(n=v.value)?void 0:n[u.isMoreProp]},{default:function(){return[(0,_vue.createVNode)("div",null,[(0,_vue.createVNode)(adherev_ui_conditionalrender_1.default,{conditional:!f.value},_isSlot(r=(0,_vue.createVNode)(adherev_ui_conditionalrender_1.default,{conditional:!_.value},{default:function(){var e;return(0,_vue.createVNode)("a",{class:"".concat(selectorPrefix,"-collapse"),onClick:function(){var e;s.value[u.dataKeys.list].length?_.value=!0:null!=(e=i())&&e.then(function(){return _.value=!0})}},[(0,_vue.createVNode)("span",null,[(null==(e=c.showReplyTextIcon)?void 0:e.call(c))||u.showReplyTextIcon]),(0,_vue.createVNode)("span",null,[(null==(e=c.showReplyText)?void 0:e.call(c))||u.showReplyText])])},noMatch:function(){var e;return(0,_vue.createVNode)("a",{class:"".concat(selectorPrefix,"-collapse"),onClick:function(){return _.value=!1}},[(0,_vue.createVNode)("span",null,[(null==(e=c.hideReplyTextIcon)?void 0:e.call(c))||u.hideReplyTextIcon]),(0,_vue.createVNode)("span",null,[(null==(e=c.hideReplyText)?void 0:e.call(c))||u.hideReplyText])])}}))?r:{default:function(){return[r]}}),(0,_vue.createVNode)(adherev_ui_conditionalrender_1.default.Show,{conditional:_.value},_isSlot((n={renderActions:function(e){var l;return(null==(l=null==c?void 0:c.renderActions)?void 0:l.call(c,e))||(null==(l=null==u?void 0:u.renderActions)?void 0:l.call(u,e))},renderAuthor:function(e){var l;return(null==(l=null==c?void 0:c.renderAuthor)?void 0:l.call(c,e))||(null==(l=null==u?void 0:u.renderAuthor)?void 0:l.call(u,e))},renderAvatar:function(e){var l;return(null==(l=null==c?void 0:c.renderAvatar)?void 0:l.call(c,e))||(null==(l=null==u?void 0:u.renderAvatar)?void 0:l.call(u,e))},renderContent:function(e){var l;return(null==(l=null==c?void 0:c.renderContent)?void 0:l.call(c,e))||(null==(l=null==u?void 0:u.renderContent)?void 0:l.call(u,e))},renderDateTime:function(e){var l;return(null==(l=null==c?void 0:c.renderDateTime)?void 0:l.call(c,e))||(null==(l=null==u?void 0:u.renderDateTime)?void 0:l.call(u,e))},renderLoading:function(){var e;return(0,_vue.createVNode)("div",null,[(null==(e=c.renderLoading)?void 0:e.call(c))||u.renderLoading])},showReplyText:function(){var e;return(null==(e=c.showReplyText)?void 0:e.call(c))||u.showReplyText},hideReplyText:function(){var e;return(null==(e=c.hideReplyText)?void 0:e.call(c))||u.hideReplyText},loadMoreReplyText:function(){var e;return(null==(e=c.loadMoreReplyText)?void 0:e.call(c))||u.loadMoreReplyText},showReplyTextIcon:function(){var e;return(null==(e=c.showReplyTextIcon)?void 0:e.call(c))||u.showReplyTextIcon},hideReplyTextIcon:function(){var e;return(null==(e=c.hideReplyTextIcon)?void 0:e.call(c))||u.hideReplyTextIcon},loadMoreCollapseTextIcon:function(){var e;return(null==(e=c.loadMoreCollapseTextIcon)?void 0:e.call(c))||u.loadMoreCollapseTextIcon}},o=(0,_vue.createVNode)("ul",{class:"".concat(selectorPrefix,"-children")},[null==(l=null===(e=s.value[u.dataKeys.list]||[])?void 0:e.map)?void 0:l.call(e,function(l){return(0,_vue.createVNode)("li",{class:"".concat(selectorPrefix,"-children-item"),key:l[u.keyProp],id:l[u.keyProp]},[(0,_vue.createVNode)(adherev_ui_conditionalrender_1.default,{conditional:!(null!=c&&c.default)},{default:function(){return(0,_vue.createVNode)(Info_1.default,{comId:l[u.keyProp],isReply:!0,defaultData:l,dataKeys:u.dataKeys,limit:u.limit,keyProp:u.keyProp,isMoreProp:u.isMoreProp,fetchData:u.fetchData,fetchReply:u.fetchReply,local:u.local,emojiPickerProps:u.emojiPickerProps},_isSlot(n)?n:{default:function(){return[n]}})},noMatch:function(){var e;return null==(e=null==c?void 0:c.default)?void 0:e.call(c,l)}})])}),(0,_vue.createVNode)(adherev_ui_conditionalrender_1.default,{conditional:!f.value&&y.value},{default:function(){return[(0,_vue.createVNode)("li",{class:(0,classnames_1.default)("".concat(selectorPrefix,"-children-item"),"more")},[(0,_vue.createVNode)("a",{onClick:d},[(0,_vue.createVNode)("span",null,[(null==(t=c.loadMoreCollapseTextIcon)?void 0:t.call(c))||u.loadMoreCollapseTextIcon]),(0,_vue.createVNode)("span",null,[(null==(t=c.loadMoreReplyText)?void 0:t.call(c))||u.loadMoreReplyText])])])]}})])))?o:{default:function(){return[o]}}),(0,_vue.createVNode)(adherev_ui_conditionalrender_1.default,{conditional:f.value},{default:function(){return[(null==(a=c.renderLoading)?void 0:a.call(c))||u.renderLoading]}})])];var e,l,t,n}})]}})]}})]}})}}});
//# sourceMappingURL=index.js.map
