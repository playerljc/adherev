"use strict";var _vue=require("vue");function _isSlot(e){return"function"==typeof e||"[object Object]"===Object.prototype.toString.call(e)&&!(0,_vue.isVNode)(e)}require("core-js/modules/es.object.define-property.js"),require("core-js/modules/es.array.map.js"),require("core-js/modules/es.string.ends-with.js"),require("core-js/modules/es.array.find.js"),require("core-js/modules/es.object.to-string.js"),Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib"),classnames_1=tslib_1.__importDefault(require("classnames")),vue_1=require("vue"),vue_types_1=require("vue-types"),adherev_ui_conditionalrender_1=tslib_1.__importDefault(require("@baifendian/adherev-ui-conditionalrender")),adherev_ui_flexlayout_1=tslib_1.__importDefault(require("@baifendian/adherev-ui-flexlayout")),adherev_util_intl_1=tslib_1.__importDefault(require("@baifendian/adherev-util-intl")),Info_1=tslib_1.__importDefault(require("../../Reply/Info")),Submit_1=tslib_1.__importDefault(require("../../Reply/Submit")),selectorPrefix="adherev-ui-comment-node",props={isReply:(0,vue_types_1.bool)().def(!1),defaultData:(0,vue_types_1.object)().def({}),dataKeys:(0,vue_types_1.object)().def({current:"current",totalPage:"totalPage",list:"list",totalCount:"totalCount"}),limit:(0,vue_types_1.number)().def(10),fetchData:(0,vue_types_1.func)(),fetchReply:(0,vue_types_1.func)(),keyProp:(0,vue_types_1.string)().def(""),isMoreProp:(0,vue_types_1.string)().def(""),local:(0,vue_types_1.string)().def("zh"),emojiPickerProps:(0,vue_types_1.object)().def({}),comId:(0,vue_types_1.oneOfType)([(0,vue_types_1.string)(),(0,vue_types_1.number)()]).def(""),renderLoading:(0,vue_types_1.object)(),loadMoreCollapseTextIcon:(0,vue_types_1.object)(),loadMoreReplyText:(0,vue_types_1.object)(),showReplyTextIcon:(0,vue_types_1.object)(),showReplyText:(0,vue_types_1.object)(),hideReplyTextIcon:(0,vue_types_1.object)(),hideReplyText:(0,vue_types_1.object)(),renderActions:(0,vue_types_1.func)(),renderAuthor:(0,vue_types_1.func)(),renderAvatar:(0,vue_types_1.func)(),renderContent:(0,vue_types_1.func)(),renderDateTime:(0,vue_types_1.func)()};exports.default=(0,vue_1.defineComponent)({name:"adv-comment-reply-node",slots:["renderLoading","loadMoreCollapseTextIcon","loadMoreReplyText","showReplyTextIcon","showReplyText","hideReplyTextIcon","hideReplyText","renderActions","renderAuthor","renderAvatar","renderContent","renderDateTime"],props:props,setup:function(a,e){function u(){var e;return v.value=!0,l={page:1,limit:a.limit},null==(e=null==t?void 0:t())?void 0:e.then(function(e){c.value=e})}function i(){var e;return v.value=!0,l.page=l.page+1,null==(e=null==t?void 0:t())?void 0:e.then(function(e){var l;c.value=tslib_1.__assign(tslib_1.__assign({},e),((l={})[a.dataKeys.list]=tslib_1.__spreadArray(tslib_1.__spreadArray([],c.value[a.dataKeys.list],!0),e[a.dataKeys.list],!0),l))})}var d=e.slots,c=(0,vue_1.ref)(((e={})[a.dataKeys.current]=1,e[a.dataKeys.list]=[],e[a.dataKeys.totalCount]=0,e[a.dataKeys.totalPage]=0,e)),r=(0,vue_1.ref)(a.defaultData),s=(0,vue_1.ref)(!1),v=(0,vue_1.ref)(!1),o=(0,vue_1.ref)(!1),l={page:1,limit:a.limit},t=function(){var e;return null==(e=null==(e=null==(e=null==a?void 0:a.fetchData)?void 0:e.call(a,tslib_1.__assign(tslib_1.__assign({},l),{record:tslib_1.__assign({},r.value)})))?void 0:e.then(function(e){return v.value=!1,e}))?void 0:e.catch(function(e){return v.value=!1,e})},_=(0,vue_1.computed)(function(){return c.value[a.dataKeys.list].length<=c.value[a.dataKeys.totalCount]});return(0,vue_1.watch)(function(){return a.defaultData},function(e){return r.value=e}),function(){var e,l,t,n;return(0,_vue.createVNode)(adherev_ui_flexlayout_1.default,{direction:"horizontal",class:(0,classnames_1.default)(selectorPrefix,a.isReply?"".concat(selectorPrefix,"-reply"):"")},{default:function(){return[(0,_vue.createVNode)(adherev_ui_flexlayout_1.default.Fixed,{class:"".concat(selectorPrefix,"-avatar-wrap")},{default:function(){return[null==(e=(null==d?void 0:d.renderAvatar)||(null==a?void 0:a.renderAvatar))?void 0:e(tslib_1.__assign({},r.value))]}}),(0,_vue.createVNode)(adherev_ui_flexlayout_1.default.Auto,{autoFixed:!0,fit:!0},{default:function(){return[(0,_vue.createVNode)(adherev_ui_flexlayout_1.default,{direction:"vertical"},{default:function(){return[(0,_vue.createVNode)(adherev_ui_flexlayout_1.default.Fixed,{class:"".concat(selectorPrefix,"-title-row"),fit:!1},{default:function(){return[(0,_vue.createVNode)("div",{class:"".concat(selectorPrefix,"-title-row-author")},[null==(l=(null==d?void 0:d.renderAuthor)||(null==a?void 0:a.renderAuthor))?void 0:l(tslib_1.__assign({},r.value))]),(0,_vue.createVNode)("div",{class:"".concat(selectorPrefix,"-title-row-date-time")},[null==(l=(null==d?void 0:d.renderDateTime)||(null==a?void 0:a.renderDateTime))?void 0:l(tslib_1.__assign({},r.value))])]}}),(0,_vue.createVNode)(adherev_ui_flexlayout_1.default.Auto,{class:"".concat(selectorPrefix,"-content-wrap")},{default:function(){return[null==(t=(null==d?void 0:d.renderContent)||(null==a?void 0:a.renderContent))?void 0:t(tslib_1.__assign({},r.value))]}}),(0,_vue.createVNode)(adherev_ui_flexlayout_1.default.Fixed,null,{default:function(){return[(0,_vue.createVNode)("ul",{class:"".concat(selectorPrefix,"-actions")},[((l=(null==(l=null==(e=null==(e=(null==d?void 0:d.renderActions)||a.renderActions)?void 0:e({record:tslib_1.__assign({},r.value),callback:function(e){r.value=e}}))?void 0:e.map)?void 0:l.call(e,function(e,l){var t,n;return adherev_ui_conditionalrender_1.default.conditionalRender({conditional:!(null!=(n=null==(t=null==(t=null==e?void 0:e.props)?void 0:t.class)?void 0:t.endsWith)&&n.call(t,"-actions-action")),noMatch:e,match:(0,_vue.createVNode)("li",{key:l,class:"".concat(selectorPrefix,"-actions-action")},[e])})}))||[]).find(function(e){return"reply"===(null==e?void 0:e.key)})||l.push((0,_vue.createVNode)("li",{key:"reply",class:(0,classnames_1.default)("".concat(selectorPrefix,"-actions-action"),"".concat(selectorPrefix,"-actions-action-reply-btn")),onClick:function(){return o.value=!0}},[adherev_util_intl_1.default.tv("回复")])),l)])];var e,l}}),(0,_vue.createVNode)(adherev_ui_conditionalrender_1.default,{conditional:o.value},{default:function(){return(0,_vue.createVNode)(adherev_ui_flexlayout_1.default.Fixed,{style:"margin-top:15px;"},{default:function(){return[(0,_vue.createVNode)(Submit_1.default,{onCancel:function(){return o.value=!1},onResult:function(e){var l;null!=(l=null==(l=a.fetchReply)?void 0:l.call(a,{id:null==(l=r.value)?void 0:l[a.keyProp],record:tslib_1.__assign({},r.value),reply:e}))&&l.then(function(){o.value=!1,u()})},local:a.local,emojiPickerProps:a.emojiPickerProps},null)]}})}}),(0,_vue.createVNode)(adherev_ui_conditionalrender_1.default,{conditional:null==(n=r.value)?void 0:n[a.isMoreProp]},{default:function(){var e,l,t,n,r,o;return(0,_vue.createVNode)(_vue.Fragment,null,[(0,_vue.createVNode)(adherev_ui_conditionalrender_1.default,{conditional:!v.value},_isSlot(e=(0,_vue.createVNode)(adherev_ui_conditionalrender_1.default,{conditional:!s.value},{default:function(){var e;return(0,_vue.createVNode)("a",{class:"".concat(selectorPrefix,"-collapse"),onClick:function(){var e;c.value[a.dataKeys.list].length?s.value=!0:null!=(e=u())&&e.then(function(){return s.value=!0})}},[(0,_vue.createVNode)("span",null,[(null==(e=d.showReplyTextIcon)?void 0:e.call(d))||a.showReplyTextIcon]),(0,_vue.createVNode)("span",null,[(null==(e=d.showReplyText)?void 0:e.call(d))||a.showReplyText])])},noMatch:function(){var e;return(0,_vue.createVNode)("a",{class:"".concat(selectorPrefix,"-collapse"),onClick:function(){return s.value=!1}},[(0,_vue.createVNode)("span",null,[(null==(e=d.hideReplyTextIcon)?void 0:e.call(d))||a.hideReplyTextIcon]),(0,_vue.createVNode)("span",null,[(null==(e=d.hideReplyText)?void 0:e.call(d))||a.hideReplyText])])}}))?e:{default:function(){return[e]}}),(0,_vue.createVNode)(adherev_ui_conditionalrender_1.default.Show,{conditional:s.value},_isSlot((o={renderActions:function(e){var l;return(null==(l=null==d?void 0:d.renderActions)?void 0:l.call(d,e))||(null==(l=null==a?void 0:a.renderActions)?void 0:l.call(a,e))},renderAuthor:function(e){var l;return(null==(l=null==d?void 0:d.renderAuthor)?void 0:l.call(d,e))||(null==(l=null==a?void 0:a.renderAuthor)?void 0:l.call(a,e))},renderAvatar:function(e){var l;return(null==(l=null==d?void 0:d.renderAvatar)?void 0:l.call(d,e))||(null==(l=null==a?void 0:a.renderAvatar)?void 0:l.call(a,e))},renderContent:function(e){var l;return(null==(l=null==d?void 0:d.renderContent)?void 0:l.call(d,e))||(null==(l=null==a?void 0:a.renderContent)?void 0:l.call(a,e))},renderDateTime:function(e){var l;return(null==(l=null==d?void 0:d.renderDateTime)?void 0:l.call(d,e))||(null==(l=null==a?void 0:a.renderDateTime)?void 0:l.call(a,e))},renderLoading:function(){var e;null!=(e=d.renderLoading)&&e.call(d)||a.renderLoading},showReplyText:function(){var e;return(null==(e=d.showReplyText)?void 0:e.call(d))||a.showReplyText},hideReplyText:function(){var e;return(null==(e=d.hideReplyText)?void 0:e.call(d))||a.hideReplyText},loadMoreReplyText:function(){var e;return(null==(e=d.loadMoreReplyText)?void 0:e.call(d))||a.loadMoreReplyText},showReplyTextIcon:function(){var e;return(null==(e=d.showReplyTextIcon)?void 0:e.call(d))||a.showReplyTextIcon},hideReplyTextIcon:function(){var e;return(null==(e=d.hideReplyTextIcon)?void 0:e.call(d))||a.hideReplyTextIcon},loadMoreCollapseTextIcon:function(){var e;return(null==(e=d.loadMoreCollapseTextIcon)?void 0:e.call(d))||a.loadMoreCollapseTextIcon}},l=(0,_vue.createVNode)("ul",{class:"".concat(selectorPrefix,"-children")},[null==(r=null===(n=c.value[a.dataKeys.list]||[])?void 0:n.map)?void 0:r.call(n,function(l){return(0,_vue.createVNode)("li",{class:"".concat(selectorPrefix,"-children-item"),key:l[a.keyProp],id:l[a.keyProp]},[(0,_vue.createVNode)(adherev_ui_conditionalrender_1.default,{conditional:!(null!=d&&d.default)},{default:function(){return(0,_vue.createVNode)(Info_1.default,{comId:l[a.keyProp],isReply:!0,defaultData:l,dataKeys:a.dataKeys,limit:a.limit,keyProp:a.keyProp,isMoreProp:a.isMoreProp,fetchData:a.fetchData,fetchReply:a.fetchReply,local:a.local,emojiPickerProps:a.emojiPickerProps},_isSlot(o)?o:{default:function(){return[o]}})},noMatch:function(){var e;return null==(e=null==d?void 0:d.default)?void 0:e.call(d,l)}})])}),(0,_vue.createVNode)(adherev_ui_conditionalrender_1.default,{conditional:!v.value&&_.value},{default:function(){var e;return(0,_vue.createVNode)("li",{class:(0,classnames_1.default)("".concat(selectorPrefix,"-children-item"),"more")},[(0,_vue.createVNode)("a",{onClick:i},[(0,_vue.createVNode)("span",null,[(null==(e=d.loadMoreCollapseTextIcon)?void 0:e.call(d))||a.loadMoreCollapseTextIcon]),(0,_vue.createVNode)("span",null,[(null==(e=d.loadMoreReplyText)?void 0:e.call(d))||a.loadMoreReplyText])])])}})])))?l:{default:function(){return[l]}}),(0,_vue.createVNode)(adherev_ui_conditionalrender_1.default,{conditional:v.value},{default:function(){return[(null==(t=d.renderLoading)?void 0:t.call(d))||a.renderLoading]}})])}})]}})]}})]}})}}});
//# sourceMappingURL=index.js.map
