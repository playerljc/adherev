"use strict";require("core-js/modules/es.object.define-property.js"),require("core-js/modules/es.number.constructor.js"),require("core-js/modules/es.array.map.js"),require("core-js/modules/es.string.ends-with.js"),require("core-js/modules/es.array.find.js"),require("core-js/modules/es.object.to-string.js"),Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib"),classnames_1=tslib_1.__importDefault(require("classnames")),vue_fragment_1=require("vue-fragment"),adherev_ui_conditionalrender_1=tslib_1.__importDefault(require("@baifendian/adherev-ui-conditionalrender")),adherev_ui_flexlayout_1=tslib_1.__importDefault(require("@baifendian/adherev-ui-flexlayout")),adherev_util_intl_1=tslib_1.__importDefault(require("@baifendian/adherev-util-intl")),Info_1=tslib_1.__importDefault(require("../../Reply/Info")),Submit_1=tslib_1.__importDefault(require("../../Reply/Submit")),selectorPrefix="adherev-ui-comment-node",Node={name:"adv-comment-reply-node",props:{isReply:{type:Boolean,default:!1},defaultData:{type:Object,default:function(){return{}}},dataKeys:{type:Object,default:function(){return{current:"current",totalPage:"totalPage",list:"list",totalCount:"totalCount"}}},limit:{type:Number,default:10},fetchData:{type:Function},fetchReply:{type:Function},keyProp:{type:String,default:""},isMoreProp:{type:String,default:""},local:{type:String,default:"zh"},emojiPickerProps:{type:Object,default:function(){return{}}},comId:{type:[String,Number],default:""}},scopedSlots:["renderActions","renderAuthor","renderAvatar","renderContent","renderDateTime"],slots:["renderLoading","loadMoreCollapseTextIcon","loadMoreReplyText","showReplyTextIcon","showReplyText","hideReplyTextIcon","hideReplyText"],data:function(){var e;return{listData:((e={})[this.dataKeys.current]=1,e[this.dataKeys.list]=[],e[this.dataKeys.totalCount]=0,e[this.dataKeys.totalPage]=0,e),data:this.defaultData,collapse:!1,loading:!1,showReply:!1,$paging:{page:1,limit:this.limit}}},watch:{defaultData:function(e){this.data=e}},computed:{hasMore:function(){return this.listData[this.dataKeys.list].length<=this.listData[this.dataKeys.totalCount]}},methods:{$renderActions:function(l){var e,t=this,i=(null===(i=null===(e=null===(i=this.$scopedSlots)||void 0===i?void 0:i.renderActions)||void 0===e?void 0:e.call(i,{record:tslib_1.__assign({},this.data),callback:function(e){t.data=e}}))||void 0===i?void 0:i.map(function(e,t){var i,a;return adherev_ui_conditionalrender_1.default.conditionalRender({conditional:!(null!==(a=null===(i=null===(a=null==e?void 0:e.data)||void 0===a?void 0:a.class)||void 0===i?void 0:i.endsWith)&&void 0!==a&&a.call(i,"-actions-action")),noMatch:e,match:l("li",{key:t,class:selectorPrefix+"-actions-action"},[e])})}))||[];return i.find(function(e){return"reply"===(null==e?void 0:e.key)})||i.push(l("li",{key:"reply",class:classnames_1.default(selectorPrefix+"-actions-action",selectorPrefix+"-actions-action-reply-btn"),on:{click:function(){return t.showReply=!0}}},[adherev_util_intl_1.default.v("回复")])),i},$renderChildren:function(a){var e,t,l=this,o={renderActions:function(e){return l.$scopedSlots.renderActions(e)},renderAuthor:function(e){return l.$scopedSlots.renderAuthor(e)},renderAvatar:function(e){return l.$scopedSlots.renderAvatar(e)},renderContent:function(e){return l.$scopedSlots.renderContent(e)},renderDateTime:function(e){return l.$scopedSlots.renderDateTime(e)}};return a("ul",{class:selectorPrefix+"-children"},[null===(t=null===(e=this.listData[this.dataKeys.list]||[])?void 0:e.map)||void 0===t?void 0:t.call(e,function(e){var t,i;return a("li",{class:selectorPrefix+"-children-item",key:e[l.keyProp],attrs:{id:e[l.keyProp]}},[a(adherev_ui_conditionalrender_1.default,{attrs:{conditional:!(null!==(i=null==l?void 0:l.$scopedSlots)&&void 0!==i&&i.default)}},[a(Info_1.default,{attrs:{comId:e[l.keyProp],isReply:!0,defaultData:e,dataKeys:l.dataKeys,limit:l.limit,keyProp:l.keyProp,isMoreProp:l.isMoreProp,fetchData:l.fetchData,fetchReply:l.fetchReply,local:l.local,emojiPickerProps:l.emojiPickerProps},scopedSlots:o},[a("div",{slot:"renderLoading"},[l.$slots.renderLoading]),a(vue_fragment_1.Fragment,{slot:"showReplyText"},[l.$slots.showReplyText]),a(vue_fragment_1.Fragment,{slot:"hideReplyText"},[l.$slots.hideReplyText]),a(vue_fragment_1.Fragment,{slot:"loadMoreReplyText"},[l.$slots.loadMoreReplyText]),a(vue_fragment_1.Fragment,{slot:"showReplyTextIcon"},[l.$slots.showReplyTextIcon]),a(vue_fragment_1.Fragment,{slot:"hideReplyTextIcon"},[l.$slots.hideReplyTextIcon]),a(vue_fragment_1.Fragment,{slot:"loadMoreCollapseTextIcon"},[l.$slots.loadMoreCollapseTextIcon])]),a(vue_fragment_1.Fragment,{slot:"noMatch"},[null===(i=null===(t=null==l?void 0:l.$scopedSlots)||void 0===t?void 0:t.default)||void 0===i?void 0:i.call(t,e)])])])}),a(adherev_ui_conditionalrender_1.default,{attrs:{conditional:!this.loading&&this.hasMore}},[a("li",{class:classnames_1.default(selectorPrefix+"-children-item","more")},[a("a",{on:{click:this.$appendData}},[a("span",[this.$slots.loadMoreCollapseTextIcon]),a("span",[this.$slots.loadMoreReplyText])])])])])},$renderMore:function(e){var t=this;return e(adherev_ui_conditionalrender_1.default,{attrs:{conditional:!this.collapse}},[e("a",{class:selectorPrefix+"-collapse",on:{click:function(){var e;t.listData[t.dataKeys.list].length?t.collapse=!0:(console.log("renderMore加载回复","comId:"+t.comId),null!==(e=t.$loadData())&&void 0!==e&&e.then(function(){return t.collapse=!0}))}}},[e("span",[this.$slots.showReplyTextIcon]),e("span",[this.$slots.showReplyText])]),e("a",{slot:"noMatch",class:selectorPrefix+"-collapse",on:{click:function(){return t.collapse=!1}}},[e("span",[this.$slots.hideReplyTextIcon]),e("span",[this.$slots.hideReplyText])])])},$loadData:function(){var t=this;return this.loading=!0,this.$data.$paging={page:1,limit:this.limit},console.log("$loadData","comId:"+this.comId),this.$fetchData().then(function(e){t.listData=e})},$appendData:function(){var i=this;this.loading=!0,this.$data.$paging.page=this.$data.$paging.page+1;var a=this.dataKeys.list;return this.$fetchData().then(function(e){var t;i.listData=tslib_1.__assign(tslib_1.__assign({},e),((t={})[i.dataKeys.list]=tslib_1.__spreadArrays(i.listData[a],e[a]),t))})},$fetchData:function(){var e,t=this;return null===(e=null===(e=null===(e=null==this?void 0:this.fetchData)||void 0===e?void 0:e.call(this,tslib_1.__assign(tslib_1.__assign({},this.$data.$paging),{record:tslib_1.__assign({},this.data)})))||void 0===e?void 0:e.then(function(e){return t.loading=!1,e}))||void 0===e?void 0:e.catch(function(e){return t.loading=!1,e})}},render:function(e){var t,i,a=this;return e(adherev_ui_flexlayout_1.default,{attrs:{direction:"horizontal"},class:classnames_1.default(selectorPrefix,this.isReply?selectorPrefix+"-reply":"")},[e(adherev_ui_flexlayout_1.default.Fixed,{class:selectorPrefix+"-avatar-wrap"},[null===(i=null===(t=this.$scopedSlots)||void 0===t?void 0:t.renderAvatar)||void 0===i?void 0:i.call(t,tslib_1.__assign({},this.data))]),e(adherev_ui_flexlayout_1.default.Auto,{attrs:{autoFixed:!0,fit:!0}},[e(adherev_ui_flexlayout_1.default,{attrs:{direction:"vertical"}},[e(adherev_ui_flexlayout_1.default.Fixed,{class:selectorPrefix+"-title-row",attrs:{fit:!1}},[e("div",{class:selectorPrefix+"-title-row-author"},[null===(t=null===(i=this.$scopedSlots)||void 0===i?void 0:i.renderAuthor)||void 0===t?void 0:t.call(i,tslib_1.__assign({},this.data))]),e("div",{class:selectorPrefix+"-title-row-date-time"},[null===(i=null===(t=this.$scopedSlots)||void 0===t?void 0:t.renderDateTime)||void 0===i?void 0:i.call(t,tslib_1.__assign({},this.data))])]),e(adherev_ui_flexlayout_1.default.Auto,{class:selectorPrefix+"-content-wrap"},[null===(t=null===(i=this.$scopedSlots)||void 0===i?void 0:i.renderContent)||void 0===t?void 0:t.call(i,tslib_1.__assign({},this.data))]),e(adherev_ui_flexlayout_1.default.Fixed,[e("ul",{class:selectorPrefix+"-actions"},[this.$renderActions(e)])]),e(adherev_ui_conditionalrender_1.default,{attrs:{conditional:this.showReply}},[e(adherev_ui_flexlayout_1.default.Fixed,{style:"margin-top:15px;"},[e(Submit_1.default,{on:{cancel:function(){return a.showReply=!1},result:function(e){var t;null!==(e=null===(t=a.fetchReply)||void 0===t?void 0:t.call(a,{id:null===(t=a.data)||void 0===t?void 0:t[a.keyProp],record:tslib_1.__assign({},a.data),reply:e}))&&void 0!==e&&e.then(function(){a.showReply=!1,a.$loadData()})}},attrs:{local:this.local,emojiPickerProps:this.emojiPickerProps}})])]),e(adherev_ui_conditionalrender_1.default,{attrs:{conditional:null===(i=this.data)||void 0===i?void 0:i[this.isMoreProp]}},[e("div",[e(adherev_ui_conditionalrender_1.default,{attrs:{conditional:!this.loading}},[this.$renderMore(e)]),e(adherev_ui_conditionalrender_1.default.Show,{attrs:{conditional:this.collapse}},[this.$renderChildren(e)]),e(adherev_ui_conditionalrender_1.default,{attrs:{conditional:this.loading}},[this.$slots.renderLoading])])])])])])}};exports.default=Node;
//# sourceMappingURL=index.js.map
