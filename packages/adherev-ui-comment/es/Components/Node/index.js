import"core-js/modules/es.number.constructor.js";import"core-js/modules/es.array.map.js";import"core-js/modules/es.string.ends-with.js";import"core-js/modules/es.array.find.js";import"core-js/modules/es.object.to-string.js";import{__assign,__spreadArray}from"tslib";import classNames from"classnames";import{Fragment}from"vue-fragment";import ConditionalRender from"@baifendian/adherev-ui-conditionalrender";import FlexLayout from"@baifendian/adherev-ui-flexlayout";import Intl from"@baifendian/adherev-util-intl";import ReplyInfo from"../../Reply/Info";import ReplySubmit from"../../Reply/Submit";var selectorPrefix="adherev-ui-comment-node",Node={name:"adv-comment-reply-node",props:{isReply:{type:Boolean,default:!1},defaultData:{type:Object,default:function(){return{}}},dataKeys:{type:Object,default:function(){return{current:"current",totalPage:"totalPage",list:"list",totalCount:"totalCount"}}},limit:{type:Number,default:10},fetchData:{type:Function},fetchReply:{type:Function},keyProp:{type:String,default:""},isMoreProp:{type:String,default:""},local:{type:String,default:"zh"},emojiPickerProps:{type:Object,default:function(){return{}}},comId:{type:[String,Number],default:""},renderLoading:{type:Object,default:function(){return null}},loadMoreCollapseTextIcon:{type:Object,default:function(){return null}},loadMoreReplyText:{type:Object,default:function(){return null}},showReplyTextIcon:{type:Object,default:function(){return null}},showReplyText:{type:Object,default:function(){return null}},hideReplyTextIcon:{type:Object,default:function(){return null}},hideReplyText:{type:Object,default:function(){return null}},renderActions:{type:Function,default:function(){return null}},renderAuthor:{type:Function,default:function(){return null}},renderAvatar:{type:Function,default:function(){return null}},renderContent:{type:Function,default:function(){return null}},renderDateTime:{type:Function,default:function(){return null}}},scopedSlots:["renderActions","renderAuthor","renderAvatar","renderContent","renderDateTime"],slots:["renderLoading","loadMoreCollapseTextIcon","loadMoreReplyText","showReplyTextIcon","showReplyText","hideReplyTextIcon","hideReplyText"],data:function(){var t;return{listData:((t={})[this.dataKeys.current]=1,t[this.dataKeys.list]=[],t[this.dataKeys.totalCount]=0,t[this.dataKeys.totalPage]=0,t),data:this.defaultData,collapse:!1,loading:!1,showReply:!1,$paging:{page:1,limit:this.limit}}},watch:{defaultData:function(t){this.data=t}},computed:{hasMore:function(){return this.listData[this.dataKeys.list].length<=this.listData[this.dataKeys.totalCount]}},methods:{$renderActions:function(l){var e=this,t=(null==(t=null==(t=(null==(t=this.$scopedSlots)?void 0:t.renderActions)||this.renderActions)?void 0:t({record:__assign({},this.data),callback:function(t){e.data=t}}))?void 0:t.map(function(t,e){var n,o;return ConditionalRender.conditionalRender({conditional:!(null!=(o=null==(n=null==(n=null==t?void 0:t.data)?void 0:n.class)?void 0:n.endsWith)&&o.call(n,"-actions-action")),noMatch:t,match:l("li",{key:e,class:"".concat(selectorPrefix,"-actions-action")},[t])})}))||[];return t.find(function(t){return"reply"===(null==t?void 0:t.key)})||t.push(l("li",{key:"reply",class:classNames("".concat(selectorPrefix,"-actions-action"),"".concat(selectorPrefix,"-actions-action-reply-btn")),on:{click:function(){return e.showReply=!0}}},[Intl.tv("回复")])),t},$renderChildren:function(o){var t,e,l=this,i={renderActions:function(t){var e,n;return(null==(n=null==(e=l.$scopedSlots)?void 0:e.renderActions)?void 0:n.call(e,t))||(null==(n=null==l?void 0:l.renderActions)?void 0:n.call(l,t))},renderAuthor:function(t){var e,n;return(null==(n=null==(e=l.$scopedSlots)?void 0:e.renderAuthor)?void 0:n.call(e,t))||(null==(n=null==l?void 0:l.renderAuthor)?void 0:n.call(l,t))},renderAvatar:function(t){var e,n;return(null==(n=null==(e=l.$scopedSlots)?void 0:e.renderAvatar)?void 0:n.call(e,t))||(null==(n=null==l?void 0:l.renderAvatar)?void 0:n.call(l,t))},renderContent:function(t){var e,n;return(null==(n=null==(e=l.$scopedSlots)?void 0:e.renderContent)?void 0:n.call(e,t))||(null==(n=null==l?void 0:l.renderContent)?void 0:n.call(l,t))},renderDateTime:function(t){var e,n;return(null==(n=null==(e=l.$scopedSlots)?void 0:e.renderDateTime)?void 0:n.call(e,t))||(null==(n=null==l?void 0:l.renderDateTime)?void 0:n.call(l,t))}};return o("ul",{class:"".concat(selectorPrefix,"-children")},[null==(e=null===(t=this.listData[this.dataKeys.list]||[])?void 0:t.map)?void 0:e.call(t,function(t){var e,n;return o("li",{class:"".concat(selectorPrefix,"-children-item"),key:t[l.keyProp],attrs:{id:t[l.keyProp]}},[o(ConditionalRender,{attrs:{conditional:!(null!=(e=null==l?void 0:l.$scopedSlots)&&e.default)}},[o(ReplyInfo,{attrs:{comId:t[l.keyProp],isReply:!0,defaultData:t,dataKeys:l.dataKeys,limit:l.limit,keyProp:l.keyProp,isMoreProp:l.isMoreProp,fetchData:l.fetchData,fetchReply:l.fetchReply,local:l.local,emojiPickerProps:l.emojiPickerProps},scopedSlots:i},[o("div",{slot:"renderLoading"},[l.$slots.renderLoading||l.renderLoading]),o(Fragment,{slot:"showReplyText"},[l.$slots.showReplyText||l.showReplyText]),o(Fragment,{slot:"hideReplyText"},[l.$slots.hideReplyText||l.hideReplyText]),o(Fragment,{slot:"loadMoreReplyText"},[l.$slots.loadMoreReplyText||l.loadMoreReplyText]),o(Fragment,{slot:"showReplyTextIcon"},[l.$slots.showReplyTextIcon||l.showReplyTextIcon]),o(Fragment,{slot:"hideReplyTextIcon"},[l.$slots.hideReplyTextIcon||l.hideReplyTextIcon]),o(Fragment,{slot:"loadMoreCollapseTextIcon"},[l.$slots.loadMoreCollapseTextIcon||l.loadMoreCollapseTextIcon])]),o(Fragment,{slot:"noMatch"},[null==(n=null==(e=null==l?void 0:l.$scopedSlots)?void 0:e.default)?void 0:n.call(e,t)])])])}),o(ConditionalRender,{attrs:{conditional:!this.loading&&this.hasMore}},[o("li",{class:classNames("".concat(selectorPrefix,"-children-item"),"more")},[o("a",{on:{click:this.$appendData}},[o("span",[this.$slots.loadMoreCollapseTextIcon||this.loadMoreCollapseTextIcon]),o("span",[this.$slots.loadMoreReplyText||this.loadMoreReplyText])])])])])},$renderMore:function(t){var e=this;return t(ConditionalRender,{attrs:{conditional:!this.collapse}},[t("a",{class:"".concat(selectorPrefix,"-collapse"),on:{click:function(){var t;e.listData[e.dataKeys.list].length?e.collapse=!0:null!=(t=e.$loadData())&&t.then(function(){return e.collapse=!0})}}},[t("span",[this.$slots.showReplyTextIcon||this.showReplyTextIcon]),t("span",[this.$slots.showReplyText||this.showReplyText])]),t("a",{slot:"noMatch",class:"".concat(selectorPrefix,"-collapse"),on:{click:function(){return e.collapse=!1}}},[t("span",[this.$slots.hideReplyTextIcon||this.hideReplyTextIcon]),t("span",[this.$slots.hideReplyText||this.hideReplyText])])])},$loadData:function(){var e=this;return this.loading=!0,this.$data.$paging={page:1,limit:this.limit},this.$fetchData().then(function(t){e.listData=t})},$appendData:function(){var n=this,o=(this.loading=!0,this.$data.$paging.page=this.$data.$paging.page+1,this.dataKeys.list);return this.$fetchData().then(function(t){var e;n.listData=__assign(__assign({},t),((e={})[n.dataKeys.list]=__spreadArray(__spreadArray([],n.listData[o],!0),t[o],!0),e))})},$fetchData:function(){var t,e=this;return null==(t=null==(t=null==(t=null==this?void 0:this.fetchData)?void 0:t.call(this,__assign(__assign({},this.$data.$paging),{record:__assign({},this.data)})))?void 0:t.then(function(t){return e.loading=!1,t}))?void 0:t.catch(function(t){return e.loading=!1,t})}},render:function(t){var e,n=this;return t(FlexLayout,{attrs:{direction:"horizontal"},class:classNames(selectorPrefix,this.isReply?"".concat(selectorPrefix,"-reply"):"")},[t(FlexLayout.Fixed,{class:"".concat(selectorPrefix,"-avatar-wrap")},[null==(e=(null==(e=this.$scopedSlots)?void 0:e.renderAvatar)||(null==this?void 0:this.renderAvatar))?void 0:e(__assign({},this.data))]),t(FlexLayout.Auto,{attrs:{autoFixed:!0,fit:!0}},[t(FlexLayout,{attrs:{direction:"vertical"}},[t(FlexLayout.Fixed,{class:"".concat(selectorPrefix,"-title-row"),attrs:{fit:!1}},[t("div",{class:"".concat(selectorPrefix,"-title-row-author")},[null==(e=(null==(e=this.$scopedSlots)?void 0:e.renderAuthor)||(null==this?void 0:this.renderAuthor))?void 0:e(__assign({},this.data))]),t("div",{class:"".concat(selectorPrefix,"-title-row-date-time")},[null==(e=(null==(e=this.$scopedSlots)?void 0:e.renderDateTime)||(null==this?void 0:this.renderDateTime))?void 0:e(__assign({},this.data))])]),t(FlexLayout.Auto,{class:"".concat(selectorPrefix,"-content-wrap")},[null==(e=(null==(e=this.$scopedSlots)?void 0:e.renderContent)||(null==this?void 0:this.renderContent))?void 0:e(__assign({},this.data))]),t(FlexLayout.Fixed,[t("ul",{class:"".concat(selectorPrefix,"-actions")},[this.$renderActions(t)])]),t(ConditionalRender,{attrs:{conditional:this.showReply}},[t(FlexLayout.Fixed,{style:"margin-top:15px;"},[t(ReplySubmit,{on:{cancel:function(){return n.showReply=!1},result:function(t){var e;null!=(e=null==(e=n.fetchReply)?void 0:e.call(n,{id:null==(e=n.data)?void 0:e[n.keyProp],record:__assign({},n.data),reply:t}))&&e.then(function(){n.showReply=!1,n.$loadData()})}},attrs:{local:this.local,emojiPickerProps:this.emojiPickerProps}})])]),t(ConditionalRender,{attrs:{conditional:null==(e=this.data)?void 0:e[this.isMoreProp]}},[t("div",[t(ConditionalRender,{attrs:{conditional:!this.loading}},[this.$renderMore(t)]),t(ConditionalRender.Show,{attrs:{conditional:this.collapse}},[this.$renderChildren(t)]),t(ConditionalRender,{attrs:{conditional:this.loading}},[this.$slots.renderLoading||this.renderLoading])])])])])])}};export default Node;
//# sourceMappingURL=index.js.map
