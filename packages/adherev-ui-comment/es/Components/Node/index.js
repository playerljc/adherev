import"core-js/modules/es.number.constructor.js";import"core-js/modules/es.array.map.js";import"core-js/modules/es.string.ends-with.js";import"core-js/modules/es.array.find.js";import"core-js/modules/es.object.to-string.js";import{__assign,__spreadArrays}from"tslib";import classNames from"classnames";import{Fragment}from"vue-fragment";import ConditionalRender from"@baifendian/adherev-ui-conditionalrender";import FlexLayout from"@baifendian/adherev-ui-flexlayout";import Intl from"@baifendian/adherev-util-intl";import ReplyInfo from"../../Reply/Info";import ReplySubmit from"../../Reply/Submit";var selectorPrefix="adherev-ui-comment-node",Node={name:"adv-comment-reply-node",props:{isReply:{type:Boolean,default:!1},defaultData:{type:Object,default:function(){return{}}},dataKeys:{type:Object,default:function(){return{current:"current",totalPage:"totalPage",list:"list",totalCount:"totalCount"}}},limit:{type:Number,default:10},fetchData:{type:Function},fetchReply:{type:Function},keyProp:{type:String,default:""},isMoreProp:{type:String,default:""},local:{type:String,default:"zh"},emojiPickerProps:{type:Object,default:function(){return{}}},comId:{type:[String,Number],default:""}},scopedSlots:["renderActions","renderAuthor","renderAvatar","renderContent","renderDateTime"],slots:["renderLoading","loadMoreCollapseTextIcon","loadMoreReplyText","showReplyTextIcon","showReplyText","hideReplyTextIcon","hideReplyText"],data:function(){var t;return{listData:((t={})[this.dataKeys.current]=1,t[this.dataKeys.list]=[],t[this.dataKeys.totalCount]=0,t[this.dataKeys.totalPage]=0,t),data:this.defaultData,collapse:!1,loading:!1,showReply:!1,$paging:{page:1,limit:this.limit}}},watch:{defaultData:function(t){this.data=t}},computed:{hasMore:function(){return this.listData[this.dataKeys.list].length<=this.listData[this.dataKeys.totalCount]}},methods:{$renderActions:function(a){var t,e=this,o=(null===(o=null===(t=null===(o=this.$scopedSlots)||void 0===o?void 0:o.renderActions)||void 0===t?void 0:t.call(o,{record:__assign({},this.data),callback:function(t){e.data=t}}))||void 0===o?void 0:o.map(function(t,e){var o,i;return ConditionalRender.conditionalRender({conditional:!(null!==(i=null===(o=null===(i=null==t?void 0:t.data)||void 0===i?void 0:i.class)||void 0===o?void 0:o.endsWith)&&void 0!==i&&i.call(o,"-actions-action")),noMatch:t,match:a("li",{key:e,class:selectorPrefix+"-actions-action"},[t])})}))||[];return o.find(function(t){return"reply"===(null==t?void 0:t.key)})||o.push(a("li",{key:"reply",class:classNames(selectorPrefix+"-actions-action",selectorPrefix+"-actions-action-reply-btn"),on:{click:function(){return e.showReply=!0}}},[Intl.v("回复")])),o},$renderChildren:function(i){var t,e,a=this,l={renderActions:function(t){return a.$scopedSlots.renderActions(t)},renderAuthor:function(t){return a.$scopedSlots.renderAuthor(t)},renderAvatar:function(t){return a.$scopedSlots.renderAvatar(t)},renderContent:function(t){return a.$scopedSlots.renderContent(t)},renderDateTime:function(t){return a.$scopedSlots.renderDateTime(t)}};return i("ul",{class:selectorPrefix+"-children"},[null===(e=null===(t=this.listData[this.dataKeys.list]||[])?void 0:t.map)||void 0===e?void 0:e.call(t,function(t){var e,o;return i("li",{class:selectorPrefix+"-children-item",key:t[a.keyProp],attrs:{id:t[a.keyProp]}},[i(ConditionalRender,{attrs:{conditional:!(null!==(o=null==a?void 0:a.$scopedSlots)&&void 0!==o&&o.default)}},[i(ReplyInfo,{attrs:{comId:t[a.keyProp],isReply:!0,defaultData:t,dataKeys:a.dataKeys,limit:a.limit,keyProp:a.keyProp,isMoreProp:a.isMoreProp,fetchData:a.fetchData,fetchReply:a.fetchReply,local:a.local,emojiPickerProps:a.emojiPickerProps},scopedSlots:l},[i("div",{slot:"renderLoading"},[a.$slots.renderLoading]),i(Fragment,{slot:"showReplyText"},[a.$slots.showReplyText]),i(Fragment,{slot:"hideReplyText"},[a.$slots.hideReplyText]),i(Fragment,{slot:"loadMoreReplyText"},[a.$slots.loadMoreReplyText]),i(Fragment,{slot:"showReplyTextIcon"},[a.$slots.showReplyTextIcon]),i(Fragment,{slot:"hideReplyTextIcon"},[a.$slots.hideReplyTextIcon]),i(Fragment,{slot:"loadMoreCollapseTextIcon"},[a.$slots.loadMoreCollapseTextIcon])]),i(Fragment,{slot:"noMatch"},[null===(o=null===(e=null==a?void 0:a.$scopedSlots)||void 0===e?void 0:e.default)||void 0===o?void 0:o.call(e,t)])])])}),i(ConditionalRender,{attrs:{conditional:!this.loading&&this.hasMore}},[i("li",{class:classNames(selectorPrefix+"-children-item","more")},[i("a",{on:{click:this.$appendData}},[i("span",[this.$slots.loadMoreCollapseTextIcon]),i("span",[this.$slots.loadMoreReplyText])])])])])},$renderMore:function(t){var e=this;return t(ConditionalRender,{attrs:{conditional:!this.collapse}},[t("a",{class:selectorPrefix+"-collapse",on:{click:function(){var t;e.listData[e.dataKeys.list].length?e.collapse=!0:null!==(t=e.$loadData())&&void 0!==t&&t.then(function(){return e.collapse=!0})}}},[t("span",[this.$slots.showReplyTextIcon]),t("span",[this.$slots.showReplyText])]),t("a",{slot:"noMatch",class:selectorPrefix+"-collapse",on:{click:function(){return e.collapse=!1}}},[t("span",[this.$slots.hideReplyTextIcon]),t("span",[this.$slots.hideReplyText])])])},$loadData:function(){var e=this;return this.loading=!0,this.$data.$paging={page:1,limit:this.limit},this.$fetchData().then(function(t){e.listData=t})},$appendData:function(){var o=this;this.loading=!0,this.$data.$paging.page=this.$data.$paging.page+1;var i=this.dataKeys.list;return this.$fetchData().then(function(t){var e;o.listData=__assign(__assign({},t),((e={})[o.dataKeys.list]=__spreadArrays(o.listData[i],t[i]),e))})},$fetchData:function(){var t,e=this;return null===(t=null===(t=null===(t=null==this?void 0:this.fetchData)||void 0===t?void 0:t.call(this,__assign(__assign({},this.$data.$paging),{record:__assign({},this.data)})))||void 0===t?void 0:t.then(function(t){return e.loading=!1,t}))||void 0===t?void 0:t.catch(function(t){return e.loading=!1,t})}},render:function(t){var e,o,i=this;return t(FlexLayout,{attrs:{direction:"horizontal"},class:classNames(selectorPrefix,this.isReply?selectorPrefix+"-reply":"")},[t(FlexLayout.Fixed,{class:selectorPrefix+"-avatar-wrap"},[null===(o=null===(e=this.$scopedSlots)||void 0===e?void 0:e.renderAvatar)||void 0===o?void 0:o.call(e,__assign({},this.data))]),t(FlexLayout.Auto,{attrs:{autoFixed:!0,fit:!0}},[t(FlexLayout,{attrs:{direction:"vertical"}},[t(FlexLayout.Fixed,{class:selectorPrefix+"-title-row",attrs:{fit:!1}},[t("div",{class:selectorPrefix+"-title-row-author"},[null===(e=null===(o=this.$scopedSlots)||void 0===o?void 0:o.renderAuthor)||void 0===e?void 0:e.call(o,__assign({},this.data))]),t("div",{class:selectorPrefix+"-title-row-date-time"},[null===(o=null===(e=this.$scopedSlots)||void 0===e?void 0:e.renderDateTime)||void 0===o?void 0:o.call(e,__assign({},this.data))])]),t(FlexLayout.Auto,{class:selectorPrefix+"-content-wrap"},[null===(e=null===(o=this.$scopedSlots)||void 0===o?void 0:o.renderContent)||void 0===e?void 0:e.call(o,__assign({},this.data))]),t(FlexLayout.Fixed,[t("ul",{class:selectorPrefix+"-actions"},[this.$renderActions(t)])]),t(ConditionalRender,{attrs:{conditional:this.showReply}},[t(FlexLayout.Fixed,{style:"margin-top:15px;"},[t(ReplySubmit,{on:{cancel:function(){return i.showReply=!1},result:function(t){var e;null!==(t=null===(e=i.fetchReply)||void 0===e?void 0:e.call(i,{id:null===(e=i.data)||void 0===e?void 0:e[i.keyProp],record:__assign({},i.data),reply:t}))&&void 0!==t&&t.then(function(){i.showReply=!1,i.$loadData()})}},attrs:{local:this.local,emojiPickerProps:this.emojiPickerProps}})])]),t(ConditionalRender,{attrs:{conditional:null===(o=this.data)||void 0===o?void 0:o[this.isMoreProp]}},[t("div",[t(ConditionalRender,{attrs:{conditional:!this.loading}},[this.$renderMore(t)]),t(ConditionalRender.Show,{attrs:{conditional:this.collapse}},[this.$renderChildren(t)]),t(ConditionalRender,{attrs:{conditional:this.loading}},[this.$slots.renderLoading])])])])])])}};export default Node;
//# sourceMappingURL=index.js.map
