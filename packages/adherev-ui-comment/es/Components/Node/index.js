import{isVNode as _isVNode,createVNode as _createVNode}from"vue";import"core-js/modules/es.array.map.js";import"core-js/modules/es.string.ends-with.js";import"core-js/modules/es.array.find.js";import"core-js/modules/es.object.to-string.js";import{__assign,__spreadArray}from"tslib";import classNames from"classnames";import{computed,defineComponent,ref,watch}from"vue";import{bool,func,number,object,oneOfType,string}from"vue-types";import ConditionalRender from"@baifendian/adherev-ui-conditionalrender";import FlexLayout from"@baifendian/adherev-ui-flexlayout";import Intl from"@baifendian/adherev-util-intl";import ReplyInfo from"../../Reply/Info";import ReplySubmit from"../../Reply/Submit";function _isSlot(e){return"function"==typeof e||"[object Object]"===Object.prototype.toString.call(e)&&!_isVNode(e)}var selectorPrefix="adherev-ui-comment-node",props={isReply:bool().def(!1),defaultData:object().def({}),dataKeys:object().def({current:"current",totalPage:"totalPage",list:"list",totalCount:"totalCount"}),limit:number().def(10),fetchData:func(),fetchReply:func(),keyProp:string().def(""),isMoreProp:string().def(""),local:string().def("zh"),emojiPickerProps:object().def({}),comId:oneOfType([string(),number()]).def(""),renderLoading:object(),loadMoreCollapseTextIcon:object(),loadMoreReplyText:object(),showReplyTextIcon:object(),showReplyText:object(),hideReplyTextIcon:object(),hideReplyText:object(),renderActions:func(),renderAuthor:func(),renderAvatar:func(),renderContent:func(),renderDateTime:func()};export default defineComponent({name:"adv-comment-reply-node",slots:["renderLoading","loadMoreCollapseTextIcon","loadMoreReplyText","showReplyTextIcon","showReplyText","hideReplyTextIcon","hideReplyText","renderActions","renderAuthor","renderAvatar","renderContent","renderDateTime"],props:props,setup:function(i,e){function c(){var e;return p.value=!0,l={page:1,limit:i.limit},null==(e=null==n?void 0:n())?void 0:e.then(function(e){s.value=e})}function d(){var e;return p.value=!0,l.page=l.page+1,null==(e=null==n?void 0:n())?void 0:e.then(function(e){var l;s.value=__assign(__assign({},e),((l={})[i.dataKeys.list]=__spreadArray(__spreadArray([],s.value[i.dataKeys.list],!0),e[i.dataKeys.list],!0),l))})}var u=e.slots,s=ref(((e={})[i.dataKeys.current]=1,e[i.dataKeys.list]=[],e[i.dataKeys.totalCount]=0,e[i.dataKeys.totalPage]=0,e)),f=ref(i.defaultData),v=ref(!1),p=ref(!1),y=ref(!1),l={page:1,limit:i.limit},n=function(){var e;return null==(e=null==(e=null==(e=null==i?void 0:i.fetchData)?void 0:e.call(i,__assign(__assign({},l),{record:__assign({},f.value)})))?void 0:e.then(function(e){return p.value=!1,e}))?void 0:e.catch(function(e){return p.value=!1,e})},m=computed(function(){return s.value[i.dataKeys.list].length<=s.value[i.dataKeys.totalCount]});return watch(function(){return i.defaultData},function(e){return f.value=e}),function(){var t,r,e,l,n,o,a;return _createVNode(FlexLayout,{direction:"horizontal",class:classNames(selectorPrefix,i.isReply?"".concat(selectorPrefix,"-reply"):"")},{default:function(){return[_createVNode(FlexLayout.Fixed,{class:"".concat(selectorPrefix,"-avatar-wrap")},{default:function(){return[null==(e=(null==u?void 0:u.renderAvatar)||(null==i?void 0:i.renderAvatar))?void 0:e(__assign({},f.value))]}}),_createVNode(FlexLayout.Auto,{autoFixed:!0,fit:!0},{default:function(){return[_createVNode(FlexLayout,{direction:"vertical"},{default:function(){return[_createVNode(FlexLayout.Fixed,{class:"".concat(selectorPrefix,"-title-row"),fit:!1},{default:function(){return[_createVNode("div",{class:"".concat(selectorPrefix,"-title-row-author")},[null==(l=(null==u?void 0:u.renderAuthor)||(null==i?void 0:i.renderAuthor))?void 0:l(__assign({},f.value))]),_createVNode("div",{class:"".concat(selectorPrefix,"-title-row-date-time")},[null==(l=(null==u?void 0:u.renderDateTime)||(null==i?void 0:i.renderDateTime))?void 0:l(__assign({},f.value))])]}}),_createVNode(FlexLayout.Auto,{class:"".concat(selectorPrefix,"-content-wrap")},{default:function(){return[null==(n=(null==u?void 0:u.renderContent)||(null==i?void 0:i.renderContent))?void 0:n(__assign({},f.value))]}}),_createVNode(FlexLayout.Fixed,null,{default:function(){return[_createVNode("ul",{class:"".concat(selectorPrefix,"-actions")},[((l=(null==(l=null==(e=null==(e=(null==u?void 0:u.renderActions)||i.renderActions)?void 0:e({record:__assign({},f.value),callback:function(e){f.value=e}}))?void 0:e.map)?void 0:l.call(e,function(e,l){var n,o;return ConditionalRender.conditionalRender({conditional:!(null!=(o=null==(n=null==(n=null==e?void 0:e.props)?void 0:n.class)?void 0:n.endsWith)&&o.call(n,"-actions-action")),noMatch:e,match:_createVNode("li",{key:l,class:"".concat(selectorPrefix,"-actions-action")},[e])})}))||[]).find(function(e){return"reply"===(null==e?void 0:e.key)})||l.push(_createVNode("li",{key:"reply",class:classNames("".concat(selectorPrefix,"-actions-action"),"".concat(selectorPrefix,"-actions-action-reply-btn")),onClick:function(){return y.value=!0}},[Intl.tv("回复")])),l)])];var e,l}}),_createVNode(ConditionalRender,{conditional:y.value},{default:function(){return[_createVNode(FlexLayout.Fixed,{style:"margin-top:15px;"},{default:function(){return[_createVNode(ReplySubmit,{onCancel:function(){return y.value=!1},onResult:function(e){var l;null!=(l=null==(l=i.fetchReply)?void 0:l.call(i,{id:null==(l=f.value)?void 0:l[i.keyProp],record:__assign({},f.value),reply:e}))&&l.then(function(){y.value=!1,c()})},local:i.local,emojiPickerProps:i.emojiPickerProps},null)]}})]}}),_createVNode(ConditionalRender,{conditional:null==(o=f.value)?void 0:o[i.isMoreProp]},{default:function(){return[_createVNode("div",null,[_createVNode(ConditionalRender,{conditional:!p.value},_isSlot(t=_createVNode(ConditionalRender,{conditional:!v.value},{default:function(){var e;return _createVNode("a",{class:"".concat(selectorPrefix,"-collapse"),onClick:function(){var e;s.value[i.dataKeys.list].length?v.value=!0:null!=(e=c())&&e.then(function(){return v.value=!0})}},[_createVNode("span",null,[(null==(e=u.showReplyTextIcon)?void 0:e.call(u))||i.showReplyTextIcon]),_createVNode("span",null,[(null==(e=u.showReplyText)?void 0:e.call(u))||i.showReplyText])])},noMatch:function(){var e;return _createVNode("a",{class:"".concat(selectorPrefix,"-collapse"),onClick:function(){return v.value=!1}},[_createVNode("span",null,[(null==(e=u.hideReplyTextIcon)?void 0:e.call(u))||i.hideReplyTextIcon]),_createVNode("span",null,[(null==(e=u.hideReplyText)?void 0:e.call(u))||i.hideReplyText])])}}))?t:{default:function(){return[t]}}),_createVNode(ConditionalRender.Show,{conditional:v.value},_isSlot((o={renderActions:function(e){var l;return(null==(l=null==u?void 0:u.renderActions)?void 0:l.call(u,e))||(null==(l=null==i?void 0:i.renderActions)?void 0:l.call(i,e))},renderAuthor:function(e){var l;return(null==(l=null==u?void 0:u.renderAuthor)?void 0:l.call(u,e))||(null==(l=null==i?void 0:i.renderAuthor)?void 0:l.call(i,e))},renderAvatar:function(e){var l;return(null==(l=null==u?void 0:u.renderAvatar)?void 0:l.call(u,e))||(null==(l=null==i?void 0:i.renderAvatar)?void 0:l.call(i,e))},renderContent:function(e){var l;return(null==(l=null==u?void 0:u.renderContent)?void 0:l.call(u,e))||(null==(l=null==i?void 0:i.renderContent)?void 0:l.call(i,e))},renderDateTime:function(e){var l;return(null==(l=null==u?void 0:u.renderDateTime)?void 0:l.call(u,e))||(null==(l=null==i?void 0:i.renderDateTime)?void 0:l.call(i,e))},renderLoading:function(){var e;return _createVNode("div",null,[(null==(e=u.renderLoading)?void 0:e.call(u))||i.renderLoading])},showReplyText:function(){var e;return(null==(e=u.showReplyText)?void 0:e.call(u))||i.showReplyText},hideReplyText:function(){var e;return(null==(e=u.hideReplyText)?void 0:e.call(u))||i.hideReplyText},loadMoreReplyText:function(){var e;return(null==(e=u.loadMoreReplyText)?void 0:e.call(u))||i.loadMoreReplyText},showReplyTextIcon:function(){var e;return(null==(e=u.showReplyTextIcon)?void 0:e.call(u))||i.showReplyTextIcon},hideReplyTextIcon:function(){var e;return(null==(e=u.hideReplyTextIcon)?void 0:e.call(u))||i.hideReplyTextIcon},loadMoreCollapseTextIcon:function(){var e;return(null==(e=u.loadMoreCollapseTextIcon)?void 0:e.call(u))||i.loadMoreCollapseTextIcon}},r=_createVNode("ul",{class:"".concat(selectorPrefix,"-children")},[null==(l=null===(e=s.value[i.dataKeys.list]||[])?void 0:e.map)?void 0:l.call(e,function(l){return _createVNode("li",{class:"".concat(selectorPrefix,"-children-item"),key:l[i.keyProp],id:l[i.keyProp]},[_createVNode(ConditionalRender,{conditional:!(null!=u&&u.default)},{default:function(){return _createVNode(ReplyInfo,{comId:l[i.keyProp],isReply:!0,defaultData:l,dataKeys:i.dataKeys,limit:i.limit,keyProp:i.keyProp,isMoreProp:i.isMoreProp,fetchData:i.fetchData,fetchReply:i.fetchReply,local:i.local,emojiPickerProps:i.emojiPickerProps},_isSlot(o)?o:{default:function(){return[o]}})},noMatch:function(){var e;return null==(e=null==u?void 0:u.default)?void 0:e.call(u,l)}})])}),_createVNode(ConditionalRender,{conditional:!p.value&&m.value},{default:function(){return[_createVNode("li",{class:classNames("".concat(selectorPrefix,"-children-item"),"more")},[_createVNode("a",{onClick:d},[_createVNode("span",null,[(null==(n=u.loadMoreCollapseTextIcon)?void 0:n.call(u))||i.loadMoreCollapseTextIcon]),_createVNode("span",null,[(null==(n=u.loadMoreReplyText)?void 0:n.call(u))||i.loadMoreReplyText])])])]}})])))?r:{default:function(){return[r]}}),_createVNode(ConditionalRender,{conditional:p.value},{default:function(){return[(null==(a=u.renderLoading)?void 0:a.call(u))||i.renderLoading]}})])];var e,l,n,o}})]}})]}})]}})}}});
//# sourceMappingURL=index.js.map
