import{Fragment as _Fragment,isVNode as _isVNode,createVNode as _createVNode}from"vue";import"core-js/modules/es.array.map.js";import"core-js/modules/es.string.ends-with.js";import"core-js/modules/es.array.find.js";import"core-js/modules/es.object.to-string.js";import{__assign,__spreadArray}from"tslib";import classNames from"classnames";import{computed,defineComponent,ref,watch}from"vue";import{bool,func,number,object,oneOfType,string}from"vue-types";import ConditionalRender from"@baifendian/adherev-ui-conditionalrender";import FlexLayout from"@baifendian/adherev-ui-flexlayout";import Intl from"@baifendian/adherev-util-intl";import ReplyInfo from"../../Reply/Info";import ReplySubmit from"../../Reply/Submit";function _isSlot(e){return"function"==typeof e||"[object Object]"===Object.prototype.toString.call(e)&&!_isVNode(e)}var selectorPrefix="adherev-ui-comment-node",props={isReply:bool().def(!1),defaultData:object().def({}),dataKeys:object().def({current:"current",totalPage:"totalPage",list:"list",totalCount:"totalCount"}),limit:number().def(10),fetchData:func(),fetchReply:func(),keyProp:string().def(""),isMoreProp:string().def(""),local:string().def("zh"),emojiPickerProps:object().def({}),comId:oneOfType([string(),number()]).def(""),renderLoading:object(),loadMoreCollapseTextIcon:object(),loadMoreReplyText:object(),showReplyTextIcon:object(),showReplyText:object(),hideReplyTextIcon:object(),hideReplyText:object(),renderActions:func(),renderAuthor:func(),renderAvatar:func(),renderContent:func(),renderDateTime:func()};export default defineComponent({name:"adv-comment-reply-node",slots:["renderLoading","loadMoreCollapseTextIcon","loadMoreReplyText","showReplyTextIcon","showReplyText","hideReplyTextIcon","hideReplyText","renderActions","renderAuthor","renderAvatar","renderContent","renderDateTime"],props:props,setup:function(a,e){function i(){var e;return f.value=!0,l={page:1,limit:a.limit},null==(e=null==n?void 0:n())?void 0:e.then(function(e){u.value=e})}function c(){var e;return f.value=!0,l.page=l.page+1,null==(e=null==n?void 0:n())?void 0:e.then(function(e){var l;u.value=__assign(__assign({},e),((l={})[a.dataKeys.list]=__spreadArray(__spreadArray([],u.value[a.dataKeys.list],!0),e[a.dataKeys.list],!0),l))})}var d=e.slots,u=ref(((e={})[a.dataKeys.current]=1,e[a.dataKeys.list]=[],e[a.dataKeys.totalCount]=0,e[a.dataKeys.totalPage]=0,e)),t=ref(a.defaultData),s=ref(!1),f=ref(!1),r=ref(!1),l={page:1,limit:a.limit},n=function(){var e;return null==(e=null==(e=null==(e=null==a?void 0:a.fetchData)?void 0:e.call(a,__assign(__assign({},l),{record:__assign({},t.value)})))?void 0:e.then(function(e){return f.value=!1,e}))?void 0:e.catch(function(e){return f.value=!1,e})},v=computed(function(){return u.value[a.dataKeys.list].length<=u.value[a.dataKeys.totalCount]});return watch(function(){return a.defaultData},function(e){return t.value=e}),function(){var e,l,n,o;return _createVNode(FlexLayout,{direction:"horizontal",class:classNames(selectorPrefix,a.isReply?"".concat(selectorPrefix,"-reply"):"")},{default:function(){return[_createVNode(FlexLayout.Fixed,{class:"".concat(selectorPrefix,"-avatar-wrap")},{default:function(){return[null==(e=(null==d?void 0:d.renderAvatar)||(null==a?void 0:a.renderAvatar))?void 0:e(__assign({},t.value))]}}),_createVNode(FlexLayout.Auto,{autoFixed:!0,fit:!0},{default:function(){return[_createVNode(FlexLayout,{direction:"vertical"},{default:function(){return[_createVNode(FlexLayout.Fixed,{class:"".concat(selectorPrefix,"-title-row"),fit:!1},{default:function(){return[_createVNode("div",{class:"".concat(selectorPrefix,"-title-row-author")},[null==(l=(null==d?void 0:d.renderAuthor)||(null==a?void 0:a.renderAuthor))?void 0:l(__assign({},t.value))]),_createVNode("div",{class:"".concat(selectorPrefix,"-title-row-date-time")},[null==(l=(null==d?void 0:d.renderDateTime)||(null==a?void 0:a.renderDateTime))?void 0:l(__assign({},t.value))])]}}),_createVNode(FlexLayout.Auto,{class:"".concat(selectorPrefix,"-content-wrap")},{default:function(){return[null==(n=(null==d?void 0:d.renderContent)||(null==a?void 0:a.renderContent))?void 0:n(__assign({},t.value))]}}),_createVNode(FlexLayout.Fixed,null,{default:function(){return[_createVNode("ul",{class:"".concat(selectorPrefix,"-actions")},[((l=(null==(l=null==(e=null==(e=(null==d?void 0:d.renderActions)||a.renderActions)?void 0:e({record:__assign({},t.value),callback:function(e){t.value=e}}))?void 0:e.map)?void 0:l.call(e,function(e,l){var n,o;return ConditionalRender.conditionalRender({conditional:!(null!=(o=null==(n=null==(n=null==e?void 0:e.props)?void 0:n.class)?void 0:n.endsWith)&&o.call(n,"-actions-action")),noMatch:e,match:_createVNode("li",{key:l,class:"".concat(selectorPrefix,"-actions-action")},[e])})}))||[]).find(function(e){return"reply"===(null==e?void 0:e.key)})||l.push(_createVNode("li",{key:"reply",class:classNames("".concat(selectorPrefix,"-actions-action"),"".concat(selectorPrefix,"-actions-action-reply-btn")),onClick:function(){return r.value=!0}},[Intl.tv("回复")])),l)])];var e,l}}),_createVNode(ConditionalRender,{conditional:r.value},{default:function(){return _createVNode(FlexLayout.Fixed,{style:"margin-top:15px;"},{default:function(){return[_createVNode(ReplySubmit,{onCancel:function(){return r.value=!1},onResult:function(e){var l;null!=(l=null==(l=a.fetchReply)?void 0:l.call(a,{id:null==(l=t.value)?void 0:l[a.keyProp],record:__assign({},t.value),reply:e}))&&l.then(function(){r.value=!1,i()})},local:a.local,emojiPickerProps:a.emojiPickerProps},null)]}})}}),_createVNode(ConditionalRender,{conditional:null==(o=t.value)?void 0:o[a.isMoreProp]},{default:function(){var e,l,n,o,t,r;return _createVNode(_Fragment,null,[_createVNode(ConditionalRender,{conditional:!f.value},_isSlot(e=_createVNode(ConditionalRender,{conditional:!s.value},{default:function(){var e;return _createVNode("a",{class:"".concat(selectorPrefix,"-collapse"),onClick:function(){var e;u.value[a.dataKeys.list].length?s.value=!0:null!=(e=i())&&e.then(function(){return s.value=!0})}},[_createVNode("span",null,[(null==(e=d.showReplyTextIcon)?void 0:e.call(d))||a.showReplyTextIcon]),_createVNode("span",null,[(null==(e=d.showReplyText)?void 0:e.call(d))||a.showReplyText])])},noMatch:function(){var e;return _createVNode("a",{class:"".concat(selectorPrefix,"-collapse"),onClick:function(){return s.value=!1}},[_createVNode("span",null,[(null==(e=d.hideReplyTextIcon)?void 0:e.call(d))||a.hideReplyTextIcon]),_createVNode("span",null,[(null==(e=d.hideReplyText)?void 0:e.call(d))||a.hideReplyText])])}}))?e:{default:function(){return[e]}}),_createVNode(ConditionalRender.Show,{conditional:s.value},_isSlot((r={renderActions:function(e){var l;return(null==(l=null==d?void 0:d.renderActions)?void 0:l.call(d,e))||(null==(l=null==a?void 0:a.renderActions)?void 0:l.call(a,e))},renderAuthor:function(e){var l;return(null==(l=null==d?void 0:d.renderAuthor)?void 0:l.call(d,e))||(null==(l=null==a?void 0:a.renderAuthor)?void 0:l.call(a,e))},renderAvatar:function(e){var l;return(null==(l=null==d?void 0:d.renderAvatar)?void 0:l.call(d,e))||(null==(l=null==a?void 0:a.renderAvatar)?void 0:l.call(a,e))},renderContent:function(e){var l;return(null==(l=null==d?void 0:d.renderContent)?void 0:l.call(d,e))||(null==(l=null==a?void 0:a.renderContent)?void 0:l.call(a,e))},renderDateTime:function(e){var l;return(null==(l=null==d?void 0:d.renderDateTime)?void 0:l.call(d,e))||(null==(l=null==a?void 0:a.renderDateTime)?void 0:l.call(a,e))},renderLoading:function(){var e;null!=(e=d.renderLoading)&&e.call(d)||a.renderLoading},showReplyText:function(){var e;return(null==(e=d.showReplyText)?void 0:e.call(d))||a.showReplyText},hideReplyText:function(){var e;return(null==(e=d.hideReplyText)?void 0:e.call(d))||a.hideReplyText},loadMoreReplyText:function(){var e;return(null==(e=d.loadMoreReplyText)?void 0:e.call(d))||a.loadMoreReplyText},showReplyTextIcon:function(){var e;return(null==(e=d.showReplyTextIcon)?void 0:e.call(d))||a.showReplyTextIcon},hideReplyTextIcon:function(){var e;return(null==(e=d.hideReplyTextIcon)?void 0:e.call(d))||a.hideReplyTextIcon},loadMoreCollapseTextIcon:function(){var e;return(null==(e=d.loadMoreCollapseTextIcon)?void 0:e.call(d))||a.loadMoreCollapseTextIcon}},l=_createVNode("ul",{class:"".concat(selectorPrefix,"-children")},[null==(t=null===(o=u.value[a.dataKeys.list]||[])?void 0:o.map)?void 0:t.call(o,function(l){return _createVNode("li",{class:"".concat(selectorPrefix,"-children-item"),key:l[a.keyProp],id:l[a.keyProp]},[_createVNode(ConditionalRender,{conditional:!(null!=d&&d.default)},{default:function(){return _createVNode(ReplyInfo,{comId:l[a.keyProp],isReply:!0,defaultData:l,dataKeys:a.dataKeys,limit:a.limit,keyProp:a.keyProp,isMoreProp:a.isMoreProp,fetchData:a.fetchData,fetchReply:a.fetchReply,local:a.local,emojiPickerProps:a.emojiPickerProps},_isSlot(r)?r:{default:function(){return[r]}})},noMatch:function(){var e;return null==(e=null==d?void 0:d.default)?void 0:e.call(d,l)}})])}),_createVNode(ConditionalRender,{conditional:!f.value&&v.value},{default:function(){var e;return _createVNode("li",{class:classNames("".concat(selectorPrefix,"-children-item"),"more")},[_createVNode("a",{onClick:c},[_createVNode("span",null,[(null==(e=d.loadMoreCollapseTextIcon)?void 0:e.call(d))||a.loadMoreCollapseTextIcon]),_createVNode("span",null,[(null==(e=d.loadMoreReplyText)?void 0:e.call(d))||a.loadMoreReplyText])])])}})])))?l:{default:function(){return[l]}}),_createVNode(ConditionalRender,{conditional:f.value},{default:function(){return[(null==(n=d.renderLoading)?void 0:n.call(d))||a.renderLoading]}})])}})]}})]}})]}})}}});
//# sourceMappingURL=index.js.map
