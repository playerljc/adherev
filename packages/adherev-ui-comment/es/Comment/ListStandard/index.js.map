{"version":3,"file":"index.js","sources":["Comment/ListStandard/index.js"],"sourcesContent":["import _Empty from \"ant-design-vue/es/empty\";\nimport _Skeleton from \"ant-design-vue/es/skeleton\";\nimport { mergeProps as _mergeProps, createVNode as _createVNode } from \"vue\";\nimport { __assign, __spreadArray } from \"tslib\";\nimport { computed, defineComponent, onMounted, ref, shallowRef, watch } from 'vue';\nimport { func, number, object } from 'vue-types';\nimport ConditionalRender from '@baifendian/adherev-ui-conditionalrender';\nimport FlexLayout from '@baifendian/adherev-ui-flexlayout';\nimport ScrollLoad from '@baifendian/adherev-ui-scrollload';\nimport CommentList from '../List';\nvar selectorPrefix = 'adherev-ui-comment-list-standard';\nvar VerticalFlexLayout = FlexLayout.VerticalFlexLayout;\nexport var listStandardProps = {\n  getScrollWrapContainer: func(),\n  flexLayoutProps: object().def({}),\n  listProps: object().def({}),\n  limit: number().def(10),\n  fetchData: func(),\n  dataKeys: object().def({\n    current: 'current',\n    totalPage: 'totalPage',\n    list: 'list',\n    totalCount: 'totalCount'\n  }),\n  renderEmpty: object(),\n  renderFirstLoading: object(),\n  renderList: func()\n};\nexport default defineComponent({\n  name: \"adv-comment-list-standard\",\n  slots: ['renderEmpty', 'renderFirstLoading'],\n  scopedSlots: ['renderList'],\n  props: listStandardProps,\n  setup: function setup(props, _a) {\n    var _b;\n    var slots = _a.slots;\n    var loading = ref(true);\n    var data = shallowRef((_b = {}, _b[props.dataKeys.current] = 1, _b[props.dataKeys.totalPage] = 0, _b[props.dataKeys.list] = [], _b[props.dataKeys.totalCount] = 0, _b));\n    var mainRef = ref();\n    var paging = {\n      page: 1,\n      limit: props.limit\n    };\n    var status = ScrollLoad.NORMAL;\n    var callbackHandler = null;\n    var onLoadMore = function onLoadMore(callback) {\n      if (status === ScrollLoad.EMPTY) {\n        status = ScrollLoad.EMPTY;\n        callback(ScrollLoad.EMPTY);\n        return;\n      }\n      callbackHandler = callback;\n      setTimeout(function () {\n        return appendData();\n      }, 100);\n    };\n    var loadData = function loadData() {\n      loading.value = true;\n      paging = {\n        page: 1,\n        limit: props.limit\n      };\n      return fetchData(function (res) {\n        data.value = res;\n      });\n    };\n    var appendData = function appendData() {\n      loading.value = true;\n      paging.page = paging.page + 1;\n      return fetchData(function (res) {\n        var _a;\n        data.value = __assign(__assign({}, res), (_a = {}, _a[props.dataKeys.list] = __spreadArray(__spreadArray([], data.value[props.dataKeys.list], true), res[props.dataKeys.list], true), _a));\n      });\n    };\n    var fetchData = function fetchData(callback) {\n      var _a;\n      return (_a = props === null || props === void 0 ? void 0 : props.fetchData) === null || _a === void 0 ? void 0 : _a.call(props, paging).then(function (data) {\n        callback(data);\n        loading.value = false;\n        return data;\n      }).catch(function (error) {\n        loading.value = false;\n        if (callbackHandler) {\n          status = ScrollLoad.ERROR;\n          callbackHandler === null || callbackHandler === void 0 ? void 0 : callbackHandler(status);\n        }\n        return error;\n      });\n    };\n    var _renderFirstLoading = function renderFirstLoading() {\n      var _a;\n      if (slots.renderFirstLoading) {\n        return (_a = slots.renderFirstLoading) === null || _a === void 0 ? void 0 : _a.call(slots);\n      }\n      if (props.renderFirstLoading) {\n        return props.renderFirstLoading;\n      }\n      var result = [];\n      for (var i = 0; i < 7; i++) {\n        result.push(_createVNode(_Skeleton, {\n          \"key\": i + 1,\n          \"loading\": true,\n          \"avatar\": true\n        }, null));\n      }\n      return result;\n    };\n    var isEmpty = computed(function () {\n      return paging.page === 1 && data.value[props.dataKeys.list].length === 0;\n    });\n    watch(function () {\n      return data.value;\n    }, function () {\n      if (callbackHandler) {\n        status = paging.page < data.value[props.dataKeys.totalPage] ? ScrollLoad.NORMAL : ScrollLoad.EMPTY;\n        callbackHandler === null || callbackHandler === void 0 ? void 0 : callbackHandler(status);\n      }\n    }, {\n      flush: 'post'\n    });\n    onMounted(function () {\n      return loadData();\n    });\n    return function () {\n      return _createVNode(VerticalFlexLayout, _mergeProps({\n        \"class\": \"\".concat(selectorPrefix)\n      }, props.flexLayoutProps || {}), {\n        renderMain: function renderMain() {\n          return _createVNode(\"div\", {\n            \"class\": \"\".concat(selectorPrefix, \"-auto\"),\n            \"ref\": mainRef\n          }, [_createVNode(CommentList, _mergeProps({\n            \"getScrollWrapContainer\": props.getScrollWrapContainer,\n            \"isLoading\": loading.value,\n            \"hasMore\": data.value[props.dataKeys.list].length <= data.value[props.dataKeys.totalCount],\n            \"onLoadMore\": onLoadMore\n          }, props.listProps || {}), {\n            default: function _default() {\n              return (// @ts-ignore\n                _createVNode(ConditionalRender, {\n                  \"conditional\": !isEmpty.value\n                }, {\n                  default: function _default() {\n                    var _a, _b;\n                    return slots.renderList ? (_a = slots === null || slots === void 0 ? void 0 : slots.renderList) === null || _a === void 0 ? void 0 : _a.call(slots, data.value) : (_b = props === null || props === void 0 ? void 0 : props.renderList) === null || _b === void 0 ? void 0 : _b.call(props, data.value);\n                  },\n                  noMatch: function noMatch() {\n                    var _a;\n                    return ((_a = slots.renderEmpty) === null || _a === void 0 ? void 0 : _a.call(slots)) || props.renderEmpty || _createVNode(_Empty, null, null);\n                  }\n                })\n              );\n            },\n            renderFirstLoading: function renderFirstLoading() {\n              return _createVNode(\"div\", null, [_renderFirstLoading()]);\n            }\n          })]);\n        }\n      });\n    };\n  }\n});"],"names":["_Empty","_Skeleton","_mergeProps","_createVNode","__assign","__spreadArray","computed","defineComponent","onMounted","ref","shallowRef","watch","func","number","object","ConditionalRender","FlexLayout","ScrollLoad","CommentList","selectorPrefix","VerticalFlexLayout","listStandardProps","getScrollWrapContainer","flexLayoutProps","def","listProps","limit","fetchData","dataKeys","current","totalPage","list","totalCount","renderEmpty","renderFirstLoading","renderList","name","slots","scopedSlots","props","setup","_a","onLoadMore","callback","status","EMPTY","callbackHandler","setTimeout","appendData","loading","value","paging","page","res","data","_b","mainRef","NORMAL","call","then","catch","error","ERROR","isEmpty","length","flush","class","concat","renderMain","isLoading","hasMore","default","conditional","noMatch","result","i","push","key","avatar"],"mappings":"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"}