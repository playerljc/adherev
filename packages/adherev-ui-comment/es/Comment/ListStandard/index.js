import"core-js/modules/es.object.keys.js";import"core-js/modules/es.symbol.js";import"core-js/modules/es.array.filter.js";import"core-js/modules/es.object.to-string.js";import"core-js/modules/es.object.get-own-property-descriptor.js";import"core-js/modules/web.dom-collections.for-each.js";import"core-js/modules/es.object.get-own-property-descriptors.js";import"core-js/modules/es.object.define-properties.js";import"core-js/modules/es.object.define-property.js";import _defineProperty from"@babel/runtime/helpers/defineProperty";function ownKeys(e,t){var r,a=Object.keys(e);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(e),t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,r)),a}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(r),!0).forEach(function(t){_defineProperty(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}import"core-js/modules/es.number.constructor.js";import{__assign,__spreadArrays}from"tslib";import{Empty,Skeleton}from"ant-design-vue";import{Fragment}from"vue-fragment";import ConditionalRender from"@baifendian/adherev-ui-conditionalrender";import FlexLayout from"@baifendian/adherev-ui-flexlayout";import ScrollLoad from"@baifendian/adherev-ui-scrollload";import CommentList from"../List";var selectorPrefix="adherev-ui-comment-list-standard",VerticalFlexLayout=FlexLayout.VerticalFlexLayout,ListStandard={name:"adv-comment-list-standard",slots:["renderEmpty","renderFirstLoading"],scopedSlots:["renderList"],props:{getScrollWrapContainer:{type:Function,default:function(){return null}},flexLayoutProps:{type:Object,default:function(){return{}}},listProps:{type:Object,default:function(){return{}}},limit:{type:Number,default:10},fetchData:{type:Function,default:function(){return null}},dataKeys:{type:Object,default:function(){return{current:"current",totalPage:"totalPage",list:"list",totalCount:"totalCount"}}},renderEmpty:{type:Object,default:function(){return null}},renderFirstLoading:{type:Object,default:function(){return null}},renderList:{type:Function,default:function(){return null}}},data:function(){var t;return{loading:!0,data:((t={})[this.dataKeys.current]=1,t[this.dataKeys.totalPage]=0,t[this.dataKeys.list]=[],t[this.dataKeys.totalCount]=0,t),$paging:{page:1,limit:this.limit},$status:ScrollLoad.NORMAL,$callbackHandler:null}},computed:{isEmpty:function(){return 1===this.$data.$paging.page&&0===this.data[this.dataKeys.list].length}},methods:{onLoadMore:function(t){var e=this;if(this.$data.$status===ScrollLoad.EMPTY)return this.$data.$status=ScrollLoad.EMPTY,void t(ScrollLoad.EMPTY);this.$data.$callbackHandler=t,setTimeout(function(){return e.$appendData()},100)},$loadData:function(){var e=this;return this.loading=!0,this.$data.$paging={page:1,limit:this.limit},this.$fetchData(function(t){e.data=t})},$appendData:function(){var r=this;this.loading=!0,this.$data.$paging.page=this.$data.$paging.page+1;var a=this.dataKeys.list;return this.$fetchData(function(t){var e;r.data=__assign(__assign({},t),((e={})[r.dataKeys.list]=__spreadArrays(r.data[a],t[a]),e))})},$fetchData:function(e){var t,a=this;return null===(t=null==this?void 0:this.fetchData)||void 0===t?void 0:t.call(this,this.$data.$paging).then(function(t){return e(t),a.loading=!1,t}).catch(function(t){var e,r;return a.loading=!1,a.$data.$callbackHandler&&(a.$data.$status=ScrollLoad.ERROR,null!==(r=(e=a.$data).$callbackHandler)&&void 0!==r&&r.call(e,a.$data.$status)),t})},$renderFirstLoading:function(t){if(this.$slots.renderFirstLoading)return this.$slots.renderFirstLoading;if(this.renderFirstLoading)return this.renderFirstLoading;for(var e=[],r=0;r<7;r++)e.push(t(Skeleton,{key:r+1,attrs:{loading:!0,avatar:!0}}));return e}},watch:{data:function(t){this.$nextTick(function(){this.$data.$callbackHandler&&(this.$data.$status=this.$data.$paging.page<t[this.dataKeys.totalPage]?ScrollLoad.NORMAL:ScrollLoad.EMPTY,this.$data.$callbackHandler(this.$data.$status))})}},mounted:function(){this.$loadData()},render:function(t){var e,r;return t(VerticalFlexLayout,{class:""+selectorPrefix,props:_objectSpread({},this.flexLayoutProps||{})},[t("div",{slot:"renderMain",class:selectorPrefix+"-auto",ref:"mainRef"},[t(CommentList,{attrs:{getScrollWrapContainer:this.getScrollWrapContainer,isLoading:this.loading,hasMore:this.data[this.dataKeys.list].length<=this.data[this.dataKeys.totalCount]},on:{loadMore:this.onLoadMore},props:_objectSpread({},this.listProps||{})},[t("div",{slot:"renderFirstLoading"},[this.$renderFirstLoading(t)]),t(ConditionalRender,{attrs:{conditional:!this.isEmpty}},[this.$scopedSlots.renderList?null===(e=null===(r=this.$scopedSlots)||void 0===r?void 0:r.renderList)||void 0===e?void 0:e.call(r,this.data):null===(r=null==this?void 0:this.renderList)||void 0===r?void 0:r.call(this,this.data),t(Fragment,{slot:"noMatch"},[this.$slots.renderEmpty||this.renderEmpty||t(Empty)])])])])])}};export default ListStandard;
//# sourceMappingURL=index.js.map
