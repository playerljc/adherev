import{mergeProps as _mergeProps,createVNode as _createVNode}from"vue";import{__assign,__spreadArray}from"tslib";import{Empty,Skeleton}from"ant-design-vue";import{computed,defineComponent,nextTick,onMounted,ref,shallowRef,watch}from"vue";import{func,number,object}from"vue-types";import ConditionalRender from"@baifendian/adherev-ui-conditionalrender";import FlexLayout from"@baifendian/adherev-ui-flexlayout";import ScrollLoad from"@baifendian/adherev-ui-scrollload";import CommentList from"../List";var selectorPrefix="adherev-ui-comment-list-standard",VerticalFlexLayout=FlexLayout.VerticalFlexLayout,props={getScrollWrapContainer:func(),flexLayoutProps:object().def({}),listProps:object().def({}),limit:number().def(10),fetchData:func(),dataKeys:object().def({current:"current",totalPage:"totalPage",list:"list",totalCount:"totalCount"}),renderEmpty:object(),renderFirstLoading:object(),renderList:func()};export default defineComponent({name:"adv-comment-list-standard",slots:["renderEmpty","renderFirstLoading"],scopedSlots:["renderList"],props:props,setup:function(a,e){function t(e){d===ScrollLoad.EMPTY?(d=ScrollLoad.EMPTY,e(ScrollLoad.EMPTY)):(c=e,setTimeout(r,100))}function r(){return o.value=!0,u.page=u.page+1,s(function(e){var t;l.value=__assign(__assign({},e),((t={})[a.dataKeys.list]=__spreadArray(__spreadArray([],l.value[a.dataKeys.list],!0),e[a.dataKeys.list],!0),t))})}var n=e.slots,o=ref(!0),l=shallowRef(((e={})[a.dataKeys.current]=1,e[a.dataKeys.totalPage]=0,e[a.dataKeys.list]=[],e[a.dataKeys.totalCount]=0,e)),i=ref(),u={page:1,limit:a.limit},d=ScrollLoad.NORMAL,c=null,s=function(t){var e;return null==(e=null==a?void 0:a.fetchData)?void 0:e.call(a,u).then(function(e){return t(e),o.value=!1,e}).catch(function(e){return o.value=!1,c&&(d=ScrollLoad.ERROR,null!=c&&c(d)),e})},f=computed(function(){return 1===u.page&&0===l.value[a.dataKeys.list].length});return watch(function(){return l},function(e){return nextTick(function(){c&&(d=u.page<l[a.dataKeys.totalPage]?ScrollLoad.NORMAL:ScrollLoad.EMPTY,null!=c&&c(d))})}),onMounted(function(){return o.value=!0,u={page:1,limit:a.limit},s(function(e){l.value=e})}),function(){return _createVNode(VerticalFlexLayout,_mergeProps({class:"".concat(selectorPrefix)},a.flexLayoutProps||{}),{renderMain:function(){return _createVNode("div",{class:"".concat(selectorPrefix,"-auto"),ref:i},[_createVNode(CommentList,_mergeProps({getScrollWrapContainer:a.getScrollWrapContainer,isLoading:o.value,hasMore:l.value[a.dataKeys.list].length<=l.value[a.dataKeys.totalCount],onLoadMore:t},a.listProps||{}),{default:function(){return _createVNode(ConditionalRender,{conditional:!f.value},{default:function(){var e;return n.renderList?null==(e=null==n?void 0:n.renderList)?void 0:e.call(n,l.value):null==(e=null==a?void 0:a.renderList)?void 0:e.call(a,l.value)},noMatch:function(){var e;return(null==(e=n.renderEmpty)?void 0:e.call(n))||a.renderEmpty||_createVNode(Empty,null,null)}})},renderFirstLoading:function(){return _createVNode("div",null,[function(){var e;if(n.renderFirstLoading)return null==(e=n.renderFirstLoading)?void 0:e.call(n);if(a.renderFirstLoading)return a.renderFirstLoading;for(var t=[],r=0;r<7;r++)t.push(_createVNode(Skeleton,{key:r+1,loading:!0,avatar:!0},null));return t}()])}})])}})}}});
//# sourceMappingURL=index.js.map
