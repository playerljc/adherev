import{createVNode as _createVNode}from"vue";import"core-js/modules/es.array.iterator.js";import"core-js/modules/es.map.js";import"core-js/modules/es.object.to-string.js";import"core-js/modules/es.string.iterator.js";import"core-js/modules/esnext.map.delete-all.js";import"core-js/modules/esnext.map.every.js";import"core-js/modules/esnext.map.filter.js";import"core-js/modules/esnext.map.find.js";import"core-js/modules/esnext.map.find-key.js";import"core-js/modules/esnext.map.includes.js";import"core-js/modules/esnext.map.key-of.js";import"core-js/modules/esnext.map.map-keys.js";import"core-js/modules/esnext.map.map-values.js";import"core-js/modules/esnext.map.merge.js";import"core-js/modules/esnext.map.reduce.js";import"core-js/modules/esnext.map.some.js";import"core-js/modules/esnext.map.update.js";import"core-js/modules/web.dom-collections.iterator.js";import{__assign}from"tslib";import debounce from"lodash/debounce";import{defineComponent,onBeforeUnmount,onMounted,ref}from"vue";import{number,string}from"vue-types";import{ResizeObserver}from"@juggle/resize-observer";import{Mode}from"./types";var selectorPrefix="adherev-ui-writingboard",props={defaultMode:string().def(Mode.FREE),defaultStrokeStyle:string().def("#000"),defaultLineWidth:number().def(2),resizeTime:number().def(300)};export default defineComponent({name:"adv-writingboard",props:props,setup:function(t,e){var e=e.expose,n=ref(),l=ref(),o=null,i=null,u=null,r=null,s=t.defaultMode,a=t.defaultLineWidth,d=t.defaultStrokeStyle,c=[],v=new Map([[Mode.FREE,{draw:function(e){var t=e.sourcePoint,e=e.targetPoint;null!=o&&o.beginPath(),null!=o&&o.moveTo(t.x,t.y),null!=o&&o.lineTo(e.x,e.y),c.push({shape:s,sourcePoint:t,targetPoint:e}),h({lineWidth:a,strokeStyle:d}),null!=o&&o.stroke()},drawStack:function(e){null!=o&&o.beginPath(),null!=o&&o.moveTo(e.sourcePoint.x,e.sourcePoint.y),null!=o&&o.lineTo(e.targetPoint.x,e.targetPoint.y),h({lineWidth:e.lineWidth,strokeStyle:e.strokeStyle}),null!=o&&o.stroke()},mouseup:function(e){P({sourcePoint:r,targetPoint:e})}}],[Mode.LINE,{draw:function(e){var t,e=e.targetPoint;null!=o&&o.clearRect(0,0,null==(t=l.value)?void 0:t.width,null==(t=l.value)?void 0:t.height),f(),null!=o&&o.beginPath(),null!=o&&o.moveTo(u.x,u.y),null!=o&&o.lineTo(e.x,e.y),h({lineWidth:a,strokeStyle:d}),null!=o&&o.stroke()},drawStack:function(e){null!=o&&o.beginPath(),null!=o&&o.moveTo(e.sourcePoint.x,e.sourcePoint.y),null!=o&&o.lineTo(e.targetPoint.x,e.targetPoint.y),h({lineWidth:e.lineWidth,strokeStyle:e.strokeStyle}),null!=o&&o.stroke()},mouseup:function(e){c.push({shape:s,lineWidth:null==o?void 0:o.lineWidth,strokeStyle:null==o?void 0:o.strokeStyle,sourcePoint:u,targetPoint:e})}}],[Mode.RECTANGLE,{draw:function(e){var e=e.targetPoint,t=(null!=o&&o.clearRect(0,0,null==(t=l.value)?void 0:t.width,null==(t=l.value)?void 0:t.height),f(),null!=o&&o.beginPath(),g({startPoint:u,targetPoint:e}));null!=o&&o.rect(t.x,t.y,Math.abs(e.x-u.x),Math.abs(e.y-u.y)),h({lineWidth:a,strokeStyle:d}),null!=o&&o.stroke()},drawStack:function(e){null!=o&&o.beginPath(),null!=o&&o.rect(e.x,e.y,e.width,e.height),h({lineWidth:e.lineWidth,strokeStyle:e.strokeStyle}),null!=o&&o.stroke()},mouseup:function(e){var t=g({startPoint:u,targetPoint:e});c.push({shape:s,lineWidth:null==o?void 0:o.lineWidth,strokeStyle:null==o?void 0:o.strokeStyle,x:t.x,y:t.y,width:Math.abs(e.x-(null==u?void 0:u.x)),height:Math.abs(e.y-(null==u?void 0:u.y))})}}],[Mode.CIRCLE,{draw:function(e){var e=e.targetPoint,t=(null!=o&&o.clearRect(0,0,null==(t=l.value)?void 0:t.width,null==(t=l.value)?void 0:t.height),f(),null!=o&&o.beginPath(),g({startPoint:u,targetPoint:e})),e=y({p2:e,p1:u});null!=o&&o.ellipse(t.x,t.y,e,e,45*Math.PI/180,0,2*Math.PI),h({lineWidth:a,strokeStyle:d}),null!=o&&o.stroke()},drawStack:function(e){null!=o&&o.beginPath(),null!=o&&o.ellipse(e.x,e.y,e.radiusX,e.radiusY,e.rotation,e.startAngle,e.endAngle),h({lineWidth:e.lineWidth,strokeStyle:e.strokeStyle}),null!=o&&o.stroke()},mouseup:function(e){var t=g({startPoint:u,targetPoint:e}),e=y({p2:e,p1:u});c.push({shape:s,lineWidth:null==o?void 0:o.lineWidth,strokeStyle:null==o?void 0:o.strokeStyle,x:t.x,y:t.y,radiusX:e,radiusY:e,rotation:45*Math.PI/180,startAngle:0,endAngle:2*Math.PI})}}],[Mode.TRIANGLE,{draw:function(e){var e=e.targetPoint,t=(null!=o&&o.clearRect(0,0,null==(t=l.value)?void 0:t.width,null==(t=l.value)?void 0:t.height),f(),null!=o&&o.beginPath(),m({startPoint:u,targetPoint:e}));null!=o&&o.moveTo(t[0].x,t[0].y),null!=o&&o.lineTo(t[1].x,t[1].y),null!=o&&o.lineTo(t[2].x,t[2].y),null!=o&&o.closePath(),h({lineWidth:a,strokeStyle:d}),null!=o&&o.stroke()},drawStack:function(e){null!=o&&o.beginPath(),null!=o&&o.moveTo(e.points[0].x,e.points[0].y),null!=o&&o.lineTo(e.points[1].x,e.points[1].y),null!=o&&o.lineTo(e.points[2].x,e.points[2].y),null!=o&&o.closePath(),h({lineWidth:e.lineWidth,strokeStyle:e.strokeStyle}),null!=o&&o.stroke()},mouseup:function(e){e=m({startPoint:u,targetPoint:e});c.push({shape:s,lineWidth:null==o?void 0:o.lineWidth,strokeStyle:null==o?void 0:o.strokeStyle,points:e})}}],[Mode.RUBBER,{draw:function(e){var t=e.sourcePoint,e=e.targetPoint;null!=o&&o.beginPath(),null!=o&&o.moveTo(t.x,t.y),null!=o&&o.lineTo(e.x,e.y),c.push({shape:s,sourcePoint:t,targetPoint:e}),o.lineWidth=15,o.strokeStyle="#fff",o.lineCap="round",o.lineJoin="round",null!=o&&o.stroke()},drawStack:function(e){null!=o&&o.beginPath(),null!=o&&o.moveTo(e.sourcePoint.x,e.sourcePoint.y),null!=o&&o.lineTo(e.targetPoint.x,e.targetPoint.y),o.lineWidth=15,o.strokeStyle="#fff",o.lineCap="round",o.lineJoin="round",null!=o&&o.stroke()},mouseup:function(e){P({sourcePoint:r,targetPoint:e})}}]]);function h(e){var t=e.lineWidth,e=e.strokeStyle;o.lineWidth=t,o.strokeStyle=e,o.lineCap="round",o.lineJoin="round"}function m(e){var t=e.startPoint,e=e.targetPoint,n=g({startPoint:t,targetPoint:e}),l=Math.abs(e.x-t.x),e=Math.abs(e.y-t.y);return[{x:n.x,y:n.y+e},{x:n.x+l/2,y:n.y},{x:n.x+l,y:n.y+e}]}function p(e){var t=e.clientX,e=e.clientY,n=null==(n=null==l?void 0:l.value)?void 0:n.getBoundingClientRect();return{x:t-n.x,y:e-n.y}}function y(e){var t=e.p1,e=e.p2,n=t.x,t=t.y,l=e.x,e=e.y;return Math.sqrt(Math.pow(l-n,2)+Math.pow(e-t,2))}function f(){for(var e=0;e<c.length;e++){var t=c[e];v.get(t.shape).drawStack(t)}}function g(e){var t=e.startPoint,e=e.targetPoint;return e.x<=t.x&&e.y<=t.y?e:e.x<=t.x&&e.y>=t.y?{x:e.x,y:t.y}:e.x>=t.x&&e.y<=t.y?{x:t.x,y:e.y}:e.x>=t.x&&e.y>=t.y?t:void 0}function P(e){var t=e.sourcePoint,e=e.targetPoint;(null==v?void 0:v.get(s)).draw({sourcePoint:t,targetPoint:e})}function x(e){M(e)}function k(e){M(__assign(__assign({},e),{clientX:e.targetTouches[0].clientX,clientY:e.targetTouches[0].clientY}))}function S(e){T(e)}function j(e){T(__assign(__assign({},e),{clientX:e.changedTouches[0].clientX,clientY:e.changedTouches[0].clientY}))}function b(e){W(e)}function w(e){W(__assign(__assign({},e),{clientX:e.targetTouches[0].clientX,clientY:e.targetTouches[0].clientY}))}function W(e){var t=e.clientX,e=e.clientY;u=r=p({clientX:t,clientY:e}),null!=(t=null==n?void 0:n.value)&&t.addEventListener("mousemove",x),null!=(e=null==n?void 0:n.value)&&e.addEventListener("mouseup",S),null!=(t=null==n?void 0:n.value)&&t.addEventListener("touchmove",k),null!=(e=null==n?void 0:n.value)&&e.addEventListener("touchend",j)}function M(e){e=p({clientX:e.clientX,clientY:e.clientY});P({sourcePoint:r,targetPoint:e}),r=e}function T(e){var t,e=p({clientX:e.clientX,clientY:e.clientY});null!=(t=v.get(s))&&t.mouseup(e),(r=u=null)!=(t=null==n?void 0:n.value)&&t.removeEventListener("mousemove",x),null!=(e=null==n?void 0:n.value)&&e.removeEventListener("mouseup",S),null!=(t=null==n?void 0:n.value)&&t.removeEventListener("touchmove",k),null!=(e=null==n?void 0:n.value)&&e.removeEventListener("touchend",j)}return e({setMode:function(e){s=e},setStrokeStyle:function(e){d=e},setLineWidth:function(e){a=e},clear:function(){var e;null!=o&&o.clearRect(0,0,null==(e=null==l?void 0:l.value)?void 0:e.width,null==(e=null==l?void 0:l.value)?void 0:e.height),r=u=null,c=[]},toDataURL:function(){var e;return null==(e=null==l?void 0:l.value)?void 0:e.toDataURL("image/png",1)}}),onMounted(function(){o=null==(e=null==l?void 0:l.value)?void 0:e.getContext("2d");var e=debounce(function(){var e;l.value.width=null==(e=null==n?void 0:n.value)?void 0:e.offsetWidth,l.value.height=null==(e=null==n?void 0:n.value)?void 0:e.offsetHeight,null!=o&&o.clearRect(0,0,null==(e=null==l?void 0:l.value)?void 0:e.width,null==(e=null==l?void 0:l.value)?void 0:e.height),f()},t.resizeTime);null!=(e=null==(i=new ResizeObserver(e))?void 0:i.observe)&&e.call(i,document.body)}),onMounted(function(){var e;null!=(e=null==n?void 0:n.value)&&e.addEventListener("mousedown",b),null!=(e=null==n?void 0:n.value)&&e.addEventListener("touchstart",w)}),onBeforeUnmount(function(){var e;null!=i&&i.disconnect(),null!=(e=null==n?void 0:n.value)&&e.removeEventListener("mousedown",b),null!=(e=null==n?void 0:n.value)&&e.removeEventListener("touchstart",w)}),function(){return _createVNode("div",{ref:n,class:selectorPrefix},[_createVNode("canvas",{ref:l},null)])}}});
//# sourceMappingURL=writingboard.js.map
