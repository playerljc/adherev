"use strict";var errorInfoHandler,warnInfoHandler,__assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var t,a=1,n=arguments.length;a<n;a++)for(var o in t=arguments[a])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},__rest=this&&this.__rest||function(e,t){var a={};for(o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(a[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var n=0,o=Object.getOwnPropertySymbols(e);n<o.length;n++)t.indexOf(o[n])<0&&Object.prototype.propertyIsEnumerable.call(e,o[n])&&(a[o[n]]=e[o[n]]);return a},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},adherev_ui_globalindicator_1=(Object.defineProperty(exports,"__esModule",{value:!0}),__importDefault(require("@baifendian/adherev-ui-globalindicator"))),adherev_util_1=__importDefault(require("@baifendian/adherev-util")),adherev_util_intl_1=__importDefault(require("@baifendian/adherev-util-intl")),ant_design_vue_1=require("ant-design-vue"),trigger402=!1,notificationThrottlingTime=2e3;function errorInfo(e,t){errorInfoHandler&&(clearTimeout(errorInfoHandler),errorInfoHandler=null),errorInfoHandler=setTimeout(function(){ant_design_vue_1.notification.error({message:e,description:t})},notificationThrottlingTime)}function warnInfo(e,t){warnInfoHandler&&(clearTimeout(warnInfoHandler),warnInfoHandler=null),warnInfoHandler=setTimeout(function(){ant_design_vue_1.notification.warn({message:e,description:t})},notificationThrottlingTime)}function createXHR(){return new XMLHttpRequest}function getDefaultConfig(){var t=this;return{timeout:Ajax.TIMEOUT,withCredentials:!0,onLoad:function(){},onLoadsStart:function(){},onLoadend:function(){},onProgress:function(){},onTimeout:function(){warnInfo(adherev_util_intl_1.default.tv("提示"),adherev_util_intl_1.default.tv("请求超时"))},onAbort:function(){warnInfo(adherev_util_intl_1.default.tv("提示"),adherev_util_intl_1.default.tv("请求终止"))},onError:function(){errorInfo(adherev_util_intl_1.default.tv("提示"),adherev_util_intl_1.default.tv("请求发生错误"))},interceptor:function(e){switch(e.status){case 401:deal401.call(t);break;case 402:deal402.call(t);break;default:errorInfo(adherev_util_intl_1.default.tv("提示"),adherev_util_intl_1.default.tv("已提出请求，但未收到任何回复"))}},loading:{show:!1,text:"",el:document.body}}}function initXhrEvents(e,t){var a=t.onTimeout,n=t.onLoadsStart,o=t.onProgress,r=t.onAbort,i=t.onError,l=t.onLoad,t=t.onLoadend;a&&e.addEventListener("timeout",a),n&&e.addEventListener("loadstart",n),o&&e.addEventListener("progress",o),r&&e.addEventListener("abort",r),i&&e.addEventListener("error",i),l&&e.addEventListener("load",l),t&&e.addEventListener("loadend",t)}function resolveData(e){var t=e.show,a=e.data,n=e.indicator;return t?{data:a,hideIndicator:function(){adherev_ui_globalindicator_1.default.hide(n)}}:a}function onreadystatechange(e){var t,a=e.xhr,u=e.interceptor,n=e.loading,o=n.show,n=n.indicator,r=e.business,_=r.messageKey,c=r.codeKey,f=r.codeSuccess,r=r.showWarn,i=e.resolve,e=e.reject,l=a.status,d=a.readyState,s=a.statusText,h=a.response,T=a.responseText;d===Ajax.READY_STATE_DONE&&(200<=l&&l<300||304===l?-1!==(d=a.getResponseHeader("Content-type")).indexOf(Ajax.CONTENT_TYPE_APPLICATION_JSON)?(t=JSON.parse(a.responseText),r&&t[c]!==f&&warnInfo(adherev_util_intl_1.default.tv("提示"),t[_]),i(resolveData({show:o,data:t,indicator:n}))):[Ajax.CONTENT_TYPE_TEXT_XML,Ajax.CONTENT_TYPE_TEXT_XML].includes(d)?i(resolveData({show:o,data:a.responseXML,indicator:n})):i(resolveData({show:o,data:a.response,indicator:n})):(u({status:l,statusText:s,response:h,responseText:T}),l&&e({status:l,statusText:s,response:h,responseText:T}),o&&n&&adherev_ui_globalindicator_1.default.hide(n)))}function sendPrepare(e,t){var u,a,_,c=t.resolve,t=t.reject,f=e.method,h=e.path,n=e.headers,o=e.data,r=e.mock,i=e.loading,T=(e.onBeforeResponse,e.dataKey),T=void 0===T?"data":T,v=e.messageKey,v=void 0===v?"message":v,p=e.codeKey,p=void 0===p?"code":p,E=e.codeSuccess,E=void 0===E?200:E,g=e.showWarn,g=void 0===g||g,e=__rest(e,["method","path","headers","data","mock","loading","onBeforeResponse","dataKey","messageKey","codeKey","codeSuccess","showWarn"]),l="".concat(adherev_util_intl_1.default.tv("加载中"),"..."),d=i.show,m=void 0!==d&&d,d=i.text,i=i.el,i=void 0===i?document.body:i;if(m&&(_=adherev_ui_globalindicator_1.default.show(i||document.body,(void 0===d?l:d)||l)),r)return setTimeout(function(){c(m?{data:h,hideIndicator:function(){adherev_ui_globalindicator_1.default.hide(_)}}:h)},200),{xhr:null,contentType:""};var i=this.baseURL,d=this.config,l=Object.assign(getDefaultConfig.call(this),d,e),r=l.timeout,d=l.withCredentials,e=l.interceptor,l=__rest(l,["timeout","withCredentials","interceptor"]),s=createXHR(),i=(s.open(f,"".concat(i,"/").concat(h),!0),s.timeout=r,s.withCredentials=d,"");if(null!==(r=adherev_util_1.default.isEmpty)&&void 0!==r&&r.call(adherev_util_1.default,n)||null===(a=adherev_util_1.default.isObject)||void 0===a||!a.call(adherev_util_1.default,n))null!==(d=adherev_util_1.default.isEmpty)&&void 0!==d&&d.call(adherev_util_1.default,o)||null===(u=adherev_util_1.default.isRef)||void 0===u||!u.call(adherev_util_1.default,o)||"get"===f||(!("form"in o&&"data"in o)||null!==(r=adherev_util_1.default.isEmpty)&&void 0!==r&&r.call(adherev_util_1.default,o.form)||null!==(a=adherev_util_1.default.isEmpty)&&void 0!==a&&a.call(adherev_util_1.default,o.data)||!(o.form instanceof HTMLFormElement)?(i="".concat(Ajax.CONTENT_TYPE_APPLICATION_JSON,";charset=utf-8"),s.setRequestHeader("Content-Type","".concat(Ajax.CONTENT_TYPE_APPLICATION_JSON,";charset=utf-8"))):i=Ajax.CONTENT_TYPE_MULTIPART_FORM_DATA);else for(var O in"Content-type"in n||"get"===f||(n["Content-Type"]="".concat(Ajax.CONTENT_TYPE_APPLICATION_JSON,";charset=utf-8"),i=n["Content-Type"]),n)s.setRequestHeader(O,n[O]);return initXhrEvents(s,l),s.onreadystatechange=onreadystatechange.bind(this,{xhr:s,interceptor:e,loading:{show:m,indicator:_},business:{dataKey:T,messageKey:v,codeKey:p,codeSuccess:E,showWarn:g},resolve:c,reject:t}),{xhr:s,contentType:i}}function getSendParams(e){var t,a,n,o,r=e.data,e=e.contentType;return 0===(e=e||"").indexOf(Ajax.CONTENT_TYPE_APPLICATION_JSON)&&null!==(t=adherev_util_1.default.isRef)&&void 0!==t&&t.call(adherev_util_1.default,r)?JSON.stringify(r):0===e.indexOf(Ajax.CONTENT_TYPE_APPLICATION_X_WWW_FORM_URLENCODED)&&null!==(a=adherev_util_1.default.isObject)&&void 0!==a&&a.call(adherev_util_1.default,r)?Array.from(Object.keys(r)).map(function(e){return encodeURIComponent("".concat(e,"=").concat(r[e]))}).join("&"):0===e.indexOf(Ajax.CONTENT_TYPE_MULTIPART_FORM_DATA)&&null!==(n=adherev_util_1.default.isObject)&&void 0!==n&&n.call(adherev_util_1.default,r)?(o=new FormData(r.form),Array.from(Object.keys(r.data)).forEach(function(e){o.append(e,r.data[e])}),o):void 0}function complexRequest(a,n){var o=this;return new Promise(function(e,t){e=sendPrepare.call(o,__assign(__assign(__assign(__assign({},getDefaultConfig.call(o)),o.config),{method:a}),n),{resolve:e,reject:t}),t=e.xhr,e=e.contentType;t&&t.send(getSendParams.call(o,{data:n.data,contentType:e}))})}function deal401(){var e;if(window.top&&window.top!==window&&window.top.postMessage("http_status_401","*"),trigger402)return!1;window.location.href=null===(e=adherev_util_1.default.casUrl)||void 0===e?void 0:e.call(adherev_util_1.default,{baseUrl:this.systemManagerBaseURL,enterUrl:window.location.href})}function deal402(){var e;if(trigger402=!0,window.parent&&window.parent!==window)return window.parent.postMessage("http_status_402","*"),!1;window.location.href=null===(e=adherev_util_1.default.casLogoutUrl)||void 0===e?void 0:e.call(adherev_util_1.default,{baseUrl:this.systemManagerBaseURL,enterUrl:window.location.href,params:"&code=402"})}var Ajax=function(){function e(e,t,a){this.baseURL=e||"",this.systemManagerBaseURL=t||"",this.config=a||{}}return e.prototype.get=function(e){var a=this,n=(e.data,__rest(e,["data"]));return new Promise(function(e,t){e=sendPrepare.call(a,__assign(__assign(__assign(__assign({},getDefaultConfig.call(a)),a.config),{method:"get"}),n),{resolve:e,reject:t}).xhr;e&&e.send(null)})},e.prototype.post=function(e){return complexRequest.call(this,"post",e)},e.prototype.path=function(e){return complexRequest.call(this,"path",e)},e.prototype.put=function(e){return complexRequest.call(this,"put",e)},e.prototype.delete=function(e){return complexRequest.call(this,"delete",e)},e.TIMEOUT=1e6,e.STATUS_SUCCESS_CODES=[200,201,202,203,204,205,206,207,208,226],e.STATUS_REDIRECT_CODES=[300,301,302,303,304,305,306,307,308],e.READY_STATE_UNSENT=0,e.READY_STATE_OPENED=1,e.READY_STATE_HEADERS_RECEIVED=2,e.READY_STATE_LOADING=3,e.READY_STATE_DONE=4,e.CONTENT_TYPE_APPLICATION_JSON="application/json",e.CONTENT_TYPE_MULTIPART_FORM_DATA="multipart/form-data",e.CONTENT_TYPE_APPLICATION_X_WWW_FORM_URLENCODED="application/x-www-form-urlencoded",e.CONTENT_TYPE_TEXT_XML="text/xml",e.CONTENT_TYPE_APPLICATION_XML="application/xml",e.CONTENT_TYPE_TEXT_PLAIN="text/plain",e}();exports.default=Ajax;
//# sourceMappingURL=ajax.js.map
