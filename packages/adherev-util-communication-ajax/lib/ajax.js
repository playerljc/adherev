"use strict";require("core-js/modules/es.object.assign.js"),require("core-js/modules/es.array.index-of.js"),require("core-js/modules/es.symbol.js"),require("core-js/modules/es.object.define-property.js"),require("core-js/modules/es.object.to-string.js"),require("core-js/modules/es.promise.js"),require("core-js/modules/es.array.includes.js"),require("core-js/modules/es.string.includes.js"),require("core-js/modules/es.array.concat.js"),require("core-js/modules/es.string.starts-with.js"),require("core-js/modules/es.array.map.js"),require("core-js/modules/es.array.from.js"),require("core-js/modules/es.string.iterator.js"),require("core-js/modules/es.object.keys.js"),require("core-js/modules/web.dom-collections.for-each.js"),require("core-js/modules/es.regexp.to-string.js");var errorInfoHandler,warnInfoHandler,__assign=function(){return(__assign=Object.assign||function(e){for(var t,a=1,r=arguments.length;a<r;a++)for(var n in t=arguments[a])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},__rest=function(e,t){var a={};for(n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(a[n[r]]=e[n[r]]);return a},__importDefault=function(e){return e&&e.__esModule?e:{default:e}},ant_design_vue_1=(Object.defineProperty(exports,"__esModule",{value:!0}),require("ant-design-vue")),adherev_ui_globalindicator_1=__importDefault(require("@baifendian/adherev-ui-globalindicator")),adherev_util_1=__importDefault(require("@baifendian/adherev-util")),adherev_util_intl_1=__importDefault(require("@baifendian/adherev-util-intl")),trigger402=!1,notificationThrottlingTime=2e3,Ajax=function(){function e(e,t,a){this.baseURL=e||"",this.systemManagerBaseURL=t||"",this.config=a||{}}return e.prototype.get=function(e){var a=this,r=(e.data,__rest(e,["data"]));return new Promise(function(e,t){e=sendPrepare.call(a,__assign(__assign(__assign(__assign({},getDefaultConfig.call(a)),a.config),{method:"get"}),r),{resolve:e,reject:t}).xhr;e&&e.send(null)})},e.prototype.post=function(e){return complexRequest.call(this,"post",e)},e.prototype.path=function(e){return complexRequest.call(this,"path",e)},e.prototype.put=function(e){return complexRequest.call(this,"put",e)},e.prototype.delete=function(e){return complexRequest.call(this,"delete",e)},e.TIMEOUT=1e6,e.STATUS_SUCCESS_CODES=[200,201,202,203,204,205,206,207,208,226],e.STATUS_REDIRECT_CODES=[300,301,302,303,304,305,306,307,308],e.READY_STATE_UNSENT=0,e.READY_STATE_OPENED=1,e.READY_STATE_HEADERS_RECEIVED=2,e.READY_STATE_LOADING=3,e.READY_STATE_DONE=4,e.CONTENT_TYPE_APPLICATION_JSON="application/json",e.CONTENT_TYPE_MULTIPART_FORM_DATA="multipart/form-data",e.CONTENT_TYPE_APPLICATION_X_WWW_FORM_URLENCODED="application/x-www-form-urlencoded",e.CONTENT_TYPE_TEXT_XML="text/xml",e.CONTENT_TYPE_APPLICATION_XML="application/xml",e.CONTENT_TYPE_TEXT_PLAIN="text/plain",e}();function errorInfo(e,t){errorInfoHandler&&(clearTimeout(errorInfoHandler),errorInfoHandler=null),errorInfoHandler=setTimeout(function(){ant_design_vue_1.notification.error({message:e,description:t})},notificationThrottlingTime)}function warnInfo(e,t){warnInfoHandler&&(clearTimeout(warnInfoHandler),warnInfoHandler=null),warnInfoHandler=setTimeout(function(){ant_design_vue_1.notification.warn({message:e,description:t})},notificationThrottlingTime)}function createXHR(){return new XMLHttpRequest}function getDefaultConfig(){var t=this;return{timeout:Ajax.TIMEOUT,withCredentials:!0,onLoad:function(){},onLoadsStart:function(){},onLoadend:function(){},onProgress:function(){},onTimeout:function(){warnInfo(adherev_util_intl_1.default.tv("提示"),adherev_util_intl_1.default.tv("请求超时"))},onAbort:function(){warnInfo(adherev_util_intl_1.default.tv("提示"),adherev_util_intl_1.default.tv("请求终止"))},onError:function(){errorInfo(adherev_util_intl_1.default.tv("提示"),adherev_util_intl_1.default.tv("请求发生错误"))},interceptor:function(e){switch(e.status){case 401:deal401.call(t);break;case 402:deal402.call(t);break;default:errorInfo(adherev_util_intl_1.default.tv("提示"),adherev_util_intl_1.default.tv("已提出请求，但未收到任何回复"))}},mock:!1,loading:{show:!1,text:"",el:document.body},onBeforeResponse:function(){},dataKey:"data",messageKey:"message",codeKey:"code",codeSuccess:200,showWarn:!0,responseType:""}}function initXhrEvents(e,t){var a=t.onTimeout,r=t.onLoadsStart,n=t.onProgress,o=t.onAbort,i=t.onError,s=t.onLoad,t=t.onLoadend;a&&e.addEventListener("timeout",a),r&&e.addEventListener("loadstart",r),n&&e.addEventListener("progress",n),o&&e.addEventListener("abort",o),i&&e.addEventListener("error",i),s&&e.addEventListener("load",s),t&&e.addEventListener("loadend",t)}function resolveData(e){var t=e.show,a=e.data,r=e.indicator,e=e.xhr;return __assign({xhr:e,data:a},t?{hideIndicator:function(){return adherev_ui_globalindicator_1.default.hide(r)}}:{})}function onreadystatechange(e){var t,a,r=e.xhr,n=e.interceptor,o=e.loading,i=o.show,o=o.indicator,s=e.business,l=s.messageKey,d=s.codeKey,u=s.codeSuccess,s=s.showWarn,_=e.resolve,e=e.reject;r.readyState===Ajax.READY_STATE_DONE&&(200<=r.status&&r.status<300||304===r.status?-1!==(t=r.getResponseHeader("Content-type")).indexOf(Ajax.CONTENT_TYPE_APPLICATION_JSON)?(a=JSON.parse(r.responseText),s&&d in a&&a[d]!==u&&warnInfo(adherev_util_intl_1.default.v("提示"),a[l]),_(resolveData({show:i,data:a,indicator:o,xhr:r}))):[Ajax.CONTENT_TYPE_TEXT_XML,Ajax.CONTENT_TYPE_TEXT_XML].includes(t)?_(resolveData({show:i,data:r.responseXML,indicator:o,xhr:r})):_(resolveData({show:i,data:r.response,indicator:o,xhr:r})):(n({status:r.status,statusText:r.statusText,response:r.response,responseText:r.responseText}),r.status&&e({status:r.status,statusText:r.statusText,response:r.response,responseText:r.responseText}),i&&o&&adherev_ui_globalindicator_1.default.hide(o)))}function isMultipartFormData(e){var t;return e&&"form"in e&&"data"in e&&(null==(t=null===adherev_util_1.default||void 0===adherev_util_1.default?void 0:adherev_util_1.default.isEmpty)?void 0:t.call(adherev_util_1.default,e.form))&&(null==(t=null===adherev_util_1.default||void 0===adherev_util_1.default?void 0:adherev_util_1.default.isEmpty)?void 0:t.call(adherev_util_1.default,e.data))&&e.form instanceof HTMLFormElement}function sendPrepare(e,t){var a,r=e.method,n=e.path,o=e.headers,i=e.data,s=e.mock,l=e.loading,d=(e.onBeforeResponse,e.dataKey),d=void 0===d?"data":d,u=e.messageKey,u=void 0===u?"message":u,_=e.codeKey,_=void 0===_?"code":_,c=e.codeSuccess,c=void 0===c?200:c,f=e.showWarn,f=void 0===f||f,e=__rest(e,["method","path","headers","data","mock","loading","onBeforeResponse","dataKey","messageKey","codeKey","codeSuccess","showWarn"]),h=t.resolve,t=t.reject,v="".concat(adherev_util_intl_1.default.tv("加载中"),"..."),T=l.show,p=void 0!==T&&T,T=l.text,l=l.el,l=void 0===l?document.body:l;if(p&&(a=adherev_ui_globalindicator_1.default.show(l||document.body,(void 0===T?v:T)||v,1e3)),s)return setTimeout(function(){h(p?{data:n,hideIndicator:function(){adherev_ui_globalindicator_1.default.hide(a)}}:n)},200),{xhr:null,contentType:""};var l=this.baseURL,T=this.config,v=Object.assign(getDefaultConfig.call(this),T,e),s=v.timeout,T=v.withCredentials,e=v.responseType,m=v.interceptor,v=__rest(v,["timeout","withCredentials","responseType","interceptor"]),g=createXHR(),l=(g.open(r,"".concat(l,"/").concat(n),!0),g.timeout=s,g.withCredentials=T||!0,g.responseType=e||"","");if(null!=(s=null===adherev_util_1.default||void 0===adherev_util_1.default?void 0:adherev_util_1.default.isEmpty)&&s.call(adherev_util_1.default,o)&&null!=(T=null===adherev_util_1.default||void 0===adherev_util_1.default?void 0:adherev_util_1.default.isObject)&&T.call(adherev_util_1.default,o))for(var E in"Content-Type"in o||isMultipartFormData(i)||(o["Content-Type"]="".concat(Ajax.CONTENT_TYPE_APPLICATION_JSON,";charset=utf-8")),l=null!=(e=o["Content-Type"])?e:"",o)g.setRequestHeader(E,o[E]);else null!=(s=null===adherev_util_1.default||void 0===adherev_util_1.default?void 0:adherev_util_1.default.isEmpty)&&s.call(adherev_util_1.default,i)&&null!=(T=null===adherev_util_1.default||void 0===adherev_util_1.default?void 0:adherev_util_1.default.isRef)&&T.call(adherev_util_1.default,i)&&"get"!==r&&(isMultipartFormData(i)?l=Ajax.CONTENT_TYPE_MULTIPART_FORM_DATA:(l="".concat(Ajax.CONTENT_TYPE_APPLICATION_JSON,";charset=utf-8"),g.setRequestHeader("Content-Type","".concat(Ajax.CONTENT_TYPE_APPLICATION_JSON,";charset=utf-8"))));return initXhrEvents(g,v),g.onreadystatechange=onreadystatechange.bind(this,{xhr:g,interceptor:m,loading:{show:p,indicator:a},business:{dataKey:d,messageKey:u,codeKey:_,codeSuccess:c,showWarn:f},resolve:h,reject:t}),{xhr:g,contentType:l}}function getSendParams(e){var t,a,r=e.data,e=e.contentType,e=void 0===e?"":e;if(e.startsWith(Ajax.CONTENT_TYPE_APPLICATION_JSON)&&null!=(t=null===adherev_util_1.default||void 0===adherev_util_1.default?void 0:adherev_util_1.default.isRef)&&t.call(adherev_util_1.default,r))return JSON.stringify(r);if(e.startsWith(Ajax.CONTENT_TYPE_APPLICATION_X_WWW_FORM_URLENCODED)&&null!=(t=null===adherev_util_1.default||void 0===adherev_util_1.default?void 0:adherev_util_1.default.isObject)&&t.call(adherev_util_1.default,r))return Array.from(Object.keys(r)).map(function(e){return"".concat(e,"=").concat(encodeURIComponent(r[e]))}).join("&");if(null!=(t=null===adherev_util_1.default||void 0===adherev_util_1.default?void 0:adherev_util_1.default.isObject)&&t.call(adherev_util_1.default,r)&&isMultipartFormData(r))return a=new FormData(r.form),Array.from(Object.keys(r.data)).forEach(function(e){a.append(e,r.data[e])}),a;if(e.startsWith(Ajax.CONTENT_TYPE_TEXT_PLAIN)){if(null!=(t=null===adherev_util_1.default||void 0===adherev_util_1.default?void 0:adherev_util_1.default.isString)&&t.call(adherev_util_1.default,r))return r;if(null!=(e=null===adherev_util_1.default||void 0===adherev_util_1.default?void 0:adherev_util_1.default.isObject)&&e.call(adherev_util_1.default,r))return JSON.stringify(r)}return r.toString()}function complexRequest(a,r){var n=this;return new Promise(function(e,t){e=sendPrepare.call(n,__assign(__assign(__assign(__assign({},getDefaultConfig.call(n)),n.config),{method:a}),r),{resolve:e,reject:t}),t=e.xhr,e=e.contentType;t&&t.send(getSendParams.call(n,{data:r.data,contentType:e}))})}function deal401(){if("undefined"!=typeof window){if(window.top&&window.top!==window&&window.top.postMessage("http_status_401","*"),trigger402)return!1;window.location.href=adherev_util_1.default.casUrl({baseUrl:this.systemManagerBaseURL,enterUrl:window.location.href})}}function deal402(){if(trigger402=!0,"undefined"!=typeof window)return window.parent&&window.parent!==window?(window.parent.postMessage("http_status_402","*"),!1):void(window.location.href=adherev_util_1.default.casLogoutUrl({baseUrl:this.systemManagerBaseURL,enterUrl:window.location.href,params:"&code=402"}))}exports.default=Ajax;
//# sourceMappingURL=ajax.js.map
